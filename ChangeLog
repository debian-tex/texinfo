2024-12-23  Gavin Smith <gavinsmith0123@gmail.com>

	7.2

	* NEWS: version and date.

2024-12-23  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/maintain/regenerate_documentlanguages-loc.pl:
	Exclude duplicate country codes as both Denmark and the Kingdom
	of Denmark have the same code.

2024-12-22  Gavin Smith <gavinsmith0123@gmail.com>

	* man/info.5, man/texinfo.5: 2024.

2024-12-22  Gavin Smith <gavinsmith0123@gmail.com>

	* INSTALL: mention --enable-xs-perl-libintl for musl.  From Patrice.
	* README-hacking: reminder to check configure flags in INSTALL

2024-12-20  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Customization Variables and Options):
	Place options in alphabetical order.

2024-12-20  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (HTML Customization Variables List):
	Change @vtable to @table to avoid duplicate index entries
	for customization variables.

2024-12-20  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (HTML Output Structure Customization):
	Add USE_NODE_DIRECTIONS as this is only documented in
	"HTML Customization Variables List".
	(HTML Customization Variables List) <USE_NODE_DIRECTIONS>:
	Fix punctuation.

2024-12-20  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo-tex-test.texi (Test of macros with @ in index):
	Enable section as we now use @ in index files.

2024-12-20  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo-tex-test.texi (Nested URL, URL): rename and
	move earlier.

2024-12-20  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo-tex-test.texi (Test of characters in section title):
	Move nearer end of file.

2024-12-20  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo-tex-test.texi (Code quote):
	Label examples.

2024-12-20  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo-tex-test.texi (@set and @value, Copying):
	Show expected results.

2024-12-20  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo-tex-test.texi
	(Cross-references, Test of auxiliary files):
	Move to end of file.

2024-12-20  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo-tex-test.texi (Test of non-alphanumeric characters):
	Move next to "Glyph commands".

2024-12-20  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo-tex-test.texi (Trim whitespace from macro arguments):
	Show expected results.

2024-12-20  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo-tex-test.texi
	(Images, Open or close a group in a macro)
	(Braceless at end of line):
	Adjust test cases/instructions slightly.

2024-12-20  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: adjust discussion of building for valgrind slightly

2024-12-19  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: remove note to check groff.texinfo.

2024-12-19  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: mention CFLAGS='-g -O0' to prevent false
	positives for valgrind.

2024-12-19  Gavin Smith <gavinsmith0123@gmail.com>

	* install-info/tests/defs.in: adjust valgrind invocation to
	report on memory leaks and use a log file

2024-12-19  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: tweak instructions for checking with valgrind
	* info/t/Init-test.inc: 2024

2024-12-17  Gavin Smith <gavinsmith0123@gmail.com>

	Bump version to 7.2

	* configure.ac,
	* doc/refcard/txirefcard.tex,
	* js/info.js,
	* util/texi2dvi,
	* util/texi2pdf: change version to 7.2

2024-12-16  Patrice Dumas  <pertusus@free.fr>

	* configure.ac, tp/Texinfo/XS/configure.ac: add comments and TODO
	describing that --enable-xs-perl-libintl can be useful on platforms
	where gettext functions are present, but setting the locale through
	LANGUAGE is not implemented, as is the case for musl.

2024-12-16  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (small): mention that @small... commands
	do not take arguments.

2024-12-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/translations.c (translate_string): if ENABLE_NLS
	is not set, remove completly the code calling functions in include
	files included only if ENABLE_NLS is set.

	* tp/Texinfo/XS/main/translations.c
	(configure_output_strings_translations): unindent cpp directives for
	consistency.

2024-12-15  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl (set_subdir_directories): correct first directory.

2024-12-15  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl (add_config_paths): remove a spurious subdir in
	@xdg_result_dirs.  Also distinguish deprecated_dir and
	deprecated_result_dir to check if deprecated_dir is in
	used_xdg_base_dirs and put it in used_base_dirs.

2024-12-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (locate_include_file): remove comments, move
	code to where the variables are used.

2024-12-15  Patrice Dumas  <pertusus@free.fr>

	Unconditionally use / as directory separator

	* tp/texi2any.pl,
	* tp/Texinfo/ModulePath.pm.in (init),
	* tp/Texinfo/Common.pm
	(locate_file_in_dirs, locate_include_file),
	* tp/Texinfo/Convert/Converter.pm
	(set_file_path, determine_files_and_directory),
	* tp/Texinfo/Convert/HTML.pm
	(_load_htmlxref_files, _do_jslicenses_file, _do_js_files)
	(_node_redirections),
	* tp/Texinfo/Convert/Plaintext.pm (output),
	* tp/Texinfo/Convert/Text.pm (output),
	* tp/ext/epub3.pm
	(epub_convert_image_command, epub_setup, epub_finish),
	* tp/ext/latex2html.pm
	(l2h_process, l2h_retrieve_from_html, l2h_init_cache, l2h_from_cache),
	* tp/ext/tex4ht.pm (tex4ht_prepare),
	* tp/init/chm.pm (chm_init),
	* tp/t/test_utils.pl:
	Concatenate directory components of file
	name with '/' separator rather than calling File::Spec->catdir.

2024-12-13  Gavin Smith <gavinsmith0123@gmail.com>

	pretest 7.1.92

2024-12-12  Carlos Maniero  <carlos@maniero.me>  (tiny change)

	* tp/ext/highlight_syntax.pm: show warning if HIGHLIGHT_SYNTAX is
	set to unknown value.
	* tp/tests/other/list-of-tests: set HIGHLIGHT_SYNTAX=source-highlight

2024-12-11  Gavin Smith <gavinsmith0123@gmail.com>

	* configure.ac: remove reference to gnulib/po subdirectory

2024-12-11  Gavin Smith <gavinsmith0123@gmail.com>

	Use new method for gnulib translations

	* info/info.c (main),
	* install-info/install-info.c (main):
	Call bindtextdomain for gnulib domain.

2024-12-11  Gavin Smith <gavinsmith0123@gmail.com>

	Excise gnulib/po

	* Makefile.am (update-po): Do not run in tp/Texinfo/XS/gnulib/po
	directory.
	* gnulib/lib/Makefile.am: rm --po-base and --po-domain
	options to gnulib-tool.

	* configure.ac, Makefile.am:
	remove reference to gnulib/po subdirectory.

	* info/info.c (main),
	* install-info/install-info.c (main):
	Do not call bindtextdomain for gnulib domain.

	* gnulib/po: delete entire directory

	* README-hacking: update

2024-12-11  Gavin Smith <gavinsmith0123@gmail.com>

	* (top-level), tp/Texinfo/XS: run gnulib-tool --add-import

2024-12-11  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/tests/formatting/list-of-tests (cpp_lines):
	Set DOC_ENCODING_FOR_INPUT_FILE_NAME instead of
	INPUT_FILE_NAME_ENCODING.  From Patrice.

2024-12-10  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/pod2texi.pl (_parsed_manual_tree): rename
	variable.

2024-12-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/transformations.c
	(fill_gaps_in_sectioning): set new section parent.  Report on
	debug message from Eli.

2024-12-10  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/tests/formatting/list-of-tests (cpp_lines):
	Add "-c INPUT_FILE_NAME_ENCODING=UTF-8".  This prevents a test
	failure when the encoding is set to something else by default, e.g.
	Windows-1252.  Report from Eli.

2024-12-10  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/pod2texi.pl: use / in generated Texinfo code
	@include.  Report fom Eli and solution from Gavin.

2024-12-10  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/tests/run_parser_all.sh (post_process_output):
	Delete some lines from output that may have directory
	components in file names in order to avoid divergent test
	output on MS-Windows where a backslash might be used as
	the directory separator.  Report from Eli.

2024-12-10  Gavin Smith <gavinsmith0123@gmail.com>

	Correct spelling

	* texi2any (merge_opened_files),
	* tp/Texinfo/Convert/HTML.pm (_do_jslicenses_file)
	* tp/Texinfo/Convert/Utils.pm (output_files_disable_output_encoding),
	* tp/Texinfo/XS/convert/convert_html.c (do_jslicenses_file),
	* tp/Texinfo/XS/main/convert_utils.c (output_files_open_out):
	Correct spelling of "overwriting".

2024-12-09  Gavin Smith <gavinsmith0123@gmail.com>

	Excise tp/Texinfo/XS/gnulib/po

	* Makefile.am (update-po): Do not run in tp/Texinfo/XS/gnulib/po
	directory.
	* tp/Texinfo/XS/gnulib/lib/Makefile.am: rm --po-base and --po-domain
	options to gnulib-tool.

	* tp/Texinfo/XS/configure.ac, tp/Texinfo/XS/Makefile.am:
	remove reference to gnulib/po subdirectory.

	* tp/Texinfo/XS/main/utils.c (messages_and_encodings_setup):
	Do not call bindtextdomain for gnulib domain.
	* tp/Texinfo/XS/gnulib/po: delete entire directory

	This gnulib checkout does not actually use any translated strings
	at present so does not need its own translation domain.  In the
	future, an alternative method is recommended for gnulib translations
	that we should use instead if needed.

	(See
	https://lists.gnu.org/archive/html/bug-gnulib/2024-12/msg00042.html
	and
	https://lists.gnu.org/archive/html/bug-gnulib/2024-12/msg00043.html.)

2024-12-08  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/api.c: remove unneeded <dirent.h> include.

2024-12-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c: update comment on Perl/C
	library plus Gnulib mixing to make clearer that there would be
	incompatibilities between Perl and C library memory management
	functions even without Gnulib.

2024-12-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (C_libtexinfo_sources),
	tp/Texinfo/XS/main/create_buttons.c: move create_buttons.c from
	convert to main, and from C_libtexinfo_convert_sources to
	C_libtexinfo_sources.

	* tp/Texinfo/XS/main/create_buttons.c (new_button_specification_info):
	add.

	* tp/Texinfo/XS/main/get_perl_info.c: remove
	get_sv_index_entries_sorted_by_letter, it is not used and uses Perl
	malloc.

	* tp/Texinfo/XS/main/get_perl_info.c
	(html_get_button_specification_list): call
	new_button_specification_list and new_button_specification_info.

	* tp/Texinfo/XS/convert/get_converter_perl_info.c,
	tp/Texinfo/XS/convert/get_html_perl_info.c,
	tp/Texinfo/XS/main/get_perl_info.c (get_source_info): use
	non_perl_malloc instead of malloc when allocating data kept in the
	converter and unallocated outside of code including Perl headers.

2024-12-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (create_destination_directory),
	tp/Texinfo/XS/convert/texinfo.c (txi_general_setup),
	tp/Texinfo/XS/main/utils.h (S_ISDIR): use stat instead of opendir to
	check if a directory exists, as some implementations of opendir may
	not fail even if the directory does not exist.  Report from Eli.

2024-12-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs,
	tp/Texinfo/XS/convert/build_html_perl_info.c,
	tp/Texinfo/XS/main/get_perl_info.c: use non_perl_free instead of free
	to free variables allocated outside of Perl C code.

2024-12-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (build_perl_array)
	(build_perl_const_element_array, build_perl_directions)
	(build_additional_info, build_indices_sort_strings)
	(build_sorted_indices_by_index, build_sorted_indices_by_letter)
	(output_unit_to_perl_hash, html_build_button): use non_perl_free to
	free a string allocated by xasprintf (from utils.c) or from
	print_element_debug (from errors.c), to avoid mixxing Perl/non Perl
	memory management functions.  Based on a report from Eli.

2024-12-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_convert_la_CPPFLAGS): remove
	XSLIBS_CPPFLAGS they should not be needed and break build on MinGW as
	Perl CORE/dirent.h is found, which does not define opendir.  Remove
	libtexinfo_convert_la_CFLAGS. Report from Eli.

2024-12-08  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/TestXS.xs: remove <config.h> include to
	avoid possible clash with redefinition of uid_t and gid_t
	in Perl header files.  Report from Eli.

2023-12-08  Eli Zaretskii <eliz@gnu.org>

	* tp/Texinfo/XS/main/build_perl_info.c
	(perl_only_free, perl_only_malloc),
	* tp/Texinfo/XS/main/get_perl_info.c (get_sv_output_units)
	(init_copy_sv_options): Add missing dTHX.

2024-12-06  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: adjust instructions for updating translations
	slightly.

2024-12-06  Gavin Smith <gavinsmith0123@gmail.com>

	* Makefile.am (update-po): Also run update-po in gnulib
	subdirectories.

2024-12-06  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/gnulib/po/Makevars (XGETTEXT_OPTIONS):
	patch to add --force-po as this gnulib import does not at present
	actually have any translatable strings.

2024-12-04  Gavin Smith <gavinsmith0123@gmail.com>

	* configure.ac: bump version to 7.1.92

2024-12-04  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo-tex-test.texi (Images) [dvi output]: disable.

2024-12-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/teximakehtml.c: include langinfo.h and call
	nl_langinfo only if HAVE_LANGINFO_CODESET is set.

	* tp/Texinfo/XS/teximakehtml.c (main): move code setting directories
	before command-line parsing.

2024-12-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (converter_converter): apply
	directly user_conf argument instead of copying first.
	Add const.

	* tp/Texinfo/XS/convert/converter.c
	(copy_converter_initialization_info): copy translated_commands too.

2024-12-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (copy_translated_commands)
	(apply_converter_info): add copy_translated_commands to copy
	translated_commands list.  Copy translated_commands in
	apply_converter_info instead of passing the argument
	translated_commands list.

	* tp/Texinfo/XS/main/build_perl_info.c
	(build_sv_options_from_options_list): use size_t instead of int.

2024-12-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (new_converter)
	(set_converter_init_information): call init_generic_converter in
	set_converter_init_information, not in new_converter, such that
	new_converter only allocate the converter.  Also it is more similar to
	Perl code.

2024-12-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (MiscXS_la_SOURCES),
	tp/Texinfo/XS/xsmisc.c, tp/Texinfo/XS/xsmisc.h: rename
	tp/Texinfo/XS/misc.c as xsmisc.c and tp/Texinfo/XS/miscxs.h as
	xsmisc.h.

2024-12-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/MiscXS.xs (xs_unicode_text), tp/Texinfo/XS/misc.c
	(xs_unicode_substitute_text): handle in_code in MiscXS.xs, remove
	in_code argument from xs_unicode_text in misc.c.  Rename
	xs_unicode_text in misc.c to xs_unicode_substitute_text to make clear
	that it is not exactly the same as the Perl function, as it does the
	substitution but does not handle in_code.

	* tp/Texinfo/XS/misc.c: remove unused whitespace_chars.

2024-12-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/misc.c: add const.

2024-12-03  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: mention libtool version

2024-12-03  Gavin Smith <gavinsmith0123@gmail.com>

	Remove stdbool.h include

	* tp/Texinfo/XS/main/manipulate_tree.c,
	* tp/Texinfo/XS/main/unicode.c,
	* tp/Texinfo/XS/main/utils.c,
	* tp/Texinfo/XS/parsetexi/def.c,
	* tp/Texinfo/XS/structuring_transfo/transformations.c:
	Remove stdbool.h include as it appears to be unnecessary and
	possibly causes a compilation error on Solaris 10.4.

2024-12-02  Patrice Dumas  <pertusus@free.fr>

	* configure.ac: remove USE_UNICODE, it is not used anywhere.

	* tp/Texinfo/XS/configure.ac: do not set GL_GNULIB_MDA_* anymore,
	there should not be any case where Perl and Gnulib headers are used
	together.

2024-12-02  Patrice Dumas  <pertusus@free.fr>

	* configure.ac: remove check for prove, prove is not used in tests
	anymore.

2024-12-01  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/Changes: point to GNU Texinfo main ChangeLog.

	* Pod-Simple-Texinfo/prove.sh: sync with tp/prove.sh.

2024-12-01  Patrice Dumas  <pertusus@free.fr>

	* configure.ac (prefer_libintl_perl), tp/Texinfo/XS/configure.ac
	(use_libintl_perl_in_xs): fix typo in variable names.  Report from Ken
	Brown.

2024-12-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm: add parentheses for define call.  Change
	in spacing.

2024-12-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/misc.c (xs_parse_texi_regex): return early if there is
	a NUL in the string, and do not set any output variable.

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line): handle
	better NUL characters in $line, which can happen with
	_parse_texi_regex XS override.

2024-12-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_starting_block)
	(_process_remaining_on_line): check if a command name is defined
	instead of testing if it is true, to catch the case of a command name
	or alias being '0'.

	* tp/Makefile.tres, tp/t/02coverage.t (command_zero), tp/t/58alias.t
	(alias_zero), tp/t/60macro.t (macro_name_zero): test unknown command,
	alias and macro name be '0'.

2024-12-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/configure.ac: add a comment explaining that the issue
	--enable-xs-perl-libintl worked around is fixed.

2024-12-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XSLoader.pm (init): do not fallback if additional
	libraries are not found and texi2any libraries are installed.  Indeed,
	in that case, there could be RUNPATH or similar pointing to the
	installation directory in the XS modules objects themselves, so the
	libraries can still be found if the libraries .la are not found.

2024-12-01  Gavin Smith <gavinsmith0123@gmail.com>

	Set LC_MESSAGES via setenv before setlocale.

	* tp/Texinfo/XS/main/translations.c (switch_messages_locale):
	Set LC_ALL with setenv instead of LC_MESSAGES.
	(translate_string): Save and restore LC_ALL in environment.

2024-12-01  Gavin Smith <gavinsmith0123@gmail.com>

	Set LC_MESSAGES via setenv before setlocale.

	* tp/Texinfo/XS/main/translations.c (switch_messages_locale):
	Set "LC_MESSAGES" via setenv before setlocale (LC_MESSAGES, ""),
	rather than giving the locale name as the second argument to
	setlocale, as this may not work on some platforms including
	macOS, Windows, AIX, and OpenBSD.  Info from Bruno Haible.

2024-11-28  Patrice Dumas  <pertusus@free.fr>

	* tp/t/same_parser_multiple_files.t: set locale to C and LANGUAGE to
	en for reproducible tests.

2024-11-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/texinfo.c (txi_general_setup),
	tp/Texinfo/XS/teximakehtml.c (main): do not get locales directory for
	output strings domain from argument, determine it as in texi2any.pl.

	* tp/Texinfo/XS/teximakehtml.c (enum teximakehtml_mode)
	(demo_parser_EXPANDED_FORMATS, main): consider 4 run modes, default to
	mimick texi2any, test corresponding to TEST set, but no mimicking of
	texi2any, 'mimick test' with both TEST set and mimicking of texi2any
	and demo.  Add command-line options to set the different modes.

	* tp/Texinfo/XS/teximakehtml.c (main): set PACKAGE_* for tests run
	modes as in texi2any.pl.

2024-11-26  Patrice Dumas  <pertusus@free.fr>

	* configure.ac (--enable-xs-perl-libintl), tp/Texinfo/XS/configure.ac
	(--enable-xs-perl-libintl, USE_LIBINTL_PERL_IN_XS),
	tp/Texinfo/XS/main/translations.c
	(configure_output_strings_translations): add an explicit configure
	command-line switch to prefer calling libintl-perl from XS code.  Set
	it if $usable_getenv_in_XS is no.  Use USE_LIBINTL_PERL_IN_XS instead
	of HAVE_USABLE_GETENV_IN_XS in configure_output_strings_translations
	to determine the default for use_external_translate_string.

2024-11-26  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Internationalization of Document Strings): move
	details on libintl implementations used to the end, and update to be
	clearer now that there is also a C implementation.
	Describe that braced argument for varying parts of the strings are
	used before telling that %s is not used.
	Remove argument on Perl version, we require that version already.
	Put in an @ignore block the justification of using braced argument for
	variable strings, there is no need for a justification.  
	Remove the point on encoding, it is not important nowadays that UTF-8
	is generally used.

2024-11-26  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (@definfoenclose, Generating HTML)
	(HTML Features Customization): Avoid using the word "format" as
	a general synonym for "process" or "output".  It should either
	have something to do with graphical layout or be in the context
	of a "file format".

2024-11-26  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (texi2any Printed Output):
	Change @a4paper to @afourpaper in command as the former is
	a mistake.  (Texinfo commands do not have digits in them.)

2024-11-26  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Syntax Highlighting): Add warning about
	change of syntax for HIGHLIGHT_SYNTAX.  Suggestion from Patrice.

2024-11-24  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Syntax Highlighting): mandate HIGHLIGHT_SYNTAX to
	be source-highlight to select source-highlight, it is better to keep
	the possibility of using other values provided by the user for other
	purposes as discussed on the mailing list.

2024-11-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ModulePath.pm.in ($texinfo_uninstalled, init),
	tp/Texinfo/XS/TestXS.xs (xstest_init),
	tp/Texinfo/XS/convert/ConvertXS.xs (init),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (init): initialize
	Texinfo::ModulePath $texinfo_uninstalled to undef, such that it is
	possible to determine that Texinfo::ModulePath init has not been
	called.

	* tp/Texinfo/XSLoader.pm (load_libtool_library): add .libs directory
	if Texinfo::ModulePath $texinfo_uninstalled is set or if it is undef
	when Texinfo::ModulePath has not been called, as is the case when
	TestXS is called, as it is not called from a Perl script.

2024-11-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Text.pm (_convert),
	tp/Texinfo/Convert/TextContent.pm (_convert),
	tp/maintain/regenerate_commands_perl_info.pl: do not put item in
	Texinfo::Command %formatted_line_commands, to have the same setup as
	in XS/C.  Update code to set $data_cmdname for item to item_LINE if in
	a @table and similar.

2024-11-22  Gavin Smith <gavinsmith0123@gmail.com>

	Change use of memcpy to memmove

	* tp/Texinfo/XS/main/text.c (text_append_n): Change memcpy
	call to memmove as this function is apparently called with
	overlapping memory regions by 'protect_first_parenthesis'.

	Report from Patrice for OpenBSD.

2024-11-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/ConvertXS.pm (BEGIN), tp/Texinfo/IndicesXS.pm
	(BEGIN): remove leading lib from library names.

2024-11-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XSLoader.pm (init): add directory with .libs only if
	calling from build directory.

2024-11-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/ConvertXS.pm (BEGIN), tp/Texinfo/IndicesXS.pm
	(BEGIN), tp/Texinfo/StructTransfXS.pm (BEGIN): add additional
	libraries the XS modules depend on.

2024-11-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/DocumentXS.pm (BEGIN), tp/Texinfo/Parser.pm (BEGIN),
	tp/Texinfo/XSLoader.pm (init): remove leading -l for specified
	additional libraries.

2024-11-21  Gavin Smith <gavinsmith0123@gmail.com>

	Load libtexinfo before libtexinfoxs

	* tp/Texinfo/DocumentXS.pm,
	* tp/Texinfo/Parser.pm: Swap order of -ltexinfoxs and -ltexinfo
	as the former requires the latter to be loaded first.

2024-11-21  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/configure.ac (LT_INIT): Add "dlopen" option,
	as according the libtool manual it should be used when building
	a library that can be dlopen'd.

2024-11-21  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XSLoader.pm (load_libtool_library):
	Add directories where loadable objects are expected to
	be found to front of search path rather than the end.

2024-11-20  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XSLoader.pm (init): Use additional libraries
	argument to call load_libtool_library.  These means we locate
	and load these libraries directly rather than relying on the
	dynamic linker to locate the libraries as a dependency of
	other libraries.

2024-11-20  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XSLoader.pm (init, load_libtool_library):
	Split out sub to handle everything up to loading the library
	with dl_load_file, but not any further.  This could potentially
	be used with library files that do not have an XS bootstrap
	function (such as libtexinfo or libtexinfoxs).
	(init): Comment out code handling additional libraries argument.

2024-11-20  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: add note about reproducibility of
	tp/tests/input/non_ascii.tar.

2024-11-18  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/maintain/regenerate_non_ascii_tar_file.sh:
	Check output of "tar --usage" in attempt to check if
	tar --sort=name is supported.

2024-11-18  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/maintain/regenerate_non_ascii_tar_file.sh:
	Do not use "if !" construct.

2024-11-18  Gavin Smith <gavinsmith0123@gmail.com>

	version check for GNU tar

	* tp/maintain/regenerate_non_ascii_tar_file.sh: add version
	check for "GNU tar" before using extra flags in case of building
	from git.

2024-11-18  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/maintain/regenerate_non_ascii_tar_file.sh: add maintenance
	script to regenerate tp/tests/input/non_ascii.tar.
	* autogen.sh,
	* tp/tests/Makefile.am (input/non_ascii.tar): Run it.

2024-11-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XSLoader.pm (init): add debug call for
	@found_additional_libraries.

2024-11-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XSLoader.pm (init): add an argument for
	@DynaLoader::dl_resolve_using additional libraries.

	* tp/Texinfo/DocumentXS.pm (BEGIN), tp/Texinfo/Parser.pm (BEGIN): add
	-ltexinfoxs and -ltexinfo as additional libraries.

2024-11-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XSLoader.pm (init): follow the DynaLoader documentation
	strictly on the return of dl_findfile, dl_load_file and
	dl_find_symbol.  Cosmetic change for dl_undef_symbols return
	condition.

2024-11-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XSLoader.pm (_find_file): compare ref() with the empty
	string.

	* tp/Texinfo/XSLoader.pm (init): check explicitely that $dlname is
	undefined or the empty string.

	* tp/Texinfo/XSLoader.pm (_debug, _fatal): cosmetic change, call shift
	right at the beginning of the function.

	* tp/Texinfo/XSLoader.pm (_fatal, init, override): cosmetic change,
	call functions with parentheses.

2024-11-17  Gavin Smith <gavinsmith0123@gmail.com>

	Remove "command-line Unicode" condition for tests

	* tp/tests/encoded/list-of-tests: remove setting
	-D 'needcommandlineunicode Need command-line unicode'

	* tp/tests/run_parser_all.sh (check_need_command_line_unicode):
	Remove, as it is superfluous with the non-ASCII file names condition
	for tests which is now used with all of the affected tests.
	* tp/tests/Makefile.am: comment moved from run_parser_all.sh.

	* tp/tests/many_input_files/output_dir_file_non_ascii.sh,
	* tp/tests/many_input_files/output_dir_non_ascii.sh,
	* tp/tests/many_input_files/tex_l2h_output_dir_non_ascii.sh,
	* tp/tests/many_input_files/tex_t4ht_output_dir_non_ascii.sh:
	Remove ad-hoc code checking HOST_IS_WINDOWS.

2024-11-17  Gavin Smith <gavinsmith0123@gmail.com>

	Skip tests for non-ASCII file names

	* tp/tests/Makefile.am (non_ascii_extracted_stamp.txt)
	(built_input/non_ascii): Use "stamp" file in check_DATA instead
	of input files directory.  This allows these files not to
	be created under given conditions.
	(non_ascii_extracted_stamp.txt) [HOST_IS_WINDOWS]: do not extract
	non_ascii.tar and record non-ASCII input files as unavailable.

	* tp/tests/encoded/list-of-tests,
	* tp/tests/tex_html/list-of-tests: mark some tests to skip with
	-D 'neednonasciifilenames Need non-ASCII file names.

	* tp/tests/run_parser_all.sh (check_need_non_ascii_file_names):
	Add check for marker in tests specifications file.

	* tp/tests/many_input_files/input_dir_non_ascii.sh,
	* tp/tests/many_input_files/output_dir_file_non_ascii.sh,
	* tp/tests/many_input_files/output_dir_non_ascii.sh,
	* tp/tests/many_input_files/tex_l2h_output_dir_non_ascii.sh,
	* tp/tests/many_input_files/tex_t4ht_output_dir_non_ascii.sh:
	Add ad hoc code to skip tests.

2024-11-17  Patrice Dumas  <pertusus@free.fr>

	* configure.ac (texinfo_cv_sys_iconv_converts_euc_cn): set to "cross
	compile guess no" if cross-compiling.  It is better to skip the tests
	requiring conversion to EUC-CN in case of cross-compilation as we do
	not know if the host can do the conversion.  Based on James Le Cuirot
	<chewi@gentoo.org> report and patch.

2024-11-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/base_utils.c (isascii_space): add.

	* tp/Texinfo/XS/Makefile.am (libparagraph_la_SOURCES),
	tp/Texinfo/XS/xspara.c (xspara__print_escaped_spaces)
	(xspara_add_text): use isascii_space.

	* tp/Texinfo/XS/Makefile.am (libparagraph_la_CPPFLAGS),
	tp/Texinfo/XS/xspara.c: do not include main/text.h, include text.h and
	add -I.

2024-11-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (C_libtexinfo_sources),
	tp/Texinfo/XS/main/base_utils.c, tp/Texinfo/XS/main/utils.c: move bug,
	fatal, isascii_* functions to a new file main/base_utils.c out of
	utils.c.

	* tp/Texinfo/XS/Makefile.am (MiscXS_la_SOURCES, MiscXS_la_CPPFLAGS),
	tp/Texinfo/XS/misc.c (xs_parse_command_name): use isascii_alnum in
	xs_parse_command_name.  Otherwise in some cases (perl 5.40 on macos)
	bytes part of UTF-8 strings are incorrectly considered to be alnum.
	Set -UHAVE_CONFIG_H in MiscXS_la_CPPFLAGS such as not to include
	config.h in base_utils.c as there is no need for config.h inclusion
	for MiscXS since Gnulib is not used at all for this XS object.

2024-11-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (isascii_alnum, isascii_alpha)
	(isascii_digit, isascii_lower, isascii_upper): use unsigned char for
	argument type, as it is the recommended type for isupper/islower...
	it saves the need to do an explicit cast.

2024-11-17  Gavin Smith <gavinsmith0123@gmail.com>

	* autogen.sh,
	* tp/tests/Makefile.am: use tar cf instead of -cf, etc.  From Patrice.

2024-11-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/html_prepare_converter.c
	(ids_hashmap_predicted_values): use heading_commands_nr.

2024-11-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/misc.c (xs_parse_command_name), tp/Texinfo/XS/xspara.c
	(xspara__print_escaped_spaces): cast argument of isalnum and isspace
	to unsigned char.  This is recommended as those functions expect
	unsigned argument, and it avoids warnings with -Wchar-subscripts when
	the functions are implemented with an array.

2024-11-16  Patrice Dumas  <pertusus@free.fr>

	* install-info/install-info.c (split_entry): cast argument of isspace
	to unsigned char.  This is recommended as this function expects
	unsigned argument, and it avoids warnings with -Wchar-subscripts when
	the function is implemented with an array.

2024-11-16  Patrice Dumas  <pertusus@free.fr>

	* info/footnotes.c (make_footnotes_node), info/indices.c
	(index_entry_matches, report_index_match), info/infodoc.c
	(replace_in_documentation), info/man.c (xrefs_of_manpage),
	info/search.c (search_forward, search_backward), info/session.c
	(program_name_from_file_name, info_search_1, incremental_search),
	info/util.c (ansi_escape, printed_representation), info/window.c
	(window_make_modeline): cast argument of isdigit, isupper, isalnum,
	islower and iscntrl to unsigned char.  This is recommended as those
	functions expect unsigned argument, and it avoids warnings with
	-Wchar-subscripts when the functions are implemented with an array.

2024-11-16  Patrice Dumas  <pertusus@free.fr>

	* info/indices.c, info/infodoc.c, info/infomap.c, info/man.c,
	info/search.c, info/session.c, info/util.c: replace tabs by spaces.
	Changes in spacing.

2024-11-16  Gavin Smith <gavinsmith0123@gmail.com>

	* autogen.sh: regenerate tp/tests/input/non_ascii.tar.  Suggestion
	from Patrice.
	* tp/tests/Makefile.am: update a comment

2024-11-16  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/tests/README: mention that input/non_ascii.tar needs
	to be deleted manually.
	* tp/tests/Makefile.am (input/non_ascii.tar): add comment.

	Report from Patrice.

2024-11-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs,
	tp/Texinfo/XS/convert/get_converter_perl_info.c,
	tp/Texinfo/XS/convert/get_html_perl_info.c,
	tp/Texinfo/XS/main/get_perl_info.c,
	tp/Texinfo/XS/parsetexi/Parsetexi.xs: remove ppport.h include
	following ppport.h advice.  Do not follow ppport.h suggestion for
	call_html_perl_function.c as we use G_LIST, which is not portable.

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_get_customization_sv): move FETCH definition down
	where it is used.

2024-11-16  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/tests/many_input_files/tex_l2h_output_dir_non_ascii.sh,
	* tp/tests/many_input_files/tex_t4ht_output_dir_non_ascii.sh:
	fix path of tex_encodé_utf8.texi.

2024-11-16  Gavin Smith <gavinsmith0123@gmail.com>

	Eliminate non-ASCII file names from tarball

	* tp/tests/Makefile.am (input/non_ascii.tar): Rule to create
	tar file of all files under input/non_ascii with non-ASCII
	file names.

	(check_DATA): Extract this tar file under built_input in build
	directory.

	(EXTRA_DIST): Distribute non_ascii.tar but not files used to
	build it.

	* tp/tests/run_parser_all.sh,
	* tp/tests/encoded/list-of-tests,
	* tp/tests/tex_html/list-of-tests,
	* tp/tests/many_input_files/input_dir_non_ascii.sh: access
	these files in new location under builddir.

	Files with non-ASCII names can be difficult to handle on
	unusual platforms, such as being difficult to delete on MS-Windows
	(report from Eli).  They remain tracked in git.

2024-11-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs
	(converter_set_global_document_commands),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_get_customization_sv, html_get_jslicenses_sv),
	tp/Texinfo/XS/main/get_perl_info.c (get_sv_output_units_descriptor)
	(add_svav_to_string_list, get_sv_index_entries_sorted_by_letter)
	(html_get_button_specification_list),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs
	(parser_store_INCLUDE_DIRECTORIES, parser_store_EXPANDED_FORMATS):
	replace av_top_index by AvFILL, which is more portable for older Perl
	versions.

2024-11-16  Patrice Dumas  <pertusus@free.fr>

	* README-hacking: update list of files with Perl C code.

2024-11-16  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/many_input_files/Makefile.am (EXTRA_DIST, TESTS)
	(tests_dirs), tp/tests/many_input_files/first_file_not_found.sh: add a
	test with two files with the first one not existing.

2024-11-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/indices.c (init_index_commands),
	tp/Texinfo/XS/parsetexi/parser.c (parse_texi): reinitialize static
	variables related to indices numbers in init_index_commands, which is
	called right after new_document in initialize_parsing in
	parsetexi/api.c and therefore rigth after setting
	parsed_document->indices_info to 0, instead of doing it at the end of
	the parsing.  Remove forget_indices.

2024-11-16  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/many_input_files/tex_l2h_output_dir_non_ascii.sh,
	tp/tests/many_input_files/tex_t4ht_output_dir_non_ascii.sh: fix path
	of tex_encodé_utf8.texi.

2024-11-16  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/tex_html/list-of-tests (tex_encoded_utf8_httex): fix path
	of tex_encodé_utf8.texi.

2024-11-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (DocumentXS_la_LDFLAGS): remove
	$(LTLIBICONV) $(LTLIBUNISTRING) from XS link flags when the XS object
	does not use libunistring or iconv.

2024-11-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am: rename libxsparagraph as libparagraph,
	libxsutils as libperlcall_utils, libxs_in_libtexinfo as
	libcallperl_libtexinfo and libxs_in_libtexinfo_convert as
	libcallperl_libtexinfo_convert.

2024-11-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/configure.ac: remove unset perl_conf_PERL_LINK, it has
	been replaced by PERL_LIBS.

2024-11-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (XSParagraph_la_LDFLAGS)
	(libtexinfoxs_la_LDFLAGS, DocumentXS_la_LIBADD)
	(StructuringTransfoXS_la_LIBADD, StructuringTransfoXS_la_LDFLAGS)
	(libtexinfo_convertxs_la_LDFLAGS, IndicesXS_la_LIBADD)
	(IndicesXS_la_LDFLAGS, ConvertXS_la_LIBADD, ConvertXS_la_LDFLAGS):
	remove $(LTLIBICONV) $(LTLIBUNISTRING) and similar from XS link flags
	when the XS object does not use libunistring or iconv.  Remove
	libgnu.la from LIBADD when an XS interface or XS library do not use
	Gnulib.

2024-11-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs
	(html_set_shared_conversion_state, html_get_shared_conversion_state),
	tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_translated_names): do not use perl_only_* wrappers as the
	files do not include Gnulib headers anymore.

2024-11-16  Gavin Smith <gavinsmith0123@gmail.com>

	Use $PERL to run Perl

	* tp/tests/many_input_files/different_encodings.sh,
	* tp/tests/many_input_files/different_languages_gen_master_menu.sh,
	* tp/tests/many_input_files/for_nbspaces_different_encodings.sh,
	* tp/tests/many_input_files/input_dir_non_ascii.sh,
	* tp/tests/many_input_files/output_dir_file_non_ascii.sh,
	* tp/tests/many_input_files/output_dir_non_ascii.sh,
	* tp/tests/many_input_files/tex_l2h_output_dir_non_ascii.sh,
	* tp/tests/many_input_files/tex_t4ht.sh,
	* tp/tests/many_input_files/tex_t4ht_output_dir_non_ascii.sh,
	* tp/tests/run_parser_all.sh: Use $PERL to run escape_file_names.pl.

2024-11-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfoxs_la_CPPFLAGS): remove
	-I$(srcdir)/convert.

2024-11-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am: move XS interfaces that do not need
	libtexinfo-convert before libtexinfo-convert.

2024-11-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_convert_la_SOURCES)
	(xs_LTLIBRARIES, libtexinfo_convertxs_la_SOURCES)
	(libtexinfo_convertxs_la_CPPFLAGS)
	(libtexinfo_convertxs_la_CFLAGS, libtexinfo_convertxs_la_LIBADD)
	(libtexinfo_convertxs_la_LDFLAGS, IndicesXS_la_LIBADD)
	(ConvertXS_la_LIBADD): add the libtexinfo-convertxs.la shared library
	with code common for XS interfaces used to call libtexinfo-convert.
	Remove XS_libtexinfo_convert_sources.

	* tp/Texinfo/XS/convert/build_html_perl_info.c,
	tp/Texinfo/XS/convert/get_converter_perl_info.c: remove config.h
	include, the Perl C files do not need Gnulib function nor autoconf
	defines.

2024-11-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (XS_libtexinfo_convert_sources)
	(noinst_LTLIBRARIES, libxs_in_libtexinfo_convert_la_SOURCES)
	(libxs_in_libtexinfo_convert_la_CPPFLAGS)
	(libxs_in_libtexinfo_convert_la_CFLAGS)
	(libxs_in_libtexinfo_convert_la_LIBADD)
	(libxs_in_libtexinfo_convert_la_LDFLAGS)
	(libtexinfo_convert_la_LIBADD): add the libxs_in_libtexinfo_convert.la
	convenience internal library to be able to compile the C code calling
	Perl from libtexinfo_convert code with different flags, to avoid
	Gnulib flags.

	* tp/Texinfo/XS/convert/build_html_perl_state.c,
	tp/Texinfo/XS/convert/call_html_perl_function.c: remove config.h
	include, there is no use of Gnulib functions nor use of autoconf
	defines in the Perl C codes.

2024-11-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (XS_libtexinfo_convert_sources),
	tp/Texinfo/XS/convert/build_html_perl_state.h,
	tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_translated_names, build_html_formatting_state),
	tp/Texinfo/XS/convert/build_html_perl_info.c: recreate
	build_html_perl_state.c, moving build_html_translated_names and
	build_html_formatting_state to the file.

2024-11-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/build_html_perl_info.c,
	tp/Texinfo/XS/convert/build_html_perl_info.h,
	tp/Texinfo/XS/Makefile.am (XS_libtexinfo_convert_sources): rename
	build_html_perl_state.c as build_html_perl_info.c.

2024-11-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/build_html_perl_state.c,
	tp/Texinfo/XS/convert/call_html_perl_function.c
	(html_argument_formatting_type_names)
	(build_html_command_formatted_args),
	tp/Texinfo/XS/convert/convert_html.c: move
	html_argument_formatting_type_names and
	build_html_command_formatted_args to call_html_perl_function.c.

	* tp/Texinfo/XS/convert/build_html_perl_state.c: make
	build_html_translated_names static.

2024-11-15  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/t/formats_encodings.t (accented_character_in_file_name):
	remove test

2024-11-15  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/tests/input/non_ascii: New directory to centralise location
	of files with non-ASCII names

	* tp/tests/run_parser_all.sh: specify -I $srcdir/input/non_ascii
	on texi2any command line

2024-11-15  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/tests/many_input_files/Makefile.am:
	Remove use of LONG_TESTS variable (same change made in
	tp/tests/Makefile.am on 2016-10-23 but this file was missed).

2024-11-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/html_prepare_converter.c
	(check_targets_order): use the PRIuPTR macro from inttypes.h
	for uintptr_t type printf format.

2024-11-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (StructuringTransfoXS_la_CPPFLAGS)
	(IndicesXS_la_CPPFLAGS, ConvertXS_la_CPPFLAGS): remove
	$(GNULIB_CPPFLAGS) as there is no Gnulib code used in XS interfaces
	code.

	* tp/Texinfo/XS/convert/ConvertXS.xs,
	tp/Texinfo/XS/convert/get_html_perl_info.c,
	tp/Texinfo/XS/main/DocumentXS.xs, tp/Texinfo/XS/main/IndicesXS.xs,
	tp/Texinfo/XS/parsetexi/Parsetexi.xs,
	tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs: do not
	include config.h as no Gnulib code is used and there is no need for
	autoconf defines.

	* tp/Texinfo/XS/main/manipulate_indices.h: add missing options_data.h
	include.

	Minor improvements in included headers.

2024-11-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/api_to_perl.c (get_refcount): call dTHX.

2024-11-15  Gavin Smith <gavinsmith0123@gmail.com>

	Escape non-ASCII file names in many_input_files tests

	* tp/tests/many_input_files/different_encodings.sh,
	* tp/tests/many_input_files/different_languages_gen_master_menu.sh,
	* tp/tests/many_input_files/for_nbspaces_different_encodings.sh,
	* tp/tests/many_input_files/input_dir_non_ascii.sh,
	* tp/tests/many_input_files/output_dir_file_non_ascii.sh,
	* tp/tests/many_input_files/output_dir_non_ascii.sh,
	* tp/tests/many_input_files/tex_l2h_output_dir_non_ascii.sh,
	* tp/tests/many_input_files/tex_t4ht.sh,
	* tp/tests/many_input_files/tex_t4ht_output_dir_non_ascii.sh:
	Run escape_file_names.pl on output directory.

	* tp/tests/many_input_files/Makefile.am: update rules to
	copy output directories in their escaped form.

2024-11-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libxsutils_la_CPPFLAGS)
	(libxsutils_la_LIBADD, libtexinfo_la_LIBADD),
	tp/Texinfo/XS/main/xs_utils.c: include config.h in xs_utils.c as
	vasprintf may come from Gnulib.  Add Gnulib flags and library for
	libxsutils.la and remove from libtexinfo.la to avoid doubly defined
	symbols.

2024-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c,
	tp/Texinfo/XS/main/get_perl_info.c: do not include config.h, the code
	should not need portability defines from autoconf or Gnulib.

2024-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/XSParagraph.xs (xspara_add_text, xspara_add_next):
	use SvPVutf8.

2024-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/XSParagraph.xs (xspara_new): iterate over the conf
	hash keys instead of trying all the variables.  It should be faster if
	there are only few variables set (not if lots of variables are set, as
	there is a linear search to determine the function to call).

2024-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/XSParagraph.xs (xspara_new), tp/Texinfo/XS/xspara.c
	(xspara_SET_CONF), tp/Texinfo/XS/xspara.h
	(XSPARA_CONF_VARIABLES_LIST): setup a list of XSParagraph
	configuration variables, XSPARA_CONF_VARIABLES_LIST applied to
	xspara_SET_CONF such that xspara_SET_CONF can be redefined in
	different codes to generate code for all the configuration variables.
	Use XSPARA_CONF_VARIABLES_LIST in xspara.c and XSParagraph.xs.

2024-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/XSParagraph.xs (xspara_new), tp/Texinfo/XS/xspara.c
	(SET_CONF), tp/Texinfo/XS/xspara.h (SET_CONF): instead of passing all
	the configuration variables in one function, setup a function per
	variable using the SET_CONF macro in xspara.c and xspara.h.  Remove
	xspara_init_state.

2024-11-14  Gavin Smith <gavinsmith0123@gmail.com>

	Escape non-ASCII bytes in reference test results

	* tp/tests/escape_file_names.pl: New file.
	* tp/tests/run_parser_all.sh (escape_file_names): Add, and
	run escape_file_names.pl on all files in output directory.

	This reduces the number of files with non-ASCII file namess
	in the sources which can cause problems on some unusual platforms.
	Report from Eli.

2024-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_do_js_files): set
	to_file_name independently of COMMAND_LINE_ENCODING.

2024-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (noinst_LTLIBRARIES)
	(XSParagraph_la_SOURCES, libxsparagraph_la_*, XSParagraph_la_CPPFLAGS)
	(XSParagraph_la_LIBADD), tp/Texinfo/XS/XSParagraph.xs: add
	libxsparagraph.la, a convenience library for XSParagraph with the C
	code that does not requires Perl and requires Gnulib, to be able to
	pass different flags than for XSParagraph.la.  Do not include config.h
	anymore in XSParagraph.xs as there is no need for Gnulib nor autoconf
	defines in this file.

	* README-hacking: update list of files with Perl C code.

2024-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/xspara.c (PARAGRAPH): rename french_spacing as
	frenchspacing to match exactly the Perl key.

	* tp/Texinfo/XS/XSParagraph.xs (xspara_new), tp/Texinfo/XS/xspara.c
	(xspara_init_state): modify xspara_init_state to be C only and get all
	the configuration variables in argument.  Get Perl conf in xspara_new
	with code similar to former xspara_init_state code in XSParagraph.xs
	and call xspara_init_state.

	* tp/Texinfo/XS/xspara.c: do not include Perl headers now that there
	is only pure C.

2024-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/XSParagraph.xs (xspara_new), tp/Texinfo/XS/xspara.c
	(xspara_new): call xspara_init_state from XSParagraph.xs, not from C.

	* tp/Texinfo/XS/XSParagraph.xs (xspara_*), tp/Texinfo/XS/xspara.c
	(xspara_set_state): use XS implicit rules for conversion of paragraph
	integer SV to int.

2024-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (MiscXS_la_CPPFLAGS, MiscXS_la_LIBADD),
	tp/Texinfo/XS/MiscXS.xs, tp/Texinfo/XS/misc.c: there is no use of
	gnulib anymore in MiscXS, remove the gnulib/autoconf flags and
	includes, in particular do not include config.h.

	* tp/Texinfo/XS/MiscXS.xs (xs_parse_command_name)
	(xs_parse_texi_regex), tp/Texinfo/XS/misc.c (xs_process_text)
	(xs_unicode_text, xs_entity_text, xs_parse_command_name)
	(xs_parse_texi_regex): use SvPVutf8_nolen in MiscXS.xs, not in C code.
	Remove useless Perl macros, remove Perl includes as there is no C Perl
	anymore in misc.c.

2024-11-14  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS: run "gnulib-tool --remove-import copy-file".
	run "gnulib-tool --import gettext-h" as module appears to be
	necessary and is removed otherwise.

2024-11-14  Gavin Smith <gavinsmith0123@gmail.com>

	Do not require copy-file module

	* tp/Texinfo/XS/convert/convert_html.c (copy_file_to): New function
	to copy a file without using Gnulib copy-file module.  Advice
	on file name encoding from Patrice.
	(html_do_js_files): Call it.

	The copy-file module has a large amount of dependencies and is
	not necessary for our needs.

2024-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/xs_utils.c (non_perl_*),
	tp/Texinfo/XS/main/utils.c: move non_perl_* functions out of utils.c
	to xs_utils.c.

	* tp/Texinfo/XS/Makefile.am (noinst_LTLIBRARIES)
	(libxsutils_la_SOURCES, libxs_in_libtexinfo_la_SOURCES)
	(libxs_in_libtexinfo_la_CPPFLAGS, libtexinfo_la_CPPFLAGS)
	(libtexinfoxs_la_LIBADD), tp/Texinfo/XS/main/call_perl_function.c,
	tp/Texinfo/XS/main/api_to_perl.c: add libxsutils and
	libxs_in_libtexinfo convenience libraries to be able to use different
	CPPFLAGS for compiltation.  libxsutils contains only xs_utils and does
	not require any CPPFLAGS.  This allows to avoid including config.h
	directly or indirectly in call_perl_function.c and api_to_perl.c and
	be fully independent of gnulib and autoconf.

2024-11-14  Patrice Dumas  <pertusus@free.fr>

	* README-hacking: add suggestion and instructions to run tests after
	turning off autovivification in Perl.

2024-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (locate_file_in_dirs),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser), tp/ext/epub3.pm
	(epub_convert_image_command), tp/init/html32.pm
	(html32_convert_item_command): check that hashes exist before
	accessing them to avoid spurious autovivification.

2024-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_sort.t: call
	Texinfo::Config::GNUT_initialize_customization, to avoid
	initialization being done through autovivification.

2024-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c
	(pass_generic_converter_to_converter_sv): fix typo in generated Perl
	hash key name.

2024-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree.c, tp/Texinfo/XS/parsetexi/api.c
	(initialize_parsing): remove the noop reset_obstacks function, remove
	comments related to obstack.

2024-11-13  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS: run
	  gnulib-tool --remove-import obstack.  Module not currently used.

2024-11-10  Gavin Smith <gavinsmith0123@gmail.com>

	pretest 7.1.91

2024-11-10  Gavin Smith <gavinsmith0123@gmail.com>

	* configure.ac,
	* js/info.js,
	* util/texi2dvi,
	* util/texi2pdf: Update version to 7.1.91

2024-11-10  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (small): Mention "@set dispenvsize small" and
	possibility of CSS for HTML output.

2024-11-09  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (HTML Output Structure Customization): Clarify
	purpose of CONTENTS_OUTPUT_LOCATION in relation to FORMAT_MENU.
	SPLIT is an empty string for non-split output.  Be clearer about
	interaction between CONTENTS_OUTPUT_LOCATION and MONOLITHIC.
	Information from Patrice.

2024-11-09  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (File Names and Links Customization for HTML): edit

2024-11-09  Gavin Smith <gavinsmith0123@gmail.com>

	HTML Output Customization manual edit

	* doc/texinfo.texi (HTML Output Structure Customization):
	Move discussion of USE_NODES immediately after discussion of
	SPLIT.

2024-11-08  Gavin Smith <gavinsmith0123@gmail.com>

	HTML Output Customization manual edit

	* doc/texinfo.texi (HTML Output Structure Customization):
	Mention SPLIT.

2024-11-08  Gavin Smith <gavinsmith0123@gmail.com>

	HTML Output Customization manual edit

	* doc/texinfo.texi (HTML Output Structure Customization):
	Attempt to distentangle explanations of different customization
	variables.  Try to present information in a logical manner with
	later information building on earlier information.

2024-11-08  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Customization of Navigation and Headers): edit

2024-11-08  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (HTML Features Customization): edit

2024-11-08  Gavin Smith <gavinsmith0123@gmail.com>

	Avoid sentence end

	* doc/texinfo.texi (Inserting Math)
	(Customization Variables for Multiple Formats):
	Add @: after e.g.

2024-11-08  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Customization of Inserted HTML Code): edit

2024-11-08  Gavin Smith <gavinsmith0123@gmail.com>

	HTML Output Customization manual edit

	* doc/texinfo.texi (HTML Output Structure Customization)
	(HTML Customization of Specific Output): Move documentation
	of PROGRAM_NAME_IN_ABOUT.

2024-11-08  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (HTML Customization for Math): Edit.

2024-11-08  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (JavaScript Interface and Licenses):	Edit.

2024-11-08  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (JavaScript Interface and Licenses):
	Move subsection later in chapter.

2024-11-08  Gavin Smith <gavinsmith0123@gmail.com>

	HTML Output Customization manual edit

	* doc/texinfo.texi (Specific Customization of HTML Formatting)
	(HTML Customization of Specific Output): Rename.

2024-11-08  Gavin Smith <gavinsmith0123@gmail.com>

	HTML Output Customization manual edit

	* doc/texinfo.texi (HTML Output Customization):  Edit slightly.
	(Customization of HTML Code Inserted)
	(Customization of Inserted HTML Code): Rename node.
	(Customization of Inserted HTML Code)
	(Specific Customization of HTML Formatting):
	Add introduction lines to nodes.

2024-11-08  Patrice Dumas  <pertusus@free.fr>

	remove unused contrib/nontests/defs.in

2024-11-08  Patrice Dumas  <pertusus@free.fr>

	* contrib/nontests/run_test_utils.sh (EGREP, FGREP),
	contrib/nontests/defs.in: remove unused EGREP and FGREP and remove
	copyright notice from defs.in as it is now trivial (and unused).
	Do not read nor find defs and defs.in from run_test_utils.sh.

2024-11-04  Gavin Smith <gavinsmith0123@gmail.com>

	Ease index files format change

	* doc/texinfo.tex (\printindex): Delay \errmessage until
	end of document to allow rest of index to be output.  This
	reduces the chance of a completely empty index file being
	left which texi2dvi will not process.
	(\byeerror, \bye): Check and output \byeerror in @bye.

	This is an unlikely case which may not occur in real documents.
	It would only happen if @printindex was used on the same
	page as all of the index entries for the index.

2024-11-03  Patrice Dumas  <pertusus@free.fr>

	* contrib/nontests/test_all.sh: add copyright notice.

2024-11-03  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: add suggestion to run contrib/nontests tests
	* contrib/nontests/README: txitextest no longer run regularly
	* contrib/nontests/local.test: delete test as we do not use
	"local" in texi2dvi

2024-11-03  Patrice Dumas  <pertusus@free.fr>

	* contrib/nontests/txitextest, contrib/nontests/*.test,
	contrib/nontests/defs.in, contrib/nontests/run_test_utils.sh: update
	copyright years.

2024-11-03  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.tex: (\doindwritex): Do not use \immediate as we
	need the page number to be set at the time the page is shipped out.

2024-11-02  Patrice Dumas  <pertusus@free.fr>

	* contrib/nonbugs/README, contrib/nonbugs/*.texi: add a directory for
	Texinfo files with some issues, but not bugs.

2024-11-02  Patrice Dumas  <pertusus@free.fr>

	* contrib/nontests/txitextest: use a temporary directory in the
	current directory and create it in the script.  Update manuals and
	paths.

2024-11-02  Patrice Dumas  <pertusus@free.fr>

	* util/texi2dvi (move_to_dest): use if instead of && to avoid
	triggering a failure with set -e if the condition is false.

2024-11-02  Patrice Dumas  <pertusus@free.fr>

	* contrib/nontests/defs.in, contrib/nontests/run_test_utils.sh
	(TEXI2DVI_run), contrib/nontests/*.test: split nontests/defs.in code
	independent of configure substitutions to the new file
	nontests/run_test_utils.sh.  Assume that all tex now understands
	--version.  Update TEXI2DVI path.  Source defs in run_test_utils.sh
	only if it is present.  Update code to be more Bourne compatible using
	recent autoconf generated code.  Set TEXINDEX and TEXINDEX_SCRIPT in
	the TEXI2DVI call in TEXI2DVI_run.  Determine srcdir in each test
	files and source run_test_utils.sh only.  

	* contrib/nontests/run_test_utils.sh (create_input_texi)
	(create_input_empty_texi), contrib/nontests/texi2dvi_no_content.test,
	contrib/nontests/texi2dvi.test (one_run): rename create_input_texi as
	create_input_empty_texi and readd create_input_texi such that it
	outputs a minimal manual instead of a manual without content.  Add
	texi2dvi_no_content.test that calls create_input_empty_texi.  Add
	an index entry in one_run.

	* contrib/nontests/test_all.sh: run all the *.test tests.

2024-11-02  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\nolig): Add brace pair after 0pt to avoid
	swallowing a following space.  Report from Werner.

2024-11-02  Gavin Smith <gavinsmith0123@gmail.com>

	Link toc page numbers to exact location on page

	* doc/texinfo.tex:  (\finishentry) [pdf or xetex]:
	If \tocnodetarget is set, use it for the target of the page number,
	rather than calling \pdfgettoks.

2024-11-01  Gavin Smith <gavinsmith0123@gmail.com>

	LuaTeX ligature suppression

	* doc/texinfo.tex (\nolig): New macro to suppress ligature
	creation in both LuaTeX and TeX.  LuaTeX diverges from the
	behaviour of TeX in that grouping characters do not suppress
	ligatures.
	(\unicodechardefs):
	Use \nolig for U+2018 and U+2019 (curly single quotes).

	Report from Werner Lemberg.

2024-11-01  Gavin Smith <gavinsmith0123@gmail.com>

	@uref line breaking

	* doc/texinfo.tex (\urefallowbreak): Increase stretch for
	ragged right output from 2 em to 3 em.
	* doc/texinfo-tex-test.texi (URL line breaking): add test cases.

	Examples sent by R. Diez.

2024-11-01  Patrice Dumas  <pertusus@free.fr>

	* README-hacking: update C flags.
	Add text about manuals interesting for the testing of HTML
	customization API and change of API.

2024-10-31  Gavin Smith <gavinsmith0123@gmail.com>

	Ease index files format conversion

	* doc/texinfo.tex (\doindwritex): Precede \write with \immediate.

	This is to help with transitioning from index files using @ as
	an escape character instead of \.   If texinfo.tex exits with
	an error about the old format being used before any entries were
	written to the index file, then the index file will stay empty.
	texi2dvi does not recognise an empty file as an index file, so
	will not call texindex, and so the sorted index file will remain
	in the old format, and texi2dvi will not complete successfully
	until the sorted index file is manually deleted.  (This was the
	case for the "bar" index in texinfo-tex-test.texi.)

2024-10-31  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\unicodechardefs): Define U+2032 (prime)
	with \prime in superscript.  From Werner Lemberg.

2024-10-30  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/encoded/list-of-tests (verbatiminclude_names_latin1_html)
	(verbatiminclude_names_latin1_html_explicit_encoding): add -c
	MESSAGE_ENCODING=UTF-8 to have a reproducible output.  With ASCII
	output encoding, there is no guarantee on the representation of
	non-ASCII characters.  Gavin idea.

2024-10-30  Patrice Dumas  <pertusus@free.fr>

	Add contrib/init_examples directory for texi2any initialization files

2024-10-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_stage_handler), tp/Texinfo/XS/convert/convert_html.c
	(html_run_stage_handlers): set status to 1 in call_stage_handler if
	error status is set.  Set the call_status in html_run_stage_handlers,
	to a positive value.

2024-10-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/t/init/stage_handler_bad_return.pm,
	tp/t/init/stage_handler_undef_return.pm, tp/tests/Makefile.onetst
	(type_base_one_test_files_generated_list),
	tp/tests/customization/list-of-tests
	(simplest_stage_handler_bad_return)
	(simplest_stage_handler_undef_return): add tests of invalid stage
	handlers return values.

2024-10-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (run_stage_handlers),
	tp/Texinfo/XS/convert/call_html_perl_function.c (call_stage_handler),
	tp/Texinfo/XS/convert/convert_html.c (html_run_stage_handlers),
	tp/Texinfo/XS/convert/replace_perl_call_html_function.c
	(call_stage_handler): check the stage handler return value and error
	out if it is not numeric.  Add an error status argument to
	call_stage_handler to get the specific error in
	html_run_stage_handlers.

2024-10-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/hashmap.c (clear_registered_ids_c_hashmap):
	do not access the hashmap if it had never been initialized.

2024-10-29  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl: do not set TEST for converter tests if already
	already set, such that TEST may be set to 0.

	* tp/Makefile.am (test_files), tp/Makefile.tres,
	tp/t/init_files_tests.t (unknown_custom_variable),
	tp/t/init/unknown_custom_variable.pm: test of unknown customization
	variables set or accessed in init file.

	* tp/t/test_utils.pl: add shebang (for colorization in vim).

2024-10-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (get_conf, set_conf, force_conf),
	tp/Texinfo/XS/convert/ConvertXS.xs (get_conf, set_conf, force_conf):
	do not abort if an unknown variable is accessed or set.  In Perl, call
	cluck if TEST is set.

2024-10-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/customization_options.c (free_options_list): free
	the options itself.

2024-10-28  Gavin Smith <gavinsmith0123@gmail.com>

	Link to section header not just the page

	* doc/texinfo.tex
	(\tocentry): Take an extra argument, the name of the node
	being referenced.  Set \tocnodetarget.
	(\finishentry) [pdf or xetex]:
	If \tocnodetarget is set, use it for the target of the link.

	(\numchapentry, \shortchapentry, \appentry, \unnchapentry)
	(\shortunnchapentry, \unnsecentry, \numsubsecentry, \unnsubsecentry)
	(\numsubsubsecentry, \unsubsubsecentry):
	Propagate node from .toc file to lower-level macros.

	(\dochapentry, \dosecentry, \dosubsecentry, \dosubsubsecentry):
	Propagate note to \tocentry.

	Hyperlinks from entries in the table of contents would go
	to the top of the page, not the actual section heading, which
	was especially confusing when there were multiple headings on
	a page.  Report from Bruno Haible.

2024-10-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/customization_options.c
	(options_list_add_option_number, copy_options_list): add an argument
	to avoid checking for duplicates in options_list_add_option_number is
	argument is set to 0.  Update callers.

2024-10-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/customization_options.c
	(copy_options_list_options, copy_options_list)
	(copy_options_list_set_configured): rename copy_options_list_options
	as copy_options_list_set_configured.  Readd copy_options_list_options
	as a static function to only do the copy.  Reorganize code to avoid
	redundancies.  Remove add_option_copy. 

2024-10-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (set_converter_init_information):
	copy directly the options list OPTIONS structure as converter
	format_defaults_conf.

	* tp/Texinfo/XS/main/customization_options.c: move code around, add
	static.  Remove new_option and set_sorted_option_key_configured.

2024-10-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/customization_options.c
	(copy_options_list_options): rename copy_numbered_options_list_options
	as copy_options_list_options.

2024-10-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_converter_perl_info.c
	(get_converter_info_from_sv): inline new_numbered_option_from_sv in
	get_converter_info_from_sv.

2024-10-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_converter_perl_info.c
	(get_converter_info_from_sv): remove unused sorted_options argument.
	Update callers.

2024-10-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/texinfo.c (err_add_option_value): remove
	unused sorted_options argument.

2024-10-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (converter_converter),
	tp/Texinfo/XS/convert/texinfo.c (txi_converter_setup): call
	converter_initialize in converter_converter again.  Adapt
	txi_converter_setup.

2024-10-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c
	(destroy_converter_initialization_info),
	tp/Texinfo/XS/convert/texinfo.c (txi_converter_format_defaults),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER_INITIALIZATION_INFO):
	remove the options field in CONVERTER_INITIALIZATION_INFO as it is now
	always set in conf.

2024-10-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/customization_options.c
	(initialize_options_list): remove the possibility to preset the number
	of elements in list, remove the number argument.  Update callers.

	* tp/Texinfo/XS/convert/get_converter_perl_info.c
	(new_numbered_option_from_sv, get_converter_info_from_sv): call
	options_list_add_option_number in new_numbered_option_from_sv and
	simplify get_converter_info_from_sv.

2024-10-28  Patrice Dumas  <pertusus@free.fr>

	Always have an OPTIONS structure associated to an options list

	* tp/Texinfo/XS/convert/texinfo.c (txi_parser): rename OPTIONS_LIST
	argument as options_list.

	* tp/Texinfo/XS/convert/converter.c
	(new_converter_initialization_info): always initialize the options
	list.

	* tp/Texinfo/XS/convert/get_converter_perl_info.c
	(get_converter_info_from_sv),
	tp/maintain/regenerate_C_options_info.pl,
	tp/Texinfo/XS/convert/texinfo.c (txi_parser),
	tp/Texinfo/XS/main/build_perl_info.c
	(build_sv_options_from_options_list),
	tp/Texinfo/XS/main/customization_options.c
	(copy_numbered_options_list_options, initialize_options_list)
	(options_list_add_option_number, options_list_add_option_name)
	(add_option_value, add_option_copy, add_new_button_option)
	(free_options_list, add_option_strlist_value),
	tp/Texinfo/XS/main/option_types.h (OPTIONS_LIST),
	tp/Texinfo/XS/teximakehtml.c (main): add an OPTIONS and
	sorted options field to OPTIONS_LIST and initialize them in
	initialize_options_list.  Set OPTIONS_LIST list to be the list of
	option numbers instead of the options themselves.  Replace
	new_option_string_value and add_new_option_value by add_option_value.
	Replace options_list_add_option by options_list_add_option_number and
	options_list_add_option_name.  Remove number_options_list as the
	options list are always numbered now.

	* tp/Texinfo/XS/convert/html_converter_init_options.c
	(html_converter_defaults), tp/Texinfo/XS/convert/texinfo.c
	(txi_parser): simplify code by using the OPTIONS to find if a
	customization variable is set is set.


2024-10-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (converter_converter),
	tp/Texinfo/XS/convert/texinfo.c (txi_converter_setup): call
	converter_initialize in txi_converter_setup, not in
	converter_converter.
	Add top_srcdir/util to TEXINFO_LANGUAGE_DIRECTORIES as in texi2any.pl,
	after the converter_converter call and before calling
	converter_initialize.

2024-10-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/teximakehtml.c (main): call txi_general_setup with
	paths setup for an uninstalled program, similarly with how
	Texinfo::ModulePath.pm can be used to set paths.

2024-10-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c
	(setup_converter_paths_information, converter_setup),
	tp/Texinfo/XS/convert/texinfo.c (txi_general_setup): use a consistent
	order for arguments.

2024-10-27  Patrice Dumas  <pertusus@free.fr>

	* doc/Makefile.am (pod2texi.texi): remove temporary file.

2024-10-27  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/Makefile.am (TEST_EXTENSIONS, T_LOG_DRIVER)
	(T_LOG_COMPILER, AM_T_LOG_FLAGS, test_files, EXTRA_DIST): use the
	automake tap framework to output the result of each of the tests.

	* Pod-Simple-Texinfo/t/Pod-Simple-Texinfo.t (index in head node):
	remove the TODO block, as a TODO block should fail.

2024-10-27  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm (_accessorize, new)
	(_texinfo_handle_element_end): add texinfo_perldoc_url_prefix
	accessor with default based on Pod::Simple::XHTML perldoc_url_prefix.

	* Pod-Simple-Texinfo/t/Pod-Simple-Texinfo.t (run_test): set
	texinfo_perldoc_url_prefix to have more reproducible test results
	as Pod::Simple::XHTML perldoc_url_prefix changed in 2019.

2024-10-27  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm: document
	texinfo_external_pod_as_url in Pod section.

2024-10-27  Patrice Dumas  <pertusus@free.fr>

	* doc/Makefile.am (pod2texi.texi): postprocess pod2texi.texi to
	substitute the MetaCPAN url that does not exist by the url on the GNU
	website.

2024-10-27  Patrice Dumas  <pertusus@free.fr>

	pod2texi: Use an @url to convert L<...> referring to external modules

	* Pod-Simple-Texinfo/Makefile.PL (WriteMakefile),
	Pod-Simple-Texinfo/README, configure.ac (POD_SIMPLE_TEXINFO_TESTS)
	(BUILD_PERL_API_TEXI): document/add Pod::Simple::XHTML dependence.

	* Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm (_accessorize),
	($pod_links_html_parser, new, _texinfo_handle_element_start)
	(_texinfo_handle_element_end): add texinfo_external_pod_as_url
	configuration, set to 1 in the default case.  Pass $manual_text
	and $section_text to L tag formatting.  If texinfo_external_pod_as_url
	is set, format L to external Pod as an @url, using idify and
	perldoc_url_prefix from Pod::Simple::XHTML, mimicking
	Pod::Simple::XHTML resolve_pod_page_link, but without url protection,
	as it is already done in Texinfo::Convert::HTML.

	* Pod-Simple-Texinfo/t/Pod-Simple-Texinfo.t (run_test)
	(index in head node, protected characters, link to external module)
	(protected -, end of line in L, empty head2): modify run_test to
	pass $external_pod_as_url as first optional argument, to be able to
	set texinfo_external_pod_as_url to a different value as the default.

	* Pod-Simple-Texinfo/t/Pod-Simple-Texinfo.t
	(link to external module external pod as url)
	(protected - external pod as url)
	(end of line in L external pod as url): tests using the same Pod as
	other tests, but with texinfo_external_pod_as_url left to the default
	value.

2024-10-27  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl (@texinfo_language_config_dirs): when calling
	texi2any in source, but not as part of a test, add top_srcdir util
	directory to @texinfo_language_config_dirs to find the default
	htmlxref.cnf file there.

2024-10-27  Patrice Dumas  <pertusus@free.fr>

	* util/htmlxref.cnf (source-highlight, src-highlite): use both
	src-highlite and source-highlight as source-highlight project name.

2024-10-27  Patrice Dumas  <pertusus@free.fr>

	* util/htmlxref.cnf (source-highlite): rename src-highlite as
	source-highlite.

2024-10-25  Gavin Smith <gavinsmith0123@gmail.com>

	pretest 7.1.90

2024-10-25  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: edit

2024-10-25  Gavin Smith <gavinsmith0123@gmail.com>

	* Pod-Simple-Texinfo/pod2texi.pl: update copyright year to 2024

2024-10-25  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Customization Variables and Options):
	Remove SILENT as an equivalent for --silent as it does not work.
	* tp/Texinfo/options_data.txt: Remove SILENT.
	* NEWS: mention removal

2024-10-25  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: instructions for help2man upgrade

2024-10-25  Gavin Smith <gavinsmith0123@gmail.com>

	Track *.pot files in git

	* .gitignore: Do not ignore gnulib/po/texinfo-gnulib.pot,
	po/texinfo.pot or tp/Texinfo/XS/gnulib/po/texinfo_tp-gnulib.pot.
	(po_document/texinfo_document.pot was already tracked).

	This is intended to stop *.po files constantly regenerating.

2024-10-24  Patrice Dumas  <pertusus@free.fr>

	* Makefile.am (BUILT_SOURCES, tp/Texinfo/HTMLData.pm)
	(tp/Texinfo/XS/main/html_conversion_data.c), tp/Makefile.am
	(translated_source_files), tp/Texinfo/XS/Makefile.am
	(translated_source_files): build early generated source files that
	contain translated strings and are thus needed when building in po*
	directories.  To help with that, add translated_source_files targets
	in Makefile.am of the generated source files directories such that it
	is easy to rebuild the files coming from any directory, in particular
	from an out of source build directory.

2024-10-24  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: suggest another distribution build check recipe

2024-10-24  Gavin Smith <gavinsmith0123@gmail.com>

	* po_document/POTFILES.in: add a file

2024-10-24  Gavin Smith <gavinsmith0123@gmail.com>

	* Makefile.am (po_document-check): Do not check in *.h files
	as these only contain declarations of translation functions,
	not their use.
	* po_document/POTFILES.in: Remove *.h files.

2024-10-24  Gavin Smith <gavinsmith0123@gmail.com>

	* po/POTFILES.in: add new files

2024-10-24  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: state autoconf 2.72.  Edit for style.

2024-10-24  Gavin Smith <gavinsmith0123@gmail.com>

	* util/srclist.txt: remove build-aux/texinfo.tex as this
	is a symlink now and therefore automatically up-to-date

2024-10-24  Gavin Smith <gavinsmith0123@gmail.com>

	* util/srclist.txt: remove all files under build-aux.
	We can add these files with "automake --add-missing" when
	required and do not need to worry about updating them from
	gnulib.

2024-10-24  Gavin Smith <gavinsmith0123@gmail.com>

	* autogen.sh: Call autoreconf instead of individual tools,
	with autopoint disabled.  Do not specify --force as this
	overwrites INSTALL.

2024-10-24  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: automake 1.17
	* README-hacking: advice on automake upgrade

2024-10-24  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking, configure.ac, tp/Texinfo/XS/configure.ac:
	Move all instructions for upgrading gettext to README-hacking.

2024-10-24  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: mention gettext version

2024-10-24  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS: update to gettext 0.22.5

2024-10-24  Gavin Smith <gavinsmith0123@gmail.com>

	Upgrade gettext to 0.22.5 by running gettextize at top level

	* README-hacking: suggest gettextize --no-changelog.  Remove
	note about gettext 0.22.

2024-10-24  Gavin Smith <gavinsmith0123@gmail.com>

	Run gnulib --add-import at top level and under tp/Texinfo/XS.

2024-10-24  Patrice Dumas  <pertusus@free.fr>

	* doc/refcard/Makefile.am (CHECKS_ENV, ccheck, vcheck): set srcdir and
	top_builddir in the checking commands environment for out of source
	builds.

2024-10-23  Patrice Dumas  <pertusus@free.fr>

	* README-hacking: update ppport.h call.

2024-10-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (html_build_button): rename
	cv_name as sub_full_name to avoid ppport.h false positive.

2024-10-23  Patrice Dumas  <pertusus@free.fr>

	Avoid using C specific types in code

	* tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal): use
	CF_block instead of ET_block_command and CF_line instead of
	ET_line_command and ET_lineraw_command.

	* tp/Texinfo/XS/main/convert_utils.c (find_innermost_accent_contents),
	tp/Texinfo/XS/parsetexi/close.c (close_command_cleanup),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block),
	tp/Texinfo/XS/parsetexi/menus.c (end_line_menu_entry),
	tp/Texinfo/XS/parsetexi/multitable.c (gather_previous_item),
	tp/Texinfo/XS/parsetexi/parser.c (isolate_last_space): use TF_text to
	determine if the cmd element can be accessed instead of C only types.

2024-10-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/element_types.txt,
	tp/Texinfo/XS/convert/convert_html.c (html_convert_tree_append),
	tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash): change
	TF_at_command to TF_c_only to flag types specific of C.

	* tp/Texinfo/XS/main/element_types.txt: add information on flags.

2024-10-23  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/texi2any.supp: add entries for fixed bug in valgrind,
	seen with "t/info_tests.t chinese_mixed_with_en_EUC_CN" and
	t/formats_encoding.t.

	See https://sourceware.org/git/gitweb.cgi?p=valgrind.git;h=947388eb043ea1c44b37df94046e1eee790ad776

2024-10-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/close.c (remove_empty_content): check cmd to
	determine if this is an @-command, we are in the parser, so it is
	safe.

2024-10-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/transformations.c
	(complete_node_menu): inverse the condition for offset_at_end for a
	more readable condition (also like Perl).  Use TF_text to make sure
	that the element is a container element now that it is clear that the
	main objective of that part of the condition is to be able to access
	CONTAINER fields.

2024-10-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ManipulateTree.pm (move_index_entries_after_items),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(move_index_entries_after_items): change the logic of the condition
	on continuing to go through elements if not among some commands to
	have a positive condition on commands.  Use TF_text to make sure that
	the element is a container element now that it is clear that the
	main objective of that part of the condition is to be able to access
	CONTAINER fields.

2024-10-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/handle_commands.c,
	tp/Texinfo/XS/parsetexi/parser.c,
	tp/Texinfo/XS/structuring_transfo/transformations.c: use TF_text to
	make sure that the element is a container element when the main
	objective of the code is to be able to access CONTAINER fields instead
	of TF_at_command.

2024-10-23  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/main/tree_types.h: add a comment

2024-10-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/element_types.awk: do not set flags that are
	not directly used in C code, but are used to determine the size of the
	lements info array.

2024-10-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_texinfo.c (expand_cmd_args_to_texi)
	(convert_to_texinfo_internal): use elt_info_number and elt_info
	content being set to determine if the elt_info element should be
	output instead of flags.

2024-10-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (store_info_string)
	(element_to_perl_hash): check that string is set in store_info_string.

	* tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash): minor
	rearrangement of code.

2024-10-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash): inline
	store_info_element in element_to_perl_hash.

2024-10-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree.c (elt_info_names): add.

	* tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash): process
	elt_info simply by going through the array.

2024-10-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree_types.h (CONTAINER),
	tp/Texinfo/XS/main/element_types.awk,
	tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash),
	tp/Texinfo/XS/main/convert_to_texinfo.c (expand_cmd_args_to_texi),
	tp/Texinfo/XS/parsetexi/parser.c (move_last_space_to_element): remove
	eit_brace_content_spaces_before_argument from enum elt_info_type, use
	eit_spaces_before_argument instead.  Do not overload enum
	elt_info_type indices, instead allow an unused slot for some elements
	in elt_info.

2024-10-21  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash):
	Place code processing string_info together and code processing
	elt_info together.

2024-10-21  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash):
	Place all calls of store_flag macro together.

2024-10-22  Patrice Dumas  <pertusus@free.fr>

	Rename tp/Texinfo/XS/main/options_types.h as options_data.h

	* tp/Texinfo/XS/Makefile.am (C_libtexinfo_sources, BUILT_SOURCES)
	(MAINTAINERCLEANFILES), tp/maintain/regenerate_C_options_info.pl:
	rename main/options_types.h as options_data.h.  Report from Gavin.
	Update includes.

2024-10-22  Gavin Smith <gavinsmith0123@gmail.com>

	Move enum global_unit_direction

	* tp/Texinfo/XS/main/tree_types.h,
	* tp/Texinfo/XS/convert/html_converter_types.h
	(enum global_unit_direction): Move to html_converter_types.h.
	Include "html_conversion_data.h" in html_converter_types.h and
	not in tree_types.h.

2024-10-22  Gavin Smith <gavinsmith0123@gmail.com>

	Move enum html_text_type

	* tp/Texinfo/XS/main/tree_types.h,
	* tp/Texinfo/XS/main/option_types.h (enum html_text_type):
	Move to option_types.h.

2024-10-22  Gavin Smith <gavinsmith0123@gmail.com>

	Move enum relative_unit_direction_type definition

	* tp/Texinfo/XS/main/tree_types.h, tp/Texinfo/XS/main/document_types.h
	(enum relative_unit_direction_type): Move to document_types.h as
	one of the enum constants is used in OUTPUT_UNIT which is in this
	header.  Include "html_conversion_data.h" in document_types.h.

2024-10-22  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/main/tree_types.h (enum directions): add comment

2024-10-22  Gavin Smith <gavinsmith0123@gmail.com>

	Move variable declaration

	* tp/Texinfo/XS/main/tree_types.h,
	* tp/Texinfo/XS/main/tree.h (ai_key_names): Move to tree.h as
	this will mean that tree_types.h again does not have any
	variable declarations in it.
	* tp/Texinfo/XS/main/tree_types.h: add a comment explaining
	purpose of enum ai_key_name.

2024-10-22  Gavin Smith <gavinsmith0123@gmail.com>

	Move OUTPUT_UNIT definition

	* tp/Texinfo/XS/main/tree_types.h,
	* tp/Texinfo/XS/main/document_types.h (enum output_unit_type)
	(OUTPUT_UNIT, OUTPUT_UNIT_LIST): Move to document_types.h as
	all source codes needing the fields of OUTPUT_UNIT also include
	this header.  Replace with forward declaration.

2024-10-21  Gavin Smith <gavinsmith0123@gmail.com>

	Hardcode "info" string in hash creation

	* tp/Texinfo/XS/main/build_perl_info.c
	(setup_info_hv): Remove 'type_key' argument and always make this
	"info".  Use HSH_info for last argument of hv_store.   Callers
	updated throughout.
	(store_extra_flag): New function to replace the single usage of
	setup_info_hv (via store_info_integer) with 'type_key' set to
	"extra".

2024-10-21  Patrice Dumas  <pertusus@free.fr>

	* po_document/POTFILES.in: rename Texinfo/Data.pm as
	Texinfo/HTMLData.pm and main/conversion_data.c as
	main/html_conversion_data.c.

2024-10-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (converter_converter): remove
	unused variable.

2024-10-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (EXTRA_DIST): remove files from EXTRA_DIST
	if they are already in *SOURCE*.

2024-10-21  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/generate_code_convert_data.pl, tp/Makefile.am
	(dist_modules_DATA, Texinfo/HTMLData.pm, MAINTAINERCLEANFILES),
	tp/Texinfo/XS/Makefile.am (C_libtexinfo_sources, EXTRA_DIST)
	(BUILT_SOURCES, main/html_conversion_data.c, MAINTAINERCLEANFILES):
	rename Texinfo/Data.pm as Texinfo/HTMLData.pm and
	main/conversion_data.c as main/html_conversion_data.c.  Report from
	Gavin.

2024-10-21  Gavin Smith <gavinsmith0123@gmail.com>

	Remove Perl and string list implementations for "registered ids"

	* tp/Texinfo/XS/main/converter_types.h (CONVERTER): remove
	fields ids_data_type, registered_ids, registered_ids_hv.
	(enum ids_data_type): Remove.

	* tp/Texinfo/XS/convert/converter.c (new_converter)
	(converter_converter): Flags argument removed.  Callers updated.

	* tp/Texinfo/XS/convert/call_html_perl_function.c,
	* tp/Texinfo/XS/convert/replace_perl_call_html_function.c
	(init_registered_ids_hv, is_hv_registered_id, hv_register_id)
	(clear_registered_ids_hv, free_registered_ids_hv): Remove.

	* tp/Texinfo/XS/convert/html_prepare_converter.c
	(html_prepare_conversion_units_targets, html_register_id)
	(html_id_is_registered),
	* tp/Texinfo/XS/convert/html_converter_finish.c
	(html_reset_converter, html_free_converter):
	Unconditionally use C hashmap implementation.

2024-10-21  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/main/converter_types.h (CONVERTER) [HAVE_CXX_HASHMAP]:
	Remove registered_ids_hashmap.

2024-10-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.xs (errors): abort if there is no
	registrar but errors was called on a Parser.

2024-10-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c
	(pass_document_parser_errors_to_registrar): setup a new registrar only
	if there is not one already.

2024-10-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.xs (parse_texi_piece): remove the
	no_store argument.

	* tp/Texinfo/Document.pm (%XS_overrides, new_document, parser_errors),
	tp/Texinfo/ParserNonXS.pm (parse_texi_line, parse_texi_file)
	(_line_warn, _line_error, _next_text, _parse_texi),
	tp/Texinfo/XS/main/DocumentXS.xs (document_parser_errors),
	tp/Texinfo/XS/main/build_perl_info.c,
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (errors),
	tp/t/no_structure_test.t, tp/t/same_parser_multiple_files.t,
	tp/t/test_protect_hashchar_at_line_beginning.t, tp/t/test_tree_copy.t,
	tp/t/test_utils.pl, tp/texi2any.pl: store parsing errors in document
	in Perl in the parser_registrar key value Texinfo::Report.  Add
	parser_errors to get the parsing errors from a Document.  Keep the
	Parser registrar for parse_texi_line as there is no document in that
	case, so the parser need to be used.  Using the parser to get parsing
	errors is not documented.

	* tp/Texinfo/XS/parsetexi/Parsetexi.xs (parse_texi_file)
	(parse_texi_piece, parse_texi_text): call directly get_document.

	* tp/Texinfo/XS/main/build_perl_info.c,
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (parse_texi_line): inline
	get_or_build_document in parse_texi_line, remove the function.

	* Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm (print_texinfo_errors):
	pass error_messages and error_count directly as the function to get
	errors may be errors or parser_errors.  Update callers.

2024-10-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Report.pm (new, clear): fix key names.

2024-10-20  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: suggest running autopoint instead of gettextize
	and using --dry-run option

2024-10-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_initialize_parsing): merge parser and
	parser state in the function, return the document.  Update callers.

	* tp/Texinfo/ParserNonXS.pm (_input_push_file): return file_name and
	directories even if the file could not be opened.

	* tp/Texinfo/ParserNonXS.pm (parse_texi_file),
	tp/Texinfo/XS/main/build_perl_info.c (get_document, fill_document_hv)
	(store_document_texinfo_tree), tp/Texinfo/XS/parsetexi/Parsetexi.xs
	(parse_texi_file), tp/Texinfo/XS/parsetexi/api.c (parse_file),
	tp/t/test_utils.pl (test), tp/texi2any.pl: return a document, with
	information on directories and file name even if the input file could
	not be opened, but do not set the tree.  Use the presence of a tree to
	determine if parsing was successful.

	* tp/Texinfo/XS/main/build_perl_info.c (build_texinfo_tree): return 0
	if there is no tree in document.

2024-10-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.xs: reindent.

2024-10-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.xs: rename parser variable as
	parser_sv.

2024-10-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (get_or_build_document),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (parse_texi_file)
	(errors): if a handle on a document is returned, do not set a
	registrar but instead keep with last_document_descriptor key a
	way to find the document where parser errors are registered for the
	next call to parser->errors.

2024-10-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm,
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (errors): implement errors in XS,
	remove from Parsetexi.pm.

2024-10-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (new_texinfo_report): fix
	registrar key name.

2024-10-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c: move new_texinfo_report code
	earlier.

	* tp/Texinfo/XS/main/build_perl_info.c
	(pass_document_parser_errors_to_registrar),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser): create Texinfo::Report
	registrar object and add to parser in
	pass_document_parser_errors_to_registrar, when it is sure that the
	Perl data is needed, and not in parser.

2024-10-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/DocumentXS.xs,
	tp/Texinfo/XS/main/build_perl_info.c (document_tree): move
	document_tree code to a function in build_perl_info.c.

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm,
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (parse_texi_line): in
	Parsetexi.xs define directly parse_texi_line instead of parse_string
	by calling document_tree to get the tree.  Remove parse_texi_line from
	Parsetexi.pm.

2024-10-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parse_texi_line),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (parse_texi_file)
	(parse_texi_piece, parse_string, parse_texi_text): in Parsetexi.xs,
	define directly parse_texi_file instead of parse_file,
	parse_texi_piece instead of parse_piece, parse_texi_text instead of
	parse_text and check arguments in parse_string. Remove
	parse_texi_file, parse_texi_piece and parse_texi_text from
	Parsetexi.pm.

2024-10-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.xs: remove now unused XS
	interfaces for build_document, get_document and
	pass_document_parser_errors_to_registrar.

2024-10-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (new_texinfo_report): add code
	doing the same as calling Texinfo::Report::new() in XS.

	* tp/Texinfo/XS/main/build_perl_info.c (get_document, build_document):
	add a registrar key by calling new_texinfo_report.

	* tp/Texinfo/XS/main/build_perl_info.c (get_or_build_document),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (parse_texi_file)
	(parse_texi_piece, parse_texi_text, parse_texi_line),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (parse_file, parse_piece)
	(parse_string, parse_text): build the document directly in parse_* by
	calling the new function get_or_build_document or directly
	get_document. Remove _get_parser_info.

2024-10-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Utils.pm (encoded_output_file_name)
	(encoded_input_file_name): use input_encoding_name instead of
	input_perl_encoding, Encode determines the alias itself.

	* tp/Texinfo/Document.pm (new_document), tp/Texinfo/ParserNonXS.pm
	(get_parser_info), tp/Texinfo/XS/main/DocumentXS.xs
	(set_document_global_info), tp/Texinfo/XS/main/build_perl_info.c
	(build_global_info), tp/Texinfo/XS/main/document_types.h
	(GLOBAL_INFO), tp/Texinfo/XS/main/utils.c (delete_global_info),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (_get_parser_info),
	tp/t/test_document.t: remove input_perl_encoding.

2024-10-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser): never set the 'conf'
	parser key, it is not used since the time parser conf became internal
	only.

2024-10-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (parser),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser): set only parser keys
	from parser_document_parsing_options, which in practice means do not
	accept a registrar in options.

	* tp/Texinfo/Common.pm: remove %parser_configuration and
	%parser_settable_configuration.

2024-10-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm, tp/Texinfo/XS/parsetexi/Parsetexi.pm:
	remove registrar method, it is a bad idea to be able to access
	directly the registrar.

2024-10-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (perl_encoding_name): add function.

	* tp/Texinfo/ParserNonXS.pm (get_parser_info),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (_get_parser_info): determine
	Perl encoding based on global_info input_encoding_name by calling
	perl_encoding_name.  Remove get_perl_encoding.  Note that the warning
	in get_perl_encoding was not kept, as it cannot happen since
	input_encoding_name is only set if the perl encoding is known in Perl
	parser, and if in a list of known encoding, all known by Perl in C.

2024-10-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres: remove t/test_parser_registrar.t test, the
	registrar should be internal only.

2024-10-19  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: Document gnulib-tool network access.

2024-10-19  Gavin Smith <gavinsmith0123@gmail.com>

	Separate directory for non-gnulib m4 files (XS)

	* tp/Texinfo/XS/m4, tp/Texinfo/XS/build-aux/m4: Move directory.
	* tp/Texinfo/XS/configure.ac (AC_CONFIG_MACRO_DIRS):
	Change 'm4' to 'build-aux/m4'.
	* tp/Texinfo/XS/Makefile.am (ACLOCAL_AMFLAGS): Likewise.

2024-10-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/customization_options.c
	(options_list_add_option): replace option with the same name in list
	if already there.

2024-10-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c
	(destroy_converter_initialization_info),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER_INITIALIZATION_INFO):
	add OPTIONS options field and free it, in case a direct access to an
	OPTIONS structure is needed.

	* tp/Texinfo/XS/convert/texinfo.c (txi_converter_format_defaults): add
	to get default options based on a customization list and a format
	string, also setting the returned CONVERTER_INITIALIZATION_INFO
	options field.

	* tp/Texinfo/XS/convert/converter.c: move converter_set_document below
	convert API functions.

	* tp/Texinfo/XS/teximakehtml.c (main): add cmdline_options for options
	common for parser and converter.  Add some code in comments using
	txi_converter_format_defaults.  Move code around.

2024-10-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm: change in comments.

2024-10-19  Gavin Smith <gavinsmith0123@gmail.com>

	* autogen.sh: pass "-I build-aux/m4" to aclocal

2024-10-19  Gavin Smith <gavinsmith0123@gmail.com>

	Attempt at separate directory for non-gnulib m4 files (top level)

	* configure.ac (AC_CONFIG_MACRO_DIRS): Add with value of
	"build-aux/m4 gnulib/m4".  This means that gettextize can
	install files under build-aux/m4, not in the same directory
	as files from gnulib.
	* Makefile.am (ACLOCAL_AMFLAGS): Add -I build-aux/m4

	* build-aux/m4: add directory
	* gnulib/m4: remove several files that are only added by
	gettextize, not by gnulib --add-import

2024-10-19  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS: re-run "gettextize" and track files in
	new locations.

2024-10-19  Gavin Smith <gavinsmith0123@gmail.com>

	Attempt at separate directory for non-gnulib m4 files

	* tp/Texinfo/XS/configure.ac (AC_CONFIG_MACRO_DIRS):
	Add 'm4' as a directory as well as 'gnulib/m4'.
	* tp/Texinfo/XS/Makefile.am (ACLOCAL_AMFLAGS): Add '-I m4'.

	This means files from libtoolize and gettextize should be
	copied under tp/Texinfo/XS/m4, not tp/Texinfo/XS/gnulib/m4.

2024-10-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (messages_and_encodings_setup): rename
	txi_base_setup as messages_and_encodings_setup.

	* tp/Texinfo/XS/convert/texinfo.c (txi_general_setup): rename
	txi_setup as txi_general_setup and add a call to
	messages_and_encodings_setup.

	* tp/Texinfo/XS/convert/texinfo.c (txi_converter_output_format_setup):
	add a function to dispatch output format global data setup.

	* tp/Texinfo/XS/teximakehtml.c (main): update.

2024-10-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/texinfo.c (txi_document_remove)
	(txi_converter_reset, txi_converter_destroy): rename
	txi_remove_document as txi_document_remove, txi_reset_converter as
	txi_converter_reset and txi_destroy_converter as
	txi_converter_destroy, for consistency.  Update caller.

2024-10-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (converter_format_data)
	(converter_output, converter_convert),
	tp/Texinfo/XS/convert/converter.h (CONVERTER_FORMAT_DATA),
	tp/Texinfo/XS/convert/texinfo.c (txi_converter_output)
	(txi_converter_convert): add converter_output and converter_convert
	fields to CONVERTER_FORMAT_DATA and converter_output and
	converter_convert to dispatch conversion.  Use it for HTML.  Replace
	txi_html_convert and txi_html_output in texinfo.c by
	txi_converter_convert and txi_converter_output that call
	converter_output and converter_convert.

	* tp/Texinfo/XS/teximakehtml.c: call txi_converter_output.

2024-10-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am: remove specification of teximakehtml_LINK
	now that there is no C++ anymore, the default should be ok.

2024-10-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c,
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (init): move build_perl_info.c
	init code to Parsetexi.xs init and remove build_perl_info.c init
	function.

2024-10-19  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/generate_code_convert_data.pl: replace incorrect
	continue by next.  Report from Gavin.

2024-10-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (converter_setup),
	tp/Texinfo/XS/main/document.c: inline txi_setup_lib_data in
	converter_setup.

	* tp/Texinfo/XS/main/utils.c (txi_base_setup),
	tp/Texinfo/XS/main/build_perl_info.c (init): move code related to
	messages gettext and encoding conversion iniitialization from
	build_perl_info.c init to the new init function in utils.c.

	* tp/Texinfo/XS/teximakehtml.c (main): call txi_base_setup.  Rearrange
	code.

2024-10-19  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl: comment out $pkgdatadir as it is not used anymore.

2024-10-18  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: add note that gettext also needs to be upgraded
	under tp/Texinfo/XS.

2024-10-18  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/gnulib/gettext.m4: re-add file by running
	"gettextize" under tp/Texinfo/XS/gnulib and discarding most of
	the changes.

2024-10-18  Gavin Smith <gavinsmith0123@gmail.com>

	Revert removal of gnulib *.m4 files

	* gnulib/m4, tp/Texinfo/XS/gnulib/m4: revert removal of gettext.m4,
	nls.m4, po.m4 and progtest.m4.

	(Reverted commit dated 2024-07-28 10:45:10, applied 2024-10-01.)

2024-10-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/parser_conf.c (register_conf): break immediately
	if a slot is found.

2024-10-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/texinfo.c (txi_setup),
	tp/Texinfo/XS/teximakehtml.c (main): do not call html_format_setup in
	txi_setup to be output format independent, call in teximakehtml.c.

2024-10-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides): reorder code.

	* tp/Texinfo/XS/convert/texinfo.c, tp/Texinfo/XS/main/utils.c,
	tp/Texinfo/XS/main/utils.h: change in comments, rebase flag values.

2024-10-18  Gavin Smith <gavinsmith0123@gmail.com>

	Remove C++ source files

	* tp/Texinfo/XS/convert/call_html_cxx_function.cpp,
	* tp/Texinfo/XS/convert/call_html_cxx_function.h: remove

	* tp/Texinfo/XS/configure.ac: Remove AC_PROG_CXX check and
	check if C++ hashmap can be used.
	* tp/Texinfo/XS/Makefile.am (teximakehtml):
	Build without options for C++.

	* tp/Texinfo/XS/main/converter_types.h
	(enum ids_data_type): remove IDT_cxx_hashmap
	(CONVF_cxx_hashmap): remove

	* tp/Texinfo/XS/convert/converter.c (new_converter) [HAVE_CXX_HASHMAP],
	* tp/Texinfo/XS/convert/html_prepare_converter.c
	(html_prepare_conversion_units, html_register_id)
	(html_id_is_registered)  [HAVE_CXX_HASHMAP],
	* tp/Texinfo/XS/convert/html_converter_finish.c
	(html_reset_converter, html_free_converter) [HAVE_CXX_HASHMAP]:
	Remove all code.

2024-10-18  Gavin Smith <gavinsmith0123@gmail.com>

	Fix teximakehtml memory leak

	* tp/Texinfo/XS/teximakehtml.c: free variable before clobbering.

2024-10-18  Gavin Smith <gavinsmith0123@gmail.com>

	C hashmap implementation

	* tp/Texinfo/XS/convert/hashmap.c
	(init_registered_ids_c_hashmap, is_c_hashmap_registered_id)
	(c_hashmap_register_id, clear_registered_ids_c_hashmap)
	(free_registered_ids_c_hashmap): New functions.

	* tp/Texinfo/XS/main/converter_types.h
	(enum ids_data_type): add IDT_hashmap
	(CONVF_hashmap): add symbol
	(CONVERTER): add field 'registered_ids_c_hashmap'.

	* tp/Texinfo/XS/convert/html_prepare_converter.c
	(html_prepare_conversion_units_targets, html_converter_customize):
	Move initialisation of hash to html_prepare_conversion_units_targets.
	(Suggestion from Patrice.)  Add code to use C hashmap implementation
	if selected.  Call ids_hashmap_predicted_values for the number of
	bins.

	* tp/Texinfo/XS/convert/html_prepare_converter.c
	(html_register_id, html_id_is_registered) <IDT_hashmap>:
	Call appropriate functions for C hashmap implementation.

	* tp/Texinfo/XS/convert/html_converter_finish.c
	(html_reset_converter, html_free_converter) <IDT_hashmap>:
	Call appropriate functions for C hashmap implementation.

	* tp/Texinfo/XS/convert/converter.c (new_converter),
	* tp/Texinfo/XS/convert/get_converter_perl_info.c
	(get_or_create_sv_converter): Use C hashmap implementation by default.
	* tp/Texinfo/XS/teximakehtml.c (main): Use CONVF_hashmap.

2024-10-18  Patrice Dumas  <pertusus@free.fr>

	Function to estimate number of "targets" for a manual

	* tp/Texinfo/XS/convert/html_prepare_converter.c
	(ids_hashmap_predicted_values): New function.

2024-10-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Translations.pm (translate_string),
	tp/Texinfo/XS/main/translations.c (translate_string): consider an
	empty string to be an unset value, and do the same checks in C and
	Perl.

2024-10-17  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: State new installation location for texi2any files.

2024-10-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am, tp/tests/Makefile.am: add comments for script calls
	that are also in autogen.sh to remind that they should be kept in sync
	with autogen.sh calls.

2024-10-16  Vitezslav Crhonek  <vcrhonek@redhat.com>

	* install-info/install-info.c (open_possibly_compressed_file):
	Fix resource leak by calling fclose in case of errors.

2024-10-16  Gavin Smith <gavinsmith0123@gmail.com>

	* install-info/install-info.c (readfile): re-order code
	to prevent possible memory leak.  Report from Vitezslav Crhonek.

2024-10-16  Vitezslav Crhonek  <vcrhonek@redhat.com>

	* install-info/install-info.c (munge_old_style_debian_options):
	Add missing initializer.

2024-10-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/errors.c (message_list_line_error_ext)
	(message_list_command_warn, pmessage_list_command_warn)
	(message_list_command_error, message_list_document_error)
	(message_list_document_warn), tp/Texinfo/XS/main/utils.c
	(non_perl_xasprintf, xasprintf): add missing "va_end".  Based on
	Vitezslav Crhonek report.

2024-10-15  Patrice Dumas  <pertusus@free.fr>

	* tp/init/book.pm (book_in_contents_button, @book_contents_buttons)
	(@book_output_unit_buttons): for regular output units (not for Top or
	special output units), have the Contents button link to the section
	location in table of contents, similarly with TOC_LINKS, but for
	a button.  Based on Rudolf Adamkovič idea.

2024-10-15  Gavin Smith <gavinsmith0123@gmail.com>

	Fix install-info memory leak

	* install-info/install-info.c (open_possibly_compressed_file):
	Move a function call returning memory that has to be freed
	to prevent a theoretical memory leak in case of an error calling
	fclose or freopen.  Report from Vitezslav Crhonek.

2024-10-15  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: add .git/hooks/post-commit script

2024-10-15  Vitezslav Crhonek  <vcrhonek@redhat.com>

	* info/util.c: add missing "va_end"

2024-10-15  Gavin Smith <gavinsmith0123@gmail.com>

	* info/session.c (info_menu_or_ref_item, info_intuit_options_node)
	(info_goto_invocation_node): Use xasprintf instead of xmalloc/sprintf.
	The previous code appeared not to allocate memory for a final null.

	Report from Vitezslav Crhonek.

2024-10-15  Vitezslav Crhonek  <vcrhonek@redhat.com>

	* info/infomap.c (fetch_user_maps): fix resource leak

2024-10-15  Vitezslav Crhonek  <vcrhonek@redhat.com>

	* info/variables.c (read_variable_name): fix memory leak

2024-10-15  Gavin Smith <gavinsmith0123@gmail.com>

	Fix info memory leak

	* info/variables.c (set_variable): Free user-entered line.

2024-10-15  Gavin Smith <gavinsmith0123@gmail.com>

	Always null terminate key sequence array

	* info/infokey.c (compile): Always null-terminate 'seq' array.
	Avoid filling the array completely as this could lead to a segfault
	if exactly 20 characters were given in a key sequence, e.g.

	bbbbbbbbbbbbbbbbbbb down-line

	Report of uninitialised variable from Vitezslav Crhonek, found
	with a static analysis tool.

2024-10-15  Gavin Smith <gavinsmith0123@gmail.com>

	* install-info/install-info.c (open_possibly_compressed_file):
	Correct check of return value of freopen.

	Report from Vitezslav Crhonek <vcrhonek@redhat.com>.

2024-10-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/configure.ac (HAVE_USABLE_GETENV_IN_XS): redirect
	stderr to /dev/null for test too.  Fix the use of AC_DEFINE to define
	only if the test succeeded.

	* tp/Texinfo/XS/main/call_perl_function.c
	(call_translations_translate_string): fix Perl function name.

2024-10-13  Patrice Dumas  <pertusus@free.fr>

	* NEWS, tp/Texinfo/Convert/HTML.pm (_external_node_href),
	tp/Texinfo/XS/convert/format_html.c (external_node_href): remove .inf
	or .info in cross-reference manual names, but warn that they should
	not have been there.  There are indeed manuals with .info in
	cross-references, for instance the glibc manual.  Report from Gavin.

2024-10-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/configure.ac (usable_getenv_in_XS)
	(HAVE_USABLE_GETENV_IN_XS): add a define set if getenv can safely be
	used in Perl, based on Perl version >= 5.38.

	* tp/Texinfo/XS/main/call_perl_function.c
	(call_translations_translate_string),
	tp/Texinfo/XS/main/replace_perl_api_call.c
	(call_translations_translate_string): add call to
	Texinfo::Translation::translate_string.

	* tp/Texinfo/Translations.pm (_XS_configure),
	tp/Texinfo/XS/convert/texinfo.c (txi_setup),
	tp/Texinfo/XS/main/DocumentXS.xs
	(configure_output_strings_translations),
	tp/Texinfo/XS/main/translations.c (use_external_translate_string)
	(configure_output_strings_translations, translate_string): add an
	argument to configure_output_strings_translations to specify whether
	to call Perl translate_string or not.  Set the variable
	use_external_translate_string variable based on the argument, or on
	HAVE_USABLE_GETENV_IN_XS if the argument is 0.  Use
	use_external_translate_string in translate_string to determine if
	call_translations_translate_string should be called.

	Report from Gavin.

2024-10-14  Gavin Smith <gavinsmith0123@gmail.com>

	* util/htmlxref.cnf (termcap): add link to single page version.
	(Node anchors are broken as this is from an old version of
	texi2html (1.52), but better than nothing.)

2024-10-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/html_tests.t (inline_in_node): test showing
	that HTML elements in @inlineraw on @node and @title line end up in
	attributes in link or meta.  Based on Benjamin Kalish report.

2024-10-13  Gavin Smith <gavinsmith0123@gmail.com>

	* info/infokey.c (compile): warn if octal sequence is out of range.
	Report from Andreas Schwab.

2024-10-13  Gavin Smith <gavinsmith0123@gmail.com>

	Avoid compiler warning

	* info/infokey.c (compile): declare a variable as an int to avoid
	a compiler warning "comparison is always true due to limited
	range of data type" with gcc -Wtype-limits.

	Report from Patrice and fix from Eli.

2024-10-13  Patrice Dumas  <pertusus@free.fr>

	* tp/init/documentation_examples.pm (MATHJAX_CONFIGURATION)
	(HTML_MATH): set MATHJAX_CONFIGURATION to the Texinfo manual example
	and HTML_MATH to mathjax.

	* tp/t/init_files_tests.t ($documentation_examples_text): add
	@displaymath using \dv from the LaTeX physics package.

2024-10-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/format_html.c (file_header_information):
	do not output mathjax header on every file if split.
	Remove trailing end of line from text output if MATHJAX_CONFIGURATION
	is set.

2024-10-13  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (HTML Xref Link Basics): edit text at end of
	node discussing split/mono links.

2024-10-13  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: add note about removing generated gnulib header
	files after "git switch".

2024-10-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/format_html.c (file_header_information),
	tp/Texinfo/XS/convert/html_prepare_converter.c (html_setup_output):
	only put extra settings in MATHJAX_CONFIGURATION in C code.  Do not
	set MATHJAX_CONFIGURATION in html_setup_output, move default MathJax
	configuration to file_header_information.  Always output it.  Only
	output value of MATHJAX_CONFIGURATION if set.

2024-10-13  Gavin Smith <gavinsmith0123@gmail.com>

	Macros for struct initialiser

	* info/variables.c (info_variables): Use macros to generate
	some of the initialiser.  This is shorter and also allows
	providing the final 'where_set' value explicitly.

2024-10-13  Gavin Smith <gavinsmith0123@gmail.com>

	Only put extra settings in MATHJAX_CONFIGURATION

	* tp/Texinfo/Convert/HTML.pm (_setup_output): do not set
	MATHJAX_CONFIGURATION.
	(_file_header_information) <MathJax>: Move default MathJax
	configuration here from _setup_output.  Always output it.
	Only output value of MATHJAX_CONFIGURATION if set.
	* doc/texinfo.texi (MathJax Customization Variables): update.
	do not show default texi2any configuration of MathJax.

2024-10-13  Patrice Dumas  <pertusus@free.fr>

	* info/util.c (printed_representation): add a comment to explain tab
	printed representation, based on Gavin explanation.

2024-10-13  Patrice Dumas  <pertusus@free.fr>

	* info/nodes.c (make_file_buffer, info_create_tag, info_create_node):
	initialize with memset call zeroing the structure.

2024-10-13  Patrice Dumas  <pertusus@free.fr>

	Install texi2any codes and included js in datadir/texi2any

	* configure.ac (CONVERTER), tp/Texinfo/XS/configure.ac (CONVERTER):
	add CONVERTER, set to texi2any.

	* Pod-Simple-Texinfo/Makefile.am (pod2texi),
	Pod-Simple-Texinfo/pod2texi.pl (BEGIN), tp/Makefile.am (do_subst),
	tp/texi2any.pl (BEGIN), util/Makefile.am (txixml2texi),
	util/txixml2texi.pl (BEGIN): pass libdir separately to set xsdir.
	Rename $lib_dir as $modules_dir.

	* Pod-Simple-Texinfo/Makefile.am (converterdatadir, modulesdir)
	(pod2texi), Pod-Simple-Texinfo/pod2texi.pl (BEGIN), js/Makefile.am
	(converterdatadir, jsdir), tp/Makefile.am (converterdatadir, do_subst)
	(modulesdir, convertmodulesdir, extensionsdir, initdir)
	(install-data-local, uninstall-local), tp/Texinfo/Convert/HTML.pm
	(_do_js_files), tp/Texinfo/ModulePath.pm.in ($converterdatadir),
	tp/Texinfo/XS/Makefile.am (converterlibdir, xsdir, converterdatadir)
	(modulesdir), tp/Texinfo/XS/convert/ConvertXS.xs (init),
	tp/Texinfo/XS/convert/convert_html.c (html_do_js_files),
	tp/Texinfo/XS/convert/converter.c (setup_converter_paths_information)
	(converter_setup), tp/Texinfo/XS/convert/converter.h
	(INSTALLED_PATHS), tp/Texinfo/XS/convert/texinfo.c (txi_setup),
	tp/Texinfo/XSLoader.pm (init), tp/texi2any.pl (BEGIN, $converter)
	($extensions_dir, @converter_config_dirs, @converter_init_dirs),
	util/Makefile.am (txixml2texi), util/txixml2texi.pl (BEGIN): pass
	CONVERTER, install in $(datadir)/$(CONVERTER), rename/replace
	pkgdatadir by converterdatadir.

2024-10-12  Patrice Dumas  <pertusus@free.fr>

	* info/nodes.c (info_create_tag): do not set nodestart_adjusted to -1,
	this special value is not used anymore.

2024-10-12  Patrice Dumas  <pertusus@free.fr>

	* info/nodes.c (info_node_of_tag_ext): call adjust_nodestart directly,
	as if nodelen is > 0 nodestart_adjusted is necessarily set, while if
	nodelen is 0, nodestart_adjusted is not set.

2024-10-12  Patrice Dumas  <pertusus@free.fr>

	* info/nodes.c (find_node_from_tag, info_node_of_tag_ext): remove
	unused parent argument.

2024-10-12  Patrice Dumas  <pertusus@free.fr>

	* info/search.c: add const.

2024-10-12  Patrice Dumas  <pertusus@free.fr>

	* info/nodes.c (info_node_of_tag_ext): add an intermediary variable
	for node tag and node tag pointer for a clearer code.  Rename input
	tag and tag pointer variables.

2024-10-12  Patrice Dumas  <pertusus@free.fr>

	* info/indices.c (info_indices_of_file_buffer), info/nodes.c
	(build_tag_table, get_nodes_of_tags_table, info_create_tag)
	(info_node_of_tag_ext), info/nodes.h (T_IsAnchor), info/scan.c
	(copy_input_to_output, scan_node_contents), info/session.c
	(info_last_node, info_first_node, info_search_internal): add
	T_IsAnchor tag flag to mark that a tag is a Ref anchor tag.  Do not
	use TAG cache.nodelen to determine if a tag is an anchor, use the
	flag.  Initialize TAG cache.nodelen to 0 and consider that the nodelen
	has not been found for a node tag if cache.nodelen is 0.

2024-10-12  Patrice Dumas  <pertusus@free.fr>

	* info/nodes.h, info/session.c: separate flag for tags from flags for
	nodes.  Use a leading T_ for for tag flags.  Move tag flag near TAG.

2024-10-12  Patrice Dumas  <pertusus@free.fr>

	* info/nodes.c (info_node_of_tag_ext): do not copy tag flags to node.
	The only flag set in tag is N_SeenBySearch and it is not used in nodes.

2024-10-12  Patrice Dumas  <pertusus@free.fr>

	* info/nodes.h: change in comments.  Move values for FILE_BUFFER.flags
	near FILE_BUFFER.  No change in code.

2024-10-12  Patrice Dumas  <pertusus@free.fr>

	* info/nodes.c, info/nodes.h, info/session.c: separate flags for nodes
	and tags from flags for file buffers.  Use a leading F_ for file
	buffer flags.

2024-10-12  Patrice Dumas  <pertusus@free.fr>

	* info/nodes.c (info_node_of_tag_ext): do not set N_IsCompressed on
	nodes, it is only relevant and used at the file buffer level.

2024-10-12  Patrice Dumas  <pertusus@free.fr>

	* info/nodes.c (init_file_buffer_tag), info/man.c (get_manpage_node):
	do not set N_HasTagsTable on a manpage node nor on a tag entry, it is
	only relevant and used at the file buffer level.

2024-10-12  Patrice Dumas  <pertusus@free.fr>

	* info/nodes.c (init_file_buffer_tag): do not set N_TagsIndirect on
	the entry, it is only relevant and used at the file buffer level.

2024-10-12  Patrice Dumas  <pertusus@free.fr>

	* info/nodes.c (info_create_node): initialize nodelen field to 0.
	Previously it was set to -1, but it is confusing because the value was
	never used.  In most cases nodelen is set right after the call to
	info_create_node.  In case of man page, it may not be set right away,
	but then it is the contents field that is used to determine if the man
	page node was setup.

2024-10-12  Patrice Dumas  <pertusus@free.fr>

	* info/dir.c, info/display.c, info/scan.c: reindent, replace tabs by
	spaces, remove spaces, minor edit of a comment.

2024-10-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/html_prepare_converter.c
	(html_initialize_output_state): add end of line to debug message.

2024-10-11  Gavin Smith <gavinsmith0123@gmail.com>

	CHECK_HTMLXREF on by default.

	* tp/Texinfo/Convert/converters_defaults.txt (html):
	Set CHECK_HTMLXREF on by default.
	* tp/t/test_utils.pl (set_converter_option_defaults):
	Clear CHECK_HTMLXREF.

	* doc/texinfo.texi (File Names and Links Customization for HTML),
	* NEWS: Update.

2024-10-11  Patrice Dumas  <pertusus@free.fr>

	* info/nodes.c (info_get_node_with_defaults): remove filename_in in
	condition inside, as it can only be setbecause of condition outside.
	Do not initialize filename and nodename, they are always set.

2024-10-11  Patrice Dumas  <pertusus@free.fr>

	* info/footnotes.c (make_footnotes_node): use fn_node directly to
	determine if the node associated to the footnote was found.

2024-10-11  Patrice Dumas  <pertusus@free.fr>

	* info/window.c: reindent, replace tabs by spaces, remove spaces.

2024-10-11  Patrice Dumas  <pertusus@free.fr>

	* info/session.c (info_handle_pointer): abort if the input label is
	not one of the expected labels.  It should never happen as the callers
	set the label explicitely.

2024-10-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/handle_commands.c (parse_rawline_command):
	go to unmacro_badname when there is trailing garbage on @unmacro line,
	not to the @clear similar label.

2024-10-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal): fix
	condition to be cmd is CM_item and not there is a cmd.

2024-10-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (is_content_empty): fix condition.

2024-10-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/DocumentXS.xs (gdt): add missing braces for
	block.  (Note that the corresponding code is not used).

2024-10-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/format_html.c (html_internal_command_tree):
	fix condition (found by clang "logical not is only applied to the left
	hand side of this comparison").

2024-10-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/macro.c (parse_macro_command_line): remove
	variable set but unused.

2024-10-11  Patrice Dumas  <pertusus@free.fr>

	* info/display.c (display_update_node_text), info/session.c
	(looking_at_newline, looking_at_alnum): check mbi_avail return value.
	The caller probably makes sure that there are bytes, but this should
	be more robust and could still be relevant for invalid multibytes
	sequences depending on mbi_avail implementation.

2024-10-10  Patrice Dumas  <pertusus@free.fr>

	* info/terminal.c (keys, keys2), info/variables.c (styles),
	tp/Texinfo/XS/main/utils.c (def_aliases, default_expanded_formats),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line),
	tp/Texinfo/XS/parsetexi/indices.c (default_indices)
	(def_command_indices), tp/Texinfo/XS/parsetexi/def.c (def_maps): add
	braces for each structure in arrays initialization.

2024-10-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/command_data.awk,
	tp/Texinfo/XS/main/element_types.awk,
	tp/maintain/generate_code_convert_data.pl,
	tp/maintain/regenerate_C_options_info.pl,
	tp/maintain/setup_converters_code_tables.pl: add braces for each
	structure in arrays.  Update scripts generating codes reading
	command_data.c to get the commands order.

2024-10-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/configure.ac (PERL_LIBS, perl_conf_LDFLAGS)
	(platform_PERL_LIBADD): set PERL_LIBS to -L.. -l for Perl.  Add it to
	platform_PERL_LIBADD but not to perl_conf_LDFLAGS.

	* tp/Texinfo/XS/Makefile.am (TestXS_la_LIBADD, MiscXS_la_LIBADD)
	(XSParagraph_la_LIBADD, libtexinfo_la_LIBADD, libtexinfoxs_la_LIBADD)
	(libtexinfo_convert_la_LIBADD, Parsetexi_la_LIBADD)
	(DocumentXS_la_LIBADD, StructuringTransfoXS_la_LIBADD)
	(IndicesXS_la_LIBADD, ConvertXS_la_LIBADD): postpend
	$(platform_PERL_LIBADD) when linking against Perl such that the
	library appears after the other libraries to resolve the symbols.
	From Eli.

2024-10-10  Patrice Dumas  <pertusus@free.fr>

	* info/session.c (info_read_and_dispatch, info_next_line)
	(info_prev_line), info/window.c (window_make_window)
	(set_window_pagetop), info/window.h (WINDOW): instead of using -1
	value of WINDOW goal_column to signal that the cursor should be
	placed in the column it is currently in, add and use the
	W_CurrentColGoal flag.  Set WINDOW goal_column to size_t as it is
	compared to unsigned fields of LINE_MAP.

2024-10-10  Patrice Dumas  <pertusus@free.fr>

	* info/window.c (collect_line_starts): add a comment to explain that
	there is a comparison of unsigned and signed integers.

2024-10-10  Patrice Dumas  <pertusus@free.fr>

	* info/t/Init-test.inc: modify proposed valgrind call in comment to
	use basename for out of source builds and put logs in t/.

2024-10-10  Patrice Dumas  <pertusus@free.fr>

	* info/filesys.c (filesys_read_info_file): convert to ssize_t to use
	as read return value an not to size_t and convert to size_t later on.
	Do not cast finfo->st_size to (long), leave it as off_t and convert to
	either size_t or ssize_t depending on how the file is read.  Add
	comments to mark conversion from unsigned to signed.

	* info/filesys.c (convert_eols): use size_t in argument an as return
	type.

2024-10-10  Patrice Dumas  <pertusus@free.fr>

	* info/window.h (LINE_MAP): use long for nline field to be consistent
	with the remaining line numbers that are unsigned.

	* info/window.c (set_window_pagetop, window_line_of_point)
	(line_map_init, window_compute_line_map): replace some int by long
	for consistency across functions, structure fields and variables
	types.

2024-10-09  Patrice Dumas  <pertusus@free.fr>

	Remove N_CannotGC, it is checked but never set

	* info/session.c (gc_file_buffers_and_nodes): do not check N_CannotGC
	in file buffer flag as it is not set anywhere.

2024-10-09  Patrice Dumas  <pertusus@free.fr>

	Remove N_UpdateTags, it is set but never checked

	* info/nodes.c (adjust_nodestart): do not set N_UpdateTags in
	node->flags as it is not checked anywhere, and nodestart_adjusted
	is set right away for the tag, not need to change the tag further.

2024-10-09  Patrice Dumas  <pertusus@free.fr>

	* info/window.c (window_log_to_phys_line): use consistent type.

2024-10-09  Patrice Dumas  <pertusus@free.fr>

	* info/session.c (info_menu_or_ref_item): use long consistently with
	node and windows length types, call labs instead of abs.

2024-10-09  Patrice Dumas  <pertusus@free.fr>

	* info/session.c (ask_for_search_string): explicitely convert the
	min_search_length variable to size_t before comparing with mbslen.

	* info/util.c (text_buffer_fill): use size_t to be consistent.

2024-10-09  Patrice Dumas  <pertusus@free.fr>

	* info/session.c (move_to_goal_column): use size_t for long.  The
	window->goal_column is necessarily positive, as move_to_goal_column is
	called after window_get_cursor_column if window->goal_column was
	negative.  And the LINE_MAP structure uses size_t for columns indices.

2024-10-09  Patrice Dumas  <pertusus@free.fr>

	* info/search.c (extend_matches, regexp_search), info/window.h
	(MATCH_STATE): make MATCH_STATE buflen long to be consistent with
	nodes length types and also with regoff_t.

2024-10-09  Patrice Dumas  <pertusus@free.fr>

	* info/nodes.c (info_reload_file_buffer_contents): add an intermediate
	variable for filesize passed to filesys_read_info_file.

	* info/nodes.h (FILE_BUFFER), info/nodes.c
	(info_reload_file_buffer_contents, info_load_file): use long for
	filesize instead of size_t to be sure that comparisons with node and
	search length are always safe.  Add comments to explicit where the
	conversion from size_t to long is done.

2024-10-09  Patrice Dumas  <pertusus@free.fr>

	* info/nodes.c (info_create_node): use consistent type.

	* info/nodes.c (info_node_of_tag_ext): remove cast of node->nodelen to
	unsigned long, it is not useful, node->nodelen should be positive at
	this point, and could be dangerous, as node->display_pos is long.

	* info/nodes.c (info_node_of_tag_ext): always reset node->display_pos
	to zero if negative.  It should not happen, but it is always safer.

2024-10-09  Patrice Dumas  <pertusus@free.fr>

	* info/echo-area.c (remove_completion_duplicates, build_completions):
	get completions number in argument and return the new completions
	number.

	* info/echo-area.c (build_completions): use a size_t index variable to
	add entries to completions_found.  Pass this variable to
	remove_completion_duplicates and retrieve the modified value.  Set
	completions_found_index at this point, such that the conversion to
	long is explicit, and mark in a comment that the completions_found*
	and LCD_completion should not be modified after that point and before
	a call to build_completions.

2024-10-09  Patrice Dumas  <pertusus@free.fr>

	* info/echo-area.c (completions_found_index)
	(info_read_completing_internal, ea_possible_completions)
	(build_completions, remove_completion_duplicates): use long even if
	the variable should never be negative as it is more robust for
	comparisons and consistent with windows fields types.

2024-10-09  Patrice Dumas  <pertusus@free.fr>

	* info/display.c (display_update_one_window): use long type consistent
	with windows fields types.

2024-10-08  Patrice Dumas  <pertusus@free.fr>

	* info/display.c (display_update_line): add int variables to avoid
	issues with unsigned int underflow and compare only signed integers
	with signed integers.

2024-10-08  Patrice Dumas  <pertusus@free.fr>

	* info/man.c (xrefs_of_manpage): use int for consistency.

	* info/display.c (display_process_line), info/util.c (ansi_escape)
	(printed_representation), info/man.c (clean_manpage), info/window.c
	(calculate_line_starts, window_compute_line_map): use int for
	ansi_escape len and printed_representation pbytes and pchars for
	consistency and also in case wcwidth in printed_representation returns
	a negative value.

2024-10-08  Patrice Dumas  <pertusus@free.fr>

	* info/nodes.c (SUBFILE), info/nodes.h (TAG): go back to long type
	instead of size_t even if the variable should never be negative as it
	is more robust for comparisons, as discussed in:
	https://lists.gnu.org/archive/html/bug-texinfo/2024-10/msg00067.html

2024-10-08  Patrice Dumas  <pertusus@free.fr>

	* info/dir.c (add_menu_to_node): call insert_text_into_node with
	node->nodelen argument directly instead of setting an intermediate
	variable.

2024-10-08  Patrice Dumas  <pertusus@free.fr>

	* info/nodes.c (SUBFILE): turn first_byte field to size_t as it is
	certain that it is positive now.

	* info/nodes.c (get_tags_of_indirect_tags_table): rename
	first_byte variable as line_first_byte.

2024-10-08  Patrice Dumas  <pertusus@free.fr>

	* info/nodes.c (get_tags_of_indirect_tags_table): ignore a bogus entry
	in indirect tags table with a negative offset for a file.

2024-10-07  Patrice Dumas  <pertusus@free.fr>

	* info/search.c (find_file_section): stop as soon as the position
	reached the binding end.

2024-10-07  Patrice Dumas  <pertusus@free.fr>

	* info/nodes.c (DEFAULT_INFO_TAG_TABLE_RANGE)
	(build_tags_and_nodes): rename DEFAULT_INFO_LOCAL_VAR_RANGE as
	DEFAULT_INFO_TAG_TABLE_RANGE.  Avoid setting search binding end or
	start to negative numbers, even temporarily, using
	DEFAULT_INFO_TAG_TABLE_RANGE as in get_file_character_encoding.

2024-10-07  Patrice Dumas  <pertusus@free.fr>

	* info/nodes.c (info_create_tag), info/nodes.h (TAG): set TAG
	nodestart to be size_t and initialize to 0.  Indeed, right after
	info_create_tag is called, the tag nodestart is set to a non-negative
	value.  It should not be possible to have 0 for nodestart from
	build_tag_table as there is at least the node separator.  A bogus
	entry in tag table or a 0 in tag table is possible and although it is
	unlikely to be correct, nodestart can be adjusted.

	* info/nodes.c (adjust_nodestart, info_node_of_tag_ext): remove
	conditions on tag->nodestart being >= 0, as it is always true.

2024-10-07  Patrice Dumas  <pertusus@free.fr>

	* info/nodes.c (get_nodes_of_tags_table): ignore node with bogus
	negative offset in tag table.

2024-10-07  Patrice Dumas  <pertusus@free.fr>

	* info/nodes.c (DEFAULT_INFO_LOCAL_VAR_RANGE)
	(get_file_character_encoding, adjust_nodestart): avoid setting
	search binding end or start to negative numbers, even temporarily.

2024-10-07  Patrice Dumas  <pertusus@free.fr>

	* info/search.c (looking_at): modify comment, as the string is
	necessarily found.

2024-10-07  Patrice Dumas  <pertusus@free.fr>

	* info/dir.c (insert_text_into_node): use size_t in argument for a
	length.

	* info/nodes.c (get_node_length): return size_t.

	* info/man.c (get_manpage_node, xrefs_of_manpage), info/nodes.c
	(build_tags_and_nodes, get_tags_of_indirect_tags_table)
	(get_file_character_encoding, get_node_length), info/search.c
	(search_forward, search_backward, string_in_line): use size_t for
	variables representing length, numbers or indices in arrays.

2024-10-07  Gavin Smith <gavinsmith0123@gmail.com>

	Fix info.js index lookup to go to correct location

	* js/info.js (cache_index_links): Save location of index anchor
	rather than just the node it is in.  This means that lookups
	of the index entry can scroll to the correct part of the node.
	Rename local variables to refer to "entries" rather than "links"
	as this is now misnamed. 
	(init_sidebar): Always use result of linkid_split to update sidebar.

	Report and investigation by Benjamin Kalish.

2024-10-07  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (@cartouche): Remove statement that there is
	a simple rectangle for cartouche in HTML output.

2024-10-07  Gavin Smith <gavinsmith0123@gmail.com>

	* js/info.js (config): Rename INDEX_NAME to TOP_NAME and
	INDEX_ID to TOP_ID to avoid confusion with document indices.
	Give TOP_ID the default value "top" instead of "index".

2024-10-06  Gavin Smith <gavinsmith0123@gmail.com>

	* js/info.js: add more debug statements

2024-10-06  Patrice Dumas  <pertusus@free.fr>

	* info/scan.c (match_in_match_list): add an indicatric variable such
	that index can be used solely as an index.

	* info/scan.c (read_bracketed_filename, read_quoted_string),
	info/search.c (skip_whitespace, skip_whitespace_and_newlines)
	(skip_non_whitespace, skip_node_separator), info/window.c
	(window_point_to_column): return size_t as it is a length.

	* info/window.c (window_get_cursor_column): return long as it is the
	type of the variable assigned to.

	* info/scan.c (read_quoted_string, skip_input), info/search.c
	(match_in_match_list, match_by_index, at_end_of_matches): use size_t
	in argument for an index in array, a length or a number.

	* info/echo-area.c (ea_possible_completions)
	(remove_completion_duplicates), info/info.c
	(info_find_matching_files), info/infopath.c (infopath_add_dir),
	info/nodemenu.c (get_visited_nodes), info/scan.c (read_quoted_string)
	(parse_top_node_line, scan_reference_label, scan_reference_target),
	info/search.c (match_in_match_list, find_file_section), info/session.c
	(forget_window_and_nodes, point_forward_char, point_forward_word)
	(gc_file_buffers_and_nodes, info_search_in_node_internal)
	(wipe_seen_flags, info_tree_search, pop_isearch, show_isearch_prompt)
	(initialize_byte_map), info/terminal.c (initialize_byte_map): use
	size_t for variables representing length, numbers or indices in
	arrays.

	* info/echo-area.c (input_line_node, LCD_reference): complete with 0
	for code clarity.

	* info/session.c (info_handle_pointer): add const.

2024-10-06  Patrice Dumas  <pertusus@free.fr>

	* info/infomap.c (locate_init_file): initialize filename such that it
	is not used uninitialized if homedir is not set.

2024-10-06  Patrice Dumas  <pertusus@free.fr>

	* configure.ac (additional-checks), tp/Texinfo/XS/configure.ac
	(additional-checks, DISABLE_ADDITIONAL_CHECKS): add configure
	--enable-additional-checks and associated DISABLE_ADDITIONAL_CHECKS
	automake conditional.

	* tp/Texinfo/XS/Makefile.am (noinst_PROGRAMS): build teximakehtml only
	if DISABLE_ADDITIONAL_CHECKS is not set.

2024-10-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/replace_perl_api_call.c (call_setup_collator):
	remove bug message as this function may be called if not linked
	against Perl and a collation locale was specified but not found.

	* tp/Texinfo/XS/main/manipulate_indices.c (setup_collator): If there
	is no collator returned by call_setup_collator, fallback to
	ctn_no_unicode.  Happens if not linked against Perl and a collation
	locale was specified but not found.  May possibly happen in other
	cases.

	Report from Gavin.

2024-10-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/teximakehtml.c (test_parser_EXPANDED_FORMATS_array)
	(main): expande @iftex sections in test mode only, by default only
	expand @ifhtml.  Report from Gavin.

2024-10-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ManipulateTree.pm (move_index_entries_after_items),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(move_index_entries_after_items): consider a @subentry to be part of
	the moved index entries.  Report from Thérèse Godefroy.

	* tp/t/index_before_item.t (subentry): add test with @subentry in
	@cindex.

2024-10-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (converter_converter), 
	tp/Texinfo/XS/convert/texinfo.c (txi_converter_setup),
	tp/Texinfo/XS/teximakehtml.c (main): add C converter specific flags
	argument to converter_converter and txi_converter_setup.

	* tp/Texinfo/XS/convert/texinfo.c: remove txi_converter.

2024-10-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (noinst_PROGRAMS): build teximakehtml only
	if HAVE_ICONV is set.

2024-10-05  Gavin Smith <gavinsmith0123@gmail.com>

	info.js start tracing option

	* js/info.js (debug): add function.
	(config): add DEBUG key.
	(updater): log action type with debug

2024-10-05  Gavin Smith <gavinsmith0123@gmail.com>

	* js/info.js (updater): add a comment

2024-10-05  Gavin Smith <gavinsmith0123@gmail.com>

	Rename info.js variable

	* js/info.js (updater): Rename local variable from 'res' to
	'result' so that we are reminded that is it is the result that
	is returned from this function.  Correct spelling of "functional".

2024-10-05  Gavin Smith <gavinsmith0123@gmail.com>

	Rename info.js variable

	* js/info.js (init_index_page, updater):
	Rename "index" variable and fields to "TI_index" to mark it as a
	Text_input object and make it clearer when this object is being
	used as opposed to other various contradictory uses of the
	word "index".

2024-10-05  Gavin Smith <gavinsmith0123@gmail.com>

	* js/info.js (init_index_page, navigation_links): rename
	"menu" variable and fields to "TI_menu" to mark it as a
	Text_input object.

2024-10-05  Gavin Smith <gavinsmith0123@gmail.com>

	* js/info.js: Exdent entire body of file (except inside a string
	constant) in attempt to make nested functions more apparent.

2024-10-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am: add teximakehtml_LDFLAGS.  Set
	explicitely teximakehtml_LINK to link with C++ only if
	TXI_HAVE_CXX_HASHMAP is set.

2024-10-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/call_html_cxx_function.cpp,
	tp/Texinfo/XS/configure.ac (texinfo_cv_cxx_hashmap): include string
	for std::string.

	* tp/Texinfo/XS/configure.ac (TXI_HAVE_CXX_HASHMAP),
	tp/Texinfo/XS/Makefile.am (TXI_CXX_CPPFLAGS, teximakehtml_CPPFLAGS):
	rename HAVE_CXX_HASHMAP automake conditional as TXI_HAVE_CXX_HASHMAP.
	Only set an automake conditional for CXX hashmap, and pass directly -D
	in Makefile.am if set.

	* tp/Texinfo/XS/Makefile.am (C_libtexinfo_convert_sources)
	(teximakehtml_SOURCES): add call_html_cxx_function.cpp to
	teximakehtml_SOURCES only.

2024-10-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/configure.ac (PACKAGE_XS_VERSION),
	tp/Texinfo/XSLoader.pm ($xs_version, init): replace hyphen by dot in
	version for XS_VERSION comparison.  Rename
	PACKAGE_PERL_NUMERICAL_VERSION as PACKAGE_XS_VERSION and
	$numerical_version as $xs_version.

2024-10-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (XSLIBS_CPPFLAGS),
	tp/Texinfo/XS/configure.ac (PACKAGE_PERL_NUMERICAL_VERSION)
	(XS_VERSION), tp/Texinfo/XSLoader.pm ($numerical_version, init):
	setup numerical versions for XS_VERSION in configure.ac and compare
	numerical version in XSLoader.pm to compare numerical through
	bootstrap.

2024-10-05  Patrice Dumas  <pertusus@free.fr>

	TODO: remove more mixing of direct processing and libraries

2024-10-05  Gavin Smith <gavinsmith0123@gmail.com>

	Fix translated strings for definition lines beginning @tie{}--

	* po_document/adjust-translations.pl: adjust translations
	for strings beginning "@tie{}-- " to have an extra hyphen as
	these strings have changed in the program and the translations
	wouldn't be used otherwise.

2024-10-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/html_prepare_converter.c
	(html_process_css_file): add a semicolon (empty statement) after the
	nocharset label.  Report from Bruno.

2024-10-05  Patrice Dumas  <pertusus@free.fr>

	TODO: remove unclear information mixing direct processing and bindings

2024-10-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/html_converter_finish.c (html_free_converter):
	use a size_t index for self->pending_closes.list.

2024-10-05  Patrice Dumas  <pertusus@free.fr>

	Update tp/maintain/lib/README

2024-08-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm: reorder functions, add more
	sections in file.

2024-08-31  Patrice Dumas  <pertusus@free.fr>

	Changes in POD, TODO.

2024-08-31  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl ($configured_url): replace http by https in
	$configured_url.

2024-08-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/converters_defaults.txt (PACKAGE_URL),
	tp/texi2any.pl (%test_conf): replace http by https in
	converters_defaults.txt and for tests.

	* tp/Texinfo/XS/convert/texinfo.c (err_add_option_string_value)
	(txi_converter_setup): print out an error message if the customization
	option was not set.  Do not set *_CONF variables, these are not
	customization variables.

	* tp/Texinfo/XS/teximakehtml.c (main): set PACKAGE_VERSION and
	PACKAGE_AND_VERSION to the values set in texi2any.pl, not texi2any,
	for comparison with calls of in-source texi2any.pl.

2024-08-31  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl ($configured_package, $configured_name),
	tp/Texinfo/Convert/converters_defaults.txt (PACKAGE, PACKAGE_NAME):
	more consistent PACKAGE and PACKAGE_NAME values when not using
	values set by configure.

2024-08-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/configure.ac (AC_INIT): use the same package name as
	in the top-level configure.ac, such that the config.h variables are
	the same.

2024-08-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/texinfo.c (txi_converter_setup): set PACKAGE_*
	and PACKAGE_*_CONFIG customization variables.

	* tp/Texinfo/XS/teximakehtml.c (main): add an option to select either
	a reproducible demonstration mode or texi2any mimicking mode.

2024-08-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm: changes in POD documentation and
	comment.

2024-08-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (%common_converters_defaults)
	(output_tree), tp/Texinfo/Convert/HTML.pm (_external_node_href)
	(_setup_output), tp/Texinfo/Convert/IXIN.pm,
	tp/Texinfo/Convert/Info.pm (output), tp/Texinfo/Convert/LaTeX.pm
	(output), tp/Texinfo/Convert/Plaintext.pm (output),
	tp/Texinfo/XS/convert/converter.c (apply_converter_info)
	(destroy_converter_initialization_info)
	(copy_converter_initialization_info, free_generic_converter),
	tp/Texinfo/XS/convert/format_html.c (external_node_href),
	tp/Texinfo/XS/convert/get_converter_perl_info.c
	(get_converter_info_from_sv),
	tp/Texinfo/XS/convert/html_prepare_converter.c (html_setup_output),
	tp/Texinfo/XS/convert/texinfo.c (txi_converter_setup),
	tp/Texinfo/XS/main/build_perl_info.c
	(pass_generic_converter_to_converter_sv),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER_INITIALIZATION_INFO)
	(CONVERTER), tp/t/test_converter_option.t, tp/t/test_utils.pl
	(set_converter_option_defaults), tp/texi2any.pl: use
	TEXINFO_OUTPUT_FORMAT customization variable value instead of
	self->{'output_format'}.  Remove self->{'output_format'} and similar C
	data.

	* doc/texinfo.texi (Customization Variables and Options)
	(Customization Variables, Global Customization Variables): document
	TEXINFO_OUTPUT_FORMAT in global customization variables, and explain
	that TEXINFO_OUTPUT_FORMAT is alwyas set.

2024-08-30  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl ($output_format): rename $format as $output_format.

2024-08-30  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl ($main_program_set_options, $format)
	(set_cmdline_format, set_format): set $format from the
	TEXINFO_OUTPUT_FORMAT customization variable.  Set
	TEXINFO_OUTPUT_FORMAT to 'info' in $main_program_set_options.  Add
	the set_cmdline_format function to set TEXINFO_OUTPUT_FORMAT from
	command line, using directly the texinfoxml format name for xml.
	Modify set_format to call Texinfo::Config::texinfo_set_from_init_file
	to set TEXINFO_OUTPUT_FORMAT.  Call set_format for
	TEXINFO_OUTPUT_FORMAT environment variable, for
	GNUT_get_format_from_init_file value, but also for
	TEXINFO_OUTPUT_FORMAT set from the command line.

2024-08-26  Patrice Dumas  <pertusus@free.fr>

	* README-hacking, tp/Texinfo/XSLoader.pm (init),
	tp/Texinfo/XS/configure.ac (AC_INIT),
	tp/maintain/change_perl_modules_version.sh: in XSLoader.pm init,
	pass the module version as argument to the bootstrap XS object
	function to compare to the XS_VERSION value.  Set
	tp/Texinfo/XS/configure.ac AC_INIT version to the same version as the
	top-level configure.ac in change_perl_modules_version.sh.  Since
	XS_VERSION is set based on the configure.ac AC_INIT version through
	Makefile.am for all the XS objects, the version check should pass.

	* tp/Texinfo/XSLoader.pm (init), tp/Texinfo/Convert/ConvertXS.pm,
	tp/Texinfo/Convert/Paragraph.pm, tp/Texinfo/DocumentXS.pm,
	tp/Texinfo/IndicesXS.pm, tp/Texinfo/MiscXS.pm, tp/Texinfo/Parser.pm,
	tp/Texinfo/StructTransfXS.pm, tp/Texinfo/XS/TestXS.pm: remove the
	XSLoader.pm init module interface number argument.

2024-08-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/html_prepare_converter.c
	(parse_htmlxref_files): remove only the last /.

	* tp/Texinfo/XS/main/customization_options.c
	(add_option_strlist_value): add.

	* tp/Texinfo/XS/convert/converter.c (apply_converter_info)
	(destroy_converter_initialization_info)
	(copy_converter_initialization_info),
	tp/Texinfo/XS/convert/get_converter_perl_info.c
	(get_converter_info_from_sv),
	tp/Texinfo/XS/convert/html_prepare_converter.c (load_htmlxref_files),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER_INITIALIZATION_INFO)
	(CONVERTER): remove texinfo_language_config_dirs from converter and
	initialization info.  Set htmlxref_dirs from the
	TEXINFO_LANGUAGE_DIRECTORIES customization variable.

	* tp/Texinfo/XS/convert/texinfo.c (txi_converter_setup): get
	texinfo_language_config_dirs as a STRING_LIST and use
	add_option_strlist_value and a copy to set
	TEXINFO_LANGUAGE_DIRECTORIES.

	* tp/Texinfo/XS/teximakehtml.c (main): set
	texinfo_language_config_dirs as a string list.  Add the
	converter_texinfo_language_config_dirs to prepend the current
	directory and input_directory and pass to txi_converter_setup.

	* tp/Texinfo/XS/convert/html_prepare_converter.c
	(clear_string_variables_list, parse_htmlxref_files): clear and free
	variables lists and lines.

2024-08-25  Patrice Dumas  <pertusus@free.fr>

	* tp/ext/latex2html.pm (l2h_process), tp/ext/tex4ht.pm
	(tex4ht_prepare): create destination directory unless it is sure that
	it is the current directory.

	* tp/Texinfo/Common.pm (encode_file_name): add an intermediary
	variable.

2024-08-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c
	(find_perl_converter_class_converter_format): handle class_name being
	NULL.

	* tp/Texinfo/XS/convert/ConvertXS.xs (converter_defaults): initialize
	class_name.

2024-08-25  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl (%ignored_formats, %converter_format_format_name)
	(_format_expanded_formats, set_format): do not set default expanded
	formats in set_format, but after the format has been setup.  Keep
	track of ignored formats to be able to remove them from defaults
	expanded formats at that time.

2024-08-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/IXINSXML.pm (%defaults): do not set
	output_format, let it be set by the caller.

2024-08-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (%common_converters_defaults),
	tp/Texinfo/Convert/DocBook.pm (%defaults), tp/Texinfo/Convert/HTML.pm
	(%defaults), tp/Texinfo/Convert/IXINSXML.pm (%defaults)
	(converter_initialize), tp/Texinfo/Convert/LaTeX.pm (%defaults),
	tp/Texinfo/Convert/Plaintext.pm (%defaults),
	tp/Texinfo/Convert/TexinfoSXML.pm (%defaults),
	tp/Texinfo/Convert/TexinfoXML.pm (%defaults),
	tp/Texinfo/XS/convert/converter.c (apply_converter_info)
	(destroy_converter_initialization_info)
	(copy_converter_initialization_info, free_generic_converter),
	tp/Texinfo/XS/convert/get_converter_perl_info.c
	(get_converter_info_from_sv),
	tp/Texinfo/XS/convert/html_converter_init_options.c
	(html_converter_defaults), tp/Texinfo/XS/main/build_perl_info.c
	(pass_generic_converter_to_converter_sv),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER_INITIALIZATION_INFO)
	(CONVERTER): remove 'converted_format' from converters defaults.  It
	should never give a different information than the module name.
	Remove the similar information in C too.

	* tp/t/test_converter_option.t: remove tests related to
	converted_format.

2024-08-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (set_converter_init_information):
	remove enum converter_format argument.  Update callers.

2024-08-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Info.pm (format_warn_strong_note),
	tp/Texinfo/Convert/Plaintext.pm (format_warn_strong_note, _convert):
	add format_warn_strong_note methods to Plaintext.pm and Info.pm to
	determine if Note in @strong requires a warning, instead of using
	'converted_format'.  That way it is certain that it is a property of
	the Converter.

2024-08-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/get_perl_info.c (get_sv_options): inline
	get_sorted_options_key_sv_option in get_sv_options.  Remove
	get_sorted_options_key_sv_option.

	* tp/Texinfo/XS/main/get_perl_info.c: remove get_sv_configured_options.

2024-08-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (%XS_overrides, get_conf, set_conf):
	(force_conf), tp/Texinfo/XS/convert/ConvertXS.xs (set_conf, get_conf)
	(force_conf): directly override get_conf, set_conf and force_conf.
	Remove _XS_get_conf, _XS_set_conf and _XS_force_conf.

	* tp/Texinfo/XS/convert/ConvertXS.xs (set_conf, get_conf, force_conf),
	tp/Texinfo/XS/main/DocumentXS.xs (document_get_conf),
	tp/Texinfo/XS/main/build_perl_info.c
	(latex_build_options_for_convert_to_latex_math),
	tp/Texinfo/XS/main/get_perl_info.c: inline and remove set_sv_conf,
	force_sv_conf and build_sv_option_from_name.

2024-10-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/format_html.c (html_convert_heading_command):
	remove code related to in_skipped_node_top that was readded during
	rebasing, but should have stayed out since 2024-09-05 "set
	in_skipped_node_top when opening a @node (or associated @part), not
	after processing the contents.".

2024-10-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/html_converter_finish.c
	(reset_html_targets_list): free command_description.

	* tp/Texinfo/XS/convert/convert_html.c: remove duplicate
	default_css_string_format_protect_text, the function used is in
	format_html.c.

	* tp/Texinfo/XS/convert/format_html.c (html_command_description):
	do not set immediately a variable.

2024-10-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_command_description):
	remove build_html_formatting_state call, there is nothing set in C
	that needs to be passed.

	* tp/Texinfo/XS/convert/format_html.c (html_command_description): add
	const.

2024-10-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (MAINTAINERCLEANFILES): add Texinfo/Data.pm.

2024-10-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_convert_la_LIBADD): reorder
	libraries.

2024-10-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (EXTRA_DIST)
	(C_libtexinfo_convert_sources): remove converters_defaults.c, add
	call_html_cxx_function.cpp.

2024-08-23  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/lib/libintl-perl: update to libintl-perl-1.33.

2024-08-23  Patrice Dumas  <pertusus@free.fr>

	Add C++ code to have an hashmap when Perl is not used

	* tp/Texinfo/XS/configure.ac (AC_PROG_CXX, HAVE_CXX_HASHMAP): call
	AC_PROG_CXX to find a C++ compiler, test that a code with an
	unordered map compiles, and set HAVE_CXX_HASHMAP if so.

	* tp/Texinfo/XS/main/text.c (xvasprintf): use format instead of
	template, template seems to be reserved when compiled as C++, even in
	extern "C".

	* tp/Texinfo/XS/Makefile.am (libtexinfo_convert_la_SOURCES)
	(EXTRA_DIST), tp/Texinfo/XS/convert/call_html_cxx_function.cpp
	(init_registered_ids_hashmap, is_hashmap_registered_id)
	(hashmap_register_id, clear_registered_ids_hashmap)
	(free_registered_ids_hashmap), tp/Texinfo/XS/main/converter_types.h
	(enum ids_data_type, CONVERTER): add an implementation of the
	registered id interface using an unordered_map in
	call_html_cxx_function.cpp.  Add converter registered_ids_hashmap
	field and associated ids_data_type.

	* tp/Texinfo/XS/convert/converter.c (new_converter),
	tp/Texinfo/XS/convert/html_converter_finish.c (html_reset_converter)
	(html_free_converter), tp/Texinfo/XS/convert/html_prepare_converter.c
	(html_converter_customize, html_id_is_registered, html_register_id):
	call C++ hashmap interface functions if ids_data_type is
	IDT_cxx_hashmap.

	* tp/Texinfo/XS/convert/converter.c (converter_converter): set
	CONVF_cxx_hashmap.

2024-08-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(clear_registered_ids_hv, free_registered_ids_hv),
	tp/Texinfo/XS/convert/html_converter_finish.c (html_reset_converter)
	(html_free_converter),
	tp/Texinfo/XS/convert/replace_perl_call_html_function.c
	(clear_registered_ids_hv, free_registered_ids_hv): reset or free data
	only if it has been set, in particular if a converter is free'd right
	after having been setup.

2024-08-22  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/regenerate_C_options_info.pl: remove leading directory
	in #include generated for options_types.h.

2024-08-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/format_html.c (external_node_href),
	tp/Texinfo/XS/convert/html_prepare_converter.c (parse_htmlxref_files):
	no warning for an empty URL prefix, instead set it as an empty string.

2024-08-21  Patrice Dumas  <pertusus@free.fr>

	Implement reading xhtmlxref in C and XS

	* tp/Texinfo/Convert/HTML.pm (_parse_htmlxref_files): encode file name
	for error message if close failed.

	* tp/Texinfo/XS/convert/converter.c (apply_converter_info)
	(destroy_converter_initialization_info)
	(copy_converter_initialization_info),
	tp/Texinfo/XS/convert/get_converter_perl_info.c
	(get_converter_info_from_sv), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER_INITIALIZATION_INFO, CONVERTER): add
	texinfo_language_config_dirs field in CONVERTER and in
	texinfo_language_config_dirs in CONVERTER_INITIALIZATION_INFO,
	pass information in apply_converter_info and get from Perl.

	* tp/Texinfo/XS/main/utils.c (locate_file_in_dirs): add.

	* tp/Texinfo/XS/convert/html_prepare_converter.c
	(STRING_VARIABLE_INFO, STRING_VARIABLES_LIST, set_variable_value)
	(read_var_len, substitute_variables, get_create_htmlxref_manual)
	(fill_source_info_file, parse_htmlxref_files, load_htmlxref_files),
	tp/Texinfo/XS/main/converter_types.h (HTMLXREF_MANUAL_LIST):
	implement reading xhtmlxref files in C.

	* tp/Texinfo/XS/convert/ConvertXS.xs
	(html_converter_initialize_beginning),
	tp/Texinfo/XS/convert/build_html_perl_state.c (build_htmlxref)
	(html_pass_xtmlxref), tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_get_customization_sv): XS interface to build xhtmlxref
	information to Perl.  Do not get xhtmlxref information from Perl
	anymore.

	* tp/Texinfo/XS/Makefile.am (AM_CPPFLAGS),
	tp/Texinfo/XS/convert/texinfo.c (txi_converter_setup),
	tp/Texinfo/XS/teximakehtml.c (main): pass sysconfidir in AM_CPPFLAGS.
	Add texinfo_language_config_dirs argument to txi_converter_setup to
	setup texinfo_language_config_dirs, and set the list of
	texinfo_language_config_dirs in teximakehtml.c main.

2024-08-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS: run
	  gnulib-tool --add-import euidaccess

	* tp/Texinfo/XS/convert/html_prepare_converter.c
	(load_htmlxref_files): start of load_htmlxref_files implementation.

	* tp/Texinfo/Convert/HTML.pm: add a comment.

2024-08-18  Patrice Dumas  <pertusus@free.fr>

	Comments on potential overflows, change in associated comments

2024-08-18  Patrice Dumas  <pertusus@free.fr>

	* tp/t/converters_tests.t (form_feeds), tp/Makefile.tres: add parts of
	t/03coverage_braces.t form_feed_in_brace_commands test relevant.
	Remove t/03coverage_braces.t form_feed_in_brace_commands.

	Add an include, changes in TODO/comments/FIXME.

2024-08-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (set_converter_init_information)
	(free_generic_converter), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER):  add format_defaults_conf OPTIONS field to converter.
	Set format_defaults_conf OPTIONS structure based on format_defaults
	options list in set_converter_init_information.

	* tp/Texinfo/XS/convert/html_prepare_converter.c
	(html_converter_initialize_beginning): use self->format_defaults_conf
	to set MAX_HEADER_LEVEL if < 0.

	* tp/Texinfo/XS/convert/html_prepare_converter.c (html_setup_output):
	use txi_base_options to set HANDLER_FATAL_ERROR_LEVEL if < 0.

	* tp/Texinfo/XS/convert/format_html.c
	(html_default_format_heading_text): simplify setting heading level,
	doing as in Perl.

	* tp/Texinfo/XS/convert/converter.c (converter_converter): assume that
	format_defaults is always set.

2024-08-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (BUILT_SOURCES, options_init_free.c),
	(libtexinfo_convert_la_SOURCES, EXTRA_DIST): rename
	convert/converters_defaults.c as convert/converters_options.c.
	Update users.

	* tp/Texinfo/XS/convert/converter.c (init_generic_converter),
	tp/Texinfo/XS/main/customization_options.c (setup_sorted_options)
	(new_sorted_options), tp/Texinfo/XS/main/get_perl_info.c
	(init_copy_sv_options), tp/Texinfo/XS/main/document.c
	(initialize_document_options),
	tp/maintain/regenerate_C_options_info.pl: pass OPTION pointers array
	to setup_sortable_options and to setup_sorted_options.  Add
	new_sorted_options that allocate an OPTION pointers array and call
	setup_sortable_options and setup_sorted_options.  Update callers.

	* tp/Texinfo/XS/main/customization_options.c
	(txi_initialise_base_options, txi_base_options)
	(txi_base_sorted_options), tp/maintain/regenerate_C_options_info.pl,
	tp/Texinfo/XS/main/document.c (txi_setup_lib_data): put
	txi_base_sorted_options in customization_options.c.  Add
	txi_base_options with the options set to their default values.  Set
	txi_base_sorted_options dynamically, associated to txi_base_options
	in txi_initialise_base_options in customization_options.c.  Call
	txi_initialise_base_options in txi_setup_lib_data.

	* tp/maintain/regenerate_C_options_info.pl: generate
	html_fill_options_directions in converters_options.c.  Add all header
	files where functions are defined.

2024-08-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c (txi_setup_lib_data),
	tp/Texinfo/XS/convert/converter.c (converter_setup): add
	txi_setup_lib_data in document.c for library main initialization.
	Call set_element_type_name_info in txi_setup_lib_data, and call
	txi_setup_lib_data in converter_setup.

	Minor other changes.

2024-08-18  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/regenerate_C_options_info.pl: rename functions setting
	options defaults.  Set correctly non integer/string options.  Add a
	function to set all options defaults.

2024-08-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/customization_options.c: reorder code, add
	form feed delimited sections.

2024-08-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES, BUILT_SOURCES)
	(MAINTAINERCLEANFILES, main/options_defaults.c),
	tp/maintain/regenerate_C_options_info.pl: separate converter options
	defaults and other options defaults generated code files.

2024-08-18  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/regenerate_C_options_info.pl: reorder code, add comments
	in output.  Pre-sort setup_sortable_options output.

2024-08-18  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/regenerate_C_options_info.pl: do not generate
	set_option_key_configured anymore, it is unused and there is a better
	version.

2024-08-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/customization_options.c
	(set_informative_command_value, set_global_document_command),
	tp/Texinfo/XS/main/utils.c: move set_informative_command_value and
	set_global_document_command to customization_options.c.

	* tp/Texinfo/XS/main/document.c (set_output_encoding),
	tp/Texinfo/XS/main/utils.c: move set_output_encoding to document.c.

	* tp/Texinfo/XS/main/document.c (initialize_document_options): call
	option_set_conf.

	* tp/Texinfo/XS/main/utils.c: remove now unused set_conf_string.

2024-08-17  Patrice Dumas  <pertusus@free.fr>

	* tp/t/input_files/last_file_same_parser.texi: add an @include.

2024-08-17  Patrice Dumas  <pertusus@free.fr>

	* tp/t/30sectioning.t (in_menu_only_special_spaces_node),
	tp/t/40moresectioning.t (only_special_spaces_node),
	tp/t/input_files/in_menu_only_special_spaces_node.texi,
	tp/t/input_files/only_special_spaces_node.texi: move TODO information
	out of texi files to .t files.

2024-08-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c
	(fill_output_units_descriptor_av): store the document descriptor
	along with output_units descriptor in the Perl output units data, as
	both the document and output units list number in document are needed
	to retrieve the output units list in C.

	* tp/Texinfo/XS/main/get_perl_info.c (get_sv_output_units_descriptor)
	(get_sv_output_units): add a document out argument in
	get_sv_output_units_descriptor and find the document associated with
	the output units if set.  If the document argument of
	get_sv_output_units is NULL, call get_sv_output_units_descriptor such
	as to find the document.  Update callers.

	* tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs
	(split_pages): remove document SV argument, as there is no such
	argument in Perl and get the document from the output units list SV.

	* tp/t/test_utils.pl: add comments to explain why descriptors added to
	output units by XS code to retrieve output units descriptor and
	document descriptor do not show up in tests results.

2024-08-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_converter_perl_info.c
	(get_converter_info_from_sv), tp/Texinfo/XS/main/build_perl_info.c
	(pass_generic_converter_to_converter_sv): always pass output_format
	and converted_format to Perl.  Do not put them in
	non_valid_customization options information.

	* tp/Makefile.tres, tp/t/test_converter_option.t: new tests file
	testing converters set/get converted_format and output_format.

2024-08-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (_generic_converter_init),
	tp/Texinfo/XS/convert/ConvertXS.xs (generic_converter_init): do not
	pass class to generic_converter_init, get it through ref and
	equivalent in XS.

	* tp/Texinfo/XS/convert/get_converter_perl_info.c
	(get_converter_info_from_sv): get class_name as argument only.  If
	NULL, no error message.

	* tp/Texinfo/XS/convert/ConvertXS.xs (converter_defaults): call
	get_converter_info_from_sv without class name argument to avoid a
	duplicate message.

2024-08-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/html_converter_init_options.c,
	tp/Texinfo/XS/convert/html_prepare_converter.c
	(html_converter_initialize_beginning): move
	html_converter_initialize_beginning to html_prepare_converter.c.

	* tp/Texinfo/XS/main/converter_types.h (TARGET_CONTENTS_FILENAME)
	(FILE_NAME_PATH, TARGET_DIRECTORY_FILENAME),
	tp/Texinfo/XS/main/utils.h: move struct declarations to
	converter_types.h.

2024-08-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/texinfo.c (txi_converter_setup): use
	add_option_string_value with txi_base_sorted_options instead of 
	add_new_option_value to get the option type based on the name.

2024-08-17  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/regenerate_C_options_info.pl: setup
	txi_base_sorted_options sorted options information, to be able to find
	type and number of options, even without a converter.

	* tp/Texinfo/XS/convert/ConvertXS.xs (converter_defaults): use
	txi_base_sorted_options.

2024-08-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (generic_converter_init),
	tp/Texinfo/XS/convert/get_converter_perl_info.c: inline
	converter_get_info_from_sv in generic_converter_init.

	* tp/Texinfo/XS/convert/ConvertXS.xs (generic_converter_init): rename
	class variable as class_name.

	* tp/Texinfo/XS/convert/converter.c (set_converter_init_information):
	call apply_converter_info on user_conf only if user_conf is non-NULL.

	* tp/Texinfo/XS/convert/get_converter_perl_info.c
	(get_converter_info_from_sv), tp/Texinfo/XS/convert/ConvertXS.xs
	(converter_defaults, generic_converter_init): create
	CONVERTER_INITIALIZATION_INFO in get_converter_info_from_sv if the
	input SV is not undef and return it.  Update callers.

	* tp/Texinfo/XS/convert/ConvertXS.xs (converter_defaults)
	(generic_converter_init), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER): add format_defaults field in CONVERTER.  If the
	converter_defaults argument is a converter, store format_defaults in
	converter and return undef to Perl in converter_defaults.  In
	generic_converter_init, if there is no format_defaults from Perl,
	take C converter format_defaults.  This avoids building to Perl and
	getting from Perl.

2024-08-16  Patrice Dumas  <pertusus@free.fr>

	No converter information in converter_defaults, and XS override

	* tp/Texinfo/XS/main/customization_options.c (copy_option): copy
	direction_string field.

	* tp/Texinfo/XS/main/customization_options.c (add_new_button_option):
	add based on tp/Texinfo/XS/teximakehtml.c code.

	* tp/Texinfo/XS/convert/get_converter_perl_info.c
	(new_numbered_option_from_sv): rename new_option_from_sv as
	new_numbered_option_from_sv.

	* tp/Texinfo/XS/convert/converter.c
	(find_format_name_converter_format): rename find_format_data_index as
	find_format_name_converter_format.  Update callers.

	* tp/Texinfo/XS/convert/converter.c (set_generic_converter_options):
	new separate function for clearer code.

	* tp/Texinfo/XS/main/utils.c (direction_unit_direction_name),
	tp/Texinfo/XS/main/build_perl_info.c (html_build_button): add the
	direction_unit_direction_name function that directly uses
	html_button_direction_names for directions that are not special units
	directions, such as to have a direction name for those directions even
	if there is no converter.  Use in html_build_button.

	* tp/Texinfo/XS/main/build_perl_info.c
	(html_build_buttons_specification): update external_references_number
	only if there is a converter.  With the change in html_build_button,
	the function can be used with a NULL converter.

	* tp/maintain/regenerate_C_options_info.pl,
	tp/Texinfo/XS/convert/html_converter_init_options.c
	(add_html_default_buttons_specifications)
	(add_texi2html_default_buttons_specifications): generate
	add_*_regular_options_defaults that add option categories or converter
	options to an option list.  Add
	add_html_default_buttons_specifications and
	add_texi2html_default_buttons_specifications to similarily add buttons
	to an option list.

	* tp/Texinfo/XS/convert/html_converter_init_options.c
	(html_converter_defaults), tp/Texinfo/XS/convert/converter.c
	(converter_defaults, converter_converter),
	tp/Texinfo/XS/convert/converter.h (CONVERTER_FORMAT_DATA): pass
	converter_format instead of converter to converter_defaults.  Have
	html_converter_defaults return the format_defaults options in the
	CONVERTER_INITIALIZATION_INFO return value.  Do not consider that
	options are numbered in converter_defaults.  Call number_options_list
	on format_defaults returned by converter_defaults, as without
	converter in format_defaults, it is unlikely for options to be
	numbered.

	* tp/Texinfo/XS/convert/converter.c
	(find_perl_converter_class_converter_format),
	tp/Texinfo/XS/convert/get_converter_perl_info.c
	(get_or_create_sv_converter): add
	find_perl_converter_class_converter_format based on
	get_or_create_sv_converter code to get converter_format based on Perl
	class.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides),
	tp/Texinfo/XS/convert/ConvertXS.xs (converter_defaults),
	tp/Texinfo/XS/main/build_perl_info.c
	(build_sv_options_from_options_list): rename html_converter_defaults
	in ConvertXS.xs as converter_defaults.  Add override of
	converter_defaults for HTML.  Never use a converter to generate the
	returned Perl information.  For that, determine the class name based on
	SvSTASH or the converter_in SV considered as a string, then the
	converter_format using find_perl_converter_class_converter_format.
	Also setup asorted options without a converter, to be able to call
	get_converter_info_from_sv.  Call converter_defaults to return a
	CONVERTER_INITIALIZATION_INFO.  Add build_sv_options_from_options_list
	to build Perl options hash based on a OPTIONS_LIST.  Call
	build_sv_options_from_options_list in ConvertXS.xs converter_defaults
	override in to return converter default Perl hash.

	* tp/Texinfo/XS/convert/html_converter_init_options.c
	(set_html_default_buttons_specifications)
	(set_texi2html_default_buttons_specifications): pass converter and
	options separately.

2024-08-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.h,
	tp/Texinfo/XS/convert/html_prepare_converter.h: comment out function
	definitions already done in html_conversion_api.h or
	html_converter_api.h.

2024-08-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_convert_la_SOURCES),
	tp/Texinfo/XS/convert/html_converter_api.h,
	tp/Texinfo/XS/convert/html_conversion_api.h: split
	html_converter_api.h in two with high level API only remaining in
	html_converter_api.h, lower level API goes to html_conversion_api.h.

	* tp/Texinfo/XS/Makefile.am (libtexinfo_convert_la_SOURCES): remove
	tp/Texinfo/XS/convert/html_converter_init_options.h and
	tp/Texinfo/XS/convert/html_converter_finish.h, html_converter_api.h
	should be used instead.

2024-08-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/customization_options.c
	(copy_numbered_options_list_options): rename copy_options_list_options
	to copy_numbered_options_list_options.  Update callers.

	* tp/Texinfo/XS/main/customization_options.c (add_option_copy)
	(copy_options_list): remove sorted_options argument, it is not used.

	* tp/Texinfo/XS/convert/ConvertXS.xs (generic_converter_init),
	tp/Texinfo/XS/convert/get_converter_perl_info.c
	(get_or_create_sv_converter): add get_or_create_sv_converter with code
	mostly from generic_converter_init, to setup a new converter only if
	there was not one already.

	* tp/Texinfo/XS/convert/converter.c (set_converter_init_information):
	do not call CONVERTER_FORMAT_DATA converter_defaults in
	set_converter_init_information.  It is better not to call it here as
	it is not called in _generic_converter_init, it should better be done
	in an overriden converter_defaults or a C only function.

	* tp/Texinfo/XS/main/customization_options.c (number_options_list):
	add to number options in list, typically if they were set without a
	converter (without sorted options) and options with nembers are
	expected.

	* tp/Texinfo/XS/convert/converter.c (converter_format_data)
	(copy_converter_initialization_info, converter_defaults)
	(converter_initialize, converter_converter),
	tp/Texinfo/XS/convert/html_converter_api.c
	(html_converter_initialize),
	tp/Texinfo/XS/convert/html_converter_init_options.c
	(html_converter_defaults): add a converter_converter function to have
	an interface similar to the Perl converter interface.  Add
	converter_initialize and converter_defaults to dispatch to format
	specific functions.  Get specific format defaults as
	converter_defaults return.  Set/update HTML functions for this change.

	* tp/Texinfo/XS/convert/texinfo.c (txi_converter): call
	converter_converter.

	* tp/Texinfo/XS/convert/texinfo.c (txi_converter_setup): add based on
	former txi_converter_initialize but updated to match the changes in
	converter interface.

	* tp/Texinfo/XS/teximakehtml.c (add_new_button_option, main): setup
	customizations as a list without converter.  Use txi_converter_setup.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_converter_defaults):
	prepare XS override for HTML converter_defaults, using
	get_or_create_sv_converter and html_converter_defaults.  Do not use
	it, though, as it should work when called from a converter, but not
	from a class.

2024-08-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_XS_html_converter_get_customization)
	tp/Texinfo/XS/convert/ConvertXS.xs
	(html_converter_get_customization_sv),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_get_customization_sv): rename
	html_converter_get_customization_sv as
	_XS_html_converter_get_customization.

	* tp/Texinfo/XS/convert/html_converter_init_options.c
	(html_converter_initialize_beginning): rename
	html_converter_initialize as html_converter_initialize_beginning.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides)
	(_XS_html_converter_initialize_beginning, converter_initialize),
	tp/Texinfo/XS/convert/ConvertXS.xs
	(html_converter_initialize_beginning),
	tp/Texinfo/XS/convert/converter.c (set_converter_init_information),
	tp/Texinfo/XS/convert/texinfo.c (txi_converter_initialize): add an XS
	override html_converter_initialize_beginning that is called at the
	beginning of converter_initialize in Perl as
	_XS_html_converter_initialize_beginning if XS is set.  Call
	html_converter_initialize_beginning in this override and in
	txi_converter_initialize.  Do not call
	html_converter_initialize_beginning in set_converter_init_information
	anymore.  The objective is to avoid to have the initialization
	necessarily split in two in C.

2024-08-15  Patrice Dumas  <pertusus@free.fr>

	TODO: update text on libraries as there are now private API at diverse
	levels available for all the C codes with a good cover.

2024-08-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_convert_la_SOURCES),
	tp/Texinfo/XS/convert/html_converter_api.c (html_output)
	(html_convert), tp/Texinfo/XS/convert/html_converter_api.h,
	tp/Texinfo/XS/convert/texinfo.c (txi_html_output): add
	html_converter_api.h with a selection of HTML conversion functions
	that allow to set up and destroy a converter and implement output()
	and convert().  Add html_output using code form texinfo.c.  Add
	html_convert implementation.

2024-08-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/html_conversion_state.c
	(compare_global_units_direction_name)
	(html_find_direction_name_global_unit),
	tp/Texinfo/XS/convert/html_prepare_converter.c: move
	html_find_direction_name_global_unit to html_conversion_state.c and
	duplicate compare_global_units_direction_name.

2024-08-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/format_html.c: move code around to have all
	formatting functions together.  Add more sections delimited by line
	feeds.

2024-08-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_convert_tree_append):
	rename convert_tree_append as html_convert_tree_append.  Update
	callers.

2024-10-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/convert/format_html.c (html_command_description): move
	html_command_description to format_html.c.

	* tp/Texinfo/XS/convert/format_html.c (html_default_format_begin_file)
	(html_default_format_node_redirection_page)
	(html_default_format_special_body_about): fix function names.

2024-08-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/html_converter_types.h: declare
	translated_special_unit_info, direction_string_type_names,
	direction_string_context_names, html_conversion_context_type_names,
	html_argument_formatting_type_names and
	html_stage_handler_stage_type_names.

	* tp/Texinfo/XS/convert_html.c (html_close_lone_element)
	(convert_tree_append): rename close_html_lone_element as
	html_close_lone_element, convert_to_html_internal as
	convert_tree_append and translate_convert_to_html_internal as
	html_translate_convert_tree_append.

	* tp/Texinfo/XS/convert_html.c (html_default_format_jslicense_file)
	(html_default_format_date_in_header): split functions formatting HTML
	out of do_jslicenses_file and html_convert_output.

	* tp/Texinfo/XS/Makefile.am (libtexinfo_convert_la_SOURCES),
	tp/Texinfo/XS/format_html.c, tp/Texinfo/XS/convert_html.c: split
	convert_html.c, moving the formatting to HTML to format_html.c,
	including html_default_format_jslicense_file and
	html_default_format_date_in_header, keeping only higher level
	conversion functions in convert_html.c.

	* tp/Texinfo/XS/convert_html.c
	(html_convert_string_tree_new_formatting_context)
	(html_convert_tree_new_formatting_context, html_convert_css_string):
	prepend html_ and declare in header file.

	* tp/Texinfo/XS/format_html.c (html_format_title_titlepage)
	(html_format_node_redirection_page, html_format_comment)
	(html_format_end_file, html_format_begin_file): prepend html_ and
	declare in header file.

2024-08-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c: rename
	convert_to_html_internal as convert_tree_append.

2024-08-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c: add a form feed delimited code
	section for html_attribute_class.

2024-08-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c: group codes: string functions,
	targets related code, conversion preparation code and node redirection
	page code.

2024-08-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/convert/html_prepare_converter.c (html_id_is_registered)
	(html_register_id): move html_id_is_registered and html_register_id to
	html_prepare_converter.c.

	* tp/Texinfo/XS/convert/convert_html.c: move translations related
	code around to group code, and move the whole above.

2024-08-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c: move code around to group code
	for different phases better together and get a more logical order of
	code phases.

	* tp/Texinfo/XS/convert/html_converter_finish.c: update includes.

2024-08-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(html_clear_direction_string_type)
	(html_reset_translated_special_unit_info_tree): prepend
	clear_direction_string_type and
	reset_translated_special_unit_info_tree with html_ and put in header
	file.

	* tp/Texinfo/XS/Makefile.am (libtexinfo_convert_la_SOURCES),
	tp/Texinfo/XS/convert/html_converter_finish.c
	(reset_special_unit_info_list, free_special_unit_info_list)
	(reset_html_targets_list, reset_html_targets, clear_type_explanations)
	(html_reset_files_source_info, html_free_files_source_info)
	(html_destroy_files_source_info, html_reset_converter)
	(free_html_no_arg_command_conversion, html_free_converter),
	tp/Texinfo/XS/convert/convert_html.c: move reset and free converter
	functions to a new file convert/html_converter_finish.c, which has
	already a header file, but was previously implemented in
	convert_html.c.

2024-08-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_free_converter): remove
	the two duplications of html_reset_converter code, they are not useful
	as html_reset_converter should always be called.

2024-08-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/html_prepare_converter.h: get declaration of
	functions in html_prepare_converter.c.

2024-08-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/convert/html_prepare_converter.c
	(html_global_unit_direction_names, html_formatting_reference_names)
	(html_add_special_unit_info, new_special_unit_info_type)
	(new_special_unit_formatting_references, new_htmlxref_manual_list)
	(initialize_js_categories_list, initialize_jslicense_files): move
	functions and variables to html_prepare_converter.c.

2024-10-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(html_setup_output_simple_page),
	tp/Texinfo/XS/convert/html_prepare_converter.c (html_set_pages_files):
	readd self->pending_closes initialization that disappeared.

	* tp/Texinfo/XS/convert/convert_html.c (html_command_description):
	call html_get_target instead of find_element_target.

2024-08-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_get_target): call
	directly find_element_target_search and not find_element_target.
	Remove find_element_target, replace with html_get_target calls.

	* tp/Texinfo/XS/convert/convert_html.c (html_get_top_unit)
	(html_set_file_source_info, html_add_to_files_source_info)
	(html_find_file_source_info, html_setup_output_simple_page):
	prepend html_ and declare.

	* tp/Texinfo/XS/convert/html_prepare_converter.c (html_get_target)
	(html_prepare_output_units_global_targets)
	(compare_global_units_direction_name, add_to_unit_file_name_paths)
	(html_setup_global_units_direction_names)
	(html_find_direction_name_global_unit, html_set_pages_files)
	(prepare_special_units_directions, compare_page_name_number)
	(html_prepare_units_directions_files),
	tp/Texinfo/XS/convert/convert_html.c: move html_get_target,
	html_prepare_output_units_global_targets,
	compare_global_units_direction_name,
	html_setup_global_units_direction_names,
	html_find_direction_name_global_unit, add_to_unit_file_name_paths,
	html_set_pages_files, prepare_special_units_directions and
	html_prepare_units_directions_files to html_prepare_converter.c.

2024-08-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_normalized_to_id)
	(html_normalized_label_id_file): prepend normalized_to_id and
	normalized_label_id_file with html_ and declare in header file.
	Update callers.

	* tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/convert/html_prepare_converter.c
	(add_element_target_to_list, add_element_target, add_special_target)
	(set_special_units_targets_files, unique_target)
	(prepare_associated_special_units_targets)
	(new_sectioning_command_target, set_root_commands_targets_node_files)
	(prepare_index_entries_targets, compare_footnote_id)
	(find_footnote_id_number, footid_base, docid_base)
	(prepare_footnotes_targets, heading_commands_list)
	(set_heading_commands_targets, check_targets_order, sort_cmd_targets)
	(html_prepare_conversion_units_targets): move
	add_element_target_to_list, add_element_target, add_special_target,
	unique_target, set_special_units_targets_files,
	prepare_associated_special_units_targets,
	new_sectioning_command_target, set_root_commands_targets_node_files,
	prepare_index_entries_targets, prepare_footnotes_targets,
	heading_commands_list, set_heading_commands_targets,
	check_targets_order, sort_cmd_targets and
	html_prepare_conversion_units_targets to html_prepare_converter.c.
	duplicate compare_footnote_id and compare_element_target.

2024-08-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_run_stage_handlers):
	prefix run_stage_handlers with html_ and declare it in header file.
	Update callers.

	* tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/convert/html_prepare_converter.c
	(init_conversion_after_setup_handler, html_process_css_file)
	(html_prepare_css, fill_jslicense_file_info, html_setup_output)
	(html_setup_convert): move to html_prepare_converter.c.

2024-08-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_html_convert_output, _setup_output),
	tp/Texinfo/XS/convert/convert_html.c (html_setup_output)
	(html_convert_output): create directory at the very beginning of
	html_convert_output, not in setup_output, to delay modifications
	to the start of the conversion.

2024-10-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/convert/html_prepare_converter.c
	(commands_internal_open_table): remove duplicate
	commands_internal_open_table from convert_html.c, add
	html_open_node_part_command.

	* tp/Texinfo/XS/convert/convert_html.h: declare node_part_command
	open function.

2024-08-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/html_converter_types.h
	(SPECIAL_LIST_MARK_CSS_NO_ARGS_CMD, COMMAND_ARGS_SPECIFICATION)
	(MAX_COMMAND_ARGS_NR, html_command_args_flags)
	(special_list_mark_css_string_no_arg_command, no_arg_formatted_cmd)
	(style_formatted_cmd, accent_cmd, format_raw_cmd),
	tp/Texinfo/XS/convert/convert_html.c: rename command_args_flags as
	html_command_args_flags, substitute_html_non_breaking_space as
	html_substitute_non_breaking_space.  Declare in
	html_converter_types.h.

	* tp/Texinfo/XS/convert/convert_html.h (ROOT_AND_UNIT),
	tp/Texinfo/XS/convert/convert_html.c (html_get_tree_root_element)
	(html_after_escaped_characters, html_substitute_non_breaking_space)
	(html_special_unit_info, html_default_format_protect_text)
	(html_complete_no_arg_commands_formatting): declare ROOT_AND_UNIT and
	html_get_tree_root_element in header file.  Rename
	substitute_html_non_breaking_space as
	html_substitute_non_breaking_space.  Prepend html_ for some functions
	and declare them in header file.  Update callers.

	* tp/Texinfo/XS/convert/convert_html.h,
	tp/Texinfo/XS/convert/convert_html.c: prepend html_ for
	css_string_convert*, convert_*command, command_conversion_external,
	command_open_external, open_*command, type_conversion_external,
	convert_*type, css_string_convert_*type, type_open_external,
	output_unit_conversion_external, convert_*unit,
	special_unit_body_formatting_external, default_format_special_body_*
	and declare in header file.

	* tp/Texinfo/XS/Makefile.am (libtexinfo_convert_la_SOURCES),
	tp/Texinfo/XS/convert/html_prepare_converter.c (html_format_setup)
	(html_converter_customize, html_initialize_output_state)
	(new_directions_strings_type, new_directions_strings_translated_type)
	(CMD_VARIETY, COMMAND_INTERNAL_CONVERSION, COMMAND_INTERNAL_OPEN)
	(TYPE_INTERNAL_CONVERSION, TYPE_INTERNAL_OPEN)
	(OUTPUT_UNIT_INTERNAL_CONVERSION)
	(SPECIAL_UNIT_BODY_INTERNAL_CONVERSION)
	(base_default_css_element_class_styles, default_code_types)
	(default_pre_class_types, quoted_style_commands, ignored_types)
	(htmlxref_split_type_names, command_special_unit_variety)
	(default_no_arg_commands_formatting, special_characters_formatting)
	(default_style_commands_formatting, html_commands_data)
	(default_commands_args, register_special_unit, SPECIAL_UNIT_ORDER)
	(compare_special_units, prepare_special_units)
	(additional_format_context_cmd, HTML_align_cmd)
	(register_format_context_command, register_pre_class_command)
	(conf_for_special_units, html_prepare_conversion_units)
	(compare_index_name, html_prepare_conversion_units): move code related
	to converter and conversion preparation to a new file,
	html_prepare_converter.c.

	* tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/convert/html_prepare_converter.c
	(html_converter_init_special_unit): move
	html_converter_init_special_unit to html_prepare_converter.c.

2024-10-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/html_conversion_state.h: declare
	html_register_opened_section_level and
	html_close_registered_sections_level.

2024-08-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_html_perl_info.c,
	tp/Texinfo/XS/convert/html_conversion_state.c
	(html_get_css_info_spec): move from get_html_perl_info.c to
	html_conversion_state.c.

	* tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/convert/html_conversion_state.c (css_info_type_names)
	(count_elements_in_filename_type_names, push_html_formatting_context)
	(pop_html_formatting_context, html_new_document_context)
	(html_pop_document_context, html_open_command_update_context)
	(html_convert_command_update_context, html_open_type_update_context)
	(html_convert_type_update_context, html_set_multiple_conversions)
	(html_unset_multiple_conversions, find_explained_command_string)
	(register_explained_command_string, source_info_id)
	(html_check_htmlxref_already_warned)
	(initialize_css_selector_style_list): move from convert_html.c
	to html_conversion_state.c.

2024-10-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/html_conversion_state.h: declare
	html_register_opened_section_level and
	html_close_registered_sections_level.

2024-08-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_convert_la_SOURCES),
	tp/Texinfo/XS/convert/html_converter_types.h (HTML_COMMAND_STRUCT)
	(enum count_elements_in_filename_type, enum css_info_type),
	tp/Texinfo/XS/convert/html_conversion_state.c (html_in_code)
	(html_in_math, html_in_preformatted_context, html_inside_preformatted)
	(html_in_non_breakable_space, html_in_raw, html_in_space_protected)
	(html_in_string, html_in_upper_case, html_in_verbatim)
	(html_paragraph_number, html_preformatted_number, html_in_align)
	(html_top_block_command, html_preformatted_classes_stack)
	(html_set_code_context, html_pop_code_context)
	(html_set_string_context, html_unset_string_context)
	(html_set_raw_context, html_unset_raw_context, html_in_multi_expanded)
	(find_page_name_number, count_elements_in_file_number)
	(html_count_elements_in_filename, html_register_footnote)
	(html_get_pending_footnotes, destroy_pending_footnotes)
	(html_register_pending_formatted_inline_content)
	(html_cancel_pending_formatted_inline_content)
	(html_get_pending_formatted_inline_content)
	(get_associated_inline_content_number)
	(html_associate_pending_formatted_inline_content)
	(html_get_associated_formatted_inline_content)
	(add_associated_file_info_integer, html_register_file_information)
	(lookup_associated_file_info, html_get_file_information)
	(html_register_opened_section_level)
	(html_close_registered_sections_level, compare_selector_style)
	(sort_css_element_class_styles, find_css_selector_style)
	(html_css_set_selector_style, html_css_get_selector_style)
	(compare_strings, html_get_css_elements_classes, html_css_add_info)
	(html_css_get_info), tp/Texinfo/XS/convert/convert_html.c: split code
	related to setting or getting HTML conversion state information out of
	convert_html.c to a separate file html_conversion_state.c.  Also add
	html_converter_types.h for declarations needed by several files used
	for the conversion to HTML.

2024-08-14  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): call convert_to_texinfo for plaintext
	test as it requires less resources, no need to set up a Parser.

2024-08-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/texinfo.c (txi_reset_converter)
	(txi_destroy_converter), tp/Texinfo/XS/teximakehtml.c: add wrappers
	for reset_converter and destroy_converter in texinfo.c and call them
	in teximakehtml.c.

2024-10-04  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/regenerate_C_options_info.pl: remove directory from
	generated include.

2024-10-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/teximakehtml.c: add missing include.

2024-08-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (new_converter): rename
	registered_converter as converter.

	* tp/Texinfo/XS/convert/converter.c (set_converter_init_information):
	rename converter_defaults as format_converter_defaults and
	converter_initialize as format_converter_initialize.

	* tp/Texinfo/XS/convert/converter.c (reset_generic_converter): add
	a function to reset parser structures tied to a document to be ready
	for a new conversion.

	* tp/Texinfo/XS/convert/converter.c (converter_format_data)
	(reset_converter, free_converter, destroy_converter),
	tp/Texinfo/XS/convert/converter.h (CONVERTER_FORMAT_DATA),
	tp/Texinfo/XS/Makefile.am (libtexinfo_convert_la_SOURCES),
	tp/Texinfo/XS/convert/ConvertXS.xs (reset_converter, destroy),
	tp/Texinfo/XS/convert/convert_html.c (html_reset_converter):
	add references to specific format reset_converter and free_converter
	functions in CONVERTER_FORMAT_DATA.  Set them for HTML, with
	declarations in the new file convert/html_converter_finish.h.
	Add reset_converter and free_converter in converter.c that call both
	the generic converter functions and function references from
	converter_format_data.  Call those functions in ConvertXS.xs.  Do not
	call free_generic_converter anymore in html_reset_converter.
	Add destroy_converter function with code of
	unregister_converter_descriptor, and call to free_converter.

2024-08-13  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): destroy PlainTexinfo converter.

2024-08-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs: reindent.

	* tp/Texinfo/XS/main/manipulate_tree.c: minor change.

	Changes in comments.

2024-08-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree.c (reallocate_list_for)
	(insert_list_slice_into_list): use size_t for added elements number.

	* tp/Texinfo/XS/main/tree.c (remove_slice_from_contents): use size_t
	for indices.

2024-08-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree.c (insert_list_slice_into_list)
	(insert_slice_into_contents, insert_list_slice_into_args)
	(insert_list_slice_into_contents): use size_t for indices.

	* tp/Texinfo/XS/structuring_transfo/structuring.c
	(insert_menu_comment_content): use size_t for index_in_preformatted.

	* tp/Texinfo/XS/parsetexi/def.c: reindent.

2024-08-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/menus.c (handle_menu_entry_separators):
	determine a positive index for entry_name.

	* tp/Texinfo/XS/parsetexi/menus.c (end_line_menu_entry): use the
	position just after the index in loop.

	* tp/Texinfo/XS/parsetexi/parser.c (begin_paragraph): use a for loop
	to find preceding @*indent.

	* tp/Texinfo/XS/main/tree.c (contents_child_by_index)
	(args_child_by_index): use size_t for indices.  Remove the possibility
	to add at the end with a negative index, the caller should be able to
	compute the index.

2024-08-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/def.c (gather_def_item): start indices from
	the end of the contents for a more readable code and avoid negative
	argument for contents_child_by_index.

2024-08-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree.c (list_set_empty_contents)
	(remove_from_element_list, remove_from_const_element_list)
	(remove_from_contents, remove_from_args): use size_t for indices.
	Remove the possibility to add at the end with a negative index, it is
	not used and the caller should be able to compute the index.

2024-08-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree.c (insert_into_element_list)
	(insert_into_contents, insert_into_args): have indices be size_t.
	Remove the possibility to add at the end with a negative index, it is
	not used and the caller should be able to compute the index.

2024-08-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (retrieve_converter)
	(unregister_converter_descriptor),
	tp/Texinfo/XS/convert/get_converter_perl_info.c (get_sv_converter),
	tp/Texinfo/XS/main/build_perl_info.c: use size_t for converter
	descriptor consistently.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_get_target),
	tp/Texinfo/XS/convert/convert_html.c (prepare_special_units)
	(html_prepare_conversion_units)
	(html_prepare_output_units_global_targets)
	(html_prepare_units_directions_files),
	tp/Texinfo/XS/convert/get_html_perl_info.c (html_find_element_from_sv)
	(get_output_units_descriptor_converter_sv)
	(element_converter_from_sv), tp/Texinfo/XS/main/build_perl_info.c,
	tp/Texinfo/XS/main/converter_types.h (CONVERTER),
	tp/Texinfo/XS/main/get_perl_info.c (get_sv_output_units_descriptor)
	(get_sv_output_units, find_root_command, find_element_from_sv),
	tp/Texinfo/XS/main/output_unit.c (retrieve_output_units)
	(split_by_node, split_by_section),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs
	(split_by_node, split_by_section, rebuild_output_units): use size_t
	for output units descriptor consistently.

	* tp/Texinfo/XS/convert/converter.c (new_converter, id_to_filename)
	(free_comma_index_subentries_tree, find_output_unit_file)
	(free_output_unit_files_file), tp/Texinfo/XS/main/output_unit.c
	(unsplit, split_pages, units_directions, units_file_directions): use
	size_t instead of int where the variable could reach a value outside
	of the int range and also when the index is better represented by a
	size_t.  Cast to/from int and size_t when needed.

2024-08-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_no_arg_commands_formatting, build_html_files_source_info)
	(build_html_elements_in_file_count, build_html_translated_names)
	(build_html_command_formatted_args, build_replaced_substrings),
	tp/Texinfo/XS/convert/convert_html.c (html_get_tree_root_element)
	(add_associated_file_info_integer, lookup_associated_file_info)
	(html_register_opened_section_level, prepare_special_units)
	(set_special_units_targets_files)
	(prepare_associated_special_units_targets)
	(set_root_commands_targets_node_files, html_get_css_elements_classes)
	(html_attribute_class, prepare_index_entries_targets)
	(prepare_footnotes_targets, set_heading_commands_targets)
	(html_prepare_output_units_global_targets, find_file_source_info)
	(html_reset_files_source_info, html_set_pages_files)
	(prepare_special_units_directions)
	(html_prepare_units_directions_files, html_default_format_contents)
	(html_default_format_end_file, get_links)
	(html_default_format_navigation_panel)
	(html_default_format_element_header, html_default_format_element_footer)
	(convert_heading_command, convert_inline_command, convert_sp_command)
	(convert_quotation_command, convert_tab_command, convert_unit_type)
	(default_format_special_body_about, html_converter_init_special_unit)
	(determine_non_default_special_unit_directions)
	(html_converter_customize, reset_html_targets_list)
	(html_initialize_output_state, html_conversion_finalization)
	(clear_type_explanations, html_reset_converter, html_free_converter)
	(html_translate_names, destroy_args_formatted)
	(html_convert_type_update_context, debug_print_html_contexts)
	(convert_to_html_internal, convert_output_unit)
	(convert_convert_output_unit_internal, html_convert_convert)
	(convert_output_output_unit_internal, html_convert_output)
	(html_node_redirections): use size_t instead of int where the variable
	could reach a value outside of the int range and also when the index
	is better represented by a size_t.  Cast to/from int and size_t when
	needed.

2024-08-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/transformations.c
	(fill_gaps_in_sectioning, move_index_entries_after_items)
	(reassociate_to_node): use number of elements and size_t in a first
	step before setting the indices.

	* tp/Texinfo/XS/main/document.c (add_other_global_info_string),
	tp/Texinfo/XS/main/manipulate_indices.c
	(destroy_indices_sorted_by_letter, destroy_indices_sortable_entries)
	(sort_indices_by_letter),
	tp/Texinfo/XS/structuring_transfo/structuring.c (sectioning_structure)
	(warn_non_empty_parts, get_node_node_childs_from_sectioning)
	(check_nodes_are_referenced, set_menus_node_directions)
	(section_direction_associated_node, complete_node_tree_with_menus)
	(nodes_tree, associate_internal_references, new_node_menu_entry)
	(insert_menu_comment_content, new_complete_node_menu)
	(print_down_menus, new_detailmenu),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(lookup_index_entry, relate_index_entries_to_table_items_in)
	(move_index_entries_after_items, insert_nodes_for_sectioning_commands)
	(reference_to_arg_internal, complete_node_menu)
	(complete_tree_nodes_missing_menu, regenerate_master_menu): use size_t
	instead of int where the variable could reach a value outside of the
	int range and also when the index is better represented by a size_t.

2024-08-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (get_encoding_conversion): use a separate
	variable for utf8_missing case.  Use size_t encoding_nr to find he
	number of the encoding, using 0 for not found.  Also use size_t for
	encoding_index and set it when the case is known.

	* tp/Texinfo/XS/parsetexi/macro.c (lookup_macro_parameter)
	(expand_macro_body): have lookup_macro_parameter return index of
	argument +1, to be able to return a size_t and use 0 for not found.

	* tp/Texinfo/XS/convert/ConvertXS.xs (get_unclosed_stream)
	(html_close_registered_sections_level, html_get_css_elements_classes)
	(html_register_footnote), tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv, html_set_shared_conversion_state),
	tp/Texinfo/XS/convert/texinfo.c (txi_parser),
	tp/Texinfo/XS/main/build_perl_info.c (build_expanded_formats),
	tp/Texinfo/XS/main/get_perl_info.c (apply_sv_parser_conf)
	(html_get_button_specification_list, find_root_command)
	(find_element_from_sv), tp/Texinfo/XS/main/translations.c
	(replace_substrings, substitute_element_array)
	(replace_convert_substrings), tp/Texinfo/XS/main/unicode.c
	(encoded_accents, unicode_point_decoded_in_encoding),
	tp/Texinfo/XS/main/utils.c (reset_encoding_list)
	(clear_expanded_formats, add_expanded_format, format_expanded_p)
	(expanded_formats_number, locate_include_file, clear_strings_list)
	(delete_global_info, get_global_document_command, is_content_empty),
	tp/Texinfo/XS/parsetexi/close.c (close_command_cleanup),
	tp/Texinfo/XS/parsetexi/commands.c (lookup_command)
	(wipe_user_commands), tp/Texinfo/XS/parsetexi/def.c (parse_def),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line)
	(end_line_starting_block, end_line_misc_line),
	tp/Texinfo/XS/parsetexi/handle_commands.c (check_no_text)
	(handle_line_command), tp/Texinfo/XS/parsetexi/indices.c
	(space_for_indices, associate_command_to_index, init_index_commands)
	(set_non_ignored_space_in_index_before_command, complete_indices),
	tp/Texinfo/XS/parsetexi/macro.c (lookup_macro, expand_macro_arguments)
	(expand_linemacro_arguments, wipe_macros, handle_macro, store_value)
	(clear_value, fetch_value, lookup_infoenclose, add_infoenclose),
	tp/Texinfo/XS/parsetexi/menus.c
	(register_extra_menu_entry_information, end_line_menu_entry),
	tp/Texinfo/XS/parsetexi/parser.c (text_contents_to_plain_text)
	(merge_text), tp/Texinfo/XS/parsetexi/separator.c
	(check_empty_expansion): use size_t instead of int where the variable
	could reach a value outside of the int range and also when the index
	is better represented by a size_t.

2024-08-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/parser_conf.h (PARSER_CONF): use size_t for the
	descriptor field.

	* tp/Texinfo/XS/main/build_perl_info.c (build_perl_*)
	(element_to_perl_hash, build_additional_info, store_source_mark_list)
	(build_tree_to_build, build_string_list, build_elements_list)
	(build_errors, add_formatted_error_messages)
	(build_target_elements_list, build_identifiers_target)
	(build_internal_xref_list, build_float_types_list)
	(build_single_index_data, build_global_info, build_global_commands)
	(output_unit_to_perl_hash, build_filenames, build_file_counters)
	(build_out_filepaths, build_output_files_unclosed_files)
	(build_output_files_opened_files),
	tp/Texinfo/XS/main/convert_to_texinfo.c (expand_cmd_args_to_texi)
	(convert_to_texinfo_internal), tp/Texinfo/XS/main/convert_to_text.c
	(convert_to_text_internal), tp/Texinfo/XS/main/convert_utils.c
	(find_innermost_accent_contents, definition_arguments_content)
	(definition_category_tree), tp/Texinfo/XS/main/debug.c,
	tp/Texinfo/XS/main/errors.c (wipe_error_messages),
	tp/Texinfo/XS/main/extra.c (get_associated_info_key)
	(lookup_associated_info, lookup_associated_info_by_index),
	tp/Texinfo/XS/main/get_perl_info.c (apply_sv_parser_conf)
	(find_index_entry_sv), tp/Texinfo/XS/main/node_name_normalization.c
	(convert_to_normalized_internal), tp/Texinfo/XS/main/parser_conf.c
	(retrieve_parser_conf): use size_t instead of int where the variable
	could reach a value outside of the int range and also when the index
	is better represented by a size_t.
	
	* tp/Texinfo/XS/main/get_perl_info.c (add_svav_to_string_list): use
	SSize_t instead of size_t for consistency.

2024-08-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/multitable.c (gather_previous_item): rename
	begin as begin_idx, end as end_pos and term_begin as term_begin_idx.
	Set directly begin_idx, end_pos and term_begin_idx to the value that
	is to be use if the command corresponding to the variable is not
	found.  Use size_t instead of int.

2024-08-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/manipulate_tree.c (copy_associated_info)
	(copy_tree_internal, remove_associated_copy_info, parse_node_manual)
	(modify_tree, normalized_menu_entry_internal_node, first_menu_node),
	tp/Texinfo/XS/main/tree.c (destroy_associated_info)
	(destroy_source_mark_list, destroy_element_and_children)
	(remove_element_from_list, add_element_if_not_in_list)
	(replace_element_in_list, next_bracketed_or_word_agg)
	(split_delimiters, split_def_args, parse_def),
	tp/Texinfo/XS/structuring_transfo/structuring.c
	(insert_menu_comment_content, new_complete_node_menu): replace int by
	size_t in situations where the variable could reach a value outside of
	the int range and also when the index is better represented by a
	size_t.

2024-08-11  Patrice Dumas  <pertusus@free.fr>

	Fix compiler warnings

	* tp/Texinfo/XS/convert/convert_html.c: put static before const in
	declarations.

	* tp/Texinfo/XS/convert/convert_html.c
	(html_cancel_pending_formatted_inline_content)
	(set_root_commands_targets_node_files),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_set_shared_conversion_state, html_get_shared_conversion_state),
	tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal),
	tp/Texinfo/XS/main/convert_utils.c (definition_arguments_content)
	(definition_category_tree, output_files_register_closed),
	tp/Texinfo/XS/main/manipulate_tree.c (remove_from_source_mark_list):
	modify code to remove useless conditions of positivity and negativity
	of size_t variables.

	* tp/Texinfo/XS/main/customization_options.c (copy_options_list):
	check if pointer is NULL, not if > 0.

	* tp/Texinfo/XS/main/convert_to_text.c (convert_def_line),
	tp/Texinfo/XS/parsetexi/counter.c (counter_reset),
	tp/Texinfo/XS/parsetexi/def.c (split_delimiters, split_def_args),
	tp/Texinfo/XS/parsetexi/indices.c (complete_indices),
	tp/Texinfo/XS/parsetexi/macro.c (handle_macro),
	tp/Texinfo/XS/parsetexi/parser.c (parse_texi): modify code to
	avoid uninitialized variable compiler warning.

	* tp/Texinfo/XS/main/manipulate_tree.c (copy_associated_info): add
	missing break.

	* tp/Texinfo/XS/main/manipulate_tree.c (copy_container_contents): fix
	new_command_element call order.

	* tp/Texinfo/XS/parsetexi/def.c (DEF_MAP, parse_def, def*_types): fix
	type, it is enum element_type.

2024-08-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (generic_converter_init),
	tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/convert/converter.c (new_converter),
	tp/Texinfo/XS/main/converter_types.h (enum ids_data_type, CONVERTER):
	make the choice between perl_hashmap and string_list for html ids
	storage and retrieval a runtime choice.  Add ids_data_type field in
	CONVERTER to register and retrieve the choice.  Add a flags argument
	to new_converter to pass low level implementation configuration, such
	as the ids data use.

2024-08-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/teximakehtml.c (main): do not add errors_nr to the
	previous value.

2024-08-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES),
	tp/Texinfo/XS/main/utils.c,
	tp/Texinfo/XS/main/customization_options.c: move functions related to
	customization options out ot utils.c to the new to
	main/customization_options.c file.

2024-08-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_free_converter),
	tp/Texinfo/XS/convert/converter.c (free_generic_converter): move debug
	message if error messages not empty to free_generic_converter.

2024-08-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (destroy, reset_converter): use C
	converter self->format to determine which function to call.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_converter_defaults): ignore
	the arguments.

2024-08-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (find_format_data_index),
	tp/Texinfo/XS/convert/converter.h (CONVERTER_FORMAT_DATA),
	tp/Texinfo/XS/main/converter_types.h (enum converter_format)
	(CONVERTER): move enum converter_format to converter_types.h, add an
	enum converter_format format field to CONVERTER.  Rename
	CONVERTER_FORMAT_DATA output_format as default_format.

	* tp/Texinfo/XS/convert/ConvertXS.xs (generic_converter_init),
	tp/Texinfo/XS/convert/converter.c (new_converter),
	tp/Texinfo/XS/convert/get_converter_perl_info.c
	(get_converter_info_from_sv, converter_get_info_from_sv),
	tp/Texinfo/XS/convert/texinfo.c (txi_converter)
	(txi_converter_initialize), tp/Texinfo/XS/teximakehtml.c (main): pass
	an enum converter_format to new_converter to set the CONVERTER
	converter_format early.  Determine the converter_format in
	ConvertXS.xs and not in converter_get_info_from_sv.  Have
	converter_get_info_from_sv return its status.  Get class from
	converter_format_data in get_converter_info_from_sv if possible.
	Add enum converter_format argument to txi_converter.
	Remove txi_converter_initialize format argument, add output_format and
	converted_format arguments.  If they are not set, take the default
	from format_defaults based on converter->format.

2024-08-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/texinfo.c (txi_converter)
	(txi_converter_initialize), tp/Texinfo/XS/teximakehtml.c (main):
	rename txi_converter as txi_converter_initialize and readd
	txi_converter that just creates a converter and returns it, hiding the
	converter descriptor.

	* tp/Texinfo/XS/convert/texinfo.c (txi_parse_texi_file)
	(txi_remove_document): add wrappers hiding the document descriptor.

	* tp/Texinfo/XS/teximakehtml.c (main): use txi_parse_texi_file and
	txi_remove_document.

2024-08-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/teximakehtml.c (add_new_option_strlist_value): copy
	strings.

	* tp/Texinfo/XS/teximakehtml.c (main): free parser_options.

	* tp/Texinfo/XS/convert/texinfo.c (txi_handle_parser_error_messages)
	(txi_handle_document_error_messages)
	(txi_handle_converter_error_messages): add wrappers for
	handle_error_messages to be used directly on document and converter.

	* tp/Texinfo/XS/teximakehtml.c (main): call txi_handle_*error_messages
	and exit 1 if there were errors.  Remove print_errors.

2024-08-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (add_formatted_error_messages),
	tp/Texinfo/XS/main/document_types.h (ERROR_MESSAGE_LIST),
	tp/Texinfo/XS/main/errors.c (message_list_line_formatted_message)
	(message_list_document_formatted_message): add error_nrs field in
	ERROR_MESSAGE_LIST and set it.  Use it in
	add_formatted_error_messages.

	* tp/Texinfo/XS/main/errors.c (error_message_text)
	(handle_error_messages): add handle_error_messages that adds file
	information to error messages and output them.

2024-08-11  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_parser_registrar.t: use is instead of ok when relevant.

2024-08-10  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/regenerate_C_options_info.pl: remove generation of
	unused get_options_key_sv_option and build_sv_option_key functions.

2024-08-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/texinfo.c: add some comments.

2024-08-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (add_new_option_value): function to add
	an option with values based on a list, without trying to find the
	index in sorted options, for cases where options are found with their
	names, in practice for parser options.

	* tp/Texinfo/XS/convert/texinfo.c (txi_parser): pass an OPTIONS_LIST
	and set parser options based on that list contents.

	* tp/Texinfo/XS/teximakehtml.c (add_new_option_strlist_value)
	(parser_EXPANDED_FORMATS, main): set parser options.

2024-08-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/texinfo.c (txi_parser),
	tp/Texinfo/XS/teximakehtml.c (values, main): add a VALUE_LIST argument
	to txi_parser.

2024-10-04  Patrice Dumas  <pertusus@free.fr>

	Add tp/Texinfo/Commands.pm tp/Texinfo/Options.pm generated files

2024-10-04  Patrice Dumas  <pertusus@free.fr>

	Add generated code files to version control

2024-10-04  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/setup_converters_code_tables.pl: use the basename to
	name the script generating the code files such that the file content
	is the same in in and out of source builds.

2024-10-04  Patrice Dumas  <pertusus@free.fr>

	Update po files

2024-08-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/texinfo.c (txi_converter),
	tp/Texinfo/XS/teximakehtml.c (main): create converter before
	txi_converter such that it may be used to get sorted options.

	* tp/Texinfo/XS/main/utils.c (options_list_add_option): rename
	list_add_option as options_list_add_option.

	* tp/Texinfo/XS/teximakehtml.c (main, add_button_option): demonstrate
	passing button and other options to txi_converter.

2024-10-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/create_buttons.c
	(new_directions_list_buttons_specifications): add const.

2024-09-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/create_buttons.c
	(new_special_unit_direction_button): pass direction information as an
	enum BUTTON_special_unit_directions.  Use buttons_special_units_names
	to get the button name.  Pass converter and call
	html_get_direction_index in new_special_unit_direction_button.  Update
	callers.
	Move new_directions_list_buttons_specifications to the end of the
	file.

2024-10-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/create_buttons.h (enum
	BUTTON_special_unit_directions),
	tp/Texinfo/XS/convert/html_converter_init_options.h: move enum
	BUTTON_special_unit_directions to create_buttons.h.

2024-08-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/create_buttons.c (new_button_specification)
	(new_button_specification_list, new_base_navigation_buttons)
	(new_base_links_buttons, new_base_navigation_section_buttons)
	(new_base_navigation_section_footer_buttons),
	tp/Texinfo/XS/convert/html_converter_init_options.c,
	tp/Texinfo/XS/Makefile.am (libtexinfo_convert_la_SOURCES): put buttons
	creations functions in a separate file, create_buttons.c.  Rename some
	functions.

2024-10-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/get_perl_info.c
	(html_fill_button_sv_specification_list): cast to (SV *) before
	callling SvPVutf8_nolen.  Report from Gavin.  Analysis of Andreas
	Schwab: before v5.37.2 SvPVutf8_nolen was a macro that dereferenced
	its argument, after that the implementation moved into an inline
	function.

2024-08-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (list_add_option)
	(add_option_string_value, add_option_copy, copy_options_list): add a
	copy function for options lists.

	* tp/Texinfo/XS/convert/texinfo.c (txi_converter),
	tp/Texinfo/XS/teximakehtml.c (main): pass options to txi_converter and
	copy them to conf.

2024-10-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_setup_output): rename
	set_conf as option_set_conf.

2024-08-09  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/regenerate_C_options_info.pl,
	tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/convert/converter.c,
	tp/Texinfo/XS/convert/html_converter_init_options.c,
	tp/Texinfo/XS/main/utils.c (option_set_conf_internal, option_set_conf)
	(option_force_conf): move set_conf and force_conf to utils.c, rename
	as option_set_conf and option_force_conf.

	* tp/Texinfo/XS/convert/texinfo.c (txi_converter),
	tp/Texinfo/XS/main/utils.c (new_option_string_value)
	(add_option_string_value): rename initialize_option_value as
	new_option_string_value and add_option_value as
	add_option_string_value and move to utils.c.

	* tp/Texinfo/XS/convert/get_converter_perl_info.c (new_option_from_sv)
	(get_converter_info_from_sv),
	tp/Texinfo/XS/convert/html_converter_init_options.c
	(html_converter_defaults), tp/Texinfo/XS/convert/texinfo.c
	(txi_converter), tp/Texinfo/XS/main/utils.c
	(copy_options_list_options, new_option, new_option_string_value)
	(add_option_string_value, free_options_list),
	tp/Texinfo/XS/main/option_types.h (OPTIONS_LIST): add space field in
	OPTIONS_LIST and make the list a list on pointers, to have the
	possibility to change the list size dynamically and have options
	references remain valid upon reallocation of the list.  Update
	callers, in particular get_converter_info_from_sv and rename
	get_option_from_sv as new_option_from_sv.

2024-08-09  Patrice Dumas  <pertusus@free.fr>

	* convert/converter.c (free_generic_converter): call
	destroy_text_options only if convert_text_options were set.

2024-08-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_convert_la_SOURCES),
	tp/Texinfo/XS/convert/texinfo.c: rename txi_converter_api.c as
	texinfo.c.

	* tp/Texinfo/XS/convert/texinfo.c (txi_complete_document): return
	void.

2024-08-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/translations.c: add const.

	* tp/Texinfo/XS/teximakehtml.c (main, print_errors): move
	clear_error_message_list call to print_errors.

	* tp/Texinfo/XS/convert/txi_converter_api.c (txi_setup),
	tp/Texinfo/XS/teximakehtml.c (main): rename
	setup_html_format_parser as txi_setup and call
	configure_output_strings_translations in txi_setup.

	* tp/Texinfo/XS/convert/txi_converter_api.c (txi_parser),
	tp/Texinfo/XS/teximakehtml.c (main): rename parse_texi_file_for_format
	as txi_parser and do not call parse_file in txi_parser.

	* tp/Texinfo/XS/convert/txi_converter_api.c (txi_complete_document)
	(txi_converter), tp/Texinfo/XS/teximakehtml.c (main):
	rename complete_document as txi_complete_document and
	converter_for_format as txi_converter.

	* tp/Texinfo/XS/convert/txi_converter_api.c (txi_html_output),
	tp/Texinfo/XS/teximakehtml.c (main): implement HTML output as a
	function, based on teximakehtml.c and ConvertXS.xs code.

	* tp/Texinfo/XS/teximakehtml.c (main): call
	remove_document_descriptor in the end.

2024-08-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (find_format_data_index): add
	to find the enum converter_format of a format string.

	* tp/Texinfo/XS/Makefile.am (libtexinfo_convert_la_SOURCES),
	tp/Texinfo/XS/convert/txi_converter_api.c (setup_html_format_parser)
	(parse_texi_file_for_format, complete_document, converter_for_format),
	tp/Texinfo/XS/teximakehtml.c: add txi_converter_api.c implementing a
	high level API for Texinfo parsing, structure and transformations and
	converter initialization.  Move add_option_value and
	initialize_option_value to txi_converter_api.c.

	* tp/Texinfo/XS/teximakehtml.c (main): call setup_html_format_parser,
	parse_texi_file_for_format, complete_document and
	converter_for_format.

	* tp/Texinfo/XS/main/manipulate_indices.c (get_sort_key): initialize
	the string passed to strxfrm_l.

	* tp/Texinfo/XS/convert/convert_html.c (html_free_converter): do not
	free customized_type_dir_strings if not set.

	* tp/Texinfo/XS/convert/convert_html.c (format_raw_cmd)
	(html_format_setup, html_converter_customize): setup a list of format
	raw commands in html_format_setup.  In html_converter_customize, set
	the conversion of format raw commands to ignore if the command is not
	expanded and the status is FRS_status_internal.

	* tp/Texinfo/XS/convert/convert_html.c (clear_type_explanations)
	(html_reset_converter, html_free_converter): add
	clear_type_explanations separated from html_reset_converter code.
	Call in html_free_converter too, in case html_reset_converter is never
	called.

	* tp/Texinfo/XS/convert/convert_html.c (html_free_converter): call
	reset_translated_special_unit_info_tree in case html_reset_converter
	is never called.

	* tp/Texinfo/XS/teximakehtml.c (main): print converter errors.  Call
	html_free_converter.  Reorder code.

2024-10-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (C_libtexinfo_sources)
	(XS_libtexinfo_sources, libtexinfo_la_SOURCES)
	(C_libtexinfo_convert_sources, XS_libtexinfo_convert_sources)
	(libtexinfo_convert_la_SOURCES): separate libtexinfo_la_SOURCES and
	libtexinfo_convert_la_SOURCES in C and XS code using variables.

	* tp/Texinfo/XS/Makefile.am (teximakehtml_SOURCES)
	(teximakehtml_LDADD): list libtexinfo and libtexinfo_convert C code
	files using the variables instead of lining against the libraries.

2024-08-07  Patrice Dumas  <pertusus@free.fr>

	Add a C demonstration program that converts Texinfo to HTML

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES)
	(libtexinfo_convert_la_SOURCES, libtexinfo_convert_la_CPPFLAGS)
	(ConvertXS_la_SOURCES): move structuring_transfo/transformations.c to
	libtexinfo and convert_html.c to libtexinfo-convert.  Remove
	StructuringTransfoXS_la_SOURCES.

	* main/replace_perl_api_call.c,
	convert/replace_perl_call_html_function.c: add functions to replace
	Perl functions call API of main/call_perl_function.h,
	main/api_to_perl.h and convert/call_html_perl_function.h by functions
	that do not need Perl.  The C implementations are noops, that are not
	meant to be called, C code equivalent to the Perl code, which can be
	called.

	* tp/Texinfo/XS/convert/convert_html.c
	(set_root_commands_targets_node_files): initialize called to 0.

	* tp/Texinfo/XS/convert/convert_html.c (convert_output_unit): use
	output_unit_conversion_function to get the final status of conversion
	of output units, as should be.

	* tp/Texinfo/XS/convert/convert_html.c (html_converter_customize):
	initialize converter special_unit_body_formatting to 0.

	* tp/Texinfo/XS/convert/convert_html.c (html_initialize_output_state)
	(register_special_unit_body_formatting_function)
	(html_converter_customize): allow customized_type_dir_strings,
	special_unit_body and html_customized_style_commands to be unset if
	there is no Perl customization.

	* tp/Texinfo/XS/convert/convert_html.c (ignored_types)
	(html_converter_customize): set FRS_status_ignored for ignored types.

	* tp/Texinfo/XS/convert/convert_html.c (html_converter_customize): if
	FORMAT_MENU is not menu, set conversion status to FRS_status_ignored
	for menu and detailmenu if they are converted in C.

	* tp/Texinfo/XS/convert/convert_html.c (html_translate_string)
	(format_*, html_converter_customize): set conversion functions to C
	functions if there was no information obtained from Perl, with status
	remaining FRS_status_none.

	* tp/Texinfo/XS/Makefile.am (noinst_PROGRAMS, teximakehtml_SOURCES)
	(teximakehtml_CPPFLAGS, teximakehtml_LDFLAGS, teximakehtml_LDADD),
	tp/Texinfo/XS/teximakehtml.c: add the teximakehtml program
	demonstrating the use of the parser, structuring and HTML conversion
	C code to parser and convert Texinfo to HTML.  No customization at
	all, the intent is to use the program as a demonstrator of how the C
	code could be used separately from Perl.

2024-10-03  Patrice Dumas  <pertusus@free.fr>

	* NEWS, tp/Texinfo/Convert/Plaintext.pm (_convert_def_line): use a ---
	for definition line leading hyphen to end up with two hyphen in the
	default case as was the case previously.  See
	https://lists.gnu.org/archive/html/bug-texinfo/2004-02/msg00021.html

2024-08-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c (initialize_document_options): add
	C function to initialize and set document options novalidate,
	documentlanguage based on parser information and call
	set_output_encoding, as is done in Perl.

2024-08-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/builtin_commands.c (ref_3_args_order)
	(ref_5_args_order), tp/Texinfo/XS/main/builtin_commands.h,
	tp/Texinfo/XS/main/node_name_normalization.c,
	tp/Texinfo/XS/structuring_transfo/transformations.c: move definitions
	of ref_3_args_order and ref_5_args_order to builtin_commands.c such
	that they are defined in one file only.

2024-10-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/get_perl_info.h: remove
	html_fill_button_specification_list declaration.

2024-08-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(init_registered_ids_hv, is_hv_registered_id, hv_register_id)
	(clear_registered_ids_hv, free_registered_ids_hv),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): remove rid union in
	converter, to be able to have both a string list or Perl HV for
	registered_ids types.

	* tp/Texinfo/XS/main/converter_types.h,
	tp/Texinfo/XS/main/document_types.h (enum command_location): move enum
	command_location declaration to document_types.h.

2024-08-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c
	(setup_converter_paths_information): allow pkgdatadir to be unset.

2024-10-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/get_perl_info.h: declare html_fill_sv_options and
	html_fill_button_sv_specification_list.

2024-08-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (initialize_options_list),
	tp/Texinfo/XS/convert/get_converter_perl_info.c
	(get_converter_info_from_sv): add.  Use in get_converter_info_from_sv.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_converter_initialize_sv),
	tp/Texinfo/XS/main/utils.c
	(html_fill_button_directions_specification_list),
	tp/Texinfo/XS/main/get_perl_info.c
	(html_fill_button_sv_specification_list),
	tp/maintain/regenerate_C_options_info.pl: rename html_fill_options as
	html_fill_sv_options.  Split html_fill_button_specification_list in
	two, with html_fill_button_sv_specification_list for direction filled
	with information from Perl data, and
	html_fill_button_directions_specification_list for directions filled
	from strings set in buttons generated in C.  Generate automatically
	html_fill_options_directions to call
	html_fill_button_directions_specification_list.  Call both
	html_fill_sv_options and html_fill_options_directions in ConvertXS.xs
	html_converter_initialize_sv.

2024-08-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_free_converter),
	tp/Texinfo/XS/main/api_to_perl.c, tp/Texinfo/XS/main/document.c
	(remove_document_descriptor), tp/Texinfo/XS/main/tree.c
	(destroy_element): inline unregister_perl_tree_element,
	unregister_document_hv and unregister_perl_tree_element calling
	unregister_perl_data.

2024-08-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_converter_customize),
	tp/Texinfo/XS/convert/convert_html.c (html_converter_customize):
	rename html_converter_initialize as html_converter_customize.

	* tp/Texinfo/XS/convert/converter.c (converter_format_data)
	(set_converter_init_information), tp/Texinfo/XS/convert/converter.h
	(CONVERTER_FORMAT_DATA): add a converter_initialize function reference
	field in CONVERTER_FORMAT_DATA and call it in
	set_converter_init_information.

	* tp/Texinfo/Convert/HTML.pm (converter_initialize),
	tp/Texinfo/XS/convert/converter.c (converter_format_data),
	tp/Texinfo/XS/convert/html_converter_init_options.c
	(html_converter_initialize): add html_converter_initialize with
	code in Perl converter_initialize function that does not need
	customization information from Perl.  set html_converter_initialize in
	converter_format_data.  Separate code in Perl converter_initialize 
	that is already called in html_converter_initialize and put it in a
	conditional at the beginning of the function.

2024-08-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_convert_la_SOURCES): rename
	convert/converter_options.c as convert/html_converter_init_options.c.

2024-08-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (converter), tp/Texinfo/Convert/*.pm
	(converter_defaults): have converter_defaults return a reference on a
	hash instead of a hash.

2024-08-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (%XS_overrides, set_document),
	tp/Texinfo/XS/convert/ConvertXS.xs (converter_set_document): call
	call_common_set_output_perl_encoding in converter_set_document and
	override the whole set_document Perl function.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_conversion_initialization):
	call html_initialize_output_state without directly.

2024-08-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs: reorder XS functions.

2024-08-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c: reorder functions.

2024-08-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (store_document_texinfo_tree):
	rename store_texinfo_tree as store_document_texinfo_tree.

	* tp/Texinfo/XS/convert/ConvertXS.xs (get_conf),
	tp/Texinfo/XS/main/DocumentXS.xs (document_get_conf),
	tp/Texinfo/XS/main/build_perl_info.c (build_sv_option_from_name)
	(latex_build_options_for_convert_to_latex_math): rename get_sv_conf as
	build_sv_option_from_name and separate converter and sorted options
	arguments.  Use in document_get_conf.

	* tp/Texinfo/XS/main/build_perl_info.c: add static keyword.

	* tp/Texinfo/XS/convert/converter_options.h,
	tp/Texinfo/XS/main/build_perl_info.h: remove unneeded functions
	declarations, reorder.

	Remove const, as buttons are modified when Perl data is built when
	needed.

2024-08-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter_options.c
	(new_special_unit_direction_button, new_basic_buttons)
	(new_link_buttons, new_directions_list_buttons_specifications): set
	direction_string only if the direction index is not known.  In the
	current implementation it is always the case, but if the special unit
	direction names could not be customized their indices could be known
	early.

2024-10-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter_options.c (DEFAULT_MISC_BUTTONS):
	rename T2H_MISC_BUTTONS as DEFAULT_MISC_BUTTONS.

	* tp/Texinfo/XS/convert/converter_options.c
	(set_html_default_buttons_specifications): set default MISC_BUTTONS
	matching Perl using new_directions_list_buttons_specifications.

2024-10-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter_options.c
	(buttons_special_units_names),
	tp/Texinfo/XS/convert/converter_options.h (enum
	BUTTON_special_unit_directions): rename t2h_special_units_names as
	buttons_special_units_names and enum T2H_special_unit_directions as
	enum BUTTON_special_unit_directions.

2024-10-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.h: declare
	html_build_buttons_specification.

	* tp/Texinfo/XS/convert/converter_options.c
	(new_directions_list_buttons_specifications): rename
	new_texi2html_buttons_specifications as
	new_directions_list_buttons_specifications.

2024-08-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (get_conf): rename conf argument
	as option_name.

	* tp/Texinfo/XS/main/get_perl_info.c
	(html_button_function_type_string): rename button_function_type_string
	as html_button_function_type_string and make it extern.

	* tp/Texinfo/XS/convert/converter_options.c (new_button_specification)
	(new_basic_buttons, new_link_buttons),
	tp/Texinfo/XS/main/get_perl_info.c
	(html_fill_button_specification_list),
	tp/Texinfo/XS/main/option_types.h (BUTTON_SPECIFICATION): add
	direction_string to BUTTON_SPECIFICATION for pure C buttons to hold a
	directions string if the direction index is not already known when the
	button specification is setup, for special units direction whose names
	are not known early.  In html_fill_button_specification_list, use the
	direction_string is there is no Perl data and the direction index is
	negative.  Add an argument to new_button_specification and set it in
	new_basic_buttons and new_link_buttons for Contents and About.

	* tp/Texinfo/XS/main/build_perl_info.c (html_build_button): add to
	build a Perl button specification from a 'pure' C button structure
	BUTTON_SPECIFICATION.  This is a partial implementation for
	BST_direction and BST_direction_info + BIT_function.  This function can
	only be called for default buttons for now, so we do not need to
	handle other types of buttons.

	* tp/Texinfo/XS/main/build_perl_info.c
	(html_build_buttons_specification): add to build a Perl buttons
	specifications list from a 'pure' C BUTTON_SPECIFICATION_LIST.

	* tp/Texinfo/XS/main/build_perl_info.c (build_sv_option),
	tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_formatting_function_format_navigation_panel)
	(call_formatting_function_format_navigation_header): call
	html_build_buttons_specification if there is no Perl data for a
	buttons specification list.

	* tp/Texinfo/XS/convert/converter_options.c (new_basic_buttons): add
	an argument to add an about button only if set.  Update callers to set
	only for headers buttons specifications.

	* tp/Texinfo/XS/convert/converter_options.c
	(set_option_buttons_specification)
	(set_html_default_buttons_specifications): add
	set_html_default_buttons_specifications to set buttons customization
	options with texi2any default buttons.

	* tp/Texinfo/XS/convert/converter_options.c (t2h_special_units_names)
	(enum T2H_special_unit_directions, T2H_SECTION_BUTTONS, T2H_TOP_BUTTONS)
	(T2H_MISC_BUTTONS, T2H_CHAPTER_BUTTONS, T2H_SECTION_FOOTER_BUTTONS)
	(new_texi2html_buttons_specifications): function and data to setup
	buttons in the texi2html way.

	* tp/Texinfo/XS/convert/converter_options.c
	(set_texi2html_default_buttons_specifications): add to set buttons
	customization options with texi2html buttons.

	* tp/Texinfo/XS/convert/converter.h (CONVERTER_FORMAT_DATA),
	tp/Texinfo/XS/convert/converter.c (set_converter_init_information):
	add converter_defaults function pointer to CONVERTER_FORMAT_DATA to
	call to initialize a converter for a specific format.  Get it and call
	it in set_converter_init_information, with the user configuration
	information structure as argument.

	* tp/Texinfo/XS/convert/converter.c (converter_format_data),
	tp/Texinfo/XS/convert/converter_options.c (html_converter_defaults):
	add a converter_defaults function for HTML converter format that sets
	customization options using converters_defaults.c function and
	buttons, both for default and with TEXI2HTML set.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_converter_defaults): return
	undef, all the HTML customization default setup is done in C now.

2024-10-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfoxs*): readd mistakenly removed
	libtexinfoxs in conflicts resolution on 2024-10-02 "remove block of
	definition of libtexinfo_convert that crept in".

	* tp/Texinfo/XS/Makefile.am (libtexinfo_convert_la_SOURCES): really
	add converter_options.c.

2024-08-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_convert_la_SOURCES),
	tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/convert/converter_options.c (new_button_specification)
	(new_button_specification_list, new_basic_buttons, new_link_buttons)
	(new_section_buttons, new_section_footer_buttons),
	tp/Texinfo/XS/convert/converter_options.h: add a new file
	converter_options.c for converters initialization code needed for
	converters other than generic converter code.  Move buttons creation
	in C functions from convert_html.c to converter_options.c.

2024-10-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES): remove files that
	are in libtexinfo_convert_la_SOURCES.

	* tp/Texinfo/XS/Makefile.am: remove block of definition of
	libtexinfo_convert that crept in through rebasing and incorrect
	conflicts resolution.

2024-08-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_converter_perl_info.c
	(set_translated_commands): remove converter, use directly generated
	translated commands.

	* tp/Texinfo/XS/convert/get_converter_perl_info.c: remove
	get_sv_configured_options.

2024-08-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (CONVERTER_FORMAT_DATA)
	(converter_format_data): rename CONVERSION_FORMAT_DATA as
	CONVERTER_FORMAT_DATA, conversion_format as converter_format_data,
	enum conversion_output_format as enum converter_format and
	CONVERSION_FORMAT_NR as TXI_CONVERSION_FORMAT_NR.

	* tp/Texinfo/XS/convert/converter.h (enum converter_format)
	(TXI_CONVERSION_FORMAT_NR, CONVERTER_FORMAT_DATA),
	tp/Texinfo/XS/convert/converter.c: move declarations to converter.h.

	* tp/Texinfo/XS/convert/ConvertXS.xs (generic_converter_init),
	tp/Texinfo/XS/convert/converter.c (set_converter_init_information),
	tp/Texinfo/XS/main/get_perl_info.c (converter_get_info_from_sv):
	determine enum converter format in converter_get_info_from_sv, pass it
	as return value.  Pass status in an integer reference.

	* tp/Texinfo/XS/convert/converter.c (set_global_document_commands):
	allow converter document to be NULL.

2024-08-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES)
	(ConvertXS_la_SOURCES): put generic converter source files in
	libtexinfo_la_SOURCES instead of ConvertXS_la_SOURCES as all the code
	that link against libtexinfoxs requires it through get_perl_info.c.

2024-08-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (get_global_document_command): set
	command_list for multi commands in the if multi.

2024-08-04  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/regenerate_perl_options_info.pl: use more simple quotes.
	set a hash for conversion options and use it to retrieve the
	information in generated get_converter_regular_options.

2024-08-04  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Managing Customization Variables): put the
	'Adding Customization Variables' node in an ignore block.  Indeed,
	adding customization variables is currently only possible in Perl, not
	with XS/C, and it is unlikely to change, as to be available in C too
	it would need to specify a type (integer, byte or char) and add
	dynamically options, which would involve important changes, so it is
	not certain that it is worth keeping this possibility, especially
	since it is not used anwhere in Texinfo currently.

2024-10-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_converter_perl_info.c
	(get_converter_info_from_sv): do not error out on
	deprecated_config_directories customization hash directory key.

2024-08-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (_generic_converter_init): update
	warning message.

	* tp/Texinfo/XS/convert/ConvertXS.xs (generic_converter_init),
	tp/Texinfo/XS/main/get_perl_info.c (get_converter_info_from_sv)
	(converter_get_info_from_sv): pass Perl class down to
	get_converter_info_from_sv.  Issue a message for an unknown
	customization option.

2024-08-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (_generic_converter_init),
	tp/Texinfo/XS/convert/ConvertXS.xs (generic_converter_init): rename
	_internal_converter_initialize as _generic_converter_init, and XS
	generic_converter_init as generic_converter_init.

2024-08-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/api_to_perl.c (register_perl_data): add
	register_perl_data and call it or unregister_perl_data, inlining
	register_perl_buttons_list, unregister_perl_buttons_list,
	unregister_perl_button, register_perl_button,
	unregister_perl_direction_icons.

2024-08-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c
	(destroy_converter_initialization_info): rename
	free_converter_initialization_info as
	destroy_converter_initialization_info.  Free the
	CONVERTER_INITIALIZATION_INFO argument.

	* tp/Texinfo/XS/main/document.c
	(destroy_document_information_except_tree): free sorted_options.

2024-08-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/get_perl_info.c (get_converter_info_from_sv)
	(set_non_customization_sv), tp/Texinfo/XS/convert/converter.c
	(free_converter_initialization_info, apply_converter_info):
	rename defaults_info variable as initialization_info, defaults_sv as
	init_info_sv, defaults as init_info.

2024-08-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs,
	tp/Texinfo/XS/main/converter_types.h (CONVERTER_INITIALIZATION_INFO),
	tp/Texinfo/XS/convert/converter.c (apply_converter_info)
	(set_converter_init_information, new_converter_initialization_info),
	tp/Texinfo/XS/main/get_perl_info.c (get_converter_info_from_sv)
	(converter_get_info_from_sv): rename CONVERTER_DEFAULTS_INFO as
	CONVERTER_INITIALIZATION_INFO.  Rename apply_converter_defaults as
	apply_converter_info, fill_converter_conf as
	set_converter_init_information, new_converter_defaults_info as
	new_converter_initialization_info, free_converter_defaults_info as
	free_converter_initialization_info, get_converter_defaults_from_sv as
	get_converter_info_from_sv and converter_get_defaults_sv as
	converter_get_info_from_sv.  Update users/callers.

2024-10-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_converter_perl_info.c: remove
	converter_initialize_sv.

	* tp/Texinfo/XS/convert/get_converter_perl_info.c
	(set_translated_commands): add converter argument.

	* tp/Texinfo/XS/convert/get_converter_perl_info.c
	(get_option_from_sv, set_non_customization_sv)
	(get_converter_defaults_from_sv, converter_get_defaults_sv),
	tp/Texinfo/XS/main/get_perl_info.c: move to get_converter_perl_info.c.

2024-08-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/api_to_perl.c (register_perl_data),
	tp/Texinfo/XS/main/utils.c (copy_option): copy icon sv.

	* tp/Texinfo/XS/main/option_types.h (OPTIONS_LIST),
	tp/Texinfo/XS/main/utils.c (free_options_list)
	(copy_options_list_options): add OPTIONS_LIST, and associated
	functions, free_options_list and copy_options_list_options.

	* tp/Texinfo/XS/main/get_perl_info.c (get_sv_option): handle options
	unset.  It could happen, for example, if the information gotten is a
	separate option information not (already) associated to an OPTIONS
	structure, for example passing through a OPTIONS_LIST.

	* tp/Texinfo/XS/main/converter_types.h (CONVERTER_DEFAULTS_INFO),
	tp/Texinfo/XS/convert/converter.c (new_converter_defaults_info)
	(new_converter_defaults_info), tp/Texinfo/XS/main/get_perl_info.c
	(get_converter_defaults_from_sv): add CONVERTER_DEFAULTS_INFO, a
	structure holding information that can be passed as information for
	converter, with options, format names and translated commands.  Add
	get_converter_defaults_from_sv to set it from Perl data.

	* tp/Texinfo/XS/main/get_perl_info.c (set_translated_commands):
	pass a SV and returns a newly allocated TRANSLATED_COMMAND.

	* tp/Texinfo/XS/main/get_perl_info.c (get_option_from_sv): setup an
	OPTION based on a SV and an option name.

	* tp/Texinfo/XS/convert/ConvertXS.xs (converter_initialize),
	tp/Texinfo/XS/convert/converter.c (apply_converter_defaults)
	(fill_converter_conf), tp/Texinfo/XS/main/get_perl_info.c
	(set_non_customization_sv, converter_get_defaults_sv): get information
	on format defaults and user customization in a separate function,
	converter_get_defaults_sv.  Then set them in the C converter with
	fill_converter_conf.  Remove converter_initialize_sv.

2024-08-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/get_perl_info.h: remove get_options_key_sv_option
	and set_option_key_configured.

2024-08-03  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/regenerate_C_options_info.pl: rename generated
	build_sv_option as build_sv_option_key.

	* tp/Texinfo/XS/main/build_perl_info.c (build_sv_option): add
	build_sv_option that gets a Perl SV based on an OPTION, for all the
	types of options.

	* tp/Texinfo/XS/main/build_perl_info.c (get_sv_conf),
	tp/Texinfo/XS/main/DocumentXS.xs (document_get_conf): find option
	using sorted options with a call to find_option_string.  Call
	build_sv_option to get the Perl SV.

2024-08-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs,
	tp/Texinfo/XS/main/get_perl_info.c: remove reset_output_init_conf and
	copy_converter_conf_sv.

	* tp/maintain/regenerate_C_options_info.pl: rename generated
	get_sv_option as get_options_key_sv_option.

	* tp/Texinfo/XS/main/get_perl_info.c (get_sv_option)
	(get_sorted_options_key_sv_option): add get_sv_option function
	that sets an OPTION based on a Perl SV, for all the types of options.
	Add get_sorted_options_key_sv_option that finds an option using sorted
	options and then sets it with Perl SV.

	* tp/Texinfo/XS/main/get_perl_info.c (get_sv_options)
	(init_copy_sv_options): add a sorted_options argument to
	get_sv_options and use get_sorted_options_key_sv_option.  Change
	init_copy_sv_options to set sorted options too and optionally get them
	back.  Update callers.

	* tp/Texinfo/XS/main/DocumentXS.xs (register_document_options),
	tp/Texinfo/XS/main/document.c (register_document_options),
	tp/Texinfo/XS/main/document.h (DOCUMENT): add and set sorted_options
	field in DOCUMENT;

	* tp/Texinfo/XS/main/utils.c (free_option, initialize_option): always
	the same order with integer then char.

2024-10-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_converter_perl_info.c: remove
	reset_output_init_conf.

	* tp/Texinfo/XS/convert/get_converter_perl_info.c
	(copy_sv_options_for_convert_text): fix init_copy_sv_options calls.

	* tp/Texinfo/XS/main/get_perl_info.h: declare
	get_sorted_options_key_sv_option.

2024-08-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs,
	tp/Texinfo/XS/main/get_perl_info.c: remove reset_output_init_conf and
	copy_converter_conf_sv.

	* tp/maintain/regenerate_C_options_info.pl: rename generated
	get_sv_option as get_options_key_sv_option.

	* tp/Texinfo/XS/main/get_perl_info.c (get_sv_option)
	(get_sorted_options_key_sv_option): add get_sv_option function
	that sets an OPTION based on a Perl SV, for all the types of options.
	Add get_sorted_options_key_sv_option that finds an option using sorted
	options and then sets it with Perl SV.

	* tp/Texinfo/XS/main/get_perl_info.c (get_sv_options)
	(init_copy_sv_options): add a sorted_options argument to
	get_sv_options and use get_sorted_options_key_sv_option.  Change
	init_copy_sv_options to set sorted options too and optionally get them
	back.  Update callers.

	* tp/Texinfo/XS/main/DocumentXS.xs (register_document_options),
	tp/Texinfo/XS/main/document.c (register_document_options),
	tp/Texinfo/XS/main/document.h (DOCUMENT): add and set sorted_options
	field in DOCUMENT;

	* tp/Texinfo/XS/main/utils.c (free_option, initialize_option): always
	the same order with integer then char.

2024-10-02  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (HTML Xref Configuration):
	Add text explaining necessity of htmlxref.cnf.	Mention
	possibility of local htmlxref.cnf.

2024-10-02  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: remove items that were in 7.1.1

2024-10-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_converter_perl_info.c
	(get_sv_configured_options, converter_initialize_sv),
	tp/Texinfo/XS/main/get_perl_info.c: move get_sv_configured_options and
	converter_initialize_sv to get_converter_perl_info.c.  Remove obsolete
	converter_initialize from get_converter_perl_info.c.

2024-08-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (find_option_string): return 0 if not
	found.

	* tp/Texinfo/XS/main/utils.c (set_sorted_option_key_configured): set
	configured on an OPTION found by name using find_option_string.

	* tp/Texinfo/XS/main/get_perl_info.c (get_sv_configured_options)
	(converter_initialize_sv): use set_sorted_option_key_configured.

2024-08-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (compare_option_str, initialize_option),
	tp/maintain/regenerate_C_options_info.pl: add option name in
	initialize_option and in generated initialize_options.

	* tp/maintain/regenerate_C_options_info.pl: generate TXI_OPTIONS_NR.
	Generate setup_sortable_options that sets up an array of OPTIONS
	OPTION fields.

	* p/Texinfo/XS/convert/converter.c (init_generic_converter)
	(free_generic_converter), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER), tp/Texinfo/XS/main/utils.c (setup_sorted_options),
	tp/Texinfo/XS/main/option_types.h (OPTION): setup sorted_options field
	in converter with the sorted options of conf.

	* tp/Texinfo/XS/main/utils.c (find_option_string): add a function to
	use bsearch to find an option by name in a sorted options array.

2024-08-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (enum conversion_output_format)
	(CONVERSION_FORMAT_NR, CONVERSION_FORMAT_DATA, conversion_format):
	setup preliminary data table to describe a converted format to be able
	to associate strings and functions.

2024-08-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (init),
	tp/Texinfo/XS/convert/converter.c (converter_setup): add directories
	as converter_setup arguments.  Call setup_converter_paths_information
	and set_element_type_name_info in converter_setup, not in ConvertXS.xs
	init.

2024-08-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (%common_converters_defaults),
	tp/Texinfo/Convert/HTML.pm (_load_htmlxref_files), tp/texi2any.pl:
	rename language_config_dirs as texinfo_language_config_dirs.

2024-08-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_converter_perl_info.c
	(reset_output_init_conf), tp/Texinfo/XS/main/get_perl_info.c: move
	reset_output_init_conf to get_converter_perl_info.c.

2024-08-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (get_sv_conf): rename get_conf
	as get_sv_conf.  Update callers.

	* tp/Texinfo/XS/main/build_perl_info.c (build_translated_commands):
	add.

	* tp/Texinfo/XS/convert/converter.h (default_special_unit_varieties),
	tp/Texinfo/XS/convert/convert_html.h: move
	default_special_unit_varieties declaration to converter.h.

	* tp/Texinfo/XS/convert/converter.c (destroy_translated_commands),
	tp/Texinfo/XS/main/convert_utils.c: move destroy_translated_commands
	to converter.c.

	* tp/maintain/regenerate_C_options_info.pl: generate C functions to
	set converter generic options.

	* tp/Texinfo/Convert/Converter.pm (set_conf),
	tp/Texinfo/XS/convert/ConvertXS.xs (set_conf, force_conf),
	tp/Texinfo/XS/main/get_perl_info.c (set_sv_conf),
	tp/maintain/regenerate_C_options_info.pl: add return values to the
	get_sv_option generate function to determine if setting a
	customization variable failed and why.  Add a status return value to
	set_sv_conf and to the set_conf and force_conf XS overrides.  Take
	into account _XS_set_conf return value to determine if the
	customization option was set.

	* tp/Texinfo/XS/main/api_to_perl.c (get_refcount): add an unused
	function, for debugging.

	* tp/Texinfo/XS/main/get_perl_info.c (get_sv_options): call
	get_sv_option even for options with undef values.

	* tp/Texinfo/XS/main/get_perl_info.c (set_translated_commands): free
	previous translated_commands before getting new ones.

	* tp/Texinfo/XS/main/api_to_perl.c (unregister_perl_buttons_list)
	(register_perl_buttons_list, unregister_perl_direction_icons),
	tp/Texinfo/XS/main/get_perl_info.c
	(html_fill_button_specification_list)
	(html_get_button_specification_list, html_fill_direction_icons)
	(html_get_direction_icons_sv), tp/Texinfo/XS/main/utils.c
	(html_free_button_specification_list, html_free_direction_icons)
	(copy_option), tp/maintain/regenerate_C_options_info.pl: add icons SV
	to the direction icons lists.  Add html_fill_button_specification_list
	and html_fill_direction_icons to fill the directions information in
	buttons or icons based on the Perl references.  Own all the Perl
	objects in C by increasing refcount when registering and decreasing
	refcount when destroying the object they are registered into.
	Generate html_fill_options function in regenerate_C_options_info.pl
	that calls html_fill_button_specification_list and
	html_fill_direction_icons for all the relevant options.

	* tp/Texinfo/XS/main/get_perl_info.c (converter_initialize_sv): rename
	converter_initialize as converter_initialize_sv.

	* tp/Texinfo/Convert/Converter.pm (_internal_converter_initialize)
	(converter), tp/Texinfo/XS/main/build_perl_info.c
	(pass_generic_converter_to_converter_sv),
	tp/Texinfo/XS/convert/ConvertXS.xs (converter_initialize)
	(html_converter_initialize_sv), tp/Texinfo/XS/convert/converter.c
	(init_generic_converter, new_converter),
	tp/Texinfo/XS/main/build_perl_info.c
	(pass_generic_converter_to_converter_sv),
	tp/Texinfo/XS/main/get_perl_info.c (converter_initialize_sv):
	initialize default generic data and customizations options of generic
	converter in C, in the new init_generic_converter function.  Setup
	explicitely %format_defaults in Perl converter and pass to XS,
	together with the customization options hash.  Move converter() Perl
	code now initialized in C to _internal_converter_initialize.  Add
	pass_generic_converter_to_converter_sv to pass information from C to
	the Perl converter, based on ConvertXS.xs converter_initialize code,
	expanded to pass translated_commands and initialize output_files.
	Setup Perl customization variables, translated_commands and
	output_format in XS/C in converter_initialize_sv.  Do not set C
	customization data based on Perl data anymore.  Call html_fill_options
	in html_converter_initialize_sv.

	* tp/Texinfo/XS/main/converter_types.h (CONVERTER),
	tp/Texinfo/XS/convert/converter.c (free_generic_converter),
	tp/Texinfo/XS/main/get_perl_info.c (converter_initialize_sv): add
	converted_format field to converter and set it.

2024-08-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (html_attribute_class, _convert_text),
	tp/Texinfo/Convert/Plaintext.pm (new_formatter): always access
	configuration through get_conf() in case it is in C data only.

	* tp/Texinfo/XS/convert/convert_html.c: change in comments.

2024-08-01  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/regenerate_C_options_info.pl: protect " in generated C
	strings.

	* tp/Texinfo/Convert/HTML.pm (_set_variables_texi2html),
	tp/Texinfo/Convert/converters_defaults.txt (texi2html): add texi2html
	regular options to Texinfo/Convert/converters_defaults.txt.

2024-08-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Utils.pm (output_files_initialize)
	(output_files_disable_output_encoding, output_files_open_out)
	(output_files_register_closed, output_files_opened_files)
	(output_files_unclosed_files), tp/Texinfo/Common.pm: move output files
	open/close API from Common.pm to Convert/Utils.pm.

	* tp/Texinfo/Convert/Converter.pm (_internal_converter_initialize):
	initialize error_warning_messages in _internal_converter_initialize.

2024-08-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (html_get_direction_index),
	tp/Texinfo/XS/convert/converter.c: move html_get_direction_index
	from converter.c to utils.c.

2024-10-02  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/regenerate_C_options_info.pl: use basename of generating
	program in comments.
	
	Add TODO item from Bruno CI.

2024-08-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm,
	tp/Texinfo/Convert/converters_defaults.txt: add converter and common
	'formats' options to use in Texinfo/Convert/Converter.pm.

2024-08-01  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/regenerate_C_options_info.pl: fix parsing of converter
	defaults options with space.

	* tp/Makefile.am (Texinfo/Options.pm), tp/Texinfo/XS/Makefile.am
	(Options.pm), tp/maintain/regenerate_perl_options_info.pl: generate
	Perl data based on Texinfo/Convert/converters_defaults.txt.

	* tp/Texinfo/Convert/HTML.pm (%defaults): get options set from
	Texinfo/Convert/converters_defaults.txt.

2024-07-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (EXTRA_DIST),
	tp/Texinfo/Convert/converters_defaults.txt, tp/Texinfo/XS/Makefile.am
	(BUILT_SOURCES, MAINTAINERCLEANFILES, regenerate_C_options_info.pl)
	(ConvertXS_la_SOURCES, EXTRA_DIST),
	tp/maintain/regenerate_C_options_info.pl: generate with
	regenerate_C_options_info.pl C functions in
	convert/converters_defaults.c based on a textual description in
	tp/Texinfo/Convert/converters_defaults.txt that sets converters default
	string and integer options.

2024-07-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_default_format_button):
	fix handling of BST_string, BST_external_string, BIT_string and
	BIT_external_string based on their new significations.

2024-07-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (html_get_direction_index),
	tp/Texinfo/XS/main/get_perl_info.c: move html_get_direction_index from
	get_perl_info.c to converter.c.

	* tp/Texinfo/XS/main/tree_types.h (enum html_text_type),
	tp/Texinfo/XS/main/converter_types.h: move enum html_text_type from
	converter_types.h to tree_types.h.

	* tp/Texinfo/XS/main/option_types.h (BUTTON_SPECIFICATION_INFO): use
	enum html_text_type for direction_information_type type instead of
	int.

	* tp/Texinfo/XS/main/get_perl_info.c
	(html_get_button_specification_list),
	tp/Texinfo/XS/main/option_types.h (enum button_specification_type)
	(enum button_information_type, BUTTON_SPECIFICATION_INFO)
	(BUTTON_SPECIFICATION), tp/Texinfo/XS/main/utils.c
	(html_free_button_specification_list, copy_option): rename BST_string
	as BST_external_string and BIT_string as BIT_external_string.  Readd
	BST_string and BIT_string associated to a regular char *string.

	* tp/Texinfo/XS/convert/convert_html.c (new_button_specification)
	(new_button_specification_list, new_basic_buttons, new_link_buttons)
	(new_section_buttons, new_section_footer_buttons): add button
	specification, button list and default button specification lists
	creation functions.

2024-07-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_converter_initialize):
	move default setting before customization up.

	* tp/Texinfo/XS/convert/convert_html.c (html_converter_initialize):
	free pre_class_types before applying customization.  Free
	style_command element before applying customization.

2024-07-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_converter_initialize_sv),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv): move call to html_converter_initialize
	and copy_converter_conf_sv out of get_html_perl_info.c to
	ConvertXS.xs.

	* tp/Texinfo/Convert/HTML.pm (converter_initialize),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_converter_initialize_sv),
	p/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv): pass
	customized_no_arg_commands_formatting as an argument.

2024-07-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (accent_cmd, html_format_setup)
	(html_converter_initialize, html_free_converter),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER): collect accent commands in accent_cmd in convert_html.c,
	not in converter.  Remove accent_cmd converter field.

	* tp/Texinfo/XS/convert/convert_html.c (style_formatted_cmd)
	(html_format_setup, html_converter_initialize, html_free_converter),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER): collect style brace commands in style_formatted_cmd in
	convert_html.c, not in converter.  Remove style_formatted_cmd
	converter field.

	* tp/Texinfo/Convert/HTML.pm (converter_initialize),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_converter_initialize_sv),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h
	(COMMAND_HTML_STYLE_COMMAND_CONVERSION, CONVERTER),
	tp/Texinfo/XS/convert/convert_html.c (html_free_converter): add
	html_customized_style_commands field to converter with type
	COMMAND_HTML_STYLE_COMMAND_CONVERSION.  Pass
	style_commands_customized_formatting_info from Perl to C through
	html_converter_initialize_sv.

	* tp/Texinfo/XS/convert/convert_html.c (quoted_style_commands)
	(default_style_commands_formatting, html_format_setup): add
	quoted_style_commands. set default_style_commands_formatting based on
	quoted_style_commands and html_style_commands_element from
	conversion_data.c.

	* tp/Texinfo/XS/convert/convert_html.c (html_converter_initialize),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv): set
	self->html_style_command_conversion based on
	default_style_commands_formatting and on
	self->html_customized_style_commands in C.  Do not get
	style_commands_formatting from Perl.

2024-07-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (converter_initialize): setup
	%customized_accent_entities with all the customized commands before
	filling accent_entities.

	* tp/Texinfo/XS/convert/converter.c (xml_accent_text_entities),
	tp/Texinfo/XS/main/converter_types.h (COMMAND_ACCENT_ENTITY_INFO):
	setup xml_accent_text_entities defaults.

	* tp/Texinfo/Convert/HTML.pm (converter_initialize),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_converter_initialize_sv),
	tp/Texinfo/XS/convert/convert_html.c (html_converter_initialize)
	(html_free_converter), tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER): add html_customized_accent_entity_info field to
	CONVERTER, with type COMMAND_ACCENT_ENTITY_INFO.  Pass
	customized_accent_entities from Perl to C through
	html_converter_initialize_sv.  Set self->accent_entities in
	html_converter_initialize based on xml_accent_text_entities, with
	customized values added.  Do not get accent_entities from Perl
	anymore.

2024-07-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/command_data.awk: rename CM_POUND_SIGN as
	CM_DOUBLE_QUOTE.  Add CM_AMPERSAND.

2024-07-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (converter_initialize),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_converter_initialize_sv),
	tp/Texinfo/XS/convert/convert_html.c (default_code_types)
	(default_pre_class_types, html_converter_initialize)
	(html_free_converter), tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h
	(TYPE_INTEGER_INFORMATION, PRE_CLASS_TYPE_INFO, CONVERTER): set
	default_code_types and default_pre_class_types.  Add
	html_customized_code_types field to CONVERTER with type
	TYPE_INTEGER_INFORMATION and html_customized_pre_class_types field
	with type PRE_CLASS_TYPE_INFO.  Pass customized_type_formatting from
	Perl to those converter fields.  Do not get code_types nor
	pre_class_types from Perl.

2024-07-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv): move up code which should have
	defaults in C and customization from Perl.  No change.

2024-07-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_format_setup): preset
	unset default_no_arg_commands_formatting for string and preformatted
	context for no arg commands only.

	* tp/Texinfo/XS/main/converter_types.h (STYLE_COMMAND_CONTEXT_NR)
	(NO_ARG_COMMAND_CONTEXT_NR): add STYLE_COMMAND_CONTEXT_NR and
	NO_ARG_COMMAND_CONTEXT_NR macros.  Use them everywhere to replace
	previously used bounds.  STYLE_COMMAND_CONTEXT_NR is set to get only
	normal and preformatted contexts.

2024-07-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_style_command)
	(html_free_converter), tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h
	(HTML_STYLE_COMMAND_CONVERSION, CONVERTER): add
	html_style_command_conversion field to CONVERTER with type
	HTML_STYLE_COMMAND_CONVERSION for style commands conversion, instead of
	using the same array as brace no arg commands.

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_no_arg_commands_formatting, build_html_translated_names),
	tp/Texinfo/XS/convert/convert_html.c
	(default_no_arg_commands_formatting, text_element_conversion)
	(convert_no_arg_command, css_string_convert_no_arg_command)
	(html_convert_css_string_for_list_mark)
	(set_no_arg_commands_formatting)
	(reset_unset_no_arg_commands_formatting_context)
	(copy_html_no_arg_command_conversion, html_initialize_output_state)
	(free_html_no_arg_command_conversion, html_free_converter)
	(html_translate_names), tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv, html_conversion_initialization_sv),
	tp/Texinfo/XS/main/converter_types.h (HTML_NO_ARG_COMMAND_CONVERSION):
	(CONVERTER): remove style field from HTML_COMMAND_CONVERSION and
	rename as HTML_NO_ARG_COMMAND_CONVERSION.  Rename
	html_command_conversion converter field as
	html_no_arg_command_conversion now that it contains only no args
	commands.  Rename copy_html_command_conversion as
	copy_html_no_arg_command_conversion, rename
	free_html_command_conversion as free_html_no_arg_command_conversion.

2024-07-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Config.pm (texinfo_register_style_command_formatting):
	correct 'quote'.

	* tp/Texinfo/Config.pm (GNUT_get_no_arg_command_formatting): use
	GNUT_no_arg_commands_formatting_strings for context check.

	* tp/Texinfo/Convert/HTML.pm (%default_style_commands_formatting):
	rename %style_commands_formatting as
	%default_style_commands_formatting.

	* doc/texi2any_api.texi (Simple Output Customization for Simple
	Commands with Braces), tp/Texinfo/Config.pm
	(@all_style_commands_formatting_context)
	(_GNUT_initialize_style_commands_formatting_info),
	tp/Texinfo/Convert/HTML.pm (@style_commands_contexts)
	(@no_args_commands_contexts), tp/init/documentation_examples.pm,
	tp/init/sc_formatting_with_css.pm: do not set string context for style
	commands.  Use variables for the list of contexts.

	* tp/Texinfo/Convert/HTML.pm (converter_initialize): get all the
	style commands formatting customization in
	%style_commands_customized_formatting_info before applying it.

2024-07-30  Patrice Dumas  <pertusus@free.fr>

	* po_document/Makevars (XGETTEXT_OPTIONS): add pgdt_noop keyword.

	* po_document/POTFILES.in: add tp/Texinfo/XS/main/conversion_data.c.

2024-07-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(determine_non_default_special_unit_directions)
	(html_initialize_output_state): add a function that returns an array
	indicating special units directions different from default spacial
	units directions names.  Indeed, if the customized special unit
	direction name is not the same as the defaults, the default direction
	info should not be used as they are not for the customized special
	unit direction.  Code taken from html_initialize_output_state for
	special units direction strings.

	* tp/Texinfo/XS/convert/convert_html.c (html_converter_initialize)
	(html_free_converter), tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER): add customized_translated_direction_strings field in
	converter and get the customized translated_direction_strings in
	html_converter_initialize_sv in the same code where customized
	untranslated direction_strings are determined.  Set converter
	translated_direction_strings in html_converter_initialize based on
	defaults from main/conversion_data.c and
	customized_translated_direction_strings.  Do not set
	translated_direction_strings from Perl data in
	html_converter_initialize_sv.

2024-07-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv): merge conditions on spec_sv for
	customized_direction_strings.

2024-07-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (converter_initialize),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_converter_initialize_sv),
	tp/Texinfo/XS/convert/convert_html.c (html_free_converter),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER): do not set
	converter->default_converted_directions_strings anymore from Perl, as
	the C defaults are now used.  Remove the
	default_converted_directions_strings argument of
	html_converter_initialize_sv.  Remove the
	default_converted_directions_strings CONVERTER field.

2024-07-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (converter_initialize): avoid spurious
	autovivification for translated_direction_strings.

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv): handle undef spec hv in
	translated_direction_strings.

	* tp/maintain/generate_code_convert_data.pl: declare
	default_converted_directions_strings and
	default_translated_directions_strings.

	* tp/Texinfo/XS/convert/convert_html.c (html_initialize_output_state):
	use default_converted_directions_strings from main/conversion_data.c
	instead of the information coming from Perl.  Determine the special
	units directions that are not the same as the default units
	directions.  If not the same as the defaults, the default direction
	info should not be used as they are not for the customized special
	unit direction.

2024-07-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (converter_initialize): remove the code
	setting sorted_special_unit_varieties and simplified_special_unit_info
	as they are not used anymore.

2024-07-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (converter_initialize): call
	GNUT_get_direction_string_info only once.

	* tp/Texinfo/Convert/HTML.pm (converter_initialize),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_converter_initialize_sv),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv): get customized_direction_strings
	through the call of html_converter_initialize_sv, not from the
	Perl converter state.

2024-07-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (@all_directions_except_special_units)
	(converter_initialize, conversion_initialization): do not use default
	directions strings directions to apply customized direction strings,
	merge the directions that never change, global relative and file, and
	the special units directions that may be customized.

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv): fix code getting context values of
	customized_direction_strings.

	* tp/Makefile.am (test_files), tp/Makefile.tres,
	tp/t/init/special_unit_direction_string_info_customization.pm,
	tp/t/init_files_tests.t
	(button_replacement_direction_strings_customization): test direction
	customization and button direction replacement and direction strings
	customization for the modified special unit direction.

2024-07-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_converter_initialize_sv),
	tp/Texinfo/XS/convert/convert_html.c
	(html_converter_init_special_unit, html_converter_initialize),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_init_special_unit_sv, html_converter_initialize_sv):
	split html_converter_init_special_unit out of
	html_converter_initialize and html_converter_init_special_unit_sv out
	of html_converter_initialize_sv and modify
	html_converter_initialize_sv in ConvertXS.xs to setup first the the
	special unit info, as the special unit directions are needed for the
	remainder of initialization.  Therefore special unit Perl
	customization needs to be read and special unit initialization in C
	code needs to be run too before doing the remaining.

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv): do not use the default special unit
	info, but the customized special units info.

	* tp/Makefile.tres, tp/t/init_files_tests.t
	(button_replacement_and_direction_customization): test both special
	unit direction customization and replacement of button in buttons
	specifications.

2024-07-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/Makefile.tres,
	tp/t/init_files_tests.t (ref_for_special_unit_direction)
	(button_replacement_for_special_unit_direction),
	tp/t/init/button_replacement_for_special_unit_direction.pm: add a
	reference without init file use for special element direction test.
	Add an init file to replace the button directions with the customized
	special unit direction.

2024-10-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_converter_perl_info.c
	(converter_initialize): readd converter_initialize that was mistakenly
	removed.

2024-07-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (direction_string)
	(from_element_direction): return 0 if the direction is negative, which
	should mean a Perl direction not found in C.

	* tp/Texinfo/XS/main/get_perl_info.c (html_get_direction_index):
	return -2 if there are directions in the converter and the direction
	is not found (instead of -1).

	* tp/Texinfo/XS/main/get_perl_info.c
	(html_get_button_specification_list): add more checks of empty arrays,
	undef values.

	* tp/Makefile.am (test_files), tp/Makefile.tres,
	tp/t/init_files_tests.t ($special_unit_direction_customization_text)
	(special_unit_direction_customization),
	tp/t/init/special_unit_direction_customization.pm: add test of special
	unit direction customization.

2024-07-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_footnotes_sequence): free footnote_location_href.

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(register_formatting_reference_default)
	(register_formatting_reference_with_default): handle HV set to 0 in
	argument.

	* tp/maintain/generate_code_convert_data.pl: add
	SPECIAL_UNIT_INFO_TYPE_NR and default_special_unit_info declarations.

	* tp/Texinfo/Convert/HTML.pm (converter_initialize),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_converter_initialize_sv),
	tp/Texinfo/XS/convert/convert_html.c (html_add_special_unit_info)
	(html_converter_initialize, reset_special_unit_info_list)
	(html_reset_converter, html_free_converter),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h
	(SPECIAL_UNIT_INFO, SPECIAL_UNIT_INFO_LIST, CONVERTER): get
	customized_special_unit_info in argument of
	html_converter_initialize_sv, put it in SPECIAL_UNIT_INFO_LIST new
	type in customized_special_unit_info field of converter.  Also get the
	customized_special_unit_varieties in converter, although this
	information is not used for now.  Set special_unit_varieties based on
	defaults in conversion_data.c and set special_unit_info default in
	html_converter_initialize before applying customization.

2024-07-29  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/generate_code_convert_data.pl: add
	BASE_DEFAULT_CSS_ELEMENT_CLASS_STYLE_NR in main/conversion_data.h.

	* tp/Texinfo/XS/convert/convert_html.c (html_css_set_selector_style)
	(sort_css_element_class_styles, find_css_selector_style): use a
	CSS_SELECTOR_STYLE_LIST pointer as first argument.  Update callers.

	* tp/Texinfo/XS/convert/convert_html.c (html_attribute_class)
	(convert_itemize_command): check that style in selector_style is set.

	* tp/Texinfo/XS/convert/convert_html.c
	(get_special_list_mark_css_string_no_arg_command): add based on
	html_initialize_output_state code.  Use in
	html_initialize_output_state.

	* tp/Texinfo/XS/convert/convert_html.c (html_format_setup)
	(default_css_element_class_styles): set
	default_css_element_class_styles based on
	base_default_css_element_class_styles set in main/conversion_data.c,
	add and remove selectors with styles. 

	* tp/Texinfo/XS/convert/convert_html.c (html_initialize_output_state): 
	initialize self->css_element_class_styles with
	default_css_element_class_styles.

	* tp/Texinfo/Convert/HTML.pm (converter_initialize),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_converter_initialize_sv),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv): remove
	default_css_element_class_styles argument.  Set
	default_css_element_class_styles as a variable set to 0 in
	html_converter_initialize_sv such that the code can be left but is not
	run.

2024-07-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (main/conversion_data.c),
	maintain/generate_code_convert_data.pl: read C commands data on STDIN.
	Generate default_translated_directions_strings and
	html_style_commands_element C data.

	* tp/Makefile.am (Texinfo/Data.pm): reformat.

2024-07-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Data/default_direction_strings.csv,
	tp/Texinfo/Data/default_special_unit_info.csv,
	tp/maintain/generate_code_convert_data.pl: determine translation
	context automatically.  Remove columns from data files.

	* tp/Makefile.am (maintenance_files, Texinfo/Data.pm),
	tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES, EXTRA_DIST)
	(BUILT_SOURCES, main/conversion_data.c, MAINTAINERCLEANFILES),
	tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/main/converter_types.h,
	tp/Texinfo/XS/main/option_types.h, tp/Texinfo/XS/main/tree_types.h,
	tp/maintain/generate_code_convert_data.pl: generate automatically C
	code files based on tp/Texinfo/Data/*.csv in
	generate_code_convert_data.pl in parallel with Perl code generation.
	Replace from manually set enum, arrays and macros
	special_unit_info_type_names, translated_special_unit_info,
	direction_type_translation_context, enum special_unit_info_type, enum
	special_unit_info_tree, TDS_TRANSLATED_TYPES_LIST,
	TDS_NON_TRANSLATED_TYPES_LIST, TDS_TYPE_MAX_NR, FIRSTINFILE_MIN_IDX,
	FIRSTINFILE_MAX_IDX, HTML_GLOBAL_DIRECTIONS_LIST,
	RUD_DIRECTIONS_TYPES_LIST and RUD_FILE_DIRECTIONS_TYPES.

2024-07-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Data/default_direction_strings.csv: fix order.

	* tp/maintain/generate_convert_data_perl_code.pl,
	tp/Texinfo/Convert/HTML.pm, tp/Texinfo/OutputUnits.pm: gather
	directions orders from one place only, in
	generate_convert_data_perl_code.pl, setup get_directions_order in
	Texinfo::Data.

2024-07-29  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Directions), tp/Texinfo/OutputUnits.pm
	(@relative_directions_order), tp/Texinfo/XS/main/tree_types.h
	(RUD_DIRECTIONS_TYPES_LIST): remove SectionNext, SectionPrev and
	SectionUp, they have no associated strings and have not be set for a
	long time.

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h,
	tp/Texinfo/XS/main/option_types.h: add comment, move code around.

2024-07-29  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/generate_convert_data_perl_code.pl: process special
	units before directions.  Change in spacing.

	* tp/Texinfo/Data/default_direction_strings.csv: change order to match
	better order in C enum.

	* tp/Texinfo/XS/main/utils.c: change in spacing.

2024-07-29  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl: get file handle from XS for - too.

2024-10-01  Patrice Dumas  <pertusus@free.fr>

	* Makefile.am, ChangeLog: remove spurious references to
	copy-file_but_owner.c. copy-file_but_owner.c never existed in this
	timeline.

2024-07-28  Patrice Dumas  <pertusus@free.fr>

	* po_document/Makevars (XGETTEXT_OPTIONS): add cdt_tree and
	translate_convert_to_html_internal keywords.

	* Makefile.am (po_document-check): match
	translate_convert_to_html_internal.

	* tp/Texinfo/XS/convert/converter.c: mark @error translation as
	Texinfo code as a translated string with gdt_noop.

	* tp/Texinfo/XS/main/convert_utils.c (convert_utils_month_name): mark
	months for translation with gdt_noop.

2024-07-28  Patrice Dumas  <pertusus@free.fr>

	* po_document/Makevars (XGETTEXT_OPTIONS), tp/Texinfo/XS/main/utils.h
	(gdt_noop, pgdt_context_noop), tp/Texinfo/XS/main/utils.c
	(def_aliases), po_document/POTFILES.in: add gdt_noop and
	pgdt_context_noop cpp macros to mark strings for translation.  Use in
	utils.c for def_aliases.  Add to XGETTEXT_OPTIONS, and add
	main/utils.c to po_document/POTFILES.in.

	* Makefile.am (po_document-check): match gdt_noop and pgdt_context_noop.

2024-07-28  Patrice Dumas  <pertusus@free.fr>

	* Makefile.am (po_document-check), po_document/POTFILES.in: add an
	exception for main/DocumentXS.c in po_document-check, remove from
	POTFILES.in.

2024-07-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_utils.c (definition_category_tree):
	remove empty lines between TRANSLATORS comment and function call.

	* Makefile.am (po_document-check): consider C files, update matching
	to get functions used in C.

	* po_document/Makevars (XGETTEXT_OPTIONS): add C only keywords
	html_cdt_tree and gdt_tree.

	* po_document/POTFILES.in: add converter C files.

2024-07-28  Patrice Dumas  <pertusus@free.fr>

	* po/Makevars (XGETTEXT_OPTIONS): add pass-perl-format flag for __p.

	* Makefile.am (po-check): add missing keywords.

2024-07-28  Patrice Dumas  <pertusus@free.fr>

	* po/Makevars (XGETTEXT_OPTIONS): add c-format flag for
	line_error_ext.

2024-07-28  Patrice Dumas  <pertusus@free.fr>

	* po/Makevars (XGETTEXT_OPTIONS): fix line_error_ext argument number.

2024-07-28  Patrice Dumas  <pertusus@free.fr>

	* po/Makevars (XGETTEXT_OPTIONS): set pass-perl-format for __.  Add
	c-format and perl-format for functions involved in error reporting.

2024-07-28  Patrice Dumas  <pertusus@free.fr>

	* po/Makevars (XGETTEXT_OPTIONS): remove --flag options of removed
	functions.

2024-07-28  Patrice Dumas  <pertusus@free.fr>

	* po_document/Makevars (XGETTEXT_OPTIONS): remove --language=Perl, it
	can be determined automatically, and could be C too.

2024-07-28  Patrice Dumas  <pertusus@free.fr>

	* po_document/Makevars (XGETTEXT_OPTIONS): disable default keywords.

2024-07-28  Patrice Dumas  <pertusus@free.fr>

	* po/Makevars (XGETTEXT_OPTIONS): disable default keywords.  Add
	ngettext.  Reorder.  Remove unused keywords.

2024-07-28  Patrice Dumas  <pertusus@free.fr>

	* po/POTFILES.in: add tp/Texinfo/XS/convert/converter.c.

2024-07-28  Patrice Dumas  <pertusus@free.fr>

	Use separate po files for tp/Texinfo/XS gnulib

	* tp/Texinfo/XS/main/build_perl_info.c (init): call
	bindtextdomain for the texinfo_tp-gnulib separate domain.

	* po/POTFILES.in: remove tp/Texinfo/XS/gnulib/lib file.

	* Makefile.am (po-check): ignore tp/Texinfo/XS/gnulib/lib/*.

2024-10-01  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (HTML Xref Link Basics, HTML Xref Configuration):
	Edit.

	Patch to documentation posted by Patrice, bug-texinfo 2024-08-23 and
	revised by Gavin.

2024-10-01  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/generate_convert_data_perl_code.pl: import
	File::Basename.

2024-10-01  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/generate_convert_data_perl_code.pl: use generating file
	basename in comment.

2024-07-28  Patrice Dumas  <pertusus@free.fr>

	* gnulib/m4: remove obsolete gnulib gettext module m4 files.

2024-10-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/gnulib/lib/Makefile.am,
	tp/Texinfo/XS/gnulib/m4/gnulib-cache.m4,
	tp/Texinfo/XS/gnulib/po/POTFILES.in: update tp/Texinfo/XS gnulib.

2024-07-28  Patrice Dumas  <pertusus@free.fr>

	Setup separate po files directory for tp/Texinfo/XS directory gnulib

	* tp/Texinfo/XS: run
	  gnulib-tool --add-import --po-base=gnulib/po --po-domain=texinfo_tp

	* tp/Texinfo/XS/Makefile.am (SUBDIRS), tp/Texinfo/XS/configure.ac
	(AC_CONFIG_FILES): update for tp/Texinfo/XS/gnulib/po/.

	* tp/Texinfo/XS/gnulib/m4: remove obsolete gnulib gettext module m4 files.

2024-07-28  Patrice Dumas  <pertusus@free.fr>

	Use separate po files for gnulib in info and install-info
	
	* info/info.c (main), install-info/install-info.c (main): call
	bindtextdomain for the PACKAGE "-gnulib" separate domain.

	* po/POTFILES.in: remove gnulib/lib files.

	* Makefile.am (po-check): ignore gnulib/lib/*.

2024-07-28  Patrice Dumas  <pertusus@free.fr>

	Setup separate po files directory for base directory gnulib

	run
	  gnulib/gnulib-tool --add-import --po-base=gnulib/po --po-domain=texinfo

	* Makefile.am (SUBDIRS), configure.ac (AC_CONFIG_FILES): update for
	gnulib/po/.

2024-07-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (default_upper_case_commands):
	add, with @sc.

	* tp/Texinfo/Convert/HTML.pm (converter_initialize),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_converter_initialize_sv),
	tp/Texinfo/XS/convert/convert_html.c (html_converter_initialize)
	(html_free_converter), tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h
	(COMMAND_INTEGER_INFORMATION, CONVERTER): add
	html_customized_upper_case_commands field in converter.  Pass
	customized_upper_case_commands to converter_initialize instead of
	getting upper_case_commands directly from Perl converter.  Initialize
	converter upper_case in html_converter_initialize based on defaults in
	default_upper_case_commands, and add
	html_customized_upper_case_commands information on top.

2024-07-27  Patrice Dumas  <pertusus@free.fr>

	* po_document/POTFILES.in: add tp/Texinfo/Data.pm.

2024-07-27  Patrice Dumas  <pertusus@free.fr>

	Use CSV files to store data relevant for Perl and C

	* tp/Texinfo/Data/default_css_element_class_styles.csv,
	tp/Texinfo/Data/default_direction_strings.csv,
	tp/Texinfo/Data/default_special_unit_info.csv,
	tp/Texinfo/Data/html_style_commands_element.csv,
	tp/maintain/generate_convert_data_perl_code.pl, tp/Makefile.am
	(dist_modules_DATA, dist_noinst_DATA, maintenance_files)
	(Texinfo/Data.pm), tp/Texinfo/Convert/HTML.pm: move
	%default_special_unit_info, %default_translated_special_unit_info,
	%default_converted_directions_strings,
	%default_translated_directions_strings,
	%default_css_element_class_styles and %style_commands_element to CSV
	files separated by | in tp/Texinfo/Data/.  Add
	maintain/generate_convert_data_perl_code.pl to generate Perl data
	in Texinfo/Data.pm based on the CSV files data.

2024-10-01  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (HTML Xref Configuration): edit description
	of splitting search order.

2024-07-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (html_get_css_elements_classes)
	(%default_css_element_class_styles): remove unused %css_rules_not_collected.

2024-10-01  Patrice Dumas  <pertusus@free.fr>

	update gnulib in tp/Texinfo/XS

2024-10-01  Patrice Dumas  <pertusus@free.fr>

	update gnulib in base directory

2024-07-27  Patrice Dumas  <pertusus@free.fr>

	* po/Makevars (XGETTEXT_OPTIONS): remove redundant keyword option.

2024-07-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_heading_command),
	tp/Texinfo/XS/convert/convert_html.c (convert_heading_command),
	tp/init/book.pm (book_convert_heading_command): use only one variable
	for toc and mini toc or menu.

2024-07-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/input.c (set_input_encoding)
	(encode_file_name): add filename_encoding_conversion to cache the
	encoding conversion like reverse_iconv did previously.  Reset in
	set_input_encoding.  Call directly encode_with_iconv instead of
	encode_string.

2024-07-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/input.c (set_input_encoding)
	(encode_file_name): use encode_string to encode the file name.  Remove
	reverse_iconv.

2024-07-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/input.c (set_input_encoding)
	(parser_reset_encoding_list): use the general input_conversions from
	utils.c in the parser.  Remove parser_input_conversions.  Do not call
	reset_encoding_list in parser_reset_encoding_list such that conversion
	code can reuse the converter setup for the parsing.

2024-07-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c (remove_document_descriptor): call
	unregister_document_hv.

2024-07-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(html_pass_conversion_initialization),
	tp/Texinfo/XS/convert/convert_html.c (html_free_converter),
	tp/Texinfo/XS/main/api_to_perl.c (unregister_html_converter_perl_hv),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): register the
	converter_info_hv in pl_info_hv field in converter to get a stable
	caching from C in Perl data, even if the Perl data changes.

	* tp/Texinfo/XS/main/api_to_perl.c (unregister_document_hv),
	tp/Texinfo/XS/main/build_perl_info.c (get_document, fill_document_hv),
	tp/Texinfo/XS/main/document_types.h (DOCUMENT): register the document
	HV in document to get a stable caching from C in Perl data, even if
	the Perl data changes.

	* tp/Texinfo/XS/convert/ConvertXS.xs
	(get_converter_indices_sorted_by_index)
	(get_converter_indices_sorted_by_letter),
	tp/Texinfo/XS/main/build_perl_info.c (BUILD_PERL_DOCUMENT_ITEM)
	(BUILD_PERL_DOCUMENT_LIST, document_global_information): use the
	C document hv field to cache Perl data instead of the passed document,
	in case it changed.  A changed document happens for DocBook in tests
	as a copy of the document is made, with the same document descriptor
	and another object.

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(pass_sv_converter_info): use the Perl object in C to cache.

2024-07-24  Patrice Dumas  <pertusus@free.fr>

	* tp/t/03coverage_braces.t (nested_in_sc): do not set docbook as
	test_formats in the test specification, as docbook is already output.

2024-07-24  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): call explicitely
	Texinfo::Common::set_output_perl_encoding for HTML for outputting
	result files, as OUTPUT_PERL_ENCODING is not set if with XS and
	there is no user-defined functions called through the HTML
	customization API.

2024-07-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/call_perl_function.c
	(call_common_set_output_perl_encoding): add a call to
	Texinfo::Common::set_output_perl_encoding to be able to set
	OUTPUT_PERL_ENCODING from C.

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(html_pass_conversion_initialization): call
	call_common_set_output_perl_encoding if
	converter->external_references_number > 0.

	* tp/Texinfo/Common.pm (output_files_open_out): remove call to
	set_output_perl_encoding.

2024-07-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(html_prepare_converted_output_info, html_do_js_files): free
	default_document_language and preamble_document_language.  Free jsdir.

2024-07-24  Patrice Dumas  <pertusus@free.fr>

	XS override for HTML::convert

	* tp/Texinfo/Convert/HTML.pm (%XS_overrides),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_convert): add an XS override
	for convert.

2024-07-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_output_units_global_targets),
	tp/Texinfo/XS/convert/build_html_perl_state.c
	(html_pass_output_units_global_targets): remove code used in
	html_prepare_output_units_global_targets to pass data to Perl, put in
	html_pass_output_units_global_targets new function.

2024-07-24  Patrice Dumas  <pertusus@free.fr>

	XS override for HTML::output

	* tp/Texinfo/XS/convert/convert_html.c (do_jslicenses_file): remove a
	spurious end of line.

	* tp/Texinfo/XS/convert/convert_html.c (html_do_js_files): rename
	do_js_files as html_do_js_files.

	* tp/Texinfo/XS/convert/convert_html.c (html_finish_output): add.

	* tp/Texinfo/Convert/HTML.pm (%XS_overrides),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_output): add an XS override
	for output.

2024-07-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_conversion_units),
	tp/Texinfo/XS/convert/build_html_perl_state.c
	(html_pass_conversion_output_units): move code setting Perl data from
	html_prepare_conversion_units to a new function,
	html_pass_conversion_output_units.

	* tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_units_directions_files),
	tp/Texinfo/XS/convert/build_html_perl_state.c
	(html_pass_units_directions_files): move code setting Perl data from
	html_prepare_units_directions_files to a new function,
	html_pass_units_directions_files.

2024-07-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_converted_output_info)
	(output), tp/Texinfo/XS/convert/convert_html.c
	(html_prepare_converted_output_info): move call of structure handler
	to the beginning of _prepare_converted_output_info out of output.

	* tp/Texinfo/Convert/HTML.pm (_finish_output, output): move code
	occuring at the end of output to a new function, _finish_output.

2024-07-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (XS_get_unclosed_stream): rename
	_XS_get_unclosed_stream as XS_get_unclosed_stream.
	
	* tp/Texinfo/Convert/Converter.pm, tp/Texinfo/Convert/HTML.pm
	(output), tp/t/test_utils.pl (close_files), tp/texi2any.pl: handle
	undef converter_unclosed_files in texi2any.pl and test_utils.pl
	when processing the output of
	Texinfo::Common::output_files_unclosed_files by calling
	XS_get_unclosed_stream.  Remove get_output_files_XS_unclosed_streams,
	now unneeded.

2024-07-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_converted_output_info)
	(output), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_converted_output_info),
	tp/Texinfo/XS/convert/convert_html.c
	(html_prepare_converted_output_info): move code from output, before
	and after _prepare_converted_output_info to
	_prepare_converted_output_info, including call of
	prepare_title_titlepage.  Add arguments for prepare_title_titlepage.
	Update XS override and C code.

2024-07-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_conversion_finalization)
	(html_prepare_title_titlepage): remove calls of
	build_html_formatting_state, the functions do not set anything passed
	in build_html_formatting_state.

2024-07-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_title_titlepage),
	tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/convert/get_html_perl_info.c: remove
	html_converter_prepare_output, which does nothing.  Do not get
	jslicenses from Perl as they are setup in C.  Remove
	html_converter_prepare_output_sv, which now does nothing.

2024-07-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_html_perl_info.c (html_get_jslicenses_sv)
	(html_converter_prepare_output_sv): split html_get_jslicenses_sv out
	of html_converter_prepare_output_sv.

2024-07-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_internal_command_text):
	do not call build_html_formatting_state, there is nothing set in C
	that needs to be passed.

2024-09-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_command_description),
	tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_formatting_function_format_single_footnote): check and reset
	flags in build_html_formatting_state.

2024-07-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_formatting_state): check and reset flags in
	build_html_formatting_state.  Update callers.

2024-07-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(html_pass_converter_initialization_state): pass converter HV, not SV.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_conversion_initialization),
	tp/Texinfo/XS/convert/build_html_perl_state.c
	(html_pass_conversion_initialization): move code passing information
	to Perl to html_pass_conversion_initialization from
	html_conversion_initialization.

2024-07-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(html_pass_converter_initialization_state): rename
	html_pass_converter_output_state as
	html_pass_converter_initialization_state.  Update caller.

2024-07-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_conversion_units):
	use C converter document name instead of document name coming from
	Perl.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides, _setup_output)
	(output), tp/Texinfo/XS/convert/ConvertXS.xs (html_setup_output):
	rename _init_output as _setup_output.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides)
	(_setup_convert, convert), tp/Texinfo/XS/convert/convert_html.c
	(html_setup_convert), tp/Texinfo/XS/convert/build_html_perl_state.c
	(html_pass_converter_output_state, html_pass_converter_setup_state),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_setup_output)
	(html_setup_convert, html_prepare_conversion_units): add
	_setup_convert call at the beginning of convert, that calls
	_init_conversion_after_setup_handler.  Add an XS override for
	_setup_convert.  Add html_pass_converter_setup_state to pass to Perl
	the information set in _setup_output or _setup_convert.  Move setting
	use_unicode_text for Perl from html_pass_converter_output_state to
	html_pass_converter_setup_state.

	* tp/Texinfo/XS/convert/convert_html.c (html_setup_output): rename
	setup_status as setup_handler_status.

2024-07-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (file_error_or_write_close):
	return -2 if the file stream is 0.

	* tp/Texinfo/XS/convert/convert_html.c (html_node_redirections): do
	not return an error immediately from the function in case of open
	error, as in Perl.

2024-09-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (do_js_files): use
	copy_file_to.

2024-07-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_do_jslicenses_file): check path before
	gathering the output.

	* tp/Texinfo/XS/convert/convert_html.c (file_error_or_write_close)
	(do_jslicenses_file, do_js_files, html_convert_output): add
	file_error_or_write_close with code from html_convert_output.
	Implement do_jslicenses_file and do_js_files in C.

2024-07-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (output_files_open_out),
	tp/Texinfo/Convert/HTML.pm (convert, output): do not call
	set_output_perl_encoding in convert nor output, but in
	output_files_open_out just before it is needed.

	* tp/Texinfo/Convert/HTML.pm (_do_js_files): close FH only if it was
	opened.

2024-07-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_conversion_initialization),
	tp/Texinfo/XS/convert/build_html_perl_state.c
	(html_pass_converter_output_state): always set converter_info in Perl
	converter for calls to get_info in Perl, which can happen anywhere.

2024-09-30  Patrice Dumas  <pertusus@free.fr>

	Add gnulib copy-file module

	* tp/Texinfo/XS:
	Run "gnulib-tool --add-import copy-file"

2024-07-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_do_js_files): encode $jsdir before
	creating the directory.  Create the directory by calling
	create_destination_directory().

2024-07-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.h (PATHS_INFORMATION)
	(conversion_paths_info), tp/Texinfo/XS/convert/converter.c: rename
	conversion_paths_information as conversion_paths_info and
	PATHS_INFORMATION union paths as p.

2024-07-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/command_data.awk (BEGIN, END),
	tp/maintain/regenerate_C_options_info.pl: add/remove newlines and add
	a comment in generated C files.

2024-07-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (init),
	tp/Texinfo/XS/convert/converter.c (setup_converter_paths_information),
	tp/Texinfo/XS/convert/converter.h (INSTALLED_PATHS, UNINSTALLED_PATHS)
	(PATHS_INFORMATION), tp/Texinfo/XS/main/build_perl_info.c (init),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (init), tp/Texinfo/XSLoader.pm
	(init): exchange second and third paths argument of init called from
	XSLoader.pm and setup_converter_paths_information for more logical
	groupings.  Consider paths in XS init functions as SV * as some are
	necessarily undef.  In ConvertXS.xs init, convert only some SV * path
	to char based on texinfo_uninstalled, other remain NULL.  Modify
	PATHS_INFORMATION struct to ba a union of INSTALLED_PATHS and
	UNINSTALLED_PATHS.  Setup conversion_paths_information accordingly in
	setup_converter_paths_information.

2024-07-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (init),
	tp/Texinfo/XS/convert/converter.c (setup_converter_paths_information)
	(conversion_paths_information), tp/Texinfo/XS/convert/converter.h
	(PATHS_INFORMATION): add the PATHS_INFORMATION structure and a global
	variable conversion_paths_information.  Fill the paths with
	setup_converter_paths_information called from ConvertXS.xs init.

2024-07-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/TestXS.xs (PREFIX, xstest_init): use xstest_ as
	prefix.  Update xstest_init call.

2024-07-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (init),
	tp/Texinfo/XS/main/build_perl_info.c (init),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (init), tp/Texinfo/XSLoader.pm
	(init): pass more ModulePath paths to init functions called by
	XSLoader.pm when initializing XS modules.

2024-09-30  Gavin Smith <gavinsmith0123@gmail.com>

	* INSTALL.generic: sync from gnulib

2024-07-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/XSParagraph.xs, tp/Texinfo/XS/xspara.c: remove
	xspara_init, as it does nothing.

2024-07-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files): fix file name.

2024-07-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (init),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (init): add const for path.  Use
	the same names for path everywhere.

2024-07-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_converted_output_info): remove unused variable.

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(pass_sv_converter_info): call bug if the converter_info is not known.

2024-07-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(pass_sv_converter_info): replace redundant non_breaking_space by
	missing line_break_element.

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(html_pass_converter_output_state): remove code setting converter_info
	Perl data, as it is now done in pass_sv_converter_info on demand.

2024-07-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_init_output)
	(html_prepare_simpletitle, html_prepare_converted_output_info)
	(html_prepare_title_titlepage): remove code setting converter_info
	Perl data, as it is now done in pass_sv_converter_info on demand.

2024-07-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(set_special_units_targets_files): reuse a TEXT for all the file
	names.

2024-07-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(pass_sv_converter_info): increase new_sv ref count when storing.

2024-07-22  Patrice Dumas  <pertusus@free.fr>

	XS override for HTML::get_info

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_conversion_initialization):
	always set the Perl document hash reference in the Perl converter, as
	it is not stored in C data.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_get_info),
	tp/Texinfo/XS/convert/build_html_perl_state.c
	(pass_sv_converter_info): XS override for get_info, with caching in
	$self->{'converter_info'}.  Note that either Perl code or XS code is
	used, so this is for consistency not really for interoperability.

	* tp/Makefile.am (test_files), tp/Makefile.tres,
	tp/t/init_files_tests.t (access_document_name_in_handler): add a test
	accessing document_name through get_info() in an handler and using it
	as a scalar reference in buttons.  This tests that get_info gives a
	correct information even if there is no Perl external reference
	called from XS, and nothing is exported to Perl,
	self->external_references_number == 0.

2024-07-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides)
	(conversion_initialization), tp/Texinfo/XS/convert/ConvertXS.xs:
	merge _initialize_output_state in conversion_initialization in Perl.
	Remove _initialize_output_state override and remove
	html_initialize_output_state from ConvertXS.xs.

2024-07-22  Patrice Dumas  <pertusus@free.fr>

	XS override for HTML::conversion_initialization

	* tp/Texinfo/Convert/HTML.pm (conversion_initialization, convert)
	(output), tp/t/accents.t: pass context as second argument of
	conversion_initialization.

	* tp/Texinfo/XS/convert/ConvertXS.xs (converter_set_document),
	tp/Texinfo/XS/main/build_perl_info.c (pass_document_to_converter_sv):
	move setting Perl data code out of converter_set_document to a new
	function pass_document_to_converter_sv in build_perl_info.c.

	* tp/Texinfo/XS/main/get_perl_info.c (converter_set_document_from_sv):
	allow a NULL document_in argument.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_initialize_output_state),
	tp/Texinfo/XS/convert/build_html_perl_state.c
	(html_pass_converter_output_state): set use_unicode_text in
	build_html_perl_state.c.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides, convert)
	(output), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_conversion_initialization, html_init_output)
	(html_prepare_simpletitle),
	tp/Texinfo/XS/convert/build_html_perl_state.c
	(html_pass_converter_output_state): add an XS override for
	conversion_initialization.  Update html_pass_converter_output_state
	with a document_in argument to set converter_info and other Perl data.
	Call Texinfo::Common::set_output_perl_encoding in Perl convert and
	output as there is no corresponding code in C/XS.  Export to Perl only
	if self->external_references_number > 0, except for jslicenses that
	are always passed, as they are always used in Perl.

	* tp/Texinfo/XS/convert/get_html_perl_info.c: add const.

2024-07-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/api_to_perl.c (get_perl_scalar_reference_value):
	return 0 if the reference is undef or the value is undef.

2024-07-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_initialize_output_state):
	pass information to Perl only if Perl code will be called from C.

2024-07-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides, _init_output):
	remove call to _XS_reset_output_init_conf, the function and the
	override.  The whole _init_output function is already overriden.

2024-09-30  Patrice Dumas  <pertusus@free.fr>

	Update test results

2024-07-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_initialize_output_state)
	(_init_output), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_initialize_output_state), tp/Texinfo/XS/convert/convert_html.c
	(html_initialize_output_state, html_init_output): move code completing
	configuration from _init_output to _initialize_output_state such that
	it is set for convert() too.

	* tp/Texinfo/Convert/HTML.pm (_init_conversion_after_setup_handler)
	(_init_output, convert), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_initialize_output_state, html_init_output)
	(html_prepare_conversion_units), tp/Texinfo/XS/convert/convert_html.c
	(init_conversion_after_setup_handler): add
	init_conversion_after_setup_handler for code common to output and
	convert, that is better run, in output(), after the first stage
	handler.

	* tp/Texinfo/Convert/HTML.pm (_init_output),
	tp/Texinfo/XS/convert/convert_html.c (html_init_output): move code
	around to register output_init_conf late after setting more
	customization variables, including based on document.

2024-07-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_formatting_state), tp/Texinfo/XS/convert/convert_html.c
	(convert_tree_new_formatting_context): no need for transmission of
	multiple_pass to Perl anymore.

2024-07-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/command_stack.c (push_string_stack_string):
	handle pushing NULL on a string_stack.

	* tp/Texinfo/Convert/HTML.pm (_internal_command_text)
	(convert_tree_new_formatting_context, _set_multiple_conversions)
	(_unset_multiple_conversions), tp/Texinfo/XS/convert/convert_html.c
	(html_set_multiple_conversions, html_unset_multiple_conversions)
	(convert_tree_new_formatting_context, html_internal_command_text): 
	add multiple pass string argument to set_multiple_conversions,
	push on multiple_pass stack in the function and pop in
	unset_multiple_conversions.  Add html_set_multiple_conversions and
	html_unset_multiple_conversions to C.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides),
	(_initialize_output_state, conversion_initialization),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_set_multiple_conversions)
	(html_unset_multiple_conversions, html_in_multi_expanded): add XS
	override for in_multi_expanded, update XS overrides for the changes in
	html_unset_multiple_conversions and html_set_multiple_conversions.

2024-07-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_initialize_output_state),
	(conversion_initialization), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_units_directions_files)
	(html_prepare_output_units_global_targets): initialize
	global_units_directions in _initialize_output_state and remove call of
	pass_html_global_units_directions from
	html_prepare_units_directions_files and
	html_prepare_output_units_global_targets as the hash is not accessed
	at all from Perl with XS with the global_direction_unit override.

2024-07-21  Patrice Dumas  <pertusus@free.fr>

	XS override for HTML::global_direction_unit

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_global_direction_unit)
	(html_prepare_units_directions_files)
	(html_prepare_output_units_global_targets),
	tp/Texinfo/XS/convert/convert_html.c
	(compare_global_units_direction_name)
	(html_setup_global_units_direction_names)
	(html_find_direction_name_global_unit, html_reset_converter),
	tp/Texinfo/XS/main/converter_types.h (SPECIAL_UNIT_DIRECTION_LIST)
	(CONVERTER): setup a sorted list of SPECIAL_UNIT_DIRECTION with
	direction name and output unit for global directions, including
	of special output units with html_setup_global_units_direction_names,
	called from html_prepare_units_directions_files and
	html_prepare_output_units_global_targets.  Add an XS override for
	global_direction_unit that uses a bsearch to find the output unit
	and the associated Perl object.

2024-09-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_converter_perl_info.h: move back
	get_converter_perl_info.c functions declarations to
	get_converter_perl_info.h.

2024-07-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (set_document): remove a redundant
	condition on $XS_convert.

	* tp/Texinfo/XS/convert/ConvertXS.xs (converter_initialize):
	converter_descriptor is necessarily set.

	* tp/Texinfo/XS/main/get_perl_info.c (converter_set_document_from_sv):
	return the converter.

	* tp/Texinfo/Convert/Converter.pm (set_document),
	tp/Texinfo/XS/convert/ConvertXS.xs (converter_set_document),
	tp/Texinfo/XS/main/build_perl_info.c (build_convert_text_options): add
	build_convert_text_options.  Setup more Perl structures in
	converter_set_document in ConvertXS.xs, renaming
	converter_set_document_from_sv to converter_set_document.

2024-07-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (converter_set_document_from_sv),
	tp/Texinfo/XS/convert/converter.c (converter_set_document),
	tp/Texinfo/XS/main/get_perl_info.c (converter_set_document_from_sv):
	rename converter_set_document as converter_set_document_from_sv in
	get_perl_info.c.  Add converter_set_document in converter.c to do the
	C part of converter_set_document_from_sv.

2024-07-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (set_output_encoding)
	(set_output_perl_encoding), tp/Texinfo/Convert/Converter.pm
	(set_document), tp/Texinfo/Convert/Text.pm (output) tp/texi2any.pl:
	split set_output_perl_encoding out of set_output_encodings.  Rename
	set_output_encodings as set_output_encoding, update callers.

2024-07-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_text)
	(_initialize_output_state), tp/t/init/spaces_in_line_breaks.init
	_texi2any_tests_set_line_break_element),
	tp/Texinfo/XS/convert/build_html_perl_state.c
	(html_pass_converter_output_state): access 'line_break_element'
	through get_info only.

2024-07-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (substitute_html_non_breaking_space)
	(_initialize_output_state),
	tp/Texinfo/XS/convert/build_html_perl_state.c
	(html_pass_converter_output_state): access 'non_breaking_space'
	through get_info only.

2024-07-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(special_characters_formatting): fix right quote numerical entity.

	* tp/Texinfo/Convert/HTML.pm (_initialize_output_state)
	(conversion_initialization): move Perl code related to setting up
	non_breaking_space, paragraph_symbol, resetting some configuration
	based on special characters and line_break_element from
	conversion_initialization to _initialize_output_state.

2024-07-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_initialize_output_state)
	(conversion_initialization),
	tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_directions_strings, html_pass_converter_output_state): build
	directions_strings from XS.  Move Perl code related to setting up
	directions_strings from conversion_initialization to
	_initialize_output_state.

2024-09-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (ConvertXS_la_SOURCES): remove
	convert_html.c to only use shared data in libtexinfo-convert.

2024-07-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (no_arg_formatted_cmd),
	tp/Texinfo/XS/convert/convert_html.h (no_arg_formatted_cmd): make
	extern.

	* tp/Texinfo/Convert/HTML.pm (_initialize_output_state)
	(conversion_initialization),
	tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_no_arg_commands_formatting, html_pass_converter_output_state):
	build no_arg_commands_formatting from XS.  Move Perl code related
	to setting up no_arg_commands_formatting from
	conversion_initialization to _initialize_output_state.

2024-07-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_xhtml_re_close_lone_element): do not
	close again an already closed lone element.  Do not match < to find
	the closing >.

	* tp/Texinfo/XS/convert/convert_html.c (xhtml_re_close_lone_element):
	implement in C.

	* tp/Texinfo/XS/convert/converter.c (set_conf): return a status.

	* tp/Texinfo/XS/convert/convert_html.c (close_lone_conf_element)
	(html_initialize_output_state): do all the initializations as in Perl.

	* tp/Makefile.tres, tp/t/html_tests.t
	(xhtml_rule_element_already_closed): new test.

2024-07-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_free_converter): free
	self->html_stage_handlers lists and handlers priority information.

2024-07-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER), tp/Texinfo/XS/convert/convert_html.c
	(free_html_command_conversion, html_free_converter): get
	customized_no_arg_commands_formatting from Perl.  Add
	free_html_command_conversion based on html_free_converter code.
	Free customized_no_arg_commands_formatting in html_free_converter.

	* tp/Texinfo/XS/convert/convert_html.c
	(reset_unset_no_arg_commands_formatting_context)
	(complete_no_arg_commands_formatting): move code above.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_initialize_output_state),
	tp/Texinfo/XS/convert/convert_html.c (set_no_arg_commands_formatting)
	(html_format_setup, copy_html_command_conversion)
	(html_initialize_output_state): set unset in
	default_no_arg_commands_formatting for preformatted and string context
	when needed, fix * command formatting, use
	unicode_character_brace_no_arg_commands[cmd].text for ASCII
	characters.  Set self->html_command_conversion for no arg commands
	based on self->customized_no_arg_commands_formatting,
	output_no_arg_commands_formatting, and possibly unicode characters.
	Reset ul.mark-* css_strings if needed.  Do not call
	html_conversion_initialization_sv in html_initialize_output_state as
	Perl information is not needed anymore there.

2024-07-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (clear_direction_string_type)
	(html_free_converter), tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER): get customized_direction_strings from Perl.

	* tp/Texinfo/XS/convert/convert_html.c (html_initialize_output_state),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_conversion_initialization_sv): setup directions_strings in C
	only, in html_initialize_output_state, using
	customized_direction_strings.

2024-07-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (unicode_entities)
	(html_format_setup): setup unicode_entities.

	* tp/Texinfo/XS/convert/convert_html.c (html_format_setup),
	tp/Texinfo/XS/main/unicode.h (ENCODING_CODEPOINTS),
	tp/maintain/setup_converters_code_tables.pl: add
	unicode_character_brace_no_arg_commands css_string field.  Set it up
	with Perl code.  Set default_no_arg_commands_formatting css_string
	based on unicode_character_brace_no_arg_commands css_string and on
	other existing @-commands formatting tables to text.

	* tp/Texinfo/XS/convert/convert_html.c (html_initialize_output_state):
	use unicode_entities and line_break_element to setup
	output_no_arg_commands_formatting

2024-07-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_initialize_output_state):
	strdup special character for output_no_arg_commands_formatting.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_initialize_output_state):
	call html_conversion_initialization_sv after
	html_initialize_output_state to have self->special_character set.

	* tp/Texinfo/XS/convert/convert_html.c
	(substitute_html_non_breaking_space): initialize result to an empty
	string.

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_conversion_initialization_sv): setup
	converter->directions_strings based on Perl
	$self->{'customized_direction_strings'} or
	converter->default_converted_directions_strings, not from Perl
	$self->{'direction_strings'}.

2024-07-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_prepare_css): initialize
	css_import_lines and css_rule_lines only if there are css files, from
	valgrind.

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv): initialize stage handlers only if
	there is at least one.

	* tp/Texinfo/Convert/HTML.pm (_XS_html_converter_initialize)
	(converter_initialize), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_converter_initialize_sv), tp/Texinfo/XS/convert/convert_html.c
	(html_free_converter), tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER): pass default_converted_directions_strings from Perl to
	default_converted_directions_strings in converter.

2024-07-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (determine_files_and_directory):
	free input_file_name, input_basename_for_outfile and document_path,
	found with valgrind.

2024-07-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%special_characters)
	(conversion_initialization): remove _set_non_breaking_space.  Add
	$xml_named_entity_nbsp as entity of non_breaking_space.  Simplify code
	setting conf_default_no_arg_commands_formatting_normal to
	non_breaking_space for space commands.

	* tp/Texinfo/XS/main/build_perl_info.c (build_expanded_formats):
	return an HV, not an SV.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_is_format_expanded): add an
	XS override for is_format_expanded.

	* tp/Texinfo/Convert/Converter.pm (_internal_converter_initialize)
	(converter), tp/Texinfo/XS/convert/ConvertXS.xs
	(converter_initialize, html_converter_initialize_sv),
	tp/Texinfo/XS/main/get_perl_info.c (converter_initialize): rename
	_XS_converter_initialize as _internal_converter_initialize.  Add code
	in _internal_converter_initialize for initialization either in generic
	XS converter or in Perl.  Build expanded_formats in XS in
	converter_initialize.  Use _internal_converter_initialize for code
	setting $converter->{'expanded_formats'} in Perl.

	* tp/Texinfo/Convert/HTML.pm (%default_css_element_class_styles):
	rename  %css_element_class_styles as
	%default_css_element_class_styles.

	* tp/Texinfo/Convert/HTML.pm (converter_initialize),
	tp/Texinfo/Convert/HTML.pm (conversion_initialization),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv, html_conversion_initialization_sv):
	pass default_css_element_class_styles to html_converter_initialize_sv.
	Use css_set_selector_style call instead of modifying directly
	$self->{'css_element_class_styles'}.

	* tp/Texinfo/XS/convert/convert_html.c (spaces_cmd)
	(html_initialize_output_state): preliminary code setting
	output_no_arg_commands_formatting in C based on
	default_no_arg_commands_formatting and non-breaking spaces.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_initialize_output_state),
	tp/Texinfo/XS/convert/build_html_perl_state.c
	(html_pass_converter_output_state): pass non-breaking space,
	paragraph_symbol, line_break element and expanded_formats in
	converter_info in XS.  For now this is redundant with Perl, but this
	should change.

	* tp/Texinfo/Convert/HTML.pm (conversion_initialization): reorder
	code.

2024-07-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv, html_conversion_initialization_sv):
	move setup of translated_direction_strings out of
	html_conversion_initialization_sv to html_converter_initialize_sv.

2024-07-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_XS_html_converter_initialize)
	(converter_initialize), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_converter_initialize_sv),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv): remove
	default_no_arg_commands_formatting argument.

2024-09-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_convert_la_SOURCES)
	(nodist_IndicesXS_la_SOURCES, ConvertXS_la_SOURCES): put converter C
	files in libtexinfo_convert_la_SOURCES.

2024-07-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES, EXTRA_DIST)
	(BUILT_SOURCES), tp/Texinfo/XS/main/convert_to_text.c,
	tp/maintain/setup_converters_code_tables.pl: merge cmd_symbol.c in
	cmd_text.c and setup cmd_text.c as a separately built file.

	* tp/Texinfo/XS/Makefile.am (ConvertXS_la_SOURCES, EXTRA_DIST),
	tp/Texinfo/Convert/Converter.pm (%xml_text_entity_no_arg_commands),
	tp/maintain/setup_converters_code_tables.pl: make
	%xml_text_entity_no_arg_commands our.  Setup cmd_converter.c with
	xml_text_entity_no_arg_commands in C.

	* tp/Texinfo/XS/convert/converter.c
	(xml_text_entity_no_arg_commands_formatting, converter_setup),
	tp/Texinfo/XS/convert/ConvertXS.xs (init): setup
	xml_text_entity_no_arg_commands_formatting.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides)
	(_XS_format_setup, import), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_format_setup), tp/Texinfo/XS/convert/convert_html.c
	(html_format_setup): rename _XS_format_init as _XS_format_setup
	and html_format_init as html_format_setup.  Rename
	nr_default_commands_args variable as default_commands_args_nr.

	* tp/Texinfo/XS/convert/convert_html.c (no_arg_formatted_cmd)
	(html_format_setup, html_free_converter),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h
	(no_arg_formatted_cmd): make no_arg_formatted_cmd a
	static variable instead of being in a converter, and setup
	no_arg_formatted_cmd in html_format_setup.  Update users.

	* tp/Texinfo/XS/convert/convert_html.c
	(default_no_arg_commands_formatting, html_format_setup): prepare
	default_no_arg_commands_formatting.

2024-07-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c, tp/Texinfo/XS/main/unicode.c,
	tp/Texinfo/XS/main/unicode.h (ENCODING_CODEPOINTS, COMMAND_UNICODE)
	(DIACRITIC_UNICODE), tp/Texinfo/XS/main/utils.h,
	tp/maintain/setup_accent_tables.pl,
	tp/maintain/setup_converters_code_tables.pl: add const.

	* tp/maintain/setup_converters_code_tables.pl: simplify code for
	unicode now that there are no empty strings anymore.

2024-07-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm, tp/Texinfo/Convert/Unicode.pm: no more
	empty strings in %unicode_map values.

2024-07-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (converter_initialize)
	(conversion_initialization): get customization from
	GNUT_get_direction_string_info in converter_initialize, set
	$self->{'customized_direction_strings'} and use it in
	conversion_initialization.

2024-07-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (converter_initialize)
	(conversion_initialization): get customization from
	GNUT_get_no_arg_command_formatting in converter_initialize, set
	$self->{'customized_no_arg_commands_formatting'} and use
	it in conversion_initialization.

2024-07-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (converter_initialize)
	(conversion_initialization): move setup of
	$self->{'translated_direction_strings'} based on defaults and user
	defined customization to converter_initialize.

2024-07-12  Patrice Dumas  <pertusus@free.fr>

	* tp/t/input_files/command_non_break_spaces_koi8.texi,
	tp/t/input_files/command_non_break_spaces_utf8.texi, tp/Makefile.am
	(test_files), tp/t/init/t2h_buttons.pm,
	tp/tests/many_input_files/for_nbspaces_different_encodings.sh: add
	buttons with non-breaking spaces to the test.

2024-07-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files),
	tp/t/input_files/command_non_break_spaces_koi8.texi,
	tp/t/input_files/command_non_break_spaces_utf8.texi,
	tests/many_input_files/for_nbspaces_different_encodings.sh,
	tp/tests/many_input_files/Makefile.am (TESTS, tests_dirs): add test of
	expansion of non-breaking space in HTML with OUTPUT_CHARACTERS=1 and a
	file with a non-breaking space in the character set followed by
	another with the character set, to check that for the second an
	entity is output for the non-breaking space.

2024-07-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%css_no_arg_commands): remove tie, as
	the Texinfo::Common::text_brace_no_arg_commands value is ok, and
	remove 'today' as it is useless.

2024-07-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Unicode.pm (%unicode_map, %extra_unicode_map):
	remove commands associated with empty string.  Add all the commands in
	comment to simplify visual comparison with other similar maps.

2024-07-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%css_no_arg_commands): add error as
	undef and do not set if %css_no_arg_commands command value is undef.
	Use Texinfo::Common::text_brace_no_arg_commands instead of other
	values of default_no_arg_commands_formatting.

2024-07-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (%text_brace_no_arg_commands): reorder.

	* tp/Texinfo/Convert/Converter.pm (%xml_text_entity_no_arg_commands)
	(%xml_text_entity_no_arg_commands_formatting): add
	%xml_text_entity_no_arg_commands with specific commands previously set
	in %xml_text_entity_no_arg_commands_formatting, and &.  Reorder.
	Comment out commands that are the same as in
	%Texinfo::Common::text_brace_no_arg_commands.  Complete
	%xml_text_entity_no_arg_commands_formatting with
	Texinfo::Common::text_brace_no_arg_commands and
	Texinfo::Common::nobrace_symbol_text for commands not already set.

	* tp/Texinfo/Common.pm (%text_brace_no_arg_commands)
	(%xml_text_entity_no_arg_commands): remove today.
	* tp/Texinfo/Convert/HTML.pm (%css_no_arg_commands),
	tp/Texinfo/Convert/NodeNameNormalization.pm
	(%normalize_node_nobrace_symbol_text): add today.

	* tp/Texinfo/Convert/HTML.pm (_translate_names): remove a useless
	possibility in a condition.

2024-07-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%default_no_arg_commands_formatting):
	for css_string preset explicitly @tie and @* values, and use
	nobrace_symbol_text preferentially to preformatted/normal values.

2024-07-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%default_no_arg_commands_formatting):
	reset explicitly & value.

	* tp/t/html_tests.t ($itemize_arguments_text): add @& and
	@ampchar to tests.

2024-07-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (remove_extension, canonpath)
	(STRING_AND_LEN, texinfo_extensions, determine_files_and_directory)
	(create_destination_directory): implement
	determine_files_and_directory and create_destination_directory in C.

	* tp/Texinfo/Convert/HTML.pm (_init_output, output),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_init_output), 
	tp/Texinfo/XS/convert/convert_html.c (html_init_output)
	(html_reset_converter), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER): add determine_files_and_directory,
	create_destination_directory and destination_directory and
	document_name registering to _init_output instead of output
	and implement in C/XS.

	* tp/Texinfo/XS/convert/convert_html.c (html_process_css_file): remove
	a useless strdup.

2024-07-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (parse_file_path),
	tp/Texinfo/XS/parsetexi/api.c: move parse_file_path to utils.c.

2024-07-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (init): set encoding conversion
	for input_conversions to utf-8 before anything else, to be sure that
	the conversion to utf-8 gets initialized.

2024-07-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (determine_files_and_directory):
	reuse document_path for output_file instead of removing the extension
	again.

2024-07-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_init_output, output),
	tp/Texinfo/XS/convert/convert_html.c (html_process_css_file)
	(html_prepare_css, html_init_output): move _prepare_css call to
	_init_output.  Implement in C.

2024-07-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_simpletitle):
	call build_simpletitle with converter_info.

	* tp/Texinfo/Convert/HTML.pm (_init_output, output),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_init_output),
	tp/Texinfo/XS/convert/build_html_perl_state.c (pass_jslicenses),
	tp/Texinfo/XS/convert/convert_html.c (contents_elements_options)
	(conf_for_documentlanguage, fill_jslicense_file_info)
	(html_init_output): move BODY_ELEMENT_ATTRIBUTES setting and
	some set_global_document_commands calls to init_output.  Move
	jslicences data setting to init_output, add to XS interface and add
	pass_jslicenses to build jslicense data from C to Perl.

2024-09-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_converter_perl_info.c
	(converter_set_document, converter_initialize)
	(reset_output_init_conf), tp/Texinfo/XS/main/get_perl_info.c: move
	converter_set_document, converter_initialize and
	reset_output_init_conf to get_converter_perl_info.c.

2024-07-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (html_free_direction_icons): reset number
	and list to 0 as the icon list structure may be reused.

	* tp/Texinfo/XS/convert/converter.c, tp/Texinfo/XS/main/utils.c
	(copy_option), tp/Texinfo/XS/main/api_to_perl.c
	(register_perl_button): move copy_option to utils.c and add the
	missing types.  For the list buttons, add register_perl_button to be
	able to increase the reference counter of a copied button Perl
	reference.

	* tp/maintain/regenerate_C_options_info.pl: add copy_options
	automatically generated function to copy a whole OPTIONS structure.

	* tp/Texinfo/Convert/HTML.pm (_init_output, output),
	tp/Texinfo/XS/convert/convert_html.c (html_init_output): move
	init_conf setup to _init_output, using copy_options.

	* tp/Texinfo/XS/main/get_perl_info.c: minor changes.

2024-09-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_init_output): set
	MATHJAX_CONFIGURATION.

2024-07-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (set_conf, force_conf)
	(set_conf_internal), tp/Texinfo/XS/main/get_perl_info.c (set_sv_conf)
	(force_sv_conf): add set_conf and force_conf in converter.c.  rename
	set_conf as set_sv_conf and force_conf as force_sv_conf in
	get_perl_info.c.

	* tp/Texinfo/XS/convert/convert_html.c (html_reset_converter): free
	shared_conversion_state.formatted_index_entries only if it was set.

	* tp/Texinfo/XS/main/utils.c (null_device_names): add.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides, _init_output)
	(output), tp/Texinfo/XS/convert/ConvertXS.xs (html_init_output)
	(html_prepare_conversion_units), tp/Texinfo/XS/convert/convert_html.c
	(html_init_output), tp/Texinfo/XS/main/build_perl_info.c
	(latex_build_options_for_convert_to_latex_math): split the beginning
	of output in _init_output.  Add an implementation in C of init_output
	and an XS interface.  Add
	latex_build_options_for_convert_to_latex_math for the XS interface.
	Increase external_references_number based on INTERNAL_LINKS and
	CONVERT_TO_LATEX_IN_MATH in html_init_output instead of
	html_prepare_conversion_units.

	* tp/Texinfo/XS/convert/converter.c (copy_option): reindent.

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_prepare_output_sv): fix the index in AV of the
	jslicense file info data.

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_stage_handler), tp/Texinfo/XS/convert/convert_html.c
	(html_stage_handler_stage_type_names, run_stage_handlers),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h
	(enum html_stage_handler_stage_type, HTML_STAGE_HANDLER_INFO)
	(HTML_STAGE_HANDLER_INFO_LIST, CONVERTER): get stage handlers from
	Perl and put them in HTML_STAGE_HANDLER_INFO_LIST structure in
	converter.  Add run_stage_handlers and call_stage_handler to call Perl
	registered stage handlers references.

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.h, tp/Texinfo/XS/convert/convert_html.h:
	move declaration of html_argument_formatting_type_names to
	convert_html.h.

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (converter_initialize, output): move the
	call of Texinfo::Config::GNUT_get_stage_handlers to
	converter_initialize.

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	* tp/init/book.pm (book_unit_file_name),
	tp/t/init/misc_file_collision.init (test_misc_file_name),
	tp/t/init/only_toc_out.init (toc_out_element_file_name): access
	'document_name' through get_info API only.

	* tp/Texinfo/Convert/HTML.pm (_set_non_breaking_space)
	(conversion_initialization, _prepare_title_titlepage)
	(_prepare_simpletitle, convert, _prepare_converted_output_info)
	(output, get_info), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_converted_output_info, html_prepare_title_titlepage),
	tp/Texinfo/XS/convert/build_html_perl_state.c (build_simpletitle),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_prepare_output_sv): set converter_info information
	directly, not from the converter hash, as soon as the information is
	ready.  Do not set the converter_info information in converter hash
	unless it is directly accessed for speed.  Also do not set
	converter_info information as a reference on string, always set a
	string directly.  Remove _reset_info.

	* tp/Texinfo/Convert/HTML.pm: remove $xml_numeric_entity_nbsp, it is
	unused.

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm: call internal functions as
	subroutines, not as object oriented methods.  Reindent.

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/MiscXS.xs (xs_process_text, xs_unicode_text)
	(xs_entity_text, xs_default_format_protect_text): use SvPVutf8_nolen
	to get SV argument and convert to text more simply.

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/MiscXS.xs (xs_process_text),
	tp/Texinfo/Convert/Plaintext.pm (_process_text_internal): add
	prototype.

	* tp/Texinfo/Convert/Plaintext.pm: call internal functions as
	subroutines, not as object oriented methods.

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Info.pm (_convert): add _suppress_styles type
	that sets suppress_styles.

	* tp/Texinfo/Convert/Info.pm (format_ref): convert @*ref using
	translations for all the possible cases of arguments of @*ref.

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Info.pm (format_ref),
	tp/Texinfo/Convert/Plaintext.pm (format_ref): double check that a
	reference is an internal reference before using the normalized
	reference as label.

	* tp/Makefile.tres, tp/t/info_tests.t
	(similar_external_and_internal_node): add a test with external and
	internal references with the same normalized node names.

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	* tp/t/21multitable.t (ref_in_multitable), tp/t/converters_tests.t
	(refs_formatting, top_in_ref, ref_error_formatting)
	(ref_in_sectioning): add info as formatted output.

	* tp/t/info_tests.t (del_quote_linebreaking, xref_quote_long_item),
	tp/t/plaintext_tests.t, tp/Makefile.tres: move tests from
	plaintext_tests to info_tests.

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (format_ref): do not prepend :: at
	the end of a reference.  Move code auround.

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (format_ref): no see for @ref.

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (format_ref): use see and See
	instead of *note and *Note.

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (format_ref): simplify output of
	reference name.

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (format_ref): never quote node
	names and labels.  Do not add Top if there is no node.

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (format_ref): do not add a full stop
	after a ref command not followed by a comma or full stop.

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (format_ref, _convert),
	tp/Texinfo/Convert/Info.pm (format_ref): split format_ref function out
	of _convert to format *ref commands.  Put format_ref both in
	Plaintext.pm and Info.pm to be able to format cross references
	differently in both formats.

	* tp/Texinfo/Convert/Plaintext.pm (format_ref): do not treat reference
	in multitable as if they were in @w.  Do not disallow breaks.

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	Convert definition line parts in plaintext in code style only when needed

	* tp/Texinfo/Convert/Plaintext.pm (_convert_def_line), NEWS:
	explicitly convert definition  name, class and arguments in code
	style.  Do not convert category nor leading dashes in code style.

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm: reindent.  Change FIXMEs to TODO.

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (_convert): common if for type
	defined for text elements.  Bug message if in top level and the text
	element is not normal text (without type).

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (_convert): ignore space types only
	when checking if an index command is last in node, as the ignored
	special containers cannot happen in that situation.  Remove
	%ignorable_types.

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (_convert, converter_initialize):
	use directly %ignored_types and %ignorable_space_types.

	* tp/Texinfo/Convert/Plaintext.pm (_convert, %ignorable_space_types): 
	handle text elements before other elements.  Remove
	spaces_before_paragraph from %ignorable_space_types and handle it
	in one place only.

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm: remove an obsolete FIXME.

2024-07-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm: remove a FIXME on @cartouche, the
	output is already correct.

	* tp/Makefile.tres, tp/t/plaintext_tests.t
	(cartouche_and_paragraph_indentation): add a test for cartouche and
	paragraph indentation.

2024-07-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (_convert): do not copy
	$self->{'current_roots'}, iterate over it starting from the end.

2024-07-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (_convert): use directly
	$self->{'current_roots'} element contents instead of using
	$self->{'current_contents'}.  Remove $self->{'current_contents'}.

2024-07-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (_convert): use parent contents to
	get the contents a ref command is in.

2024-07-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (_convert): remove an obsolete
	FIXME.  Add a comment with an explanation why there is a warning for
	@xref not followed by comma or full stop.

2024-07-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (_convert): try to make code finding
	next @*ref element more straightforward.

2024-07-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (process_printindex): output for
	@seeentry and @seealso.

2024-07-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (_convert): remove condition on
	line definition command now that it is handled directly.

	* tp/Texinfo/Convert/DocBook.pm (_convert): remove FIXME.

2024-07-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_convert): use direcly braced element
	for multitable prototype.  Other minor changes.

	* tp/Makefile.tres, tp/t/converters_tests.t (multitable_prototypes):
	add a test with multitable prototypes, including @-commands, spaces
	and erroneus construct, for output in all the conversion formats.

2024-07-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_convert): rearrange conditions
	nesting for clearer code.

2024-07-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_sp_command),
	tp/Texinfo/Convert/Plaintext.pm (_convert),
	tp/Texinfo/XS/convert/convert_html.c (convert_sp_command): consider
	empty @sp argument to be 1, to have an output more consistent with
	Texinfo TeX.

	* tp/Texinfo/Convert/LaTeX.pm (_convert): consider empty @sp argument
	to be empty.

	* tp/Makefile.tres, tp/t/converters_tests.t
	(sp_empty_lines_1_no_arg_zero): test of @sp, @sp 0 and @sp 1 with
	diverse possibilities for empty lines.

2024-07-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (_convert_def_line, _convert):
	rename $command as $cmdname. 

2024-07-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm, tp/Texinfo/Convert/Plaintext.pm:
	simplify conditions on args.

	* tp/Texinfo/Convert/Plaintext.pm (process_footnotes): add types to
	node and anchor element generated for a separate footnote.

	* tp/Texinfo/Convert/Plaintext.pm (_convert): check if there are args
	for @link.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_line_command_args): remove a
	useless argument of sprintf.

	* tp/Texinfo/Convert/DocBook.pm (_convert): handle better @-command
	defined with definfoenclose missing braces and with 0 args.

	* tp/Makefile.tres, tp/t/03coverage_braces.t
	(definfoenclose_bad_argument, definfoenclose_no_braces): new tests.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (_convert): simplify args
	conditions, use element instead of element contents.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Text.pm (_convert): set and use $cmdname earlier.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Text.pm (brace_no_arg_command): rename $command
	as $command_name.

	* tp/Texinfo/Convert/Text.pm (_convert): set $cmdname based on
	$element->{'cmdname'} and use it instead.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Text.pm (%ignored_types, %ignored_text_types)
	(_convert): process text elements first.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/08misc_commands.t (comment_without_line): add
	test with @comment without argument at the very end of a document.

	* tp/t/08misc_commands.t (command_not_closed_on_center_line): move to
	@converted_test_cases.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_convert): use $cmdname instead of
	$element->{'cmdname'} and $command_name instead of $cmdname.
	Reindent.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_index_entry): use element
	instead of contents.

	* tp/Texinfo/Convert/DocBook.pm (_convert_def_line): remove useless
	impossible condition.  Reindent.

	* tp/Texinfo/Convert/DocBook.pm (_convert): simplify conditions on
	args.  Use elements instead of contents.  Use variables for
	$substituted_strings.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line): close a bogus brace
	@-command without argument followed by spaces only, and not by
	newlinewithout argument followed by spaces only, and not by newline.

	* tp/Makefile.tres, tp/t/03coverage_braces.t (seeentry_no_braces):
	test of @seeentry without braces at end of document, on an index entry
	command line.

	* tp/Makefile.tres, tp/t/08misc_commands.t
	(command_not_closed_on_center_line): add test.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_converted_output_info),
	tp/Texinfo/Convert/LaTeX.pm (_title_font),
	tp/Texinfo/Convert/Plaintext.pm (_convert),
	tp/Texinfo/XS/convert/convert_html.c (convert_titlefont_command):
	simplify args conditions for titlefont and/or handle titlefont element
	without braces and with 0 args.

	* tp/Makefile.tres, tp/t/03coverage_braces.t (titlefont_no_braces):
	test of @titlefont without braces at end of document.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/03coverage_braces.t (U_no_braces): test of
	@U without braces at end of document.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_convert), tp/Texinfo/Convert/HTML.pm
	(_convert_U_command), tp/Texinfo/Convert/LaTeX.pm (_convert),
	tp/Texinfo/Convert/Plaintext.pm (_convert): reorganize slightly U
	formatting code, simplify args conditions.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_convert): simplify conditions on
	element args for @U.  Remove error message for empty @U as there is
	already the same message output un Parser.

	* tp/t/03coverage_braces.t: add docbook as test_formats for all the
	tests in @test_cases.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm: simplify conditions on element args.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/03coverage_braces.t (math_no_braces)
	(strong_no_braces, caption_no_braces, footnote_no_braces)
	(hyphenation_no_braces): test of brace commands without braces at end
	of document.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Text.pm (_convert): revert a change on
	explained_commands conversion, if the number of args is >= 2, handle
	them especially.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Text.pm (_convert),
	tp/Texinfo/XS/convert/convert_html.c (convert_uref_command),
	tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal):
	handle @url without braces, with 0 args.

	* tp/Makefile.tres, tp/t/03coverage_braces.t (url_no_braces): test of
	@url without braces at end of document.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_convert),
	tp/Texinfo/Convert/LaTeX.pm (_convert): simplify condition for element
	args.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_exdent_command): handle better
	exdent with empty argument text.

	* tp/Texinfo/XS/convert/convert_html.c: minor changes.

	* tp/Makefile.tres, tp/t/08misc_commands.t (exdent_no_line): add a
	test with exdent not followed by anything.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Text.pm (_convert),
	tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal),
	tp/Texinfo/XS/convert/convert_html.c (convert_email_command): handle
	@email with no brace and 0 args.

	* tp/Makefile.tres, tp/t/03coverage_braces.t (email_no_braces): test of
	@email without braces at end of document.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_convert),
	tp/Texinfo/Convert/LaTeX.pm (_convert),
	tp/Texinfo/Convert/Plaintext.pm (_convert): simplify conditions on
	element args, convert arg and not arg contents.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm (_convert),
	tp/Texinfo/Convert/Plaintext.pm (_convert): simplify conditions.

	* tp/Texinfo/Convert/DocBook.pm (_convert), tp/Texinfo/Convert/HTML.pm
	(_convert_explained_command), tp/Texinfo/XS/convert/convert_html.c
	(convert_explained_command): handle bogus 'explanation' commands abbr
	and acronym without braces, with 0 args, at end of document.

	* tp/Makefile.tres, tp/t/03coverage_braces.t (abbr_no_braces): test of
	@abbr without braces at end of document.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Text.pm (_convert),
	tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal):
	handle @image without brace, with 0 args.

	* tp/Makefile.tres, tp/t/03coverage_braces.t (image_no_braces): test
	of @image without braces at end of document.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_convert): simplify condition.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_xref_commands),
	tp/Texinfo/Convert/LaTeX.pm (_convert),
	tp/Texinfo/Convert/Plaintext.pm (_convert),
	tp/Texinfo/XS/convert/convert_html.c (convert_xref_commands): handle
	@*ref command without brace.

	* tp/Texinfo/ParserNonXS.pm (_handle_comma),
	tp/Texinfo/XS/parsetexi/separator.c (handle_comma): return @inline*
	argument container element instead of the command element if the
	braces have been seen.

	* tp/Texinfo/ParserNonXS.pm (_close_commands),
	tp/Texinfo/XS/parsetexi/close.c (close_commands): handle explicitly
	@-command without brace there when close_commands is called.  Should
	mainly correspond with bogus brace @-command without brace at the end
	of a document followed by spaces only and no newline.

	* tp/Texinfo/ParserNonXS.pm (_close_brace_command): print debug
	message if the basic_inline_commands popped is not the current
	command.

	* tp/Makefile.tres, tp/t/03coverage_braces.t
	(brace_command_no_braces): test of @xref without brace at the end of
	the document.

2024-07-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/command_stack.c,
	tp/Texinfo/XS/parsetexi/counter.c (print_counter_top): debugging code.

2024-06-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace): fix @U
	argument checking code.

	* tp/Makefile.tres, tp/t/03coverage_braces.t (command_in_U): add test.

2024-06-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace): fix
	@dotless argument checking code.

	* tp/Makefile.tres, tp/t/03coverage_braces.t (command_in_dotless): add
	test.

2024-06-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_handle_comma): rename a missed arg_text
	as arg_text_e.

2024-06-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/macro.c (handle_macro): remove a useless
	setting of internal_space_holder.

	Add const.

2024-06-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_handle_close_brace),
	tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace): reorganize
	code, add variables, change variable names for clearer code. Remove
	impossible cases code of args not set, since we are in args. Close
	command before adding spaces_after_close_brace.

	* tp/Texinfo/ParserNonXS.pm (_handle_comma),
	tp/Texinfo/XS/parsetexi/separator.c (handle_comma): rename arg_text as
	arg_text_e.

2024-06-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_handle_comma),
	tp/Texinfo/XS/parsetexi/separator.c (handle_comma): make code clearer.
	Decrease remaining_args right after seeing a comma.  Use different
	variables for elements instead or using input current element.  Use
	input current element as the first argument if the comma is is the
	first seen for a BRACE_inline command.

2024-06-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_handle_block_command),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_block_command):
	reorganize code, change variable names for clearer code, better
	separation of def* and other block commands, and try to finish
	modifying an element before registering it as an arg or content.

2024-06-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (build_additional_info),
	tp/Texinfo/XS/main/debug.c (print_associate_info_debug),
	tp/Texinfo/XS/main/extra.c (add_extra_element, lookup_extra_element),
	tp/Texinfo/XS/main/manipulate_tree.c (copy_associated_info)
	(remove_associated_copy_info), tp/Texinfo/XS/main/tree_types.h
	(KEY_PAIR), tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(complete_node_menu, complete_tree_nodes_missing_menu): add a new
	const_element field to the union in KEY_PAIR.  Use it for
	extra_element to make extra_element const.  Update
	build_additional_info, print_associate_info_debug and tree copy code
	accordingly  Cast to remove the const in handle_close_brace as the
	element is modified to add an extra information, and in
	complete_node_menu and complete_tree_nodes_missing_menu as the element
	is modified to have a menu or menu entry inserted.

2024-06-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Transformations.pm (_prepend_new_menu_in_node_section):
	set menu parent.

	* tp/Texinfo/Structuring.pm (new_complete_node_menu),
	tp/Texinfo/XS/structuring_transfo/structuring.c
	(new_complete_node_menu): do not set new menu parent, it is better to
	set it downstream, as in many case there should not be a parent.

	Add const.

2024-06-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (build_additional_info),
	tp/Texinfo/XS/main/debug.c (print_associate_info_debug),
	tp/Texinfo/XS/main/extra.c (add_extra_contents)
	(lookup_extra_contents), tp/Texinfo/XS/main/manipulate_tree.c
	(copy_associated_info, remove_associated_copy_info),
	tp/Texinfo/XS/main/tree.c (destroy_associated_info): rename
	extra_load as extra_contents, lookup_extra_load as
	lookup_extra_contents and add_extra_load as add_extra_contents.
	Remove the previous lookup_extra_contents and add_extra_contents
	now that they are not used anymore.

2024-06-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree.c (remove_from_const_element_list): add.

	* tp/Texinfo/XS/parsetexi/handle_commands.c (handle_block_command),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(reassociate_to_node, prepend_new_menu_in_node_section)
	(complete_node_menu, regenerate_master_menu): use extra_load for menus
	extra information. Remove const by casting in menu generation code
	since elements are modified when tree is transformed.

2024-06-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (build_perl_array): rename e as
	e_l.

	* tp/Texinfo/XS/main/build_perl_info.c
	(build_perl_const_element_array, build_additional_info),
	tp/Texinfo/XS/main/debug.c (print_associate_info_debug),
	tp/Texinfo/XS/main/extra.c (add_extra_load, lookup_extra_load),
	tp/Texinfo/XS/main/manipulate_tree.c (copy_associated_info)
	(remove_associated_copy_info), tp/Texinfo/XS/main/tree.c
	(destroy_associated_info), tp/Texinfo/XS/main/tree_types.h
	(enum extra_type, KEY_PAIR): add extra_load extra type with
	CONST_ELEMENT_LIST, add the const_list field in key pair union.
	Add build_perl_const_element_array to build Perl array from a
	CONST_ELEMENT_LIST.  Add handling of extra_load to
	print_associate_info_debug, destroy_associated_info and tree copy.
	Use it for section_childs and authors extra information. Update
	callers for those extra information keys.

2024-06-29  Patrice Dumas  <pertusus@free.fr>

	Reindent enum declarations

2024-06-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/output_unit.c (units_directions),
	tp/Texinfo/XS/main/tree_types.h (OUTPUT_UNIT): make OUTPUT_UNIT
	directions field an array on const output units pointers.  Cast to
	remove the const in units_directions in the cases where the directions
	are set based on other directions.

2024-06-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (relocate_source_marks): check if source_mark
	position is defined before comparing with positions, if not it is as
	if it was 0.

2024-06-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (output_unit_to_perl_hash):
	move unit_command storing earlier.  Return after unit_command storing
	if the unit_type is external_node_unit since there isn't anything else
	of interest in such output units.

	* tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_units_directions_files),
	tp/Texinfo/XS/main/build_perl_info.c (output_units_list_to_perl_hash):
	build external_node_unit Perl hashes especially when they are ready,
	using a new function output_units_list_to_perl_hash that sets up Perl
	hashes for output units but do not put the output units in an array.

	* tp/Texinfo/XS/main/build_perl_info.c (output_unit_to_perl_hash):
	assume that all the output units in directions have a reference to a
	Perl object now that external_node_unit are built before directions in
	other output units are.

2024-06-29  Patrice Dumas  <pertusus@free.fr>

	Add const.

2024-06-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/structuring.c
	(get_node_node_childs_from_sectioning): return a CONST_ELEMENT_LIST.
	Update callers.

2024-06-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (complete_node_tree_with_menus),
	tp/Texinfo/XS/structuring_transfo/structuring.c
	(complete_node_tree_with_menus): determine the next of Top node with
	the Top node, but set the prev as the Top node when looking at each
	node.  This avoids setting prev for non-node commands, or for nodes
	without automatic directions.

2024-06-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree.c (new_const_element_list)
	(destroy_const_element_list, reallocate_const_element_list)
	(add_to_const_element_list), tp/Texinfo/XS/main/tree_types.h
	(CONST_ELEMENT_LIST): add a list of const ELEMENT *, to be used in
	cases the elements in the list are not to be modified.

	* tp/Texinfo/XS/main/document_types.h (DOCUMENT),
	tp/Texinfo/XS/structuring_transfo/structuring.c
	(sectioning_structure, complete_node_tree_with_menus, nodes_tree): set
	document nodes list and sections list to be CONST_ELEMENT_LIST.  Use a
	cast to remove const in complete_node_tree_with_menus where, as an
	exception to the rule, the node from nodes list is modified.

2024-06-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/structuring.c
	(sectioning_structure): use only one TEXT for section numbers for all
	the sections, to reuse memory.

2024-06-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (nodes_tree),
	tp/Texinfo/XS/structuring_transfo/structuring.c (nodes_tree):
	determine top node section child when processing top node, but set
	the direction in top node section child when processing the node,
	as done for other nodes.

2024-06-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (build_perl_directions),
	tp/Texinfo/XS/main/extra.c (add_extra_directions)
	(lookup_extra_directions), tp/Texinfo/XS/main/manipulate_tree.c
	(copy_associated_info, remove_associated_copy_info),
	tp/Texinfo/XS/main/tree.c (destroy_associated_info, new_directions),
	tp/Texinfo/XS/main/tree_types.h (KEY_PAIR): use a simple list for
	directions in extra info with elements const.  The elements are set to
	const because directions are set after the tree is and, as a rule, the
	elements should not be modified when accessed from directions.  cast
	to remove the const where the element accessed through directions need
	to be modified, in build_perl_directions and for tree copying code.
	Update users/callers.

2024-06-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_xref_commands),
	tp/Texinfo/XS/main/extra.c (lookup_extra_element)
	(lookup_extra_container), tp/Texinfo/XS/main/manipulate_tree.c
	(copy_container_contents): separate extra_container from
	extra_element, by adding a specific function to lookup extra
	container, lookup_extra_container.  Add copy_container_contents to
	create a new element to be used as extra_container and refer to the
	contents of another element.  Use it to add containers instead of
	elements.  Replace lookup_extra_element by lookup_extra_container for
	all the callers with extra_container keys.

2024-06-26  Patrice Dumas  <pertusus@free.fr>

	Add some const

2024-06-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree_types.h (OUTPUT_UNIT): use a union for
	unit_command and special_unit_command.

2024-06-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/OutputUnits.pm (output_unit_texi),
	tp/Texinfo/XS/main/output_unit.c (output_unit_texi): prepend
	'_EXT_NODE: ' to external node output unit debug string output.

	* tp/Texinfo/XS/main/output_unit.c (units_directions): use a
	ELEMENT_STACK for up list instead of an ELEMENT_LIST and reuse is for
	all the elements.

	* tp/Texinfo/XS/main/tree_types.h (OUTPUT_UNIT),
	tp/Texinfo/XS/convert/convert_html.c (from_element_direction)
	(html_default_format_begin_file), tp/Texinfo/XS/main/build_perl_info.c
	(output_unit_to_perl_hash), tp/Texinfo/XS/main/output_unit.c
	(output_unit_texi, label_target_unit_element, split_by_node)
	(split_by_section): distinguish unit_command for an output unit
	unit_command found in the tree and special_unit_command for a special
	output unit unit_command, which is added.  Update uses of
	unit_command.

2024-06-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_default_format_contents),
	tp/Texinfo/XS/main/extra.c (lookup_extra_element)
	(lookup_extra_element_oot), tp/Texinfo/XS/main/manipulate_indices.c
	(index_content_element), tp/Texinfo/XS/parsetexi/indices.c
	(complete_indices): add lookup_extra_element_oot and use it
	exclusively for extra_element_oot.  Modify lookup_extra_element to
	accept only extra_element and extra_container.

2024-06-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_def_line),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line): copy element
	used as 'def_index_element' extra information, even if it is not
	translated.

2024-06-26  Patrice Dumas  <pertusus@free.fr>

	* doc/tp_api/texi2any_internals.texi, doc/tp_api/api_includes/*.texi:
	add to version control to have reference versions, but also to have
	something for users who cannot regenerate the files but have access to
	version control files.

2024-06-26  Patrice Dumas  <pertusus@free.fr>

	* configure.ac: fix --enable-pod-simple-texinfo-tests help string.

	* configure.ac: rearrange code.

2024-06-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (AM_TESTS_ENVIRONMENT), tp/tests/Makefile.am
	(AM_TESTS_ENVIRONMENT), tp/tests/many_input_files/Makefile.am
	(AM_TESTS_ENVIRONMENT), Pod-Simple-Texinfo/Makefile.am
	(AM_TESTS_ENVIRONMENT): do not set builddir (nor buildir) it should
	not be used anywhere.

2024-06-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (EXTRA_DIST): remove tp_tests variable.  Change in
	comments.

2024-06-26  Patrice Dumas  <pertusus@free.fr>

	* tp/prove.sh: remove -I that are not needed with Texinfo::ModulePath
	anymore.  Comments on use of srcdir.

2024-06-26  Patrice Dumas  <pertusus@free.fr>

	* tp/t/no_structure_test.t, tp/t/same_parser_multiple_files.t,
	tp/t/test_tree_copy.t, tp/t/test_utils.pl: add fallback for $srcdir
	based on Texinfo::ModulePath $top_srcdir.

2024-06-26  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): reset or create output directories early.
	Set parser errors only once.  Do not abort if input file is not found
	and $document is undef.  Skip structuring and conversion with a goto
	if there is no $document.  Skip most of test out file output if there
	is no $document.  Call $document methods in comparisons only if
	$document is not undef.

2024-06-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_close_brace_command)
	(_handle_close_brace), tp/Texinfo/XS/parsetexi/close.c
	(close_brace_command), tp/Texinfo/XS/parsetexi/separator.c
	(handle_close_brace): pop ct_inlineraw context in close_brace_command
	instead of handle_close_brace, such that it is done when the command
	is closed although there is no closing brace.

	* tp/Makefile.tres, tp/t/16raw.t (inlineraw_not_closed): add test of
	@inlineraw not closed.

	* tp/Texinfo/XS/parsetexi/api.c, tp/Texinfo/XS/parsetexi/macro.c:
	change in FIXMEs.

2024-06-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (build_perl_directions): rename
	e as e_l, set an ELEMENT called e for more readable code.

	* tp/Texinfo/XS/main/debug.c (print_associate_info_debug): add
	extra_index_entry and extra_directions.  Minor code improvements.

	* tp/Texinfo/XS/main/debug.c (print_element_debug_details): access
	extra_info only if not text element.  Minor changes.

2024-06-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.h (TEXT_OPTIONS): use size_t for
	document_descriptor.

	* tp/Texinfo/XS/parsetexi/parser.c (parse_texi_document): return void.

	* tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/main/DocumentXS.xs,
	tp/Texinfo/XS/main/build_perl_info.c, tp/Texinfo/XS/main/document.c,
	tp/Texinfo/XS/main/get_perl_info.c, tp/Texinfo/XS/main/translations.c,
	tp/Texinfo/XS/parsetexi/Parsetexi.xs, tp/Texinfo/XS/parsetexi/api.c,
	tp/Texinfo/XS/parsetexi/parser.c: use size_t more for document
	descriptors.

2024-06-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/targets.c, tp/Texinfo/XS/parsetexi/labels.c
	(set_labels_identifiers_target): move set_labels_identifiers_target to
	labels.c.

	* tp/Texinfo/XS/main/targets.c: remove destroy_label_list.  Add
	static for functions.

	* tp/Texinfo/XS/parsetexi/api.c,
	tp/Texinfo/XS/structuring_transfo/transformations.c: use size_t for
	document descriptor more.

2024-06-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (%leading_space_types, _merge_text)
	(_abort_empty_line): use a hash for special spaces text types in
	merge_text and abort_empty_line.

	* tp/Texinfo/XS/main/element_types.txt,
	tp/Texinfo/XS/parsetexi/parser.c (merge_text),
	tp/Texinfo/XS/parsetexi/parser.c (abort_empty_line): add a new
	TF_leading_space flag, and use it for special spaces text types in
	merge_text and abort_empty_line.

2024-06-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (process_verb_contents): use
	delimiter_len instead of calling strlen.  Use break instead of goto.

	* tp/Texinfo/XS/parsetexi/parser.c (isolate_last_space): check the
	debug conditional when there are several debug function calls.

	Change in comments.

2024-06-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (isolate_trailing_spaces_element)
	(isolate_trailing_space, isolate_last_space): have
	isolate_trailing_spaces_element return the input element if it
	consists only of spaces.  Use that information to determine that the
	element text is only space in isolate_last_space and
	isolate_trailing_space instead of calling strspn.

2024-06-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_isolate_trailing_space)
	(_register_extra_menu_entry_information, _isolate_last_space)
	(_process_remaining_on_line), tp/Texinfo/XS/parsetexi/menus.c
	(register_extra_menu_entry_information),
	tp/Texinfo/XS/parsetexi/parser.c (isolate_trailing_space)
	(isolate_last_space, process_remaining_on_line): check if there is
	content and the last content is text in isolate_trailing_space.  Call
	directly isolate_trailing_space in
	register_extra_menu_entry_information.  Remove call of
	isolate_trailing_space from isolate_last_space.

	* tp/Texinfo/ParserNonXS.pm (_isolate_trailing_spaces_element)
	(_isolate_trailing_space, _isolate_last_space),
	tp/Texinfo/XS/parsetexi/parser.c (isolate_trailing_spaces_element)
	(isolate_trailing_space, isolate_last_space): split
	isolate_trailing_spaces_element out of isolate_last_space, and use it
	in isolate_trailing_space to correctly transfer source marks.
	Reorganize isolate_last_space code to be more like
	isolate_trailing_space code, in particular do not check separately
	that the text ends with spaces.

2024-06-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): call
	close_container instead of end_paragraph to close a paragraph when
	directly in the paragraph.

2024-06-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (%close_paragraph_not_preformatted)
	(_end_paragraph_preformatted, _close_commands)
	(_process_remaining_on_line), tp/Texinfo/XS/parsetexi/close.c
	(close_commands), tp/Texinfo/XS/parsetexi/parser.c
	(end_paragraph_preformatted, process_remaining_on_line): add
	_end_paragraph_preformatted that closes preofrmatted or paragraph.
	Use it in close_commands.  In process_remaining_on_line, handle
	especially @-command closing paragraph and not preformatted, and
	@-command closing both, calling end_paragraph_preformatted in that
	case.

2024-06-23  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Customization Variables and Options): put @vindex
	at beginning of line.

2024-06-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_close_commands),
	tp/Texinfo/XS/parsetexi/close.c (close_commands): instead of calling
	end_paragraph and end_preformatted, call close_all_style_commands once
	and close paragraph or preformatted, depending on the one present.

	* tp/Texinfo/ParserNonXS.pm (_end_line, _handle_close_brace),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line),
	tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace): call
	close_container instead of end_paragraph to close a paragraph when
	directly in the paragraph.

	* tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): remove
	a useless check of cmd being non-zero.

	* tp/Texinfo/XS/parsetexi/close.c, tp/Texinfo/XS/parsetexi/parser.c:
	rename closed_block_command as closed_block_cmd and
	interrupting_command as interrupting_cmd.

2024-06-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_abort_empty_line),
	tp/Texinfo/XS/parsetexi/parser.c (abort_empty_line): remove returned
	status from abort_empty_line.

2024-06-23  Patrice Dumas  <pertusus@free.fr>

	Stricter check of @-commands not appearing at the beginning of a line

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): check
	that an @-command is opened at the beginning of a line by checking
	that the previous element is an empty_line text element.

2024-06-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_in_begin_paragraph),
	tp/Texinfo/XS/parsetexi/parser.c (in_begin_paragraph): rename
	begin_paragraph_p as in_begin_paragraph.

2024-06-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_begin_paragraph_p, _begin_paragraph),
	tp/Texinfo/XS/parsetexi/parser.c (begin_paragraph): add
	_begin_paragraph_p in Perl code.  Do not call begin_paragraph_p in
	begin_paragraph, instead let the caller call begin_paragraph is
	begin_paragraph_p returns true.  Update callers.

	* tp/Texinfo/ParserNonXS.pm (_merge_text): rename
	$last_element_type as $last_elt_type.

	* tp/Texinfo/ParserNonXS.pm (_merge_text),
	tp/Texinfo/XS/parsetexi/parser.c (merge_text): instead of calling
	*abort_empty_line, inline the corresponding code, mixing with
	paragraph opening, and without the case of last_element text empty,
	already handled.

2024-06-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/03coverage_braces.t
	(footnote_ending_on_empty_line_spaces): test with footnote with end
	line and spaces after end line before closing brace.

	* tp/Makefile.tres, tp/t/08misc_commands.t
	(indent_with_command_after_without_space)
	(indent_with_text_after_without_space): tests with indent followed by
	command starting a paragraph or text (through a @value expansion)
	without space in-between.

2024-06-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_merge_text),
	tp/Texinfo/XS/parsetexi/parser.c (merge_text): handle especially the
	case of no last element, as there cannot be paragraph or special text
	elements handling in that case.

	* tp/Texinfo/ParserNonXS.pm (_close_current)
	(_move_last_space_to_element, _abort_empty_line, _end_line),
	tp/Texinfo/XS/parsetexi/close.c (close_current),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line),
	tp/Texinfo/XS/parsetexi/parser.c (move_last_space_to_element)
	(do_abort_empty_line): separate code moving a last space children as
	info spaces_before_argument in element out of abort_empty_line to
	move_last_space_to_element, and call directly
	move_last_space_to_element when relevant.

2024-06-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_abort_empty_line): define more variables
	and add separate if.

	* tp/Texinfo/ParserNonXS.pm (_merge_text, _abort_empty_line)
	(_end_line, _handle_open_brace), tp/Texinfo/XS/main/element_types.txt,
	tp/Texinfo/XS/parsetexi/end_line.c (end_line, do_abort_empty_line)
	(merge_text, abort_empty_line), tp/Texinfo/XS/parsetexi/separator.c
	(handle_open_brace): add a new internal text type,
	internal_spaces_before_context_argument, for context brace commands
	only, otherwise very similar with internal_spaces_before_argument.

2024-06-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_utils.c (find_innermost_accent_contents)
	(find_root_command_next_heading_command): fix type_data text flag
	symbol.

2024-06-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_texi): call _pop_context at the
	end of document parsing.

	* tp/Texinfo/XS/parsetexi/parser.c (parse_texi): check that the
	context popped at the end of the document is base or line.

	* tp/Texinfo/ParserNonXS.pm: do not call _pop_context with an object
	oriented syntax.

2024-06-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_to_html_internal):
	types not known in Perl cannot be set to ignored as types in Perl, so
	consider only their ignored status as commands.

2024-06-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%default_commands_conversion): ignore
	explicitly seealso, seeentry and sortas.

2024-06-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_abort_empty_line),
	tp/Texinfo/XS/parsetexi/parser.c (do_abort_empty_line): simplify debug
	message.
	
	Changes in comments.

2024-09-29  Patrice Dumas  <pertusus@free.fr>

	Update/fix test result

2024-06-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (%type_without_paragraph),
	tp/Texinfo/XS/parsetexi/parser.c (begin_paragraph_p): remove explicit
	check for root_line as non-paragraph type, as it is in ct_line context
	now.

2024-06-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_current_context_command): rename
	_top_context_command as _current_context_command to match C code.

	* tp/Texinfo/ParserNonXS.pm (%parsing_state_initialization)
	(_initialize_parsing, parse_texi_piece, parse_texi_line)
	(parse_texi_text, parse_texi_file, _parse_texi),
	tp/Texinfo/XS/parsetexi/api.c (initialize_parsing, parse_file)
	(parse_text, parse_string, parse_piece),
	tp/Texinfo/XS/parsetexi/context_stack.c (current_context_command)
	(top_context_command, current_context),
	tp/Texinfo/XS/parsetexi/parser.c (parse_texi): add the root context as
	argument to initialize_parsing.  Set root context to ct_line if in
	parse_texi_line, and to ct_base otherwise.  Modify C code to have an
	explicit root context.

	* tp/Texinfo/ParserNonXS.pm (_current_context_command)
	(_end_line, _handle_other_command, _process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_other_command)
	(process_remaining_on_line): verify that the top context command is
	defined when checking that we are in line context on a command line
	argument.

	* tp/Texinfo/XS/parsetexi/context_stack.c: remove in_context.

2024-06-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (text_contents_to_plain_text): use
	text_append_n in ADD, as we always know the text length.

2024-06-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (text_contents_to_plain_text): do
	not check that the element is not NULL, it should never happen.

2024-06-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (is_end_current_command): remove
	end_cmd argument is it is always set to the cmd argument.  Update
	callers.

2024-06-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm, tp/Texinfo/XS/parsetexi/parser.c
	(macro_block_stack, macro_block_number, macro_block_space)
	(push_macro_block_stack, pop_macro_block_stack)
	(macro_block_stack_top): rename raw_block_stack as macro_block_stack,
	other raw_block_* variables as macro_block_*, push_raw_block_stack as
	push_macro_block_stack, pop_raw_block_stack as pop_macro_block_stack
	and raw_block_stack_top as macro_block_stack_top.  Update callers.

2024-06-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_macro_block_contents)
	(_parse_tex), tp/Texinfo/XS/parsetexi/parser.c
	(process_macro_block_contents, parse_texi): emit errors on unclosed
	raw block commands (except for the first level) in
	process_macro_block_contents if the block is not finished instead of
	checking at the end of the parsing.

2024-06-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line, _parse_texi),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line)
	(parse_texi): process a definition line continuation right where it is
	seen.  Get the next line immediately too.

2024-06-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/handle_commands.c (handle_block_command):
	minor changes.  avoid setting current twice.  use else if for
	conditions that are exclusive instead of series of if.

	* tp/Texinfo/ParserNonXS.pm (_handle_block_command): update to be more
	like C code.

2024-06-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_handle_block_command)
	(_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_block_command),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): remove
	the code related to @*macro from handle_block_command and put it
	directly in process_remaining_on_line.

2024-06-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (process_macro_block_contents)
	(process_raw_block_contents)
	(process_ignored_raw_format_block_contents)
	(process_remaining_on_line): free and set allocated_text in functions,
	as soon as next_line is called.  Pass line as out parameter by
	reference.

2024-06-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line, _parse_texi),
	tp/Texinfo/XS/parsetexi/parser.c (process_verb_contents)
	(process_remaining_on_line, parse_texi): process verb contents right
	after brace opening.  Do it in the process_verb_contents function in
	C.

2024-06-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(html_prepare_units_directions_files),
	tp/Texinfo/XS/main/converter_types.h
	(enum output_units_descriptor_type, CONVERTER),
	tp/Texinfo/XS/main/output_unit.c (label_target_unit_element)
	(units_directions): create an output unit list in
	html_prepare_units_directions_files to register external nodes special
	output units created in label_target_unit_element.  This is such that
	the output units can be freed when the document is destroyed.

2024-06-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/structuring.c (number_floats): do
	not use a static TEXT variable, instead initialize the TEXT variable
	at the beginning of the function and reuse the storage.  The function
	should only be called once per document.

2024-06-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c
	(process_ignored_raw_format_block_contents): use next_text instead of
	next_line to get a new line within contents.

	* tp/Texinfo/XS/parsetexi/parser.c (process_macro_block_contents)
	(process_raw_block_contents)
	(process_ignored_raw_format_block_contents): free the line returned by
	next_text.  free and reallocate the line when the line is returned
	without leading spaces.

	* tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): free
	allocated before storing and store the lines returned by
	process_*_block_contents functions in allocated_text to avoid memory
	leaks.

2024-06-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_raw_block_contents): fix
	detection of @end to gather the whole command name.

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line)
	(_parse_texi), tp/Texinfo/XS/parsetexi/parser.c
	(process_remaining_on_line, parse_texi): use process_raw_block_contents
	to process ignored conditional block commands.

2024-06-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_raw_block_contents)
	(_process_macro_block_contents, _process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/parser.c (process_macro_block_contents)
	(process_raw_block_contents, process_remaining_on_line): create
	process_macro_block_contents out of process_raw_block_contents for
	macro specific code.  Change C code to separate better determination
	of nested command beginning and detection of @end line.

2024-06-21  Patrice Dumas  <pertusus@free.fr>

	* tp/t/55conditionals.t (value_on_ifset): add test with @value on
	@ifset line.

2024-06-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm
	(_process_ignored_raw_format_block_contents)
	(_process_remaining_on_line), tp/Texinfo/XS/parsetexi/parser.c
	(process_ignored_raw_format_block_contents)
	(process_remaining_on_line): add
	process_ignored_raw_format_block_contents to process contents of an
	ignored raw format block command until the @end line.  Call it after a
	command line to catch raw format block command with a comment on
	the line.

	* tp/Makefile.tres, tp/t/16raw.t (comments_on_raw_block_line): test
	with comments on raw format block command lines with contents, with an
	expanded format and an ignored format.

2024-06-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_raw_block_contents)
	(_process_remaining_on_line, _parse_texi),
	tp/Texinfo/XS/parsetexi/parser.c (process_raw_block_contents)
	(process_remaining_on_line, parse_texi): add
	process_raw_block_contents to process a raw block command contents
	until @end line.  Use it right after the block command opening.

2024-06-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line, _parse_texi),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line)
	(parse_texi): handle ignored format raw command right after end_line
	call, by calling next_text within process_remaining_on_line and
	processing until @end instead of returning.  @end is then processed by
	the next call of process_remaining_on_line without going through
	the parse_texi lines loop.

2024-06-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line, _parse_texi),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line)
	(parse_texi): no need to check explicitly that a fprmat raw block
	command is ignored, as if directly in the command it is necessarily
	ignored, otherwise there would be a rawpreformatted container.

	* tp/Makefile.tres, tp/t/16raw.t
	(empty_line_in_command_in_expanded_not_expanded): add test of empty
	line in brace commands in raw format blocks.

2024-06-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line, _parse_texi),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line, parse_texi): call
	abort_empty_line for an internal_spaces_before_argument at end of line
	in end_line and not in parse_texi.

2024-06-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (set_menus_node_directions): handle
	undef FORMAT_MENU.

2024-06-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (%parsing_state_initialization)
	(%begin_paragraph_contexts, _pop_context, _end_line)
	(_get_context_stack, _handle_open_brace, _parse_texi),
	tp/Texinfo/XS/parsetexi/close.c (close_brace_command),
	tp/Texinfo/XS/parsetexi/context_stack.c (current_context)
	(is_context_empty), tp/Texinfo/XS/parsetexi/context_stack.h
	(begin_paragraph_context, enum context),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line),
	tp/Texinfo/XS/parsetexi/parser.c (parse_texi),
	tp/Texinfo/XS/parsetexi/separator.c (handle_open_brace): do not
	differentiate base context and ct_brace_command. Rename ct_NONE as
	ct_base and push ct_base instead of ct_brace_command when opening a
	context brace command (that do not start math context).  Add
	is_context_empty in C to determine that the context is empty since
	the base context can now appear in the context stack and modify
	similarly Perl code.

2024-06-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_texi),
	tp/Texinfo/XS/parsetexi/parser.c (parse_texi): do not abort an empty
	line which is not an empty string at the end of the document.

2024-06-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_handle_menu_entry_separators),
	tp/Texinfo/XS/parsetexi/menus.c (handle_menu_entry_separators): reuse
	the empty_line as the internal_menu_star element.  Setup last_element
	at the beginning of the function.

2024-06-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (%parsing_state_initialization): call
	toplevel context ct_NONE as in C.

	* tp/Texinfo/ParserNonXS.pm (_close_container): add source_info
	argument to _close_container, update callers.

	* tp/Texinfo/ParserNonXS.pm: remove unused _remove_empty_arg.

	* tp/Texinfo/ParserNonXS.pm (_handle_macro),
	tp/Texinfo/XS/parsetexi/macro.c (handle_macro): do not call
	_merge_text, setup more simply the macro_call_element contents
	when a macro is called with the whole line as argument.

	* tp/Texinfo/ParserNonXS.pm (%type_without_paragraph)
	(%begin_paragraph_contexts, _begin_paragraph, _close_container)
	(_abort_empty_line, _end_line), tp/Texinfo/XS/parsetexi/close.c
	(close_container), tp/Texinfo/XS/parsetexi/context_stack.h
	(begin_paragraph_context, enum context),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line),
	tp/Texinfo/XS/parsetexi/parser.c (begin_paragraph_p, begin_paragraph):
	add paragraph in context.  Change the logic of determination of
	paragraph beginning and treatment of empty lines at end of line.

	* tp/Makefile.tres, tp/t/50value.t (unknown_value_after_spaces): add
	test with unknown @value after spaces on a line and not in a
	paragraph.

2024-06-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line):
	simplify code related to deprecated commands, make it more like Perl.

2024-06-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_merge_text): also use
	_transfer_source_marks when merging with existing $last_element.

2024-06-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (merge_text): no need to retrieve
	the last element with empty_line anymore, as it is not removed in
	do_abort_empty_line anymore, as the case of empty text is handled
	before.

	* tp/Texinfo/ParserNonXS.pm (_merge_text): update to match C code.

2024-06-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_merge_text),
	tp/Texinfo/XS/parsetexi/parser.c (merge_text): if a special space text
	element is empty and there is non space text merged, reuse the element
	as a normal text element.  This is different from before if there are
	source marks as now they are kept as is, previously, a call to
	*_abort_empty_line followed by adding a new element led to an empty
	text element added to store the source marks.

2024-06-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (merge_text),
	tp/Texinfo/XS/parsetexi/source_marks.c (transfer_source_marks): add an
	added length argument to transfer_source_marks, to use the function in
	merge_text when merging with existing text.  Update
	transfer_source_marks callers.

2024-06-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (abort_empty_line): call with a
	pointer on element, not a pointer on pointer.  Update callers.

	* tp/Texinfo/XS/parsetexi/parser.c (abort_empty_line)
	(do_abort_empty_line, merge_text): move do_abort_empty_line out of
	abort_empty_line and call it directly in merge_text instead of redoing
	the same check of elements again in abort_empty_line.  Change
	merge_text code to be simpler.

2024-06-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (merge_text): modify code to have
	the new_text label before a statement and not a declaration.

	* tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line):
	comment out unused value_valid label.

2024-06-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/output_unit.c (destroy_output_unit): destroy the
	unit_command if the output_unit is a special_unit_variety as in that
	case the element is not in the main document Texinfo tree and will not
	be freed.

2024-06-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/output_unit.c (retrieve_output_units)
	(new_output_units_descriptor): rename output_units variable as
	output_units_lists.

2024-06-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c
	(destroy_document_information_except_tree),
	tp/Texinfo/XS/main/output_unit.c (destroy_output_unit)
	(free_output_unit_list, free_output_units_lists): free output units.

2024-06-16  Patrice Dumas  <pertusus@free.fr>

	Associate output units lists with document in XS

	* tp/Texinfo/Convert/Plaintext.pm (output), tp/Texinfo/OutputUnits.pm
	(rebuild_output_units), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_conversion_units, html_prepare_units_directions_files)
	(html_prepare_output_units_global_targets),
	tp/Texinfo/XS/convert/convert_html.c (html_get_tree_root_element),
	tp/Texinfo/XS/convert/convert_html.c (prepare_special_units)
	(set_special_units_targets_files)
	(prepare_associated_special_units_targets)
	(html_internal_command_href, html_prepare_output_units_global_targets)
	(html_prepare_units_directions_files, html_convert_convert)
	(html_prepare_title_titlepage, html_convert_output),
	tp/Texinfo/XS/main/build_perl_info.c (fill_output_units_descriptor_av)
	(build_output_units_list, setup_output_units_handler)
	(rebuild_output_units_list), tp/Texinfo/XS/main/document_types.h
	(OUTPUT_UNIT_LISTS, DOCUMENT), tp/Texinfo/XS/main/get_perl_info.c
	(get_sv_output_units), tp/Texinfo/XS/main/output_unit.c
	(retrieve_output_units, new_output_units_descriptor, split_by_node)
	(split_by_section),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs
	(split_by_node, split_by_section, rebuild_output_units, split_pages),
	tp/t/test_utils.pl (test): add output_units_lists in DOCUMENT, and put
	and retrieve output units from there. Remove output_units_list,
	output_units_number and output_units_space in output_unit.c.

2024-06-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/manipulate_tree.c (copy_associated_info): use
	the newly initialized string list instead of allocating another one.

2024-06-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/command_stack.c
	(command_is_in_referred_command_stack): add braces for better code
	readability.

	* tp/Texinfo/XS/main/convert_utils.c (encoded_input_file_name)
	(encoded_output_file_name): simpler conditions.

2024-06-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (xml_numeric_entity_accent):
	remove condition on cmd being an accent command, there is no specific
	reason to test it especially.  Rearrange code.

2024-06-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal): use
	data_cmd instead of element->e.c->cmd more.

	* tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal):
	use more flags and command data in conditions and rearrange.

2024-06-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/transformations.c
	(move_index_entries_after_items): fix condition.

2024-06-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/transformations.c
	(protect_first_parenthesis_in_targets_internal): check that the
	element is an @-command element before calling get_label_element.

2024-09-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_command_description):
	update for move of cmd to CONTAINER.

2024-06-16  Patrice Dumas  <pertusus@free.fr>

	Turn source_mark_list to a pointer

	* tp/Texinfo/XS/main/tree_types.h (ELEMENT),
	tp/Texinfo/XS/main/build_perl_info.c (store_source_mark_list),
	tp/Texinfo/XS/main/manipulate_tree.c (add_source_mark)
	(relocate_source_marks, parse_node_manual, modify_tree, protect_text),
	tp/Texinfo/XS/main/tree.c (free_element_source_mark_list)
	(destroy_element_empty_source_mark_list, destroy_element),
	tp/Texinfo/XS/parsetexi/close.c (close_container)
	(close_command_cleanup), tp/Texinfo/XS/parsetexi/def.c
	(split_delimiters, split_def_args), tp/Texinfo/XS/parsetexi/parser.c
	(merge_text, abort_empty_line, isolate_last_space_internal),
	tp/Texinfo/XS/parsetexi/source_marks.c (transfer_source_marks),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(protect_first_parenthesis)
	(protect_hashchar_at_line_beginning_internal): turn the
	source_mark_list field of ELEMENT to a pointer.  Add
	free_element_source_mark_list and
	destroy_element_empty_source_mark_list.

2024-06-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_close_command_cleanup): separate
	multitable head and body only if the multitable has contents.

	* tp/Texinfo/ParserNonXS.pm (_close_command_cleanup),
	tp/Texinfo/XS/parsetexi/close.c (close_command_cleanup): update code
	taking into account that
	i) there cannot be ignorable_spaces_after_command before before_item,
	as it is added only after commands, and inside commands arguments.
	ii) there cannot be an @end in before_item, as soon as an @end is seen
	it is popped from the element it is in, before closing.
	iii) there can only be before_item or elements associated with @*item
	directly in block item at commands.

	* tp/Texinfo/XS/parsetexi/utils.c (item_line_parent): use explicit
	command enums.

	* tp/Texinfo/XS/main/convert_utils.c
	(find_root_command_next_heading_command): fix condition.

	* tp/Texinfo/ParserNonXS.pm (_expand_macro_arguments): fix condition.

	* tp/Texinfo/Document.pm (new_document): do not initialize explicitly
	'included_files' to give the same output as with XS.

	* tp/Texinfo/XS/main/manipulate_indices.c
	(idx_leading_text_or_command), tp/Texinfo/Indices.pm
	(_idx_leading_text_or_command), tp/Texinfo/XS/main/utils.c
	(is_content_empty), tp/Texinfo/Common.pm (is_content_empty): handle
	text element first.

	* tp/Texinfo/XS/main/node_name_normalization.c
	(convert_to_normalized_internal),
	tp/Texinfo/Convert/NodeNameNormalization.pm (%ignored_text_types)
	(_convert): handle text first, including ignored text types, and the
	remaining elements afterwards.

	* tp/Texinfo/Translations.pm (_substitute_element_array),
	tp/Texinfo/XS/main/translations.c (substitute_element_array): check
	for text first, as there is no recursion in that case.

	* tp/Texinfo/XS/main/tree_types.h (CONTAINER, ELEMENT),
	tp/Texinfo/XS/main/tree.c (new_command_element),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block),
	tp/Texinfo/XS/parsetexi/indices.c
	(set_non_ignored_space_in_index_before_command): move cmd from
	ELEMENT to CONTAINER, as text element do not have a command name.
	Update users, making sure in particular that element_command_name,
	element_builtin_cmd, element_builtin_data_cmd and similar functions
	and macros are never called for a text element.

	* tp/Texinfo/XS/parsetexi/separator.c (handle_open_brace): rename
	command variable as cmd.

	* tp/t/test_document.t: fix the calls to is().

	* tp/Makefile.tres, tp/t/05paragraph.t
	(indent_before_macro_definition_and_other): add test with command that
	are skipped between @indent and the next paragraph.

2024-06-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree_types.h (KEY_PAIR),
	tp/Texinfo/XS/main/extra.c (get_associated_info_key),
	tp/Texinfo/XS/parsetexi/end_line.c,
	tp/Texinfo/XS/structuring_transfo/transformations.c: remove the skey
	field of KEY_PAIR, now that it is not used anywhere anymore.

2024-06-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/DocumentXS.xs (set_document_global_info),
	tp/Texinfo/XS/main/build_perl_info.c (build_global_info),
	tp/Texinfo/XS/main/document.c (add_other_global_info_string),
	tp/Texinfo/XS/main/document_types.h (KEY_STRING_PAIR)
	(OTHER_GLOBAL_INFO, GLOBAL_INFO): do not use ASSOCIATED_INFO for
	global_info.other_info, use specific structures and
	add_other_global_info_string to add a key, string pair.

	* tp/Texinfo/XS/main/extra.c: remove get_associated_info_skey and
	add_associated_info_string_dup.

	* tp/Makefile.tres, t/test_document.t: add test of Texinfo::Document
	set_document_global_info.

2024-09-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_command_description):
	use integer key lookup_extra_element.

2024-06-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (build_additional_info),
	tp/Texinfo/XS/main/debug.c (print_associate_info_debug),
	tp/Texinfo/XS/main/extra.c (add_extra_misc_args)
	(add_extra_index_entry, lookup_extra_misc_args)
	(lookup_extra_index_entry), tp/Texinfo/XS/main/manipulate_tree.c
	(copy_associated_info): use an integer key for extra_misc_args and
	extra_index_entry.  Remove lookup_associated_sinfo and lookup_extras.
	Update callers.

2024-06-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (build_additional_info),
	tp/Texinfo/XS/main/extra.c (add_extra_contents, add_extra_directions)
	(lookup_extra_contents, lookup_extra_directions),
	tp/Texinfo/XS/main/manipulate_tree.c (copy_associated_info),
	tp/Texinfo/XS/structuring_transfo/structuring.c (direction_bases)
	(section_direction_associated_node): use an integer key for
	extra_contents and extra_directions.  Update callers.

2024-06-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (delete_global_info): use the pointer
	directly.

	* tp/Texinfo/XS/main/debug.c (print_associate_info_debug),
	tp/Texinfo/XS/main/extra.c (add_extra_string, add_extra_string_dup)
	(lookup_extra_string), tp/Texinfo/XS/main/build_perl_info.c
	(build_additional_info): use an integer key for extra_string.  Update
	callers.

2024-06-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/debug.c (print_associate_info_debug): update for
	change in misc_args.

	* tp/Texinfo/XS/main/build_perl_info.c (build_additional_info),
	tp/Texinfo/XS/main/debug.c (print_associate_info_debug),
	tp/Texinfo/XS/main/extra.c (add_extra_element, add_extra_element_oot)
	(add_extra_container, lookup_extra_element, lookup_extra)
	(lookup_extras): use an integer key for extra_element,
	extra_element_oot and extra_container.  Update callers.

2024-06-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_register_file_information):
	really use the string stored in small_strings.

2024-06-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(add_associated_file_info_integer, html_register_file_information)
	(lookup_associated_file_info, html_get_file_information)
	(html_set_pages_files, setup_output_simple_page)
	(html_conversion_finalization), tp/Texinfo/XS/main/converter_types.h
	(FILE_INFO_KEY_PAIR, FILE_ASSOCIATED_INFO, FILE_ASSOCIATED_INFO_LIST)
	(CONVERTER), tp/Texinfo/XS/main/extra.c: add a specific structure for
	information associated to a file instead of using the generic
	ASSOCIATED_INFO structures.  Remove add_associated_info_integer.

	* tp/Texinfo/XS/main/build_perl_info.c (build_additional_info),
	tp/Texinfo/XS/main/debug.c (print_associate_info_debug),
	tp/Texinfo/XS/main/extra.c (get_associated_info_skey)
	(get_associated_info_key, lookup_associated_info)
	(lookup_associated_sinfo, add_extra_integer, lookup_extra_by_index)
	(lookup_extra_integer), tp/Texinfo/XS/main/manipulate_tree.c
	(copy_associated_info), tp/Texinfo/XS/main/tree.c (ai_key_names),
	tp/Texinfo/XS/main/tree_types.h (AI_KEYS_LIST),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(reassociate_to_node): use an integer key for extra info integer.
	Duplicate some functions to still use string as key for other
	extra types.  Update callers.

2024-06-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_register_file_information):
	make sure that the key is saved on the heap by adding to converter
	small_strings.

2024-06-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_handle_line_command),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command):
	rename extra key level as subentry_level.

2024-06-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_gather_def_item, _end_line_misc_line)
	(_end_line_starting_block, _end_line, _handle_line_command)
	(_handle_block_command, _handle_open_brace),
	tp/Texinfo/XS/main/tree_types.h, tp/Texinfo/XS/parsetexi/def.c
	(gather_def_item), tp/Texinfo/XS/parsetexi/end_line.c
	(end_line_starting_block, end_line_misc_line, end_line),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command)
	(handle_block_command), tp/Texinfo/XS/parsetexi/parser.c
	(check_valid_nesting), tp/Texinfo/XS/parsetexi/separator.c
	(handle_open_brace),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(reassociate_to_node): do not set def_line as type for @def*x and
	@def*line.  Use extra def_command to determine that an element is
	either a @def* line command or a def_line type in Perl.  Set and use
	EF_def_line flag to determine that an element is either a @def* line
	command or a def_line type in C.

	* tp/Texinfo/Convert/DocBook.pm (%docbook_line_commands)
	(_convert_def_line, _convert), tp/Texinfo/Convert/HTML.pm
	(default_type_conversion), tp/Texinfo/Convert/LaTeX.pm
	(%def_line_commands, _convert_def_line, _convert),
	tp/Texinfo/Convert/Plaintext.pm (_convert_def_line, _convert),
	tp/Texinfo/Convert/TexinfoMarkup.pm (%line_commands)
	(_convert_def_line, _convert), tp/Texinfo/Convert/Text.pm
	(%converted_formattable_line_commands, _convert_def_line)
	(_convert), tp/Texinfo/Convert/TextContent.pm
	(%formatted_line_commands, converter_initialize),
	tp/Texinfo/XS/convert/convert_html.c (convert_def_command),
	tp/Texinfo/XS/main/convert_to_text.c (convert_def_line)
	(convert_to_text_internal), : convert
	@def* line command in addition to def_line type.

2024-06-10  Patrice Dumas  <pertusus@free.fr>

	Use a string list for extra_misc_args

	* tp/Texinfo/XS/convert/convert_html.c (convert_sp_command)
	(convert_tab_command, convert_printindex_command),
	tp/Texinfo/XS/main/build_perl_info.c (build_additional_info),
	tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal),
	tp/Texinfo/XS/main/extra.c (add_extra_misc_args)
	(lookup_extra_misc_args), tp/Texinfo/XS/main/manipulate_tree.c
	(copy_associated_info), tp/Texinfo/XS/main/tree.c
	(destroy_associated_info), tp/Texinfo/XS/main/utils.c
	(informative_command_value), tp/Texinfo/XS/parsetexi/end_line.c
	(parse_line_command_args, end_line_starting_block)
	(end_line_misc_line), tp/Texinfo/XS/parsetexi/handle_commands.c
	(handle_line_command): use a STRING_LIST for extra_misc_args.

2024-06-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_printindex_command),
	tp/Texinfo/XS/main/build_perl_info.c (build_additional_info),
	tp/Texinfo/XS/main/extra.c (add_extra_index_entry)
	(lookup_extra_index_entry), tp/Texinfo/XS/main/manipulate_tree.c
	(copy_associated_info), tp/Texinfo/XS/main/tree.c
	(destroy_associated_info), tp/Texinfo/XS/main/tree_types.h
	(INDEX_ENTRY_LOCATION, KEY_PAIR, enum extra_type),
	tp/Texinfo/XS/parsetexi/indices.c (enter_index_entry),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(lookup_index_entry, relate_index_entries_to_table_items_in): add
	extra_index_entry extra type that represents the location of an index
	entry, with index name and number in index.  Use it instead of
	misc_args for index entries.

2024-06-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash): nest
	conditions to avoid calling the conditions on setting Perl data for
	all the elements.

2024-06-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (store_info_element): check if
	element to store is 0 in store_info_element.  Update callers.

2024-06-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (store_additional_info)
	(store_info_integer, element_to_perl_hash): add store_info_integer.
	Modify store_additional_info to take a reference on a hv in argument
	and not a number.

	* tp/Texinfo/XS/convert/convert_html.c (html_default_format_contents)
	(convert_style_command, convert_menu_entry_type)
	(convert_def_line_type), tp/Texinfo/XS/convert/converter.c
	(table_item_content_tree), tp/Texinfo/XS/main/build_perl_info.c
	(element_to_perl_hash), tp/Texinfo/XS/main/targets.c
	(set_labels_identifiers_target, add_element_to_identifiers_target),
	tp/Texinfo/XS/main/tree_types.h (ELEMENT),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command)
	(handle_block_command, handle_brace_command),
	tp/Texinfo/XS/parsetexi/macro.c (parse_macro_command_line),
	tp/Texinfo/XS/parsetexi/parser.c (begin_paragraph)
	(register_command_as_argument, process_remaining_on_line),
	tp/Texinfo/XS/structuring_transfo/structuring.c
	(check_nodes_are_referenced, complete_node_tree_with_menus, nodes_tree)
	(new_node_menu_entry),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(insert_nodes_for_sectioning_commands): set un flags extra code,
	isindex, is_target, omit_def_name_space, not_after_command,
	invalid_syntax, command_as_argument_kbd_code, indent, noindent.

2024-06-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_utils.c (find_innermost_accent_contents):
	use a static ELEMENT_LIST for arguments and copy in the end.

	* tp/Texinfo/Convert/Utils.pm (find_innermost_accent_contents),
	tp/Texinfo/XS/main/convert_utils.c (find_innermost_accent_contents):
	check text first as accent argument and rearrange code.

	* tp/Texinfo/XS/main/convert_utils.c
	(find_root_command_next_heading_command): check text first.

2024-06-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/element_types.txt,
	tp/Texinfo/XS/main/types_data.h: add at_command flag.

	* tp/Texinfo/XS/convert/convert_html.c (convert_to_html_internal),
	tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash),
	tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal):
	do text element more separately from other elements.

	* tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash):
	use flag for condition that select types only if needed in Perl.

	* tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal):
	use types to separate classes of ignored commands.

	* tp/Texinfo/XS/parsetexi/handle_commands.c (handle_brace_command):
	put BRACE_inline in ET_brace_args_command.

2024-06-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/counter.c (counter_element_value): add.

	* tp/Texinfo/XS/parsetexi/macro.c (argument_brace_groups)
	(expand_linemacro_arguments): use an COUNTER counter instead of a
	counter in element, there are few elements, there is no issue with
	linear searching in the counter.

	* tp/Texinfo/XS/main/tree_types.h (ELEMENT): remove counter.

2024-06-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ManipulateTree.pm (_copy_tree): modify code to take into
	acocunt that there is no command name in text and be more similar with
	C code.

2024-06-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/transformations.c
	(reassociate_to_node): select elements with "element_node" before
	accessing it.

	* tp/Texinfo/XS/main/tree_types.h (CONTAINER, ELEMENT): move
	ASSOCIATED_INFO extra_info to CONTAINER now that it is never used by
	text elements.  Update code accessing this field.

2024-06-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ManipulateTree.pm (_copy_tree)
	(_remove_element_copy_info): update to be like the C implementation.
	Rename _copy_extra_info as _remove_element_copy_info.

2024-06-09  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_tree_copy.t ($tref): do have mix text elements with
	extra/contents, as it is not a valid tree, make them containers.

2024-06-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/manipulate_tree.c (copy_associated_info)
	(associate_info_references): move string, integer and misc_arg copying
	to copy_associated_info.

	* tp/Texinfo/XS/main/manipulate_tree.c (copy_tree_internal)
	(copy_associated_info, get_copy_ref): directly copy an element that has
	not been copied before and is seen in the tree.  Remove
	copy_tree_internal.  No need for counter anymore as all the elements
	are copied when needed.  Remove increase_ref_counter.

	* tp/Texinfo/XS/main/manipulate_tree.c (remove_associated_copy_info)
	(remove_element_copy_info): since there are no reference to resolve
	anymore in the second step, it is now only used to remove the
	reference to the copy element in each element in the copied tree.
	Rename associate_info_references as remove_associated_copy_info and
	copy_extra_info as remove_element_copy_info.

2024-06-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/manipulate_tree.c (copy_extra_info): remove 'new'
	argument as it can always be obtained from the element being copied.

2024-06-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/manipulate_tree.c (copy_element)
	(copy_associated_info, copy_tree_internal, associate_info_references)
	(copy_extra_info): use the element flags to mark that the copy of an
	element was done, and put the pointer to the copy in the element
	elt_info after the usual information.

2024-06-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree_types.h (ELEMENT): add a counter in element.

	* tp/Texinfo/XS/main/manipulate_tree.c (copy_tree_internal)
	(get_copy_ref, associate_info_references): use element counter instead
	of "_counter" extra information.

	* tp/Texinfo/XS/parsetexi/macro.c (expand_linemacro_arguments): use
	the element counter to count the top level matching braces.  Remove
	set_toplevel_braces_nr and count_toplevel_braces.

2024-06-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (setup_info_hv)
	(store_info_element, store_info_string, element_to_perl_hash): add
	setup_info_hv that only sets up the info hash in the Perl element.
	Remove store_info_sv and call hv_store in the functions that called
	store_info_sv before.

2024-06-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (store_info_sv)
	(store_info_element, store_info_string, element_to_perl_hash):
	pass directly a pointer on an HV * instead of a number of info added.

2024-06-08  Patrice Dumas  <pertusus@free.fr>

	Remove info_info ASSOCIATED_INFO from CONTAINER

	* tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash),
	tp/Texinfo/XS/main/debug.c (print_element_debug_details),
	tp/Texinfo/XS/main/manipulate_tree.c (copy_tree_internal)
	(copy_extra_info), tp/Texinfo/XS/main/tree.c (destroy_element),
	tp/Texinfo/XS/main/tree_types.h (CONTAINER),
	tp/Texinfo/XS/parsetexi/close.c (is_container_empty): remove
	completely the info_info ASSOCIATED_INFO information from CONTAINER
	in ELEMENT now that everything is in other data structures, mainly
	elt_info and string_info.

2024-06-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/extra.c: remove add_info_string,
	add_info_string_dup, lookup_info and lookup_info_string.

2024-06-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_to_html_internal): fix
	a condition.

	* tp/Texinfo/XS/main/build_perl_info.c (store_info_sv)
	(store_info_element, store_info_string): split store_info_sv out of
	store_info_element and add store_info_string to strore string in info.

	* tp/Texinfo/XS/convert/converter.c (table_item_content_tree),
	tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash),
	tp/Texinfo/XS/main/builtin_commands.c (element_command_name),
	tp/Texinfo/XS/main/convert_to_texinfo.c (expand_cmd_args_to_texi),
	tp/Texinfo/XS/main/manipulate_tree.c (copy_tree_internal),
	tp/Texinfo/XS/main/tree.c (new_element, new_command_element)
	(destroy_element), tp/Texinfo/XS/parsetexi/close.c
	(close_brace_command), tp/Texinfo/XS/parsetexi/end_line.c
	(end_line_misc_line), tp/Texinfo/XS/parsetexi/handle_commands.c
	(handle_line_command, handle_brace_command),
	tp/Texinfo/XS/parsetexi/macro.c (parse_macro_command_line)
	(handle_macro), tp/Texinfo/XS/parsetexi/parser.c
	(process_remaining_on_line), tp/Texinfo/XS/parsetexi/separator.c
	(handle_open_brace): remove "delimiter", "alias_of" and "command_name"
	info string from the info structure and add them to the string_info
	array.

2024-06-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/handle_commands.c (parse_rawline_command)
	(handle_line_command): return an ELEMENT_LIST from
	parse_rawline_command.

2024-06-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/handle_commands.c (parse_rawline_command)
	(handle_line_command): set rawline command text type to ET_rawline_arg
	directly in parse_rawline_command.

	* tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command):
	create a raw line command only if not ignored.

	* tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command):
	set ET_def_line type early, when calling new_element.

2024-06-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/def.c (gather_def_item): check first if
	there is content for a def item before creating the element.

2024-06-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (%container_ignored_if_empty)
	(_convert), tp/Texinfo/Convert/LaTeX.pm (%container_ignored_if_empty)
	(_convert), tp/Texinfo/Convert/TexinfoMarkup.pm
	(%container_ignored_if_empty, _convert): ignore explicitly some
	empty containers instead of relying on the tree to be without those
	empty containers.

	* tp/Texinfo/ParserNonXS.pm (_close_container),
	tp/Texinfo/XS/parsetexi/close.c (close_container): keep the original
	element type when an element is kept for the source marks.

	* tp/Texinfo/XS/convert/converter.c (table_item_content_tree): do not
	reset the type it is already set.

	* tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line): set
	ET_index_entry_command type when creating the element.

2024-09-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_command_description),
	tp/Texinfo/XS/structuring_transfo/structuring.c (new_node_menu_entry):
	use the union e name.

2024-06-08  Patrice Dumas  <pertusus@free.fr>

	Do not use unnamed union for ELEMENT

	* tp/Texinfo/XS/main/tree_types.h (ELEMENT): rename the union as e.
	Update codes using the corresponding union fields.

2024-06-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/element_types.txt,
	tp/Texinfo/XS/main/types_data.h: add macro_call type flag.

	* tp/Texinfo/XS/main/tree_types.h (CONTAINER): move string_info to
	CONTAINER.

	* tp/Texinfo/XS/main/tree_types.h (enum string_info_type): add
	sit_command_name.

2024-06-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/manipulate_tree.c (copy_tree_internal),
	tp/Texinfo/XS/structuring_transfo/transformations.c (correct_level)
	(protect_hashchar_at_line_beginning_internal): use new_command_element
	to create a new command element.  Set correctly types of new command
	elements.

2024-06-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (is_end_current_command): pass
	directly an enum command_id as argument.  Update callers.

	* tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): remove
	top_stack_raw_element.

2024-06-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (new_command_element_added)
	(table_item_content_tree): add new_command_element_added and use it in
	table_item_content_tree.

2024-06-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_handle_brace_command),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_brace_command): have
	definfoenclose always takes precedence.  Rearrange code.

2024-06-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/extra.c: remove add_info_element_oot,
	add_info_integer, lookup_info_integer and lookup_info_element.

2024-06-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree.c (destroy_element_and_children): fix
	condition (found with valgrind).

2024-06-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash),
	tp/Texinfo/XS/main/convert_to_texinfo.c (convert_to_texinfo_internal),
	tp/Texinfo/XS/main/tree_types.h (enum elt_info_type),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command),
	tp/Texinfo/XS/parsetexi/parser.c (isolate_last_space_internal),
	tp/Texinfo/XS/structuring_transfo/structuring.c (new_block_command),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(fill_gaps_in_sectioning, new_node): put spaces_after_argument in
	elt_info.

2024-06-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_handle_macro),
	tp/Texinfo/XS/main/element_types.txt, tp/Texinfo/XS/parsetexi/macro.c
	(handle_macro): set macro_call_line or rmacro_call_line as type for
	macro call argument when there are no braces and the whole line is the
	argument.

	* tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash),
	tp/Texinfo/XS/main/convert_to_texinfo.c (expand_cmd_args_to_texi)
	(convert_to_texinfo_internal),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command),
	tp/Texinfo/XS/parsetexi/macro.c (expand_macro_arguments)
	(expand_linemacro_arguments), tp/Texinfo/XS/parsetexi/parser.c
	(abort_empty_line), tp/Texinfo/XS/structuring_transfo/structuring.c
	(new_block_command),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(fill_gaps_in_sectioning, new_node): put spaces_before_argument in
	elt_info.

2024-06-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/element_types.awk,
	tp/Texinfo/XS/main/element_types.txt, tp/Texinfo/XS/main/tree_types.h
	(enum elt_info_type), tp/Texinfo/XS/main/types_data.h: add
	spaces_before and spaces_after flags.  Rearrange indices of element in
	elt_info.

	* tp/Texinfo/XS/structuring_transfo/transformations.c
	(fill_gaps_in_sectioning): add the correct types to the created
	command elements.

	* tp/Texinfo/XS/main/convert_to_texinfo.c (expand_cmd_args_to_texi)
	(convert_to_texinfo_internal): expand spaces_before_argument only in
	elements which can have the info.

2024-06-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_expand_macro_arguments),
	tp/Texinfo/XS/parsetexi/macro.c (expand_macro_arguments): associate
	spaces_before_argument with brace argument, not with command call.

	* tp/Texinfo/ParserNonXS.pm (_expand_linemacro_arguments),
	tp/Texinfo/XS/parsetexi/macro.c (expand_linemacro_arguments): set
	argument type to line_arg.  Put first spaces_before_argument in
	linemacro_call, similar to other line commands.

2024-06-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/element_types.awk,
	tp/Texinfo/XS/main/element_types.txt, tp/Texinfo/XS/main/tree_types.h:
	add braces type flag, use it in element_types.awk.

	* tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash),
	tp/Texinfo/XS/main/convert_to_texinfo.c (expand_cmd_args_to_texi),
	tp/Texinfo/XS/parsetexi/macro.c (handle_macro),
	tp/Texinfo/XS/parsetexi/parser.c (gather_spaces_after_cmd_before_arg)
	(new_value_element): put spaces_after_cmd_before_arg in elt_info
	instead of info.

2024-06-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/element_types.awk: block_line_arg and line_arg
	hold spaces_after_cmd_before_arg and comment_at_end, not the commands.

	* tp/Texinfo/XS/main/build_perl_info.c (store_info_element)
	(element_to_perl_hash), tp/Texinfo/XS/main/convert_to_texinfo.c
	(convert_to_texinfo_internal), tp/Texinfo/XS/main/manipulate_tree.c
	(copy_element, copy_associated_info, copy_tree_internal)
	(copy_extra_info), tp/Texinfo/XS/main/tree.c (new_element)
	(destroy_element), tp/Texinfo/XS/main/tree_types.h
	(enum elt_info_type), tp/Texinfo/XS/parsetexi/parser.c
	(isolate_last_space),
	tp/Texinfo/XS/structuring_transfo/transformations.c (new_node):
	initialize, free, copy elt_info list of elements meant to replace
	the elements in info.  Put comment_at_end in that list instead of
	in the info structure and pass it to Perl.

	* tp/Texinfo/XS/main/tree_types.h (enum string_info_type, ELEMENT):
	prepare string information in element to replace information in info.

2024-06-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree.c (destroy_associated_info): use k_pair
	variable.

2024-06-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_brace_command):
	add brace_args_command type for BRACE_arguments in C.

	* tp/Texinfo/XS/main/builtin_commands.h (COMMAND),
	tp/Texinfo/XS/main/command_data.awk,
	tp/Texinfo/XS/main/element_types.awk: set elt_info_number in
	element_types.awk only.

2024-06-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (process_footnotes): rename
	variables and fields.

	* tp/Texinfo/Convert/LaTeX.pm (_convert), tp/Texinfo/Convert/Info.pm
	(format_image), tp/Texinfo/Convert/Plaintext.pm (process_footnotes)
	(format_image, _convert), tp/Texinfo/Convert/Text.pm (_convert),
	tp/Texinfo/XS/convert/convert_html.c (convert_image_command): check
	that extra, info, args and args_formatted exist before accessing
	them.

	* tp/Makefile.tres, tp/t/converters_tests.t
	(various_itemize_command_as_argument): add test of various brace
	commands, without braces, as @itemize argument.

2024-06-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_starting_block): check
	that the command_as_argument on @itemize line is alone without
	modifying an array, by looping over the contents as in C.

	* tp/Texinfo/ParserNonXS.pm (_end_line_starting_block),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block): simplify
	the code checking that the command as arg is brace noarg or has
	braces.

	* tp/Texinfo/ParserNonXS.pm (_handle_close_brace): simplify condition
	on args and contents.

2024-06-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (table_item_content_tree): determine
	the command name usable as Texinfo::Commands key by using the
	generic definfoenclose one if the type is definfoenclose.  Similar to
	using element_builtin_cmd in C.

2024-06-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (begin_paragraph_p): select types
	that could contain paragraphs only.  Improve documentation of the
	code by listing the types that are avoided.

2024-06-03  Patrice Dumas  <pertusus@free.fr>

	Rename brace_command_container type as brace_arg

2024-09-28  Patrice Dumas  <pertusus@free.fr>

	Update test results

2024-06-03  Patrice Dumas  <pertusus@free.fr>

	Rename brace_command_arg type as brace_container

2024-06-03  Patrice Dumas  <pertusus@free.fr>

	Remove command_as_argument element type

	* tp/Texinfo/Convert/Text.pm (_convert): fix parentheses of brace
	command argument type test.

	* tp/Texinfo/Convert/LaTeX.pm (_convert): determine if a command as
	argument is the default for itemize by checking the parents and not
	the type.

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): determine that the
	command_as_argument element by comparing with the itemize parent extra
	value instead of using the type.

	* tp/Texinfo/Convert/Converter.pm (table_item_content_tree),
	tp/Texinfo/Convert/Texinfo.pm (_convert_to_texinfo)
	(_expand_cmd_args_to_texi): check that type is set before accessing
	and do not access type if not needed.

	* tp/Texinfo/ParserNonXS.pm (_end_line_starting_block)
	(_register_command_as_argument), tp/Texinfo/XS/main/build_perl_info.c
	(element_to_perl_hash), tp/Texinfo/XS/parsetexi/end_line.c
	(end_line_starting_block), tp/Texinfo/XS/parsetexi/parser.c
	(register_command_as_argument): do not set a special type for the
	command_as_argument, and do not set a flag in C.

2024-06-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash),
	tp/Texinfo/XS/main/element_types.txt, tp/Texinfo/XS/parsetexi/parser.c
	(begin_paragraph_p): add more types for commands.

	* tp/Texinfo/XS/main/tree.c (new_command_element): new function to add
	a command element, for clearer code.

	* tp/Texinfo/XS/structuring_transfo/structuring.c (new_block_command)
	(new_complete_node_menu, new_detailmenu),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(complete_node_menu): pass only an element to new_block_command, the
	caller should have called new_command_element already to set the
	command.

	* tp/Texinfo/XS/convert/convert_html.c (convert_float_command)
	(convert_printindex_command, html_convert_output),
	tp/Texinfo/XS/convert/converter.c (table_item_content_tree),
	tp/Texinfo/XS/main/convert_utils.c (expand_verbatiminclude)
	(definition_category_tree), tp/Texinfo/XS/main/manipulate_tree.c
	(new_asis_command_with_text, protect_text),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_other_command)
	(handle_line_command, handle_block_command, handle_brace_command),
	tp/Texinfo/XS/parsetexi/macro.c (parse_macro_command_line),
	tp/Texinfo/XS/parsetexi/parser.c (new_value_element)
	(process_remaining_on_line),
	tp/Texinfo/XS/structuring_transfo/structuring.c (new_block_command),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(fill_gaps_in_sectioning, new_node) : set command elements types, use
	new_command_element.
	
	* tp/Texinfo/XS/convert/convert_html.c (convert_printindex_command):
	call directly new_element with the correct type instead of modifying
	afterwards.

2024-06-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree.c: remove completly spare_element, to avoid
	the complexity. Also elements are now more reused.

2024-06-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash),
	tp/Texinfo/XS/main/convert_to_texinfo.c (expand_cmd_args_to_texi)
	(convert_to_texinfo_internal), tp/Texinfo/XS/main/manipulate_tree.c
	(copy_tree_internal), tp/Texinfo/XS/main/tree_types.h (ELEMENT),
	tp/Texinfo/XS/parsetexi/def.c (parse_def): replace inserted field by
	flags and add a corresponding flag.

	* tp/Texinfo/XS/convert/converter.c (table_item_content_tree),
	tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block),
	tp/Texinfo/XS/parsetexi/parser.c (register_command_as_argument): put
	command_as_argument as a flag.

	* tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash),
	tp/Texinfo/XS/main/element_types.txt,
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command)
	(handle_brace_command), tp/Texinfo/XS/parsetexi/macro.c
	(parse_macro_command_line, handle_macro),
	tp/Texinfo/XS/parsetexi/parser.c (begin_paragraph_p)
	(new_value_element, process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/separator.c (handle_open_brace): add types for
	@-commands in C.

2024-06-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/builtin_commands.h (COMMAND),
	tp/Texinfo/XS/main/command_data.awk,
	tp/Texinfo/XS/main/element_types.awk, tp/Texinfo/XS/main/tree_types.h
	(ELEMENT), tp/Texinfo/XS/main/types_data.h (TYPE_DATA): prepare
	information on the number of elements needed to have the info_info
	associated info elements information.

2024-06-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_to_html_internal): do
	not call element_command_name for text elements.

	* tp/Texinfo/XS/main/manipulate_tree.c (copy_extra_info),
	tp/Texinfo/XS/main/tree.c (destroy_element),
	tp/Texinfo/XS/main/tree_types.h (CONTAINER, ELEMENT): move info_info
	to CONTAINER, as it is not used in text elements anymore.

	* tp/Texinfo/XS/main/build_perl_info.c, tp/Texinfo/XS/main/debug.c,
	tp/Texinfo/XS/main/extra.c, tp/Texinfo/XS/parsetexi/close.c: update to
	use info_info in CONTAINER and not directly in ELEMENT.

2024-06-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (store_additional_info)
	(element_to_perl_hash): pass the number of information to
	store_additional_info, and if some information is already set reuse
	the HV.

	* tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash),
	tp/Texinfo/XS/main/convert_to_texinfo.c (expand_cmd_args_to_texi)
	(convert_to_texinfo_internal), tp/Texinfo/XS/main/manipulate_tree.c
	(copy_tree_internal), tp/Texinfo/XS/main/tree_types.h (ELEMENT),
	tp/Texinfo/XS/parsetexi/def.c (parse_def),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block): set
	inserted directly in the ELEMENT structure instead of in the info
	additional information.

2024-06-01  Patrice Dumas  <pertusus@free.fr>

	Type brace_command_container for brace_command_arg without spaces

	* tp/Texinfo/Convert/Converter.pm (table_item_content_tree),
	tp/Texinfo/Convert/NodeNameNormalization.pm (_convert),
	tp/Texinfo/Convert/Plaintext.pm (_convert),
	tp/Texinfo/Convert/Texinfo.pm (_expand_cmd_args_to_texi),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/Convert/Text.pm b/tp/Texinfo/Convert/Text.pm (_convert),
	tp/Texinfo/ParserNonXS.pm (_print_command_args_texi)
	(_expand_macro_arguments, _isolate_last_space, _handle_open_brace),
	tp/Texinfo/XS/convert/converter.c (table_item_content_tree),
	tp/Texinfo/XS/main/convert_to_texinfo.c (expand_cmd_args_to_texi),
	tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal),
	tp/Texinfo/XS/main/element_types.txt,
	tp/Texinfo/XS/main/node_name_normalization.c
	(convert_to_normalized_internal), tp/Texinfo/XS/parsetexi/end_line.c
	(end_line_starting_block), tp/Texinfo/XS/parsetexi/macro.c
	(expand_macro_arguments), tp/Texinfo/XS/parsetexi/parser.c
	(isolate_last_space), tp/Texinfo/XS/parsetexi/separator.c
	(handle_open_brace): use a different container for brace commands args
	if the brace command is of the arguments type and the spaces are in
	the info data of the brace commands args, called
	brace_command_container.

2024-06-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/def.c (parse_def),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line): use directly
	the definition line arguments to determine the class/category/name for
	the index entry.  Remove the returned information from parse_def.

	* tp/Texinfo/XS/parsetexi/separator.c (handle_open_brace): remove an
	impossible condition, as the linemacro call bracketed type is a
	different type now.

	* tp/Texinfo/XS/parsetexi/def.c (split_def_args): remove a redundant
	condition.

2024-06-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/element_types.txt: remove unused
	space_command_arg.  Reorder.

2024-06-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (%all_commands), tp/Texinfo/command_data.txt:
	as the internal commands also are in another category, they need to
	have a data field that can be compared to the category.  The internal
	commands therefore need to be removed explicitly from the %all_commands
	hash.

	* tp/Texinfo/XS/convert/convert_html.c (convert_to_html_internal):
	consider that an element with both a type and a command to be ignored
	if it is ignored both as a type element and as a command element.

2024-06-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/transformations.c: add const.

2024-06-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (present_bug_message): add an end of
	line at the end of the additional_information, to avoid addition of
	the location of the error in present_bug_message.

2024-09-28  Patrice Dumas  <pertusus@free.fr>

	Update test result

2024-06-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (table_item_content_tree),
	tp/Texinfo/XS/convert/converter.c (table_item_content_tree): if the
	command_as_argument is a context brace command, such as @math or
	@footnote, corresponding to an arguably bogus @*table line, as @*table
	argument should only be indicatric commands, setup expected trees for
	these @-commands, to avoid debug messages/converter crashes.

	* tp/t/03coverage_braces.t (one_argument_leading_trailing_spaces): add
	noarg brace commands to the test.

	* tp/Makefile.tres, tp/t/converters_tests.t
	(various_vtable_command_as_argument): text with various non indicatric
	brace @-commands as @vtable argument.

2024-06-01  Patrice Dumas  <pertusus@free.fr>

	* tp/t/03coverage_braces.t (one_argument_leading_trailing_spaces): add
	accent commands to the test.

2024-05-31  Patrice Dumas  <pertusus@free.fr>

	Separate memory use in ELEMENT between text elements and other elements

	* tp/Texinfo/XS/main/tree_types.h (ELEMENT): make a union for TEXT and
	CONTAINER.

2024-09-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_command_description)
	(html_default_format_single_footnote),
	tp/Texinfo/XS/structuring_transfo/structuring.c (new_node_menu_entry):
	add missing ELEMENT c union.

2024-05-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/manipulate_tree.c (copy_extra_info)
	(modify_tree), tp/Texinfo/XS/main/translations.c
	(substitute_element_array), tp/Texinfo/XS/main/tree.c
	(destroy_element_and_children): do not recurse if in a text element.

	* tp/Texinfo/XS/parsetexi/macro.c (expand_macro_arguments): create
	ET_brace_command_arg element with new_element as it is not a text
	element.

	* tp/Texinfo/XS/structuring_transfo/transformations.c
	(insert_nodes_for_sectioning_commands): new_node_tree is not text, set
	it to ET_NONE and create with new_element.

	* tp/Texinfo/XS/main/tree.c (new_element, destroy_element),
	tp/Texinfo/XS/main/tree_types.h (CONTAINER, ELEMENT): add a CONTAINER
	structure for the information only relevant in container elements, and
	not in text elements.  Remove from the ELEMENT and replace by a
	pointer to the CONTAINER structure.

	* tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/convert/converter.c,
	tp/Texinfo/XS/main/build_perl_info.c,
	tp/Texinfo/XS/main/convert_to_texinfo.c,
	tp/Texinfo/XS/main/convert_to_text.c,
	tp/Texinfo/XS/main/convert_utils.c, tp/Texinfo/XS/main/debug.c,
	tp/Texinfo/XS/main/errors.c, tp/Texinfo/XS/main/floats.c,
	tp/Texinfo/XS/main/get_perl_info.c,
	tp/Texinfo/XS/main/manipulate_indices.c,
	tp/Texinfo/XS/main/manipulate_tree.c,
	tp/Texinfo/XS/main/node_name_normalization.c,
	tp/Texinfo/XS/main/output_unit.c, tp/Texinfo/XS/main/targets.c,
	tp/Texinfo/XS/main/translations.c, tp/Texinfo/XS/main/tree.c,
	tp/Texinfo/XS/main/utils.c, tp/Texinfo/XS/parsetexi/debug_parser.c,
	tp/Texinfo/XS/parsetexi/def.c, tp/Texinfo/XS/parsetexi/end_line.c,
	tp/Texinfo/XS/parsetexi/errors_parser.c,
	tp/Texinfo/XS/parsetexi/handle_commands.c,
	tp/Texinfo/XS/parsetexi/indices.c, tp/Texinfo/XS/parsetexi/labels.c,
	tp/Texinfo/XS/parsetexi/macro.c, tp/Texinfo/XS/parsetexi/menus.c,
	tp/Texinfo/XS/parsetexi/multitable.c,
	tp/Texinfo/XS/parsetexi/parser.c,
	tp/Texinfo/XS/parsetexi/source_marks.c,
	tp/Texinfo/XS/structuring_transfo/structuring.c,
	tp/Texinfo/XS/structuring_transfo/transformations.c: update for the
	change in ELEMENT by adding a ->c indirection to the container field.

2024-05-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_handle_close_brace),
	tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace): if the
	argument of @errormsg is not text, still give an empty string as error
	message.

	* tp/Texinfo/XS/parsetexi/end_line.c (parse_line_command_args): check
	if the argument is text before accessing the text length.

	* tp/Texinfo/XS/main/tree.c (new_text_element, destroy_element),
	tp/Texinfo/XS/main/tree_types.h (ELEMENT): setup the text field in
	ELEMENT to be a pointer, such as to be able later on to have it in an
	union along with another structure pointer for other elements.

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line): check that
	the element type is text before accessing the text.

	* tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/convert/converter.c,
	tp/Texinfo/XS/main/build_perl_info.c,
	tp/Texinfo/XS/main/convert_to_texinfo.c,
	tp/Texinfo/XS/main/convert_to_text.c,
	tp/Texinfo/XS/main/manipulate_indices.c,
	tp/Texinfo/XS/main/manipulate_tree.c,
	tp/Texinfo/XS/main/node_name_normalization.c,
	tp/Texinfo/XS/main/translations.c, tp/Texinfo/XS/main/utils.c,
	p/Texinfo/XS/parsetexi/close.c,
	tp/Texinfo/XS/parsetexi/debug_parser.c, tp/Texinfo/XS/parsetexi/def.c,
	tp/Texinfo/XS/parsetexi/end_line.c,
	tp/Texinfo/XS/parsetexi/handle_commands.c,
	tp/Texinfo/XS/parsetexi/indices.c, tp/Texinfo/XS/parsetexi/macro.c,
	tp/Texinfo/XS/parsetexi/menus.c, tp/Texinfo/XS/parsetexi/parser.c,
	tp/Texinfo/XS/parsetexi/separator.c,
	tp/Texinfo/XS/parsetexi/source_marks.c,
	tp/Texinfo/XS/structuring_transfo/structuring.c,
	tp/Texinfo/XS/structuring_transfo/transformations.c: update for change
	in ELEMENT text.

2024-05-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (new_text_element_added),
	tp/Texinfo/XS/main/tree.c (new_text_element): add a new function to
	setup a text element, to prepare for a different initialization and
	different struct union field use.  Update calls.

2024-05-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/element_types.awk,
	tp/Texinfo/XS/main/types_data.h (TYPE_DATA): rename TYPE type as
	TYPE_DATA.

	* tp/Texinfo/XS/main/element_types.awk, tp/Texinfo/XS/Makefile.am
	(libtexinfo_la_SOURCES): generate types data in element_types.c
	instead of in types_data.c.  Remove main/types_data.c and
	element_type_names.

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_types_conversion, call_types_open),
	tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/build_perl_info.c
	(element_to_perl_hash), tp/Texinfo/XS/main/builtin_commands.c
	(set_element_type_name_info), tp/Texinfo/XS/main/debug.c
	(print_element_debug), tp/Texinfo/XS/parsetexi/close.c
	(close_current), tp/Texinfo/XS/parsetexi/handle_commands.c
	(handle_block_command), tp/Texinfo/XS/parsetexi/parser.c (merge_text)
	(abort_empty_line): use type_data[type].name instead of
	element_type_names[type].

2024-09-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/extra.c (lookup_extra_misc_args),
	tp/Texinfo/XS/main/manipulate_tree.c (associate_info_references),
	tp/Texinfo/XS/main/tree.c (destroy_associated_info): add missing
	KEY_PAIR union name k.

	Reorder ChangeLog to correspond to commits order.

2024-05-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_sp_command)
	(convert_tab_command, convert_printindex_command),
	tp/Texinfo/XS/main/build_perl_info.c (build_additional_info),
	tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal),
	tp/Texinfo/XS/main/debug.c (print_associate_info_debug),
	tp/Texinfo/XS/main/extra.c (add_extra_misc_args)
	(lookup_extra_misc_args), tp/Texinfo/XS/main/manipulate_tree.c
	(associate_info_references), tp/Texinfo/XS/main/tree.c
	(destroy_associated_info), tp/Texinfo/XS/main/utils.c
	(informative_command_value), tp/Texinfo/XS/parsetexi/end_line.c
	(parse_line_command_args, end_line_starting_block)
	(end_line_misc_line), tp/Texinfo/XS/parsetexi/handle_commands.c
	(handle_line_command), tp/Texinfo/XS/parsetexi/indices.c
	(enter_index_entry),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(lookup_index_entry, relate_index_entries_to_table_items_in):
	use an ELEMENT_LIST for extra_misc_args.  Add lookup_extra_misc_args.

2024-05-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/indices.c (enter_index_entry),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(relate_index_entries_to_table_items_in): set type as ET_other_text
	instead of ET_NONE.

	* tp/Texinfo/XS/main/build_perl_info.c (build_additional_info),
	tp/Texinfo/XS/main/debug.c (print_associate_info_debug),
	tp/Texinfo/XS/main/manipulate_tree.c (associate_info_references):
	always use text element with type ET_other_text in extra_misc_args.
	Use the type to determine if the element represents text or an
	integer.

2024-05-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/debug.c (print_element_debug): text element never
	have contents nor arg, nor command.

	* tp/Texinfo/XS/convert/convert_html.c (convert_to_html_internal),
	tp/Texinfo/XS/main/convert_to_texinfo.c (convert_to_texinfo_internal),
	tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal),
	tp/Texinfo/XS/main/debug.c (print_element_debug),
	tp/Texinfo/XS/main/manipulate_tree.c (copy_tree_internal)
	(relocate_source_marks, protect_text),
	tp/Texinfo/XS/main/node_name_normalization.c
	(convert_to_normalized_internal), tp/Texinfo/XS/main/utils.c
	(is_content_empty),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(protect_hashchar_at_line_beginning_internal): use type flags to
	determine if an element is a text element.

2024-05-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/element_types.txt: add more text flags for text
	elements.

	* tp/Texinfo/XS/main/manipulate_tree.c (copy_tree_internal): text
	elements may have inserted info set, so copy info.

	* tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash):
	reorganize to take into account that text element do not args nor
	contents nor extras.

	* tp/Texinfo/XS/parsetexi/parser.c (isolate_trailing_space)
	(isolate_last_space, process_remaining_on_line): pass last contents
	element as isolate_trailing_space argument.

	* tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash),
	tp/Texinfo/XS/parsetexi/parser.c (check_space_element)
	(text_contents_to_plain_text, merge_text, isolate_trailing_space),
	(process_remaining_on_line), tp/Texinfo/XS/parsetexi/source_marks.c
	(place_source_mark): use type flags to determine if an element
	is a text element.

2024-05-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/element_types.awk: order correctly the types.

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES): add
	main/types_data.c as a normal built source file.

	* tp/Texinfo/XS/convert/converter.c (float_type_number, float_name_caption)
	(comma_index_subentries_tree, free_comma_index_subentries_tree),
	tp/Texinfo/XS/main/convert_utils.c (definition_category_tree): set
	ET_normal_text as type for normal text instead of ET_NONE.

	* tp/Texinfo/Common.pm (debug_print_element),
	tp/Texinfo/XS/parsetexi/debug_parser.c (print_element_debug_parser):
	text element never have contents nor arg, nor command.

	* tp/Texinfo/XS/main/element_types.txt,
	tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash): add
	other_text type to detect text not in regular converted tree elements.

	* tp/Texinfo/XS/parsetexi/end_line.c (parse_line_command_args),
	tp/Texinfo/XS/parsetexi/handle_commands.c (parse_rawline_command)
	(handle_line_command), tp/Texinfo/XS/parsetexi/macro.c
	(expand_macro_arguments, expand_linemacro_arguments, handle_macro),
	tp/Texinfo/XS/parsetexi/parser.c (abort_empty_line)
	(isolate_last_space_internal, gather_spaces_after_cmd_before_arg)
	(process_remaining_on_line),
	tp/Texinfo/XS/structuring_transfo/structuring.c (new_block_command),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(fill_gaps_in_sectioning): set type as ET_other_text instead of ET_NONE.

	* tp/Texinfo/XS/main/types_data.h (TYPE): rename type_name field as
	name.

	* tp/Texinfo/XS/parsetexi/close.c (is_container_empty),
	tp/Texinfo/XS/parsetexi/debug_parser.c (print_element_debug_parser):
	use type flags to determine if an element is a text element.

2024-05-31  Patrice Dumas  <pertusus@free.fr>

	Add data structure for information on types in C

	* tp/Texinfo/XS/main/types_data.h (TYPES), tp/Texinfo/XS/Makefile.am
	(BUILT_SOURCES, libtexinfo_la_SOURCES, EXTRA_DIST),
	tp/Texinfo/XS/main/element_types.awk,
	tp/Texinfo/XS/main/element_types.txt: add code in element_types.awk to
	setup a TYPE structure for information on types, similar to the
	COMMAND data, but with flags only.  Add flags information in
	element_types.txt, to mark text elements.  Generate the structure
	array with information on all the types in main/types_data.c.

2024-05-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/command_data.awk (END): initialize flags_str and
	other_flags_str for each command.

2024-05-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (check_space_element): fix
	conditional to detect better space elements.

	* tp/Texinfo/XS/convert/convert_html.c (html_internal_command_tree)
	(html_external_command_tree, html_default_format_program_string)
	(convert_value_command, convert_printindex_command),
	tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal),
	tp/Texinfo/XS/main/convert_utils.c (expand_today),
	tp/Texinfo/XS/main/manipulate_tree.c (parse_node_manual),
	tp/Texinfo/XS/parsetexi/parser.c (new_value_element),
	tp/Texinfo/XS/structuring_transfo/structuring.c (new_block_command)
	(new_node_menu_entry, new_detailmenu),
	tp/Texinfo/XS/structuring_transfo/transformations.c (new_node)
	(insert_nodes_for_sectioning_commands)
	(protect_hashchar_at_line_beginning_internal): set ET_normal_text as
	type for normal text instead of ET_NONE.

	* tp/Texinfo/XS/convert/convert_html.c (convert_menu_entry_type),
	tp/Texinfo/XS/main/manipulate_indices.c (idx_leading_text_or_command),
	tp/Texinfo/XS/main/manipulate_tree.c (parse_node_manual),
	tp/Texinfo/XS/main/utils.c (informative_command_value),
	tp/Texinfo/XS/parsetexi/handle_commands.c (check_no_text),
	tp/Texinfo/XS/parsetexi/menus.c (end_line_menu_entry),
	tp/Texinfo/XS/parsetexi/separator.c (handle_comma),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(protect_first_parenthesis, new_node): use
	type ET_normal_text to determine that an element is text instead of
	element text.space or text.end.

	* tp/Texinfo/XS/parsetexi/menus.c (end_line_menu_entry): use types
	ET_menu_entry_leading_text and ET_menu_entry_separator to determine
	that an element is text in menu entry.

	* tp/Texinfo/XS/main/manipulate_tree.c (copy_tree_internal): rearrange
	code and exit sooner if the element is a text element as there are
	no additional information nor contents nor args.

	* tp/Texinfo/XS/main/convert_utils.c
	(find_root_command_next_heading_command): add a bug message if normal
	text appears directly in top level (should be in a paragraph).

2024-09-28  Gavin Smith <gavinsmith0123@gmail.com>

	Tweak config paths for Info

	* info/infomap.c (locate_init_file):
	Check ~/.infokey before checking XDG_CONFIG_HOME,
	simililar to how GNU Emacs does it.   Do not use /etc/xdg as
	a default for XDG_CONFIG_DIRS.  Check in $sysconfdir/xdg/texinfo
	before XDG_CONFIG_DIRS, as with recent changes to texi2any.
	* info/Makefile.am (AM_CPPFLAGS): propagate sysconfdir

	* NEWS, doc/info-stnd.texi (Custom Key Bindings): update.

2024-05-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_split_delimiters): remove undefined
	warnings.

	* tp/Texinfo/ParserNonXS.pm (_end_line_menu_entry): update code now
	that contents are removed if empty.

2024-05-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_split_delimiters),
	tp/Texinfo/XS/parsetexi/def.c (split_delimiters): more readable check
	of already split elements.

	* tp/Texinfo/XS/parsetexi/close.c (close_current),
	tp/Texinfo/XS/parsetexi/def.c (split_delimiters, split_def_args)
	(parse_def), tp/Texinfo/XS/parsetexi/handle_commands.c
	(handle_line_command), tp/Texinfo/XS/parsetexi/indices.c
	(set_non_ignored_space_in_index_before_command, complete_indices),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): use
	ET_normal_text for normal text instead of ET_NONE.  Mark special texts
	with a comment.

	* tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command):
	for raw line arguments parsing, reuse the elements in args instead of
	allocating new ones.

	* tp/Texinfo/XS/parsetexi/def.c (split_delimiters, split_def_args),
	tp/Texinfo/XS/parsetexi/end_line.c (parse_line_command_args)
	(end_line_starting_block), :
	use type to determine if an element is a text element when possible.

2024-05-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_merge_text),
	tp/Texinfo/XS/parsetexi/parser.c (merge_text): rename last_child as
	last_element.  Set last_element in _merge_text to check type.

	* tp/Texinfo/ParserNonXS.pm (_merge_text, _abort_empty_line),
	tp/Texinfo/XS/parsetexi/parser.c (merge_text, abort_empty_line): add
	the leading empty text in merge_text instead of abort_empty_line, to
	clarify the code.  Update abort_empty_line callers in C.

2024-05-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (%parser_document_state_initialization)
	(_abort_empty_line, _start_empty_line_after_command, _handle_macro)
	(_handle_open_brace, _handle_comma): instead of putting the command
	associated to internal spaces in the extra information of the space,
	put it in the state as internal_space_holder.  Add the parser as
	_start_empty_line_after_command argument, update callers.
	Also reuse the internal space as the info spaces_before_argument
	of the command associated with the internal space in _abort_empty_line.

	* tp/Texinfo/ParserNonXS.pm (_isolate_last_space),
	tp/Texinfo/XS/parsetexi/parser.c (isolate_last_space): always isolate the
	last space independentely of its type and type of the current
	container.

	* tp/Texinfo/ParserNonXS.pm (_isolate_last_space),
	tp/Texinfo/XS/parsetexi/parser.c (isolate_last_space_internal): reuse
	the internal space as the info spaces_after_argument.

	* tp/Texinfo/XS/parsetexi/parser.c (begin_paragraph, merge_text):
	return 0 if the paragraph was not started.  Shortcut the code merging
	text if a paragraph was started in merge_text.

	* tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash),
	tp/Texinfo/XS/main/element_types.txt,
	tp/Texinfo/XS/parsetexi/menus.c (handle_menu_entry_separators),
	tp/Texinfo/XS/parsetexi/parser.c (merge_text, abort_empty_line),
	tp/Texinfo/XS/parsetexi/separator.c (handle_open_brace),
	tp/Texinfo/XS/parsetexi/source_marks.c (place_source_mark): add a text
	type, normal_text, used internally in XS parser for regular text,
	instead of using ET_NONE.

	* tp/Texinfo/XS/parsetexi/parser.c (isolate_last_space_internal): do
	not use an intermediate TEXT, directly set the new element text.  Add
	last_elt as argument to isolate_last_space_internal.

2024-09-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_converter_perl_info.c: add missing
	#include.

2024-05-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/converter_types.h (TARGET_FILENAME)
	(enum command_location), tp/Texinfo/XS/main/utils.h: move
	TARGET_FILENAME and enum command_location to converter_types.h.

	* tp/Texinfo/XS/main/convert_utils.h,
	tp/Texinfo/XS/main/manipulate_indices.h: avoid dependencies on other
	header files defining also functions by using struct instead of types.

	Update includes.  Order includes by starting from the most generic.

2024-09-28  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Loading Init Files), doc/texinfo.texi (HTML
	Xref Configuration), tp/texi2any.pl (add_config_paths)
	(set_subdir_directories): search in $sysconfdir/xdg before
	XDG_CONFIG_DIRS.  Do not search in XDG_DATA_DIRS.  Agreement on Gavin
	report.

2024-09-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_formatted_nodedescription_nr)
	(_convert_menu_entry_type): add _formatted_nodedescription_nr based on
	_convert_menu_entry_type code.

	* tp/Texinfo/Convert/HTML.pm (command_description, _translate_names)
	(_file_header_information), tp/Texinfo/XS/convert/convert_html.c
	(html_command_description, file_header_information)
	(reset_html_targets_list, html_translate_names),
	tp/Texinfo/XS/main/converter_types.h (HTML_TARGET): add
	command_description to get the description associated to a node or
	sectioning command node.  Use it to set description if there is no
	documentdescription (and to set keywords).  Inspired by Benjamin
	Kalish report.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_command_description): XS
	override for html_command_description.

	* tp/Makefile.tres, tp/t/html_tests.t
	($nodedescription_description_texinfo)
	(nodedescription_description)
	(nodedescription_description_no_use_nodes): test nodedescription used
	as meta description.

2024-09-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_file_header_information)
	(_default_format_begin_file, _default_format_node_redirection_page),
	tp/Texinfo/XS/convert/convert_html.c (BEGIN_FILE_INFORMATION)
	(destroy_begin_file_information, file_header_information)
	(html_default_format_begin_file)
	(html_default_format_node_redirection_page): add keywords to
	file_header_information returned information.

2024-09-25  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Loading Init Files), doc/texinfo.texi (HTML
	Xref Configuration): hint that we do not follow strictly the XDG Base
	Directory Specification for defaults.

2024-09-25  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl (add_config_paths, set_subdir_directories): mark
	$sysconfdir as deprecated by $sysconfdir/xdg.

2024-09-24  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Loading Init Files), doc/texinfo.texi (HTML
	Xref Configuration), tp/texi2any.pl (add_config_paths)
	(set_subdir_directories): use $sysconfdir/xdg instead of $sysconfdir
	in search paths.  Remove default absolute XDG Base Directory
	Specification system configuration and system data irectories from
	search path.

	* tp/texi2any.pl: do not add ./init to init files search path.

2024-09-23  Gavin Smith <gavinsmith0123@gmail.com>

	* contrib/EPUB_conformance: Remove subdirectory as patches are
	no longer useful - the issues they fixed have been fixed in the
	main program.

2024-09-23  Patrice Dumas  <pertusus@free.fr>

	* doc/refcard/txivarcheck (read_tp): ignore customization variable
	names beginning with _ that are internal variables.

2024-09-23  Patrice Dumas  <pertusus@free.fr>

	* doc/refcard/Makefile.am (ccheck, vcheck), doc/refcard/txicmdcheck
	(main), doc/refcard/txivarcheck (main): use srcdir to find programs
	and input files for out of source build.

	* util/txicmdlist (BEGIN), util/txicustomvars (BEGIN): use
	top_builddir to find Texinfo::ModulePath for out of source build.

2024-09-22  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: remove bug-fix item that was in 7.1.1.

2024-09-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_convert_la_CFLAGS): fix.

2024-09-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am: change order of xs_LTLIBRARIES for
	relinking in make distcheck.

2024-09-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_converter_perl_info.c (get_sv_converter)
	(converter_initialize, converter_set_document, reset_output_init_conf)
	(copy_sv_options_for_convert_text),
	tp/Texinfo/XS/main/get_perl_info.c, tp/Texinfo/XS/Makefile.am
	(nodist_IndicesXS_la_SOURCES, ConvertXS_la_SOURCES): move functions
	needed converter code out of get_perl_info.c to a new file
	get_converter_perl_info.c.

	* tp/Texinfo/XS/Makefile.am (xs_LTLIBRARIES)
	(libtexinfo_convert_la_SOURCES, libtexinfo_convert_la_CPPFLAGS)
	(libtexinfo_la_CFLAGS, libtexinfo_convert_la_LDFLAGS)
	(IndicesXS_la_CPPFLAGS, IndicesXS_la_LIBADD, ConvertXS_la_SOURCES)
	(ConvertXS_la_LIBADD): add libtexinfo-convert.la library for converter
	code, including code linked against Perl called from converters.

2024-09-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/configure.ac (perl_conf_PERL_LINK): setup flags to
	link against Perl when it is not in perl_conf_LDFLAGS.  Not needed in
	the default case, but useful to link against Perl explicitly.

2024-09-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%css_element_class_styles): use an
	absolute border-radius for cartouche as a relative one looks bad when
	width and height are different.  From Gavin.

2024-09-22  Patrice Dumas  <pertusus@free.fr>

	* p/Texinfo/XS/convert/call_html_perl_function.c
	(call_latex_convert_to_latex_math),
	tp/Texinfo/XS/main/call_perl_function.c: move
	call_latex_convert_to_latex_math to call_html_perl_function.c to avoid
	a dependency to build_tree_to_build in call_perl_function.c.

	* tp/Texinfo/XS/main/build_perl_info.c,
	tp/Texinfo/XS/main/build_perl_info.h,
	tp/Texinfo/XS/main/call_perl_function.c (newSVpv_utf8): move
	newSVpv_utf8 to call_perl_function.c as it is used here.  Still declare
	newSVpv_utf8 in build_perl_info.h to avoid bringing Perl headers in
	call_perl_function.h.

2024-09-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES)
	(libtexinfo_la_CPPFLAGS, libtexinfo_la_CFLAGS, libtexinfo_la_LDFLAGS)
	(libtexinfoxs_la_SOURCES): move api_to_perl.c and call_perl_function.c
	to libtexinfo, as the functions are needed in libtexinfo code.  Add
	Perl flags to libtexinfo_la_* accordingly.  This is in order to avoid
	interdependencies between the libraries, such that -no-undefined can
	be used for libtexinfo.

2024-09-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_LDFLAGS),
	tp/Texinfo/XS/configure.ac (platform_LDFLAGS): add platform_LDFLAGS to
	contain -no-undefined on Windows to be used for shared libraries not
	linked against Perl.

2024-09-22  Patrice Dumas  <pertusus@free.fr>

	* configure.ac (--enable-ptys-tests, PTYS_TESTS): add
	--enable-ptys-tests, replacing have_ptys with PTYS_TESTS conditional.

	* info/Makefile.am (info_tests_with_pseudotty, info_tests, TESTS)
	(EXTRA_DIST): split TESTS in two, with info_tests_with_pseudotty tests
	that are only run if PTYS_TESTS is true.  That way
	--disable-ptys-tests is acknowledged even if there is a pseudotty
	program present in the info directory.

	* info/Makefile.am (CLEANFILES): add pseudotty to CLEANFILES if it is
	not built.

2024-09-21  Patrice Dumas  <pertusus@free.fr>

	* configure.ac (tp-tests): do not conditionalize tp tests on prove, it
	is not needed since we switched to automake tap implementation.

	* tp/Makefile.am: inline tp_tests variable.

2024-09-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/configure.ac (perl_conf_LDFLAGS): use string
	concatenation instead of += to add -no-undefined and associated flags.
	The previous code triggers an error in Cygwin in CI.

2024-09-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/options_data.txt, tp/ext/epub3.pm (epub_setup),
	tp/maintain/check_epubcheck_texi_t.sh: set dcterms:modified to the
	generation time in the default case as it is not a publication date,
	but a last modified date for the whole publication.  Also set
	_INLINE_STYLE_WIDTH unconditionaly.  Remove EPUB_STRICT.

	* NEWS, TODO, doc/texinfo.texi (EPUB Conformance), tp/TODO: update.

	* doc/texinfo.texi (Generating EPUB): update EPUB generated version.

2024-09-21  Patrice Dumas  <pertusus@free.fr>

	* tp/t/formats_encodings.t (japanese_shift_jis): assume that test
	should be skipped if there is no conversion from EUC-CN as an evidence
	of problematic iconv implementation.

2024-09-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/configure.ac (fetch_conf): remove carriage return \r
	for the specific case of a Cygwin shell calling native Windows Perl,
	as it should be the only case where a carriage return could happen.
	Use a sed substitution based on a printf carriage return expansion
	for portability.

2024-09-20  Patrice Dumas  <pertusus@free.fr>

	* configure.ac: redirect STDERR to AS_MESSAGE_LOG_FD for tests of Perl
	modules checking several modules at once.

2024-09-20  Patrice Dumas  <pertusus@free.fr>

	* doc/tp_api/Makefile.am (MAKEINFO_ENVIRONMENT)
	(texi2any_internals_dependencies, texi2any_internals.texi): instead of
	going to srcdir, use --outdir pod2texi.pl option to specify a
	different output directory from the include directory and generate
	Texinfo files from the build directory.

2024-09-20  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/pod2texi.pl (@included): fix included files
	information order in array reference.

2024-09-20  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/pod2texi.pl ($pod2texi_help, $outdir)
	(@included): add --outdir to specify the directory where included
	files are output, with default based on --subdir.  --subdir is now
	only used to specify include files directory from the main manual.

2024-09-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%css_element_class_styles)
	(_convert_def_command), tp/Texinfo/XS/convert/convert_html.c
	(convert_def_command): use CSS for DEF_TABLE table width setting, as it
	is styling.

	* tp/Texinfo/XS/convert/convert_html.c (convert_def_command): use
	open_element_with_class.

2024-09-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_def_command)
	(_convert_def_line_type), tp/Texinfo/XS/convert/convert_html.c
	(convert_def_command, convert_def_line_type): add 'generic' def-block
	and def-line classes for @def* commands.

2024-09-17  Gavin Smith <gavinsmith0123@gmail.com>

	* util/htmlxref.cnf: add gprofng.  From Thérèse Godefroy
	<godef.th@free.fr>.

2024-09-17  Patrice Dumas  <pertusus@free.fr>

	* NEWS, TODO: remove from TODO add to NEWS that attributes have been
	replaced by CSS.

2024-09-17  Patrice Dumas  <pertusus@free.fr>

	* tp/t/html_tests.t (simple_only_special_spaces_node): skip if Perl
	too old.

2024-09-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%css_element_class_styles)
	(_convert_menu_entry_type, _convert_menu_comment_type),
	tp/Texinfo/XS/convert/convert_html.c (convert_menu_entry_type)
	(convert_menu_comment_type): do not use empty spaces to add padding
	between menu <table> columns, instead use CSS padding-left in the
	menu description cell.

	* tp/Texinfo/XS/convert/convert_html.c (convert_menu_entry_type): use
	open_element_with_class.

2024-09-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%css_element_class_styles)
	(_default_format_button_icon_img),
	tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_button_icon_img): add a class for the icon img,
	remove align attribute and use CSS instead.

2024-09-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_default_format_navigation_header),
	tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_navigation_header): do not set cellpadding nor
	cellspacing for VERTICAL_HEAD_NAVIGATION, it is not really useful and,
	if set, should be set with CSS.  Add classes.

2024-09-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_default_format_navigation_panel),
	tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_navigation_panel): do not set cellpadding nor
	cellspacing for HEADER_IN_TABLE table, the result is very similar to
	defaults.  Add nav-button class to HEADER_IN_TABLE table td such that
	CSS can be used to set cell padding.

2024-09-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_menu_command),
	tp/Texinfo/XS/convert/convert_html.c (convert_menu_command): remove
	cellspacing in @menu formatting table.  It is not really useful,
	and, if set, should be set with CSS such as to be customizable.

2024-09-15  Patrice Dumas  <pertusus@free.fr>

	Format HTML About directions explanations table with CSS

	* TODO, tp/Texinfo/Convert/HTML.pm (%css_element_class_styles)
	(_default_format_special_body_about),
	tp/Texinfo/XS/convert/convert_html.c  (open_element_with_class)
	(default_format_special_body_about): add classes for all the <th> and
	<td> in About directions explanations table and for the table itself.
	Set borders with CSS using those classes.

2024-09-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (file_header_information): use
	MATHJAX_CONFIGURATION customization variable.

2024-09-15  Patrice Dumas  <pertusus@free.fr>

	Format @cartouche in HTML with CSS and round corners

	* tp/Texinfo/Convert/HTML.pm (%css_element_class_styles)
	(_convert_cartouche_command), tp/Texinfo/XS/convert/convert_html.c
	(convert_cartouche_command): add CSS style for cartouche table with
	border and round corners.  Remove border attribute.

2024-09-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%defaults): do not set MISC_BUTTONS to
	SECTION_BUTTONS in the default case, as there are no regular
	directions set for special output units.  Add Top button instead of
	regular directions, with default now being the same as with TEXI2HTML
	style.  Report from Rudolf Adamkovič.

2024-09-10  Gavin Smith <gavinsmith0123@gmail.com>

	* info/terminal.c (terminal_prep_terminal_hook): Return void not
	int.  Report from Biswapriyo Nath.

2024-09-10  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (MathJax Customization Variables),
	tp/Texinfo/Convert/HTML.pm (output): add tex MathJax option block that
	tighten the configuration to what is really needed for MathJax in
	texi2any output.

2024-09-10  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/Makefile.am (parser_tests_environment): add srcdir in the
	environment for parser_tests.sh calls.

2024-09-09  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (%formats, test): add the epub_file format,
	associated to convert_to_html.
	Minor changes in code.

	* tp/Makefile.tres, tp/t/epub_tests.t: use epub_file format.

2024-09-08  Patrice Dumas  <pertusus@free.fr>

	* NEWS, TODO, doc/texinfo.texi (Achieving strict EPUB conformance):
	document EPUB_STRICT and give other information on EPUB conformance.

2024-09-08  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): if $arg_output is set, output EPUB as an
	epub file if Archive::Zip is installed, by simply setting OUTFILE.

	* tp/t/test_utils.pl (_set_outfile_name, test): separate code setting
	output file name for $arg_output as _set_outfile_name.  Use
	_set_outfile_name both for converted output for the diverse formats
	and for epub.

2024-09-08  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): if doing epub, set init_files_options
	EPUB_CREATE_CONTAINER_FILE in the default case.

2024-09-08  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/check_epubcheck_texi_t.sh: sort first level directories.

2024-09-08  Patrice Dumas  <pertusus@free.fr>

	* tp/t/epub_tests.t, tp/Makefile.tres, tp/t/html_tests.t: new
	t/epub_tests.t file for epub related tests.  Move epub related tests
	from html_tests.t to epub_tests.t.

2024-09-08  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): if epub3.pm is loaded, compare
	*_epub_package/EPUB and *_epub_package/EPUB/xhtml contents.

2024-09-08  Patrice Dumas  <pertusus@free.fr>

	* doc/Makefile.am (wwwdoc-build): fix Pod/Simple/Texinfo.pm out of
	source path.

2024-09-08  Patrice Dumas  <pertusus@free.fr>

	* doc/Makefile.am (gendocs_envvars, wwwdoc-build): fix out of source
	wwwdoc-build build.

2024-09-08  Patrice Dumas  <pertusus@free.fr>

	* tp/ext/epub3.pm (epub_finish): remove a spurious tab character in
	container file.

2024-09-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/options_data.txt (_INLINE_STYLE_WIDTH), tp/ext/epub3.pm
	(epub_setup), tp/Texinfo/Convert/HTML.pm (_convert_tab_command)
	(_convert_def_command), tp/Texinfo/XS/convert/convert_html.c
	(convert_tab_command, convert_def_command): add _INLINE_STYLE_WIDTH
	customization variable.  Replace width attribute by inline CSS if
	_INLINE_STYLE_WIDTH is set.  Set _INLINE_STYLE_WIDTH in epub3.pm if
	EPUB_STRICT is set.

2024-09-07  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: manual build of pod2texi.html not required
	(since 2022-11-19).

2024-09-07  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: add 7.1.1 release notice

2024-09-07  Patrice Dumas  <pertusus@free.fr>

	* tp/ext/epub3.pm (epub_finish): fix nav file formatting with gap
	in sectioning.

	* tp/Makefile.tres, tp/t/html_tests.t (section_part_epub): add a test
	of epub, with @part and starting at @section, leading to a gap in
	sectioning.

2024-09-07  Patrice Dumas  <pertusus@free.fr>

	* tp/ext/epub3.pm (epub_finish): fix nav file formatting with a
	command with a zero section level not appearing first, by consistently
	using $section_level.

	* tp/Makefile.tres, tp/t/html_tests.t (chapter_before_top_epub): test
	chapter before top in epub for nav file formatting.

	* tp/maintain/check_epubcheck_texi_t.sh: show the command used to
	generate EPUB in log.

2024-09-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_xref_commands),
	tp/Texinfo/XS/convert/convert_html.c (convert_xref_commands): handle
	better formatting of internal ref in string context with nested
	references.

	* tp/maintain/check_epubcheck_texi_t.sh: call with
	NO_TOP_NODE_OUTPUT=0 to avoid lots of false positives.

	* tp/Makefile.tres, tp/t/html_tests.t
	(double_recursive_self_section_reference_node_no_use_node): new test
	of recursive references, split with USE_NODES=0.

2024-09-06  Patrice Dumas  <pertusus@free.fr>

	* tp/ext/epub3.pm (epub_finish): use transliterate_protect_file_name
	on opf file name to replace spaces, and avoid non ascii characters.

	* tp/t/test_utils.pl (test): add $srcdir.'ext/' to init files search
	path.

	* tp/Makefile.tres, tp/t/html_tests.t
	(setfilename_on_top_and_after_node_epub): add test of EPUB generation,
	tesing EPUB generation with files with spaces in their names.

2024-09-06  Patrice Dumas  <pertusus@free.fr>

	Percent encode file name in internal href

	* tp/Texinfo/Convert/HTML.pm (_internal_command_href),
	tp/Texinfo/XS/convert/convert_html.c (html_internal_command_href):
	call url_protect_file_text on target_filename to percent encode.

2024-09-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_default_format_button_icon_img)
	(_default_format_navigation_panel, _convert_menu_command)
	(_convert_printindex_command), tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_button_icon_img)
	(html_default_format_navigation_panel)
	(html_default_format_navigation_header, convert_menu_command)
	(convert_printindex_command): remove border=0 for img and table as it
	is the dafault and a deprecated attribute.

	* tp/tests/many_input_files/Makefile.am (copy-tex-html, copy-tests):
	copy to $srcdir.

2024-09-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%css_element_class_styles)
	<displaymath>: center displaymath.  Report and CSS from Rudolf
	Adamkovič.

2024-09-06  Patrice Dumas  <pertusus@free.fr>

	* tp/t/init/t2h_singular.init (singular_format_footer): update for
	close_registered_sections_level call change.

2024-09-06  Patrice Dumas  <pertusus@free.fr>

	* tp/ext/latex2html.pm (l2h_to_html): do not set latex2html -dir
	option if the destination directory is the current directory.
	Report by Jeremy Bryant.

2024-09-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/t/input_files/htmlxref-test.cnf,
	tp/t/htmlxref.t: rename t/input_files/htmlxref.cnf as
	t/input_files/htmlxref-test.cnf as now the htmlxref.cnf file found
	along with source files is used and could therefore interact with
	in-source conversions.

2024-09-06  Patrice Dumas  <pertusus@free.fr>

	* tp/init/book.pm (book_convert_heading_command): sync with HTML.pm.

2024-09-05  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Heading Commands Formatting),
	tp/Texinfo/Convert/HTML.pm (register_opened_section_level)
	(close_registered_sections_level, _initialize_output_state),
	tp/Texinfo/XS/convert/ConvertXS.xs
	(html_register_opened_section_level)
	(html_close_registered_sections_level),
	tp/Texinfo/XS/convert/convert_html.c
	(html_register_opened_section_level)
	(html_register_opened_filename_section_level)
	(html_close_registered_sections_level)
	(html_close_registered_filename_sections_level, html_set_pages_files)
	(html_conversion_finalization, html_free_converter),
	tp/Texinfo/XS/main/converter_types.h (STRING_STACK_LIST, CONVERTER):
	add a filename argument to register_opened_section_level and
	close_registered_sections_level to avoid closing sections in another
	file.  Update XS interface.  Update callers.

2024-09-05  Patrice Dumas  <pertusus@free.fr>

	* tp/ext/epub3.pm (epub_convert_special_unit_type): rename
	$element variable as $output_unit.

2024-09-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/html_tests.t
	(simple_only_special_spaces_node), t/init/no_navigation.pm,
	t/input_files/simple_only_special_spaces_node.texi: add a simpler
	version of only_special_spaces_node as a file_test split by node as
	the smallest case that triggers a bug with div closed in the wrong
	file.

2024-09-05  Patrice Dumas  <pertusus@free.fr>

	* TODO: add an entry for printindex formatting in HTML, to avoid using
	table and refer to past discussions.

2024-09-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_heading_command)
	(_open_node_part_command), tp/Texinfo/XS/convert/convert_html.c
	(convert_heading_command, open_node_part_command): set
	in_skipped_node_top when opening a @node (or associated @part), not
	after processing the contents.

	* tp/Makefile.tres, tp/t/40moresectioning.t
	(nodes_no_section_footnote_no_top_node_output): add test with
	footnote in a node after a skipped Top node, with USE_NODES=0.

	* tp/t/*.t: Use the hash notation to set USE_NODES.

2024-09-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_xref_commands),
	tp/Texinfo/XS/convert/convert_html.c (convert_xref_commands): avoid an
	infinite recursion going through ref to node on sectioning command
	line and ref to sectioning command on node line, in case USE_NODES is
	0.

	* tp/Makefile.tres, tp/t/30sectioning.t
	(double_recursive_self_section_node_reference_no_use_node): test
	double recursive self section node reference with USE_NODES=0.

2024-09-04  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/all_tests.sh: use $srcdir, adapt for out of source
	build.

2024-09-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/options_data.txt (EPUB_STRICT): add.

	* tp/ext/epub3.pm (epub_finish): if EPUB_STRICT is set, use the EPUB
	generation time for dcterms:modified.  Based on patch from Daniel
	Cerqueira <dan.git@lispclub.com>.

	* tp/maintain/check_epubcheck_texi_t.sh: set LC_ALL and LANGUAGE for
	reproducible errors.  Use EPUB_STRICT in call.  Keep the epub_package
	directory.

2024-09-04  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/check_epubcheck_texi_t.sh: check systematically EPUB
	t/*.t tests validity.

2024-09-04  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/check_back_xml_forth_texi_t.sh: add $srcdir for out of
	source builds.

2024-09-03  Patrice Dumas  <pertusus@free.fr>

	Use <pre> for @displaymath HTML formatting

	* NEWS, tp/Texinfo/Convert/HTML.pm (%css_element_class_styles),
	tp/Texinfo/Convert/HTML.pm (_convert_displaymath_command),
	tp/Texinfo/XS/convert/convert_html.c (convert_displaymath_command):
	use <pre> for @displaymath formatting such that Texinfo source
	indentation is kept, in particular for text browsers.  Report from
	Rudolf Adamkovič.

2024-09-03  Gavin Smith <gavinsmith0123@gmail.com>

	Update FSF address

	* doc/texinfo.texi,
	* doc/info-fr.texi,
	* doc/refcard/txirefcard.tex,
	* texindex/jrtangle,
	* texindex/jrweave:
	Update FSF address or replace with link to website

	* doc/refcard/txirefcard.tex: remove defunct www.gnupress.org link

2024-08-29  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: add a couple of points for building from
	release branch

2024-09-03  Patrice Dumas  <pertusus@free.fr>

	Add MATHJAX_CONFIGURATION customization variable

	* tp/Texinfo/options_data.txt, doc/texinfo.texi (MathJax Customization
	Variables), tp/Texinfo/Convert/HTML.pm (_file_header_information)
	(output), NEWS: add MATHJAX_CONFIGURATION customization variable, for
	user wanting to change the global MathJax object configuration.
	Report from Rudolf Adamkovič.

2024-08-28  Patrice Dumas  <pertusus@free.fr>

	Use XDG Base Directory Specification for directory lookups

	* tp/Texinfo/Common.pm (locate_file_in_dirs), tp/t/test_utils.pl
	(test), tp/texi2any.pl (locate_and_load_init_file)
	(locate_and_load_extension_file): add deprecated directories argument
	and return deprecated directories used.  Update callers.

	* tp/texi2any.pl (add_config_paths): add function to setup directories
	using XDG Base Directory Specification environment variable,
	installation directory and default XDG Base Directory Specification
	directories.  The default XDG Base Directory Specification directories
	are added (last) even if the environment variable is set, such as to
	always have directories searched implementation and user-configuration
	independent.

	* tp/texi2any.pl (set_subdir_directories): set all the directories
	where files are searched for in a subdirectory.  In current directory,
	in HOME, following the XDG Base Directory Specification and by calling
	add_config_paths.  Set deprecated_dirs information with dot directory
	directly found in HOME that is deprecated by XDG Base Directory
	Specification HOME directories.  Use set_subdir_directories to set
	@texinfo_language_config_dirs, @program_config_dirs.

	* tp/texi2any.pl (_warn_deprecated_dirs, $config_init_files)
	(locate_and_load_init_file): warn for deprecated directories.

	* tp/Texinfo/Convert/Converter.pm (%common_converters_defaults),
	tp/texi2any.pl: pass main program deprecated directories information
	to converter through deprecated_config_directories key value.

	* tp/Texinfo/Convert/HTML.pm (_parse_htmlxref_files): pass
	deprecated_config_directories to locate_file_in_dirs and warn about
	deprecated directories used.

	* NEWS, doc/texi2any_api.texi (Loading Init Files), doc/texinfo.texi
	(HTML Xref Configuration): update directory lookup descriptions.

2024-08-28  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Simple Navigation Panel Customization): the
	boolean set by button formatting function specifies that a delimiter
	is desired before the button.  Also update the description of the
	functions arguments.

2024-08-26  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl (%converter_format_expanded_region_name)
	(set_format): more explicit code and variable names to distinguish
	output format, converter format and expanded region.

2024-08-25  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl: fix a typo.

2024-08-25  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (HTML Xref Configuration), tp/texi2any.pl
	(@texinfo_language_config_dirs): prepend curdir before the call of
	converter, and also add the leading input file path directory if
	there is a leading directory and it is not the current directory.

2024-08-25  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Invoking @command{texi2any}): correct -I and -P
	documentation, texi2any always search in the current directory and the
	input file path leading directory if there is one , irrespective of
	the -I and -P values given.

2024-08-25  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Modifying Main Program Array Variables),
	tp/Texinfo/Config.pm (texinfo_add_to_option_list): add a $prepend
	optional argument to texinfo_add_to_option_list, in which case the
	values are prepended.

2024-08-25  Patrice Dumas  <pertusus@free.fr>

	Add TEXINFO_LANGUAGE_DIRECTORIES customization option

	* tp/Texinfo/Convert/Converter.pm (%defaults),
	tp/Texinfo/Convert/HTML.pm (_load_htmlxref_files),
	tp/Texinfo/options_data.txt, tp/texi2any.pl ($cmdline_options): add
	TEXINFO_LANGUAGE_DIRECTORIES to replace the
	'texinfo_language_config_dirs' information passed directly to
	converters.

2024-08-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (%common_converters_defaults),
	tp/Texinfo/Convert/HTML.pm (_load_htmlxref_files), tp/texi2any.pl:
	rename language_config_dirs as texinfo_language_config_dirs.

2024-08-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (locate_file_in_dirs): if the input file path
	contains directories, returns it if it is found but do not search it
	in directories.

	* doc/texi2any_api.texi (Loading Init Files), doc/texinfo.texi (File
	Names and Links Customization for HTML): update documentation.

2024-08-25  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (HTML Xref Link Basics, HTML Xref Configuration):
	remove the "HTML Xref Mismatch" node, it is not the best way to go and
	somewhat obsolete.  Keep the information in tp/TODO.  Add some
	information on mismatched cross-references in the last paragraphs of
	"HTML Xref Link Basics".

2024-08-25  Gavin Smith <gavinsmith0123@gmail.com>

	* util/htmlxref.cnf (smtp, smtpmail): Rename to smtpmail to
	match name of manual.  Report from Eli.

2024-08-24  Patrice Dumas  <pertusus@free.fr>

	 * tp/Texinfo/Convert/HTML.pm (_parse_htmlxref_files)
	 (_external_node_href), tp/Texinfo/XS/convert/convert_html.c
	 (external_node_href): use an empty string for an htmlxref manual
	 entry without URL prefix instead of undef.

2024-08-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_parse_htmlxref_files): no warning for
	an empty URL prefix as it is the only way to override an entry
	appearing in a file processed later on.

	* tp/t/htmlxref.t (htmlxref_no_urlprefix_first), tp/Makefile.tres,
	tp/t/input_files/htmlxref-no_urlprefix_first.cnf, tp/Makefile.am
	(test_files): new test with htmlxref entry with an empty URL prefix
	before an entry with URL prefix.

2024-08-23  Patrice Dumas  <pertusus@free.fr>

	* INSTALL: correct a typo.

2024-08-23  Patrice Dumas  <pertusus@free.fr>

	EPUB Conformance issues documentation, workarounds and TODO

	* TODO, doc/texinfo.texi (EPUB Conformance),
	contrib/EPUB_conformance/*.patch, contrib/EPUB_conformance/README:
	document that EPUB generated is not conformant.  Add patches from
	Daniel Cerqueira in contrib/EPUB_conformance/ that cannot be applied
	as is, but are necessary for EPUB conformance.  Add TODO entries that
	should allow to fix more permanently this issue.

2024-08-22  Gavin Smith <gavinsmith0123@gmail.com>

	* util/htmlxref.cnf: Add eglot.  Report from Eli.

2024-08-22  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: add extra build system checks.  From Patrice
	and Bruno.

2024-08-22  Gavin Smith <gavinsmith0123@gmail.com>

	No 'local' in shell script

	* install-info/tests/defs.in (findprog): Remove use of
	'local' for saving the value of IFS (input field separator).
	On Solaris 10 there is a warning "local: not found" and it
	is likely stopping IFS from being reset correctly, leading
	to subsequent errors.


2024-08-21  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi: modify, reassociate and comment out
	@nodedescription that were incorrectly associated with EPUB related
	nodes.

2024-08-20  Bruno Haible <bruno@clisp.org>

	build: Fix failure of all install-info tests on Solaris 11.4.

	* install-info/tests/defs.in (DIFF_OPTIONS): New variable.
	(diff): Remove variable.
	* install-info/tests/ii-*-test: Use diff $DIFF_OPTIONS instead
	of ${diff}.

2024-08-18  Gavin Smith <gavinsmith0123@gmail.com>

	Check for diff --strip-trailing-cr.

	* configure.ac (DIFF_OPTIONS, DIFF_U_OPTION, DIFF_A_OPTION):
	Do not AC_SUBST DIFF_U_OPTION or DIFF_A_OPTION, using DIFF_OPTIONS
	instead.
	(DIFF_CR_OPTION) [mingw]: Check if --strip-trailing-cr option
	works and include it in DIFF_OPTIONS if so.

	* tp/tests/run_parser_all.sh,
	* tp/defs.in,
	* tp/tests/many_input_files/different_encodings.sh,
	* tp/tests/many_input_files/different_languages_gen_master_menu.sh,
	* tp/tests/many_input_files/input_dir_non_ascii.sh,
	* tp/tests/many_input_files/output_dir_file_non_ascii.sh,
	* tp/tests/many_input_files/output_dir_non_ascii.sh,
	* tp/tests/many_input_files/tex_l2h.sh,
	* tp/tests/many_input_files/tex_l2h_output_dir_non_ascii.sh,
	* tp/tests/many_input_files/tex_t4ht.sh,
	* tp/tests/many_input_files/tex_t4ht_output_dir_non_ascii.sh,
	* Pod-Simple-Texinfo/test_scripts/manual_sectioning_gap_test.sh,
	* Pod-Simple-Texinfo/test_scripts/test_empty_head2.sh,
	* Pod-Simple-Texinfo/test_scripts/test_ref_to_unknown.sh:
	Use DIFF_OPTIONS instead of DIFF_A_OPTION and/or DIFF_U_OPTION
	in order to have --strip-trailing-cr possibly included.

	* install-info/defs.in: Remove handling of --strip-trailing-cr,
	using DIFF_OPTIONS instead.

	Test failures due to carriage returns on mingw reported by
	Bruno Haible, bug-texinfo 2024-06-09.

2024-08-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (new_node_menu_entry),
	tp/Texinfo/XS/structuring_transfo/structuring.c (new_node_menu_entry):
	set source info for added node menu entries, as a source info is
	expected for node menu entries. Report from Dario Gjorgjevski and
	Gavin Smith.

2024-08-15  Gavin Smith <gavinsmith0123@gmail.com>

	* build-aux/ar-lib: Remove.  It does not appear to be
	used anywhere.

2024-08-15  Gavin Smith <gavinsmith0123@gmail.com>

	Untrack some build files

	* build-aux/compile, build-aux/config.guess, build-aux/config.sub,
	build-aux/depcomp, build-aux/install-sh, build-aux/mdate-sh,
	build-aux/missing, build-aux/tap-driver.sh, build-aux/test-driver:
	Untrack in git.  These files are imported when autogen.sh runs
	and this stops a divergence in the output of "git diff" if
	a different version of automake etc. is installed.

2024-08-15  Gavin Smith <gavinsmith0123@gmail.com>

	* autogen.sh: Do not append command line arguments ("$@") to
	automake command line.  The purpose of this is unknown.  It
	meant that an incorrect "-n" flag would be printed in "chicken"
	mode.

2024-08-15  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/pm_to_blib: Remove empty, apparently useless
	file.

2024-08-14  Gavin Smith <gavinsmith0123@gmail.com>

	Add tp/Texinfo/XS/build-aux

	* tp/Texinfo/XS/configure.ac: Add AC_CONFIG_AUX_DIR to use
	"build-aux" to store some auxiliary build files.  From Bruno.

2024-08-13  Gavin Smith <gavinsmith0123@gmail.com>

	* autogen.sh: Run autoreconf under tp/Texinfo/XS/ with
	AUTOPOINT=true.  From Bruno.


2024-08-10  Patrice Dumas  <pertusus@free.fr>

	Update man/pod2texi.1, po*/*.po and gnulib generated gperf files

2024-08-10  Patrice Dumas  <pertusus@free.fr>

	Update po files

2024-08-10  Patrice Dumas  <pertusus@free.fr>

	Run gnulib-tool --add-import in tp/Texinfo/XS

2024-08-10  Patrice Dumas  <pertusus@free.fr>

	Run gnulib-tool --add-import at top level

2024-08-10  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/regenerate_C_options_info.pl,
	tp/maintain/regenerate_commands_perl_info.pl,
	tp/maintain/regenerate_documentlanguages-iana.pl,
	tp/maintain/regenerate_documentlanguages-loc.pl,
	tp/maintain/regenerate_perl_options_info.pl,
	tp/maintain/setup_accent_tables.pl,
	tp/maintain/setup_converters_code_tables.pl: add the information that
	a generated file is automatically generated if missing.
	Use the basename to name the script generating the code files such
	that the file content is the same in in and out of source builds.

	* tp/Texinfo/XS/Makefile.am (Commands.pm, Options.pm): depend on the
	generating script.

2024-08-10  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/tp_api/Makefile.am (texi2any_internals.texi):
	Change working directory to $(srcdir) before running pod2texi.
	This allows pod2texi to generate @include directives correctly
	with the --subdir option.
	(texi2any_internals_dependencies): List dependencies with
	../../ prefix instead of $(top_srcdir)/.
	(MAKEINFO_ENVIRONMENT): Use abs_top_srcdir and abs_top_buildir
	instead of top_srcdir and top_buildir.

	Analysis by Patrice.

2024-08-09  Patrice Dumas  <pertusus@free.fr>

	* TODO: add Rahguzar demand of math rendered as image in Info.

2024-08-09  Patrice Dumas  <pertusus@free.fr>

	Use prototypes instead of old style K&R definitions

	* info/pcterm.c (pc_goto_xy, pc_put_text, pc_write_chars)
	(pc_scroll_terminal, pc_initialize_terminal): use prototypes instead
	of old style K&R definitions.

	Changes in spacing.

2024-08-09  Gavin Smith <gavinsmith0123@gmail.com>

	Remove VFunction.

	* info/terminal.c, info/terminal.h
	(terminal_begin_blink_hook, terminal_begin_bold_hook)
	(terminal_begin_inverse_hook, terminal_begin_standout_hook)
	(terminal_begin_underline_hook, terminal_clear_screen_hook)
	(terminal_clear_to_eol_hook, terminal_default_colour_hook)
	(terminal_down_line_hook, terminal_end_all_modes_hook)
	(terminal_end_inverse_hook, terminal_end_standout_hook)
	(terminal_end_underline_hook, terminal_get_screen_size_hook)
	(terminal_goto_xy_hook, terminal_initialize_terminal_hook)
	(terminal_new_terminal_hook, terminal_prep_terminal_hook)
	(terminal_put_text_hook, terminal_ring_bell_hook)
	(terminal_scroll_terminal_hook, terminal_set_bgcolour_hook,)
	(terminal_set_colour_hook, terminal_unprep_terminal_hook,)
	(terminal_up_line_hook, terminal_write_chars_hook):
	Declare with explicit variable list.
	(VFunction): Remove.

	C23 does not allow a variable list to be left undefined as ().
	Report from Jeffrey Cliff <jeffrey.cliff@gmail.com>.

2024-08-08  Bruno Haible  <bruno@clisp.org>

	* texindex/Makefile.am (texindex.awk): Move the generated
	texindex.awk from the build dir to the source dir.

	* man/Makefile.am (man/Makefile.am): Set environment variable
	TEXINDEX_SCRIPT, so that the texindex program find its
	texindex.awk script.

2024-08-08  Gavin Smith <gavinsmith0123@gmail.com>

	* Pod-Simple-Texinfo/Makefile.am (pod2texi):
	Remove replacement of USE_EXTERNAL_LIBINTL,
	USE_EXTERNAL_EASTASIANWIDTH and USE_EXTERNAL_UNIDECODE as
	these no longer occur in pod2texi.pl (since change
	on 2023-09-24).

2024-08-08  Patrice Dumas  <pertusus@free.fr>

	* doc/tp_api/Makefile.am (texi2aany_internals.texi): Generate
	in srcdir.  Report from Bruno.

2024-08-08  Gavin Smith <gavinsmith0123@gmail.com>

	* man/Makefile.am (MAKEINFO): Remove unused (this also had incorrect
	spelling of another variable).

2024-08-08  Gavin Smith <gavinsmith0123@gmail.com>

	* Makefile.am (BUILT_SOURCES): Add tp/Texinfo/ModulePath.pm along
	with rule to generate it.  This helps in running "make dist"
	without running "make" first.  Report from Bruno.

2024-08-07  Patrice Dumas  <pertusus@free.fr>

	* info/Makefile.am (../gnulib/lib/libgnu.a):
	Add rule to allow running "make dist" without running "make"
	first.  Report from Bruno Haible.

2024-08-07  Gavin Smith <gavinsmith0123@gmail.com>

	* autogen.sh: Do not run autoreconf under tp/Texinfo/XS/, running
	individual tools instead.  This stops autopoint running and
	overwriting files with older versions.

2024-08-07  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS: add or upgrade gettext files by following
	new instructions in configure.ac.

2024-08-07  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/configure.ac: elaborate on comment using
	information from Bruno.

2024-08-07  Bruno Haible  <bruno@clisp.org>

	build: Prepare for use of autopoint.

	* configure.ac: Add comments about use of autopoint.
	* tp/Texinfo/XS/configure.ac: Specify the same GNU gettext
	version as the top-level configure.ac. Add comments about use
	of autopoint.

2024-08-04  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: Remove out-of-date information about running
	"make" before "make dist".

2024-08-04  Patrice Dumas  <pertusus@free.fr>

	* doc/tp_api/Makefile.am (tp/Texinfo/ModulePath.pm):
	Add rule to allow running "make dist" without running "make"
	first.  Report from Bruno Haible.

2024-08-04  Patrice Dumas  <pertusus@free.fr>

	* info/Makefile.am (../gnulib/lib/libgnu.a):
	Add rule to allow running "make dist" without running "make"
	first.  Report from Bruno Haible.

2024-07-27  Patrice Dumas  <pertusus@free.fr>

	* t/init_files_tests.t
	(test_format_single_footnote_in_inline_content),
	tp/t/init/footnote_mark_in_inline_content.pm, tp/Makefile.tres,
	tp/Makefile.am (test_files): add a test for format_single_footnote
	custoization to have the footnote mark in inline content.  Partly
	based on Roger Crew code.

2024-07-27  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.tex (Customizing Footnotes),
	tp/Texinfo/Convert/HTML.pm (_default_format_single_footnote)
	(_default_format_footnotes_sequence),
	tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_formatting_function_format_single_footnote),
	tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_single_footnote, format_single_footnote)
	(html_default_format_footnotes_sequence): format the footnote text in
	format_single_footnote.  Remove footnote_text argument of
	default_format_single_footnote, add the footnote element and
	number_in_doc.

2024-07-26  Patrice Dumas  <pertusus@free.fr>

	Add format_single_footnote formatting reference for a single footnote

	* doc/texi2any_api.texi (Customizing Footnotes),
	tp/Texinfo/Convert/HTML.pm (%default_formatting_references)
	(_default_format_single_footnote, _default_format_footnotes_sequence),
	tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_formatting_function_format_single_footnote),
	tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_single_footnote, format_single_footnote)
	(html_default_format_footnotes_sequence): add a formatting reference
	for a single footnote.  Based on a report and a patch of Roger Crew.

2024-07-26  Patrice Dumas  <pertusus@free.fr>

	* doc/Makefile.am (MAINTAINERCLEANFILES): set generated Texinfo files
	as MAINTAINERCLEANFILES.

	* tp/Texinfo/XS/Makefile.am (MAINTAINERCLEANFILES): set generated
	source files as MAINTAINERCLEANFILES.

2024-07-26  Patrice Dumas  <pertusus@free.fr>

	* doc/tp_api/Makefile.am (DISTCLEANFILES, dist-info): do not
	distribute Info files.

	* doc/tp_api/Makefile.am (maintainerclean-local)
	(MAINTAINERCLEANFILES): remove generated Texinfo file with
	maintainerclean.

2024-07-25  Patrice Dumas  <pertusus@free.fr>

	* tp/init/book.pm (book_convert_heading_command):  sync with HTML.pm.

2024-07-20  Gavin Smith <gavinsmith0123@gmail.com>

	* util/htmlxref.cnf: Add use-package.

	From Jacob Ilsø Christensen <jacobilsoe@gmail.com>

2024-07-20  Gavin Smith <gavinsmith0123@gmail.com>

	* util/htmlxref.cnf: Change cran.r-project.org to CRAN.R-project.org.

	From Sebastian Meyer <seb.meyer@fau.de>.

2024-07-06  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Typed Functions): fix parenthesis in example.

2024-06-30  Gavin Smith <gavinsmith0123@gmail.com>

	* util/htmlxref.cnf: add R-FAQ.

	From Sebastian Meyer <seb.meyer@fau.de>.

2024-06-17  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/tp_api/Makefile.am (texi2any_internals.texi):
	Pass -f option to rm for removing temporary file.

2024-06-17  Patrice Dumas  <pertusus@free.fr>

	Use explicit prototype for Info command functions

	* info/m-x.c (info_execute_command): call command function with two
	arguments only, window and count.

	* info/doc.h (InfoCommand), info/echo-area.c
	(read_and_dispatch_in_echo_area, ea_yank_pop)
	(ea_possible_completions), info/info.h (COMMAND_FUNCTION),
	info/makedoc.c (process_one_file), info/session.c
	(info_read_and_dispatch, read_key_sequence), info/terminal.h
	(VFunction): add a function type COMMAND_FUNCTION for pointers on info
	commands function and replace the VFunction untyped generic function
	type.  Move VFunction definition to terminal.h.

2024-06-17  Gavin Smith <gavinsmith0123@gmail.com>

	Info tests timeout

	* info/t/Init-test.inc (TEXINFO_INFO_TESTS_TIMEOUT, run_ginfo):
	Use environment variable to allow changing tests timeout
	from the environment.  Increase default timeout from 5 to 10
	seconds. This is to support running the tests on slow systems,
	such as under CPU emulation.  Report of test timeouts from Nelson.

2024-06-17  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/regenerate_C_options_info.pl: remove a spurious ; output
	after generated function definitions.

2024-06-16  Patrice Dumas  <pertusus@free.fr>

	* system.h: remove strerror definition, the prototype looks wrong and
	the conditional is not set anywhere.

2024-06-16  Patrice Dumas  <pertusus@free.fr>

	* info/filesys.h (infopath_string), info/infopath.c (infopath_string):
	remove extern in infopath_string filesys.h declaration.  Add void in
	infopath_string argument.

2024-06-11  Gavin Smith <gavinsmith0123@gmail.com>

	* info/infomap.c (locate_init_file) [__MINGW32__]:
	Add missing semicolon.  From Bruno.

2024-06-11  Patrice Dumas  <pertusus@free.fr>

	* doc/Makefile.am (pod2texi.texi), doc/tp_api/Makefile.am
	(MAKEINFO_ENVIRONMENT, MAKEINFO, texi2any_internals.texi): set/use
	environment variables to have ModulePath.pm work correctly.  Remove -I
	options now unneeded.

2024-06-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (non_perl_malloc): add.

	* tp/Texinfo/XS/main/call_perl_function.c (call_collator_getSortKey):
	use non_perl_malloc instead of malloc.

2024-06-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_types_conversion): call non_perl_free instead of free.

	* tp/Texinfo/XS/convert/ConvertXS.xs,
	tp/Texinfo/XS/main/build_perl_info.c,
	tp/Texinfo/XS/main/get_perl_info.c,
	tp/Texinfo/XS/main/node_name_normalization.c,
	tp/Texinfo/XS/parsetexi/def.c: include stdlib.h for free.

2024-06-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/debug_parser.c: add missing stdlib.h
	include.  Report by Bruno.

2024-06-11  Patrice Dumas  <pertusus@free.fr>

	Add missing void to prototypes

	* tp/Texinfo/XS/main/builtin_commands.h (set_element_type_name_info),
	tp/Texinfo/XS/main/parser_conf.c (register_conf): add void in
	prototypes.  Found thanks to -Wstrict-prototypes based on Bruno.

2024-06-11  Patrice Dumas  <pertusus@free.fr>

	* doc/Makefile.am (pod2texi.texi): add
	-I $(top_builddir)/tp/Texinfo/XS.

	* tp/Texinfo/ModulePath.pm.in (init): do not add
	tp/Texinfo/XS/parsetexi to @INC, there is nothing to be found there.

	* tp/Texinfo/ModulePath.pm.in ($tp_builddir),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (init): rename builddir as
	tp_builddir.

2024-06-11  Patrice Dumas  <pertusus@free.fr>

	doc: prefix target file names in srcdir with '$(srcdir)/'

	* doc/Makefile.am (html_default_commands_args.texi): prefix the
	target file names which is created in srcdir with '$(srcdir)/'.

2024-06-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/conf.c: add missing stdlib.h include.
	Report by Bruno.

2024-06-11  Patrice Dumas  <pertusus@free.fr>

	Remove check and include of xlocale.h now done in gnulib locale

	* tp/Texinfo/XS/configure.ac, tp/Texinfo/XS/main/manipulate_indices.c:
	remove test of xlocale.h and explicit include, everything should be
	covered by the gnulibe locale module.  From Gavin and Bruno.

2024-06-11  Patrice Dumas  <pertusus@free.fr>

	Add gnulib locale module for XS

	* tp/Texinfo/XS:
	Run "gnulib-tool --add-import locale"

2024-06-10  Bruno Haible  <bruno@clisp.org>

	man: Add support for VPATH builds with OpenBSD 'make'

	* man/Makefile.am: In the rules that use HELP2MAN, prefix the
	target file names with '$(srcdir)/'.

2024-06-10  Patrice Dumas  <pertusus@free.fr>

	Include xlocale.h for newlocale and other symbols if found

	* tp/Texinfo/XS/configure.ac (AC_CHECK_HEADERS),
	tp/Texinfo/XS/main/manipulate_indices.c: test if xlocale.h exists, and
	if yes include it.  Needed on MacOs.  Report from Bruno.

2024-06-10  Patrice Dumas  <pertusus@free.fr>

	Fix out-of-source build of pod2texi.texi

	* doc/tp_api/Makefile.am (pod2texi.texi): create pod2texi.texi in
	$(srcdir) by passing the --subdir option.
	Pass "-I $(top_builddir)/tp" to perl to find generated modules,
	from Gavin.

2024-06-09  Gavin Smith <gavinsmith0123@gmail.com>

	Fix out-of-source build of texi2any_internals.texi

	* doc/tp_api/Makefile.am (texi2any_internals.texi):
	Pass  "-I $(top_builddir)/tp" to perl to find generated modules.
	Filter output through sed by outputting a temporary file rather
	than piping output - this allows detecting if perl run failed.

2024-06-06  Patrice Dumas  <pertusus@free.fr>

	* Makefile.am (po_document-check): Check for cdt, pcdt, cdt_string
	and gdt_string, by modifying the regex.  Some unused functions could
	be found, such as pgdt_string, but it should not be an issue.

	* po/Makevars, po_document/Makevars: add comments to remember to
	update po*-check when new functions are added as keywords.

2024-06-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/DocumentXS.xs (document_tree)
	(indices_sort_strings), tp/Texinfo/XS/main/build_perl_info.c
	(BUILD_PERL_DOCUMENT_ITEM, BUILD_PERL_DOCUMENT_LIST)
	(document_global_information): rename sv_ref to avoid false positiver
	reported by ppport.h as sv_ref is also exported as part of Perl API as
	a function.  Report by Gavin.

2024-06-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert),
	tp/Texinfo/XS/convert/convert_html.c
	(set_special_units_targets_files): remove code that is never run
	found with solaris compiler.

	* tp/Texinfo/XS/convert/convert_html.c
	(set_special_units_targets_files): MONOLITHIC option is integer.
	Found with solaris compiler.

2024-06-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/call_html_perl_function.c: include ppport.h for
	G_LIST.

2024-06-06  Patrice Dumas  <pertusus@free.fr>

	Substitute Perl formatting function for button only for Perl with cv_name

	* tp/Texinfo/XS/main/get_perl_info.c
	(html_get_button_specification_list): replace the Perl formatting
	function for button by a C formatting function for default formatting
	functions only if the PErl version has cv_name.  Based on ppport.h
	output, use 5.21.5 as minimum Perl version.  Based on Gavin
	investigations.

2024-06-06  Patrice Dumas  <pertusus@free.fr>

	Do not use unnamed union for INDEX_COLLATOR

	* tp/Texinfo/XS/main/manipulate_indices.c (INDEX_COLLATOR): rename the
	union as coll.  Update codes using the corresponding union fields.

2024-06-06  Patrice Dumas  <pertusus@free.fr>

	Do not use unnamed union for CONVERTER

	* tp/Texinfo/XS/main/converter_types.h (CONVERTER): rename the
	registered ids union as rid.  Update codes using the corresponding
	union fields.

2024-06-06  Patrice Dumas  <pertusus@free.fr>

	Do not use unnamed union for COMMAND_OR_TYPE

	* tp/Texinfo/XS/main/converter_types.h (COMMAND_OR_TYPE): name the
	union as ct.  Update codes using the corresponding union fields.

2024-06-06  Patrice Dumas  <pertusus@free.fr>

	Do not use unnamed union for OPTION

	* tp/Texinfo/XS/main/option_types.h: name the main union as o.  Update
	codes using the corresponding union fields.

2024-06-06  Patrice Dumas  <pertusus@free.fr>

	Do not use unnamed union for KEY_PAIR and BUTTON_SPECIFICATION*

	* tp/Texinfo/XS/main/tree_types.h (KEY_PAIR): name the main union as
	k.  Update codes using the corresponding union fields.

	* tp/Texinfo/XS/main/option_types.h (BUTTON_SPECIFICATION_INFO)
	(BUTTON_SPECIFICATION): name the main union as b or bi.  Update codes
	using the corresponding union fields.

2024-06-05  Gavin Smith <gavinsmith0123@gmail.com>

	* po/POTFILES.in: update

2024-06-05  Gavin Smith <gavinsmith0123@gmail.com>

	* Makefile.am (po-check): Check for message_list_document_warn,
	message_list_document_error, message_list_command_warn and
	message_list_command_error.

2024-06-05  Gavin Smith <gavinsmith0123@gmail.com>

	* Makefile.am (po-check): Remove check for lex/yacc sources as
	this does not apply anywhere in this package.

2024-06-04  Gavin Smith <gavinsmith0123@gmail.com>

	Partial po/POTFILES.in update

	* po/POTFILES.in: add/remove some files

	* Makefile.am (po-check): Remove code checking for strings in
	.twjr files as it led to false positives for C files containing
	simply the string constant "__".  This code was not doing anything
	anyway as it was not enabled for "*.twjr" files.

	* TODO: mention that texindex strings don't seem to be
	translated.

2024-06-04  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/convert/ConvertXS.xs,
	* tp/Texinfo/XS/convert/call_html_perl_function.c,
	* tp/Texinfo/XS/parsetexi/Parsetexi.xs:
	Add/remove #include "ppport.h" according to output of "perl ppport.h".

2024-06-04  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: advice on upgrading ppport.h

2024-06-04  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS: run gnulib-tool --add-import

2024-06-04  Gavin Smith <gavinsmith0123@gmail.com>

	Run gnulib-tool --add-import at top level

2024-06-03  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (_handle_other_command)
	* tp/Texinfo/XS/parsetexi/handle_commands.c (handle_other_command):
	Issue warning for @ at end of line command.

2024-06-03  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: add entry for SPARC memory alignment bugfix

2024-06-03  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: add entry for fix on 2024-02-09 "Fix unnumbered sections
	in PDF outline."

2024-06-03  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: add entry for fix on 2024-02-11 "Avoid crash from
	undefined style."

2024-06-03  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: add entry for fix on 2024-05-01 "Remove parent of @include
	or @setfilename source mark elements"

2024-06-02  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (The Top Node, Updating Commands):
	Avoid saying "sectioning command line" as this is confusing.

2024-06-02  Gavin Smith <gavinsmith0123@gmail.com>

	Prepare for pretest release

	* configure.ac: bump version to 7.1.90.
	(AM_INIT_AUTOMAKE): add dist-xz option.

	* util/texi2dvi, util/texi2pdf, js/info.js: version, copyright date.

	* tp/texi2any.pl, info/info.c, install-info/install-info.c,
	texindex/ti.twjr, Pod-Simple-Texinfo/pod2texi: 2024 in version
	messages.

2024-05-29  Alfred M. Szmidt  <ams@gnu.org>  (tiny change)

	* tp/Texinfo/XS/main/utils.c (clear_option, free_option)
	(initialize_option): Add a no-op compund statment to mitigate
	errors from GCC.

2024-05-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (merge_text): remove unused
	variable.

2024-05-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/macro.c (handle_macro),
	tp/Texinfo/XS/parsetexi/parser.c (internal_space_holder)
	(abort_empty_line, start_empty_line_after_command),
	tp/Texinfo/XS/parsetexi/separator.c (handle_open_brace, handle_comma):
	instead of putting the command associated to internal spaces in the
	extra information of the space, put it in a global element,
	internal_space_holder.
	Also reuse the internal space as the info spaces_before_argument
	of the command associated with the internal space.

2024-05-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/close.c (is_container_empty),
	tp/Texinfo/XS/parsetexi/macro.c: remove unused remove_empty_arg
	functions.  Make is_container_empty static.

2024-05-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/api.c (parse_file): cast the decode_string
	argument to char* to remove the const, as, even if decode_string do
	not modify its argument, it cannot be marked const if iconv input
	buffer is not const in iconv prototype.

2024-05-29  Patrice Dumas  <pertusus@free.fr>

	Use the command line encoding for input file name in message

	* tp/Texinfo/XS/main/parser_conf.c (clear_parser_conf),
	tp/Texinfo/XS/main/parser_conf.h (PARSER_CONF),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs
	(parser_conf_set_COMMAND_LINE_ENCODING),
	tp/Texinfo/XS/parsetexi/conf.c (parser_conf_set_COMMAND_LINE_ENCODING)
	(reset_parser_conf): pass COMMAND_LINE_ENCODING to C code.

	* b/tp/Texinfo/XS/parsetexi/api.c (parse_file): use the
	COMMAND_LINE_ENCODING, if set, to decode the input file path name
	for error line part of the error message output if the input file
	cannot be opened.

2024-05-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c
	(destroy_document_information_except_tree)
	(remove_document_descriptor): destroy the document structure fields
	and the small_strings even if the tree is not set.

	* tp/Texinfo/XS/main/document.c
	(unregister_document_merge_with_document): free the removed document
	itself and liberate the document list slot.

2024-05-28  Patrice Dumas  <pertusus@free.fr>

	Fix error message of XS parser when the input file cannot be opened

	* tp/Texinfo/XS/parsetexi/api.c (initialize_parsing, parse_file)
	(parse_text, parse_string, parse_piece): have initialize_parsing
	return the document_descriptor and get it from there in parse_*.

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parse_texi_file),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (parse_file),
	tp/Texinfo/XS/parsetexi/api.c (parse_file): add a status
	argument to parse_file in api.c, set it to non-zero if the parsing
	could not proceed.  Set the open error message in api.c parse_file,
	where the error can be converted to a string with strerror.  Return a
	document_descriptor even if there was an error.  In Parsetexi.xs
	parse_file, check the status, and if there was an error, get the
	parsing error and destroy the document.  Remove the error setting
	in Parsetexi.pm parse_texi_file, where $! is unlikely to be correct.

	* tp/Texinfo/ParserNonXS.pm (parse_texi_file): rename $input_file_name
	as $decoded_input_file_path.

	* tp/Texinfo/ParserNonXS.pm (parse_texi_file): do not pass the
	PROGRAM configuration value to document_error, it is not in the parser
	customization variables, and we do not want to add more.

2024-05-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parse_texi_file): remove the
	now useless call to fileparse.

2024-05-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line):
	set directly line to an empty string instead of going to the end of
	line.

	* tp/Texinfo/XS/parsetexi/parser.c (isolate_trailing_space):
	reuse text_len instead of calling strlen.

2024-05-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/translations.c (replace_substrings),
	tp/Texinfo/XS/main/utils.c (read_flag_len),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block),
	tp/Texinfo/XS/parsetexi/handle_commands.c (parse_rawline_command),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): replace
	read_flag_name by read_flag_len that only returns the length of the
	flag.  This allows to check first if there is a matching brace or if
	there is nothing remaining on the line before allocating the memory
	for the flag.  Update callers.

	* tp/Texinfo/XS/parsetexi/parser.c (new_value_element)
	(process_remaining_on_line): add length of flag as an argument to
	new_value_element.  Update callers.

	* tp/Texinfo/XS/parsetexi/parser.c (abort_empty_line)
	(isolate_last_space_internal): use text_append_n instead of
	text_append.

	* tp/Texinfo/XS/parsetexi/parser.c (isolate_last_space_internal):
	reuse text_len instead of calling strlen.

2024-05-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/macro.c (handle_macro): use strchrnul
	instead of strchr to have more common code.

2024-05-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_abort_empty_line),
	tp/Texinfo/XS/parsetexi/parser.c (abort_empty_line): different debug
	message if additional_spaces are added or not.

	* tp/Texinfo/XS/parsetexi/parser.c (abort_empty_line),
	tp/Texinfo/XS/parsetexi/parser.c (merge_text): add a length
	argument for additional_spaces length.  Update callers.

2024-05-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/macro.c (handle_macro),
	tp/Texinfo/XS/parsetexi/menus.c (handle_menu_entry_separators)
	(end_line_menu_entry), tp/Texinfo/XS/parsetexi/parser.c (merge_text)
	(process_remaining_on_line), tp/Texinfo/XS/parsetexi/separator.c
	(handle_open_brace, handle_close_brace): add a text length argument to
	merge_text.  Update merge_text and callers.

	* tp/Texinfo/XS/parsetexi/close.c (close_current): use text_append_n
	instead of text_append.

	* tp/Texinfo/XS/parsetexi/multitable.c (gather_previous_item): output
	REPARENT debug message only if there are contents in before_item.

2024-05-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_gather_previous_item),
	tp/Texinfo/XS/parsetexi/multitable.c (gather_previous_item): add a
	debug message.

2024-05-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Translations.pm (configure): warn if $localesdir
	is undefined and do not call bindtextdomain nor _XS_configure
	in that case.

	* tp/t/same_parser_multiple_files.t: find $localesdir and call
	Texinfo::Translations::configure.

	* tp/t/test_utils.pl: add a comment to explain that even with
	LocaleData not found, the test could still succeed if the translations
	are found elsewhere.

2024-05-27  Patrice Dumas  <pertusus@free.fr>

	* doc/tp_api/texi2any_internals_preamble.texi: add @setfilename for
	platforms with old automake < 1.6.2.

2024-05-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parse_texi_file): rename
	$input_file_name as $decoded_input_file_path.

	* tp/Texinfo/XS/parsetexi/Parsetexi.xs (parse_file),
	tp/Texinfo/XS/parsetexi/api.c (parse_file),
	tp/Texinfo/XS/parsetexi/input.c (input_push_file): rename filename as
	input_file_path.

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parse_texi_file),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (parse_file),
	tp/Texinfo/XS/parsetexi/api.c (parse_file, parse_file_path): pass
	only the input file path to parse_file.  Determine the directory in
	parse_file using the new function parse_file_path.

	* tp/Texinfo/XS/parsetexi/input.c: add some const.

	Changes in comments.

2024-05-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/DocumentXS.xs (document_errors): warn if a
	document C data is not found.

	* tp/Texinfo/XS/main/build_perl_info.c (add_formatted_error_messages):
	remove error messages for situations that should not happen.

2024-05-26  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_parse_texi_line.t: change in variable names, test the
	number of errors in any case.

	* tp/t/test_protect_hashchar_at_line_beginning.t: use
	Texinfo::XSLoader::XS_*_enabled, change in variable names, test the
	number of errors in any case, use a list for reference errors, use the
	same code for errors handling as in test_parse_texi_line.t.

2024-05-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_id_is_registered)
	(html_register_id, html_converter_initialize, html_reset_converter)
	(html_free_converter), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER): make registered_ids a pointer in CONVERTER, to have only
	pointers in the registered ids union.

2024-05-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/converter_types.h (CONVERTER): rename seen_ids as
	registered_ids.  Update users.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_register_id)
	(html_id_is_registered), tp/Texinfo/XS/convert/convert_html.c
	(html_id_is_registered, html_register_id): add html_id_is_registered
	and html_register_id functions for registered_ids access.

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(init_registered_ids_hv, is_hv_registered_id, hv_register_id)
	(clear_registered_ids_hv, free_registered_ids_hv),
	tp/Texinfo/XS/convert/convert_html.c (USE_PERL_HASHMAP)
	(html_id_is_registered, html_register_id, html_converter_initialize)
	(html_reset_converter, html_free_converter),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): add an alternative
	interface to register and retrieve registered ids, using a Perl hash.
	If USE_PERL_HASHMAP is defined, the default, the Perl hash map is
	used.

2024-05-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/parser_conf.c: add a NOTE in comment explaining
	why the registered confs are never unallocated.

2024-05-24  Patrice Dumas  <pertusus@free.fr>

	* tp/t/no_structure_test.t: uncomment the call to
	Texinfo::Tests::create_group_directory.

2024-05-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files),
	tp/t/input_files/first_file_same_parser.texi,
	tp/t/input_files/last_file_same_parser.texi,
	tp/t/input_files/next_file_same_parser.texi, tp/Makefile.tres,
	t/same_parser_multiple_files.t: add a special test of reused parser
	used to parser different files.

2024-05-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Tests.pm (@EXPORT_OK, create_group_directory)
	(prepare_format_directories), tp/t/no_structure_test.t
	(_do_format_test_file): add a Package declaration in Texinfo/Tests.pm.
	Add create_group_directory, move _prepare_test_directory to
	Texinfo::Tests, renaming as prepare_format_directories.  Rename
	_run_file_test as _do_format_test_file.

2024-05-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am, tp/t/test_utils.pl, tp/Texinfo/Tests.pm
	(compare_dirs_files, unlink_dir_files): add tp/Texinfo/Tests.pm for
	common code to be used in tests.

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): avoid incorrect
	autovivification for bracketed_arg parent parent.

	* tp/Texinfo/XS/convert/convert_html.c (html_default_format_contents):
	do contents only if there is one section.

	* tp/Texinfo/Convert/DocBook.pm (_docbook_section_element, _convert),
	tp/Texinfo/Convert/HTML.pm (_convert_heading_command)
	(_prepare_output_units_global_targets, _default_format_contents),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/OutputUnits.pm (units_directions),
	tp/Texinfo/Structuring.pm (section_level_adjusted_command_name),
	tp/Texinfo/XS/convert/convert_html.c (html_default_format_contents)
	(convert_heading_command), tp/Texinfo/XS/main/utils.c
	(section_level_adjusted_command_name): handle better extra
	section_level, section_directions and section_childs not set, in case
	there is a conversion without structuring information available.

	* tp/Makefile.tres, t/no_structure_test.t: add tests of conversion
	without calling Structuring code after parsing.

2024-05-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c (wipe_document_errors)
	(wipe_document_parser_errors): rename clear_document_parser_errors as
	wipe_document_parser_errors and clear_document_errors as
	wipe_document_errors.  Update caller.

2024-05-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm: access 'accept_internalvalue' in 'conf'.

	* tp/Texinfo/ParserNonXS.pm (_initialize_parsing): only initialize
	states from conf if they are modified during parsing.

2024-05-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/api.c (parse_file): comment out the code
	adding the input file directory to the include directories list as it
	is already done in the main program.

2024-05-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm: access customization options in 'conf'
	if they are not supposed to change during parsing.

2024-05-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm (_add_element_to_identifiers_target): remove
	unused customization_information argument.

	* tp/Texinfo/Report.pm (line_warn, line_error), tp/Texinfo/Common.pm
	(get_perl_encoding, converter_or_registrar_line_warn),
	tp/Texinfo/Document.pm (_existing_label_error)
	(set_labels_identifiers_target, register_label_element),
	tp/Texinfo/ParserNonXS.pm (_line_warn) (_line_error): do not pass
	customization_information, pass directly $debug.  Update callers.

	* tp/Texinfo/Common.pm (locate_include_file): do not pass
	customization_information, pass directly $include_directories.  Update
	callers.

	* tp/Texinfo/Report.pm (document_warn, document_error),
	tp/t/test_parser_registrar.t: do not pass customization_information,
	pass directly $program_name. Update callers.

	* tp/Texinfo/ParserNonXS.pm (parse_texi_file, _encode_file_name)
	(_next_text, _end_line_misc_line),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (_get_parser_info)
	(parse_texi_file), tp/t/do_master_menu.t,
	tp/t/test_protect_hashchar_at_line_beginning.t: access directly conf
	in $self->{'conf'}. remove get_conf from parsers.

2024-05-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/parser_conf.c (free_parser_conf, apply_conf):
	If the previous conf is not registered, free the list in addition to
	clearing them as they are overwritten.  Found with valgrind.

2024-05-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/translations.c (replace_convert_substrings): call
	reset_parser_conf now that the configurations can be separate.

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser): do not store the
	configuration for later reuse of the parser if accept_internalvalue is
	set, which is interpreted as being called from gdt, in which case the
	parser will not be reused.

2024-05-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (wipe_values),
	tp/Texinfo/XS/parsetexi/macro.c: move wipe_values to utils.c such that
	it may be used by files in main.

2024-05-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/get_perl_info.c (apply_sv_parser_conf),
	tp/Texinfo/XS/main/parser_conf.c (apply_conf),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (parse_texi_file)
	(parse_texi_piece, parse_texi_text, parse_texi_line),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (parse_file, parse_piece)
	(parse_string, parse_text), tp/Texinfo/XS/parsetexi/conf.c
	(reset_parser_conf): pass parser to parser_* functions in Parsetexi.xs
	to retrieve the parser_conf_descriptor kept in the parser with
	apply_sv_parser_conf.  Replace the current global_parser_conf with the
	parser_conf associated with the parser by calling apply_conf.
	Do not clear global_parser_conf structures in reset_parser_conf if the
	global_parser_conf is registered.  Inline clear_global_parser_conf.

2024-05-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/input.c (parser_include_directories)
	(parser_locate_include_file), tp/Texinfo/XS/parsetexi/api.c
	(initialize_parsing, parse_file): add parser_include_directories,
	initialized from a copy of global_parser_conf.include_directories
	to add the input file directory for the parsing only and not to the
	configuration.

2024-05-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/parser_conf.c (parser_conf_list)
	(parser_conf_number, parser_conf_space, retrieve_parser_conf)
	(register_conf, clear_parser_conf), tp/Texinfo/XS/main/parser_conf.h
	(PARSER_CONF), tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (register_parser_conf),
	tp/Texinfo/XS/parsetexi/conf.c (reset_parser_conf): add
	parser_conf_list, a list of PARSER_CONF and register parser
	configuration setup at the end of Parsetexi.pm parser through the
	reset_parser_conf XS interface.  Clear memory of the global parser
	conf only if it is not registered.

2024-05-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES),
	tp/Texinfo/XS/parsetexi/*.c, tp/Texinfo/XS/parsetexi/conf.c,
	tp/Texinfo/XS/main/parser_conf.c (global_parser_conf)
	(clear_parser_conf, clear_global_parser_conf),
	tp/Texinfo/XS/main/parser_conf.h (PARSER_CONF): add main/parser_conf.c
	and main/parser_conf.h with code from parsetexi/conf.c and
	parsetexi/conf.h, with the PARSER_CONF structure and
	clear_parser_conf.  Rename global parser_conf variable as
	global_parser_conf.

2024-05-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm (errors), tp/Texinfo/ParserNonXS.pm (errors),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (errors),
	tp/t/test_parse_texi_line.t: clear Texinfo::Report errors when
	returning them with a call to errors().

2024-05-21  Patrice Dumas  <pertusus@free.fr>

	Reset parsing state to the configuration values before parsing

	* tp/Texinfo/Common.pm (%common_parser_customization)
	(%parser_customization, %parser_inner_options): rename
	%common_parser_options as %common_parser_customization and add
	LOCALE_ENCODING.  Rename %parser_options as %parser_customization and
	%parser_inner_configuration as %parser_inner_options.

	* tp/Texinfo/Common.pm (%parser_configuration)
	(%parser_document_state_configuration)
	(%parser_document_parsing_options): split %parser_state_configuration
	in two with %parser_configuration with registrar and
	%parser_document_state_configuration with values.  Add
	%parser_document_parsing_options for all the customizations and
	similar that should be set for a document parsing.

	* tp/Texinfo/ParserNonXS.pm (%parser_document_state_initialization)
	(%parsing_state_initialization): move 'sections_level_modifier' and
	'input_file_encoding' from %parsing_state_initialization to
	%parser_document_state_initialization.

	* tp/Texinfo/ParserNonXS.pm (parser, _initialize_parsing): base
	configuration on %Texinfo::Common::parser_document_parsing_options.
	Add a $parser_conf hash reference and fill it instead of modifying the
	parser itself for variables in Texinfo::Common
	parser_document_parsing_options and add only the others (only
	registrar, in practice) to the parser.  Store $parser_conf in
	$parser->{'conf'}.  Use $parser->{'conf'} to reset the parser in
	_initialize_parsing.

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser, parse_texi_file)
	(_get_parser_info): update based on change in ParserNonXS.pm.  Inline
	_get_parser_error_registrar.

	* tp/Texinfo/XS/parsetexi/api.c (initialize_parsing): move code around
	to correspond better to type of variables in Perl.

	* tp/Texinfo/XS/parsetexi/conf.c (reset_parser_conf): set debug to 0
	in the default case.

2024-05-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (%parsing_state_initialization)
	(get_parser_info, _end_line_misc_line, _handle_close_brace): store
	'input_encoding_name' directly in $document->{'global_info'}.

2024-05-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/macro.c (new_macro): inline lookup_free_slot
	in new_macro.

2024-05-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/macro.c (free_slots_nr, lookup_free_slot)
	(new_macro, unset_macro_record, wipe_macros): keep track of the number
	of free slots available after calls of unset_macro_record.  If there
	is a free slot and the macro was not already found, use preferentially
	a free slot, found with lookup_free_slot.

2024-05-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree.c, tp/Texinfo/XS/parsetexi/macro.c: add
	const.

2024-05-20  Patrice Dumas  <pertusus@free.fr>

	Add const

2024-05-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/debug.c (debug_protect_eol): always allocate the
	returned string.  Update callers.

	* tp/Texinfo/XS/parsetexi/commands.c (close_preformatted_command):
	remove obsolete check of index_entry_command.

	* tp/Texinfo/XS/parsetexi/macro.c (parse_macro_command_line):
	distinguish the line and pointers on line.

	* tp/Texinfo/XS/*/*.c: add const.  Use strndup instead of modifying
	temporarily an input line otherwise not modified to add an end of line.

2024-05-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/source_marks.c (source_marks_counters)
	(register_source_mark, transfer_source_marks): add
	source_marks_counters array to hold the source marks counters.

2024-05-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/api.c (parser_conf_reset_values)
	(parser_conf_add_value): rename parser_reset_values_conf as
	parser_conf_reset_values and parser_store_value as
	parser_conf_add_value.  Update users.

2024-05-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/conf.c: add parser_ in the name of all the
	functions in conf.c that are part of the parser public API.

2024-05-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/conf.h (PARSER_CONF): rename CONF as
	PARSER_CONF.

2024-05-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/conf.h (parser_conf): rename conf as
	parser_conf.  Update users.

2024-05-20  Patrice Dumas  <pertusus@free.fr>

	Set remaining configuration vaiables in CONF

	* tp/Texinfo/XS/main/translations.c (replace_convert_substrings),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs
	(conf_set_DOC_ENCODING_FOR_INPUT_FILE_NAME)
	(conf_set_INPUT_FILE_NAME_ENCODING, conf_set_LOCALE_ENCODING)
	(conf_set_accept_internalvalue), tp/Texinfo/XS/parsetexi/api.c
	(reset_parser), tp/Texinfo/XS/parsetexi/commands.c (lookup_command),
	tp/Texinfo/XS/parsetexi/conf.c
	(conf_set_DOC_ENCODING_FOR_INPUT_FILE_NAME)
	(conf_set_INPUT_FILE_NAME_ENCODING, conf_set_LOCALE_ENCODING)
	(conf_set_accept_internalvalue, reset_conf),
	tp/Texinfo/XS/parsetexi/conf.h (CONF), tp/Texinfo/XS/parsetexi/input.c
	(encode_file_name), tp/Texinfo/XS/parsetexi/parser.c: add
	doc_encoding_for_input_file_name, input_file_name_encoding,
	locale_encoding and accept_internalvalue in CONF.  Add the
	corresponding functions to set them.  Remove
	parser_set_DOC_ENCODING_FOR_INPUT_FILE_NAME,
	parser_set_input_file_name_encoding, parser_set_locale_encoding,
	parser_set_accept_internalvalue, set_input_file_name_encoding,
	set_locale_encoding, set_doc_encoding_for_input_file_name and the
	corresponding variables.

2024-05-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (%parser_state_configuration)
	(%parser_inner_configuration, %parser_settable_configuration),
	tp/Texinfo/ParserNonXS.pm (parser),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser): move
	%parser_state_configuration, %parser_inner_configuration and
	%parser_settable_configuration to Texinfo::Common.  Update
	Parsetexi.pm to set the same keys as ParserNonXS parser.  Inline
	_setup_conf in ParserNonXS.pm parser.

2024-05-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/api.c (initialize_parsing),
	tp/Texinfo/XS/parsetexi/parser.c: inline
	wipe_parser_global_variables in initialize_parsing.

2024-05-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (conf_set_documentlanguage),
	tp/Texinfo/XS/parsetexi/api.c (initialize_parsing, reset_parser),
	tp/Texinfo/XS/parsetexi/conf.c (conf_set_documentlanguage)
	(reset_conf), tp/Texinfo/XS/parsetexi/conf.h (CONF),
	tp/Texinfo/XS/parsetexi/parser.c (wipe_parser_global_variables): add
	documentlanguage and global_documentlanguage_fixed in CONF, add
	conf_set_documentlanguage to set them.  Initialize
	global_documentlanguage in initialize_parsing.  Remove
	parser_set_documentlanguage_override and
	set_documentlanguage_override.

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line),
	tp/Texinfo/XS/parsetexi/parser.c: inline set_documentlanguage in
	end_line_misc_line.

2024-05-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (parser_store_EXPANDED_FORMATS):
	iterate over EXPANDED_FORMATS in Parsetexi.xs.

2024-05-20  Patrice Dumas  <pertusus@free.fr>

	Replace parser_expanded_formats by const.expanded_formats

	* tp/Texinfo/XS/main/utils.h: rename expanded_formats as
	default_expanded_formats, make it const and extern.

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (conf_clear_expanded_formats)
	(conf_add_expanded_format), tp/Texinfo/XS/parsetexi/api.c
	(reset_parser), tp/Texinfo/XS/parsetexi/conf.c (reset_conf)
	(conf_clear_expanded_formats, conf_add_expanded_format): add
	expanded_formats in CONF, add conf_clear_expanded_formats to clear,
	conf_add_expanded_format to add expanded formats and replace
	parser_expanded_formats by const.expanded_formats. Remove
	parser_clear_expanded_formats and parser_add_expanded_format.

	This changes the default expanded formats to be none, which matches
	Perl (and POD of Parser module).

2024-05-19  Patrice Dumas  <pertusus@free.fr>

	Replace parser_include_dirs_list by conf.include_directories

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs
	(parser_store_INCLUDE_DIRECTORIES), tp/Texinfo/XS/parsetexi/api.c
	(reset_parser, parse_file), tp/Texinfo/XS/parsetexi/conf.c
	(conf_clear_INCLUDE_DIRECTORIES, conf_add_include_directory)
	(reset_conf), tp/Texinfo/XS/parsetexi/conf.h (CONF),
	tp/Texinfo/XS/parsetexi/input.c (parser_locate_include_file): iterate
	over the INCLUDE_DIRECTORIES array reference in XS
	parser_store_INCLUDE_DIRECTORIES function instead of doing it in Perl.
	Add include_directories STRING_LIST in CONF, add
	conf_clear_INCLUDE_DIRECTORIES to clear it and
	conf_add_include_directory to add to it and replace
	parser_include_dirs_list by conf.include_directories.  Remove
	parser_add_include_directory and parser_clear_include_directories.

2024-05-19  Patrice Dumas  <pertusus@free.fr>

	Replace debug_output by conf.debug

	* tp/Texinfo/XS/main/translations.c (replace_convert_substrings),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (conf_set_DEBUG),
	tp/Texinfo/XS/parsetexi/api.c, tp/Texinfo/XS/parsetexi/conf.c
	(conf_set_DEBUG, reset_conf), tp/Texinfo/XS/parsetexi/conf.h (CONF),
	tp/Texinfo/XS/parsetexi/debug_parser.c,
	tp/Texinfo/XS/parsetexi/errors_parser.c (line_error_internal),
	tp/Texinfo/XS/parsetexi/parser.c (complete_indices): add debug field
	in CONF, add conf_set_DEBUG function to set it, and replace
	debug_output by conf.debug.  Remove set_debug_output and
	parser_set_debug.

2024-05-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/api.c (initialize_parsing): rename
	reset_parser_except_conf to initialize_parsing and make it static.

2024-05-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/api.c (reset_parser_except_conf),
	tp/Texinfo/XS/parsetexi/parser.c (parse_texi): call
	init_index_commands in reset_parser_except_conf and not in parse_texi,
	now that reset_parser_except_conf only called right before parse_texi
	and not in reset_parser anymore.

2024-05-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/api.c (reset_parser_except_conf, parse_file)
	(parse_text, parse_string, parse_texi): call new_document and
	set_input_encoding in reset_parser_except_conf.

2024-05-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/translations.c (replace_convert_substrings):
	do not call reset_parser_except_conf, it is already called in
	parse_string.

2024-05-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser): check on keys
	independentely of values.

2024-05-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser, parse_texi_piece)
	(parse_texi_text, parse_texi_line),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (parse_piece, parse_piece)
	(parse_string, parse_text, parser_add_expanded_format)
	(parser_set_input_file_name_encoding, parser_set_locale_encoding)
	(parser_set_documentlanguage_override): do not encode to UTF-8 in Perl
	code and get binary strings in XS, instead use SvPVutf8 to get string
	and convert to UTF-8 in XS.

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser): check on keys
	independentely of values, i.e. do not test in one condition the key name
	and whether the value is defined, use only the key name in the first
	condition and test afterwards if the value is defined.

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs: change in spacing.

2024-05-19  Patrice Dumas  <pertusus@free.fr>

	Remove memory leaks (valgrind)

	* tp/Texinfo/XS/parsetexi/api.c (parser_reset_values_conf): wipe
	conf values.

	* tp/Texinfo/XS/parsetexi/conf.c (reset_conf): do not call memset, in
	order to keep and reuse the conf.values list.  Wipe conf values.

	* tp/Texinfo/XS/parsetexi/macro.c (init_values): wipe parser values.

	* tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/main/output_unit.c: remove memory leaks in debug
	messages.

2024-05-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document_types.h (VALUE, VALUE_LIST): move VALUE
	definition to document_types.h, define VALUE_LIST.

	* tp/Texinfo/XS/parsetexi/macro.c (wipe_values): wipe values from a
	VALUE_LIST passed in argument.

	* tp/Texinfo/XS/parsetexi/macro.c (store_value, store_parser_value),
	(parser_values, clear_value, fetch_value),
	tp/Texinfo/XS/parsetexi/handle_commands.c (parse_rawline_command):
	modify store_value to store in a VALUE_LIST passed in argument.  Add
	the parser_values VALUE_LIST variable for the parser, replacing
	value_list, value_number and value_space that are removed.  Add
	store_parser_value that does the same as store_value previously by
	calling store_value with parser_values.  Update fetch_value and
	clear_value to use parser_values.

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (parser_store_values),
	tp/Texinfo/XS/parsetexi/api.c (parser_reset_values_conf)
	(reset_parser_except_conf, reset_parser, parser_store_value),
	tp/Texinfo/XS/parsetexi/conf.c (reset_conf),
	tp/Texinfo/XS/parsetexi/conf.h (CONF), tp/Texinfo/XS/parsetexi/macro.c
	(init_values): add values field in CONF to store default values and
	values from parser initialization.  Pass all the values from Perl hash
	at once through parser_store_values.  Reset the default values in CONF
	in parser_store_values by calling parser_reset_values_conf before
	setting customization values.  Modify reset_conf to set the default for
	CONF values, setting txicommandconditionals.
	Add init_values to initialize the parser values by copying CONF
	values.  Call init_values in reset_parser_except_conf.
	Do not call wipe_values in reset_parser, init_values now initialize
	the parser values based on configuration.

	* tp/Texinfo/XS/parsetexi/macro.c (fetch_value): remove the special
	case for txicommandconditionals, it should be set in reset_conf or
	from Perl through parser_store_values.

2024-05-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/api.c (reset_parser, parse_file): call
	reset_parser_except_conf in parse_file instead of reset_parser.

2024-05-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (%parser_document_state_initialization):
	initialize explicitly 'current_part'.

2024-05-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (parse_texi): set a document
	variable to keep track of the parsed document when the global variable
	is overwritten.

	* tp/Texinfo/XS/parsetexi/indices.c (complete_indices),
	tp/Texinfo/XS/parsetexi/parser.c (parse_texi): use a DOCUMENT in
	complete_indices call.

2024-05-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c (new_document)
	(destroy_document_information_except_tree, clear_document_errors)
	(clear_document_parser_errors), tp/Texinfo/XS/main/document_types.h
	(DOCUMENT), tp/Texinfo/XS/main/DocumentXS.xs,
	tp/Texinfo/XS/main/build_perl_info.c,
	tp/Texinfo/XS/main/translations.c,
	tp/Texinfo/XS/parsetexi/errors_parser.c,
	tp/Texinfo/XS/structuring_transfo/structuring.c,
	tp/Texinfo/XS/structuring_transfo/transformations.c: put
	error_messages and parser_error_messages directly in DOCUMENT, not as
	a pointer.

2024-05-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c (new_document)
	(destroy_document_information_except_tree),
	tp/Texinfo/XS/main/document_types.h (DOCUMENT),
	tp/Texinfo/XS/convert/ConvertXS.xs,
	tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/convert/converter.c,
	tp/Texinfo/XS/main/build_perl_info.c,
	tp/Texinfo/XS/main/get_perl_info.c,
	tp/Texinfo/XS/parsetexi/handle_commands.c,
	tp/Texinfo/XS/parsetexi/parser.c,
	tp/Texinfo/XS/structuring_transfo/structuring.c,
	tp/Texinfo/XS/structuring_transfo/transformations.c: put
	global_commands directly in DOCUMENT, not as a pointer.

2024-05-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c (new_document),
	tp/Texinfo/XS/main/document_types.h (DOCUMENT),
	tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/main/DocumentXS.xs,
	tp/Texinfo/XS/main/build_perl_info.c,
	tp/Texinfo/XS/main/convert_to_text.c, tp/Texinfo/XS/main/utils.c,
	tp/Texinfo/XS/parsetexi/api.c,
	tp/Texinfo/XS/parsetexi/handle_commands.c,
	tp/Texinfo/XS/parsetexi/indices.c, tp/Texinfo/XS/parsetexi/input.c,
	tp/Texinfo/XS/parsetexi/macro.c, tp/Texinfo/XS/parsetexi/separator.c:
	put global_info directly in DOCUMENT, not as a pointer.

2024-05-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c
	(unregister_document_merge_with_document): simplify code.

	* tp/Texinfo/XS/main/targets.c (set_labels_identifiers_target): pass a
	LABEL_LIST.  Update callers.

	* tp/Texinfo/XS/main/DocumentXS.xs (document_errors),
	tp/Texinfo/XS/main/build_perl_info.c (add_formatted_error_messages)
	(pass_errors_to_registrar): call clear_error_message_list out of code
	building Perl as far as possible.

	* tp/Texinfo/XS/main/build_perl_info.c, tp/Texinfo/XS/main/targets.c,
	tp/maintain/regenerate_C_options_info.pl: add const.

2024-05-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/DocumentXS.xs (set_document_global_info): fix
	format.

	* tp/Texinfo/XS/convert/converter.c,
	tp/Texinfo/XS/main/build_perl_info.c,
	tp/Texinfo/XS/main/get_perl_info.c, tp/Texinfo/XS/main/utils.c: add
	const.

2024-05-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (build_target_elements_list)
	(build_internal_xref_list, build_float_types_list)
	(BUILD_PERL_DOCUMENT_LIST): use a list as input argument.  Update
	callers.  Modify BUILD_PERL_DOCUMENT_LIST to use a list too, using the
	address of the fieldname.

	* tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/convert/get_html_perl_info.c,
	tp/Texinfo/XS/main/IndicesXS.xs, tp/Texinfo/XS/main/document.c
	(new_document, destroy_document_information_except_tree),
	tp/Texinfo/XS/main/document_types.h (DOCUMENT),
	tp/Texinfo/XS/main/floats.c (float_list_to_listoffloats_list)
	(free_listoffloats_list), tp/Texinfo/XS/main/targets.c
	(set_labels_identifiers_target, sort_labels_identifiers_target)
	(add_element_to_identifiers_target), tp/Texinfo/XS/main/utils.c
	(free_indices_info), tp/Texinfo/XS/parsetexi/end_line.c,
	tp/Texinfo/XS/parsetexi/indices.c, tp/Texinfo/XS/parsetexi/labels.c,
	tp/Texinfo/XS/parsetexi/parser.c (parse_texi),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs
	(relate_index_entries_to_table_items_in_tree),
	tp/Texinfo/XS/structuring_transfo/structuring.c,
	tp/Texinfo/XS/structuring_transfo/transformations.c: put directly
	structures in DOCUMENT instead of pointers for some fields that are
	not moved around.  Modify float_list_to_listoffloats_list and
	set_labels_identifiers_target to take in argument the list where the
	generated structure will be put instead of returning it.  Replace
	destroy_listoffloats_list by free_listoffloats_list, which does not
	destroy the argument.  Modify sort_labels_identifiers_target and
	add_element_to_identifiers_target to change only the list of
	identifiers_target, not the LABEL_LIST.  Replace wipe_index_names by
	free_indices_info that does not destroy the argument.

2024-05-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c (document_list, retrieve_document)
	(new_document, remove_document_descriptor): store a document pointer
	in document_list, not a document, such that the document pointer
	remains valid upon reallocating.  Then it becomes easier to have
	fields in the document being themselves structures instead of pointers
	on structures.

2024-05-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (prepare_index_entries_targets)
	(convert_printindex_command, html_initialize_output_state)
	(html_reset_converter), tp/Texinfo/XS/convert/get_html_perl_info.c
	(find_index_entry_numbers_index_entry_sv),
	tp/Texinfo/XS/main/IndicesXS.xs (index_entry_element_sort_string),
	tp/Texinfo/XS/main/build_perl_info.c (build_index_data)
	(fill_document_hv), tp/Texinfo/XS/main/document.c
	(document_merged_indices, document_indices_sort_strings)
	(destroy_document_information_except_tree),
	tp/Texinfo/XS/main/document_types.h (INDEX_LIST),
	tp/Texinfo/XS/main/get_perl_info.c (find_index_entry_sv)
	(get_sv_index_entries_sorted_by_letter)
	(find_document_index_entry_extra_index_entry_sv)
	(find_element_extra_index_entry_sv),
	tp/Texinfo/XS/main/manipulate_indices.c (merge_indices)
	(setup_index_entries_sort_strings), tp/Texinfo/XS/main/utils.c
	(indices_info_index_by_name, wipe_index_names),
	tp/Texinfo/XS/parsetexi/end_line.c (parse_line_command_args),
	tp/Texinfo/XS/parsetexi/indices.c (add_index_internal)
	(add_index, init_index_commands, forget_indices)
	(resolve_indices_merged_in, complete_indices),
	tp/Texinfo/XS/parsetexi/parser.c (parse_texi),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs
	(relate_index_entries_to_table_items_in_tree),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(lookup_index_entry, relate_index_entries_to_table_items_in)
	(relate_index_entries_to_table_items_internal)
	(relate_index_entries_to_table_items_in_tree): replace the index_names
	indices list by indices_info INDEX_LIST structure, with the number of
	indices. Pass an indices list as argument to
	resolve_indices_merged_in.

2024-05-18  Patrice Dumas  <pertusus@free.fr>

	Setup an empty document early instead of storing variables at the end

	* tp/Texinfo/XS/main/document.c (new_document),
	tp/Texinfo/XS/parsetexi/api.c (reset_parser_except_conf, parse_file)
	(parse_text, parse_string, parse_piece),
	tp/Texinfo/XS/parsetexi/end_line.c (parse_line_command_args)
	(end_line_starting_block, end_line_misc_line),
	tp/Texinfo/XS/parsetexi/errors_parser.c (line_error_internal),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command),
	(handle_block_command), tp/Texinfo/XS/parsetexi/indices.c
	(add_index_internal, add_index, init_index_commands)
	(enter_index_entry, forget_indices, resolve_indices_merged_in),
	tp/Texinfo/XS/parsetexi/input.c (set_input_encoding, encode_file_name)
	(save_string), tp/Texinfo/XS/parsetexi/labels.c (register_label)
	(remember_internal_xref), tp/Texinfo/XS/parsetexi/macro.c
	(store_value, clear_value), tp/Texinfo/XS/parsetexi/parser.c
	(parsed_document, register_global_command)
	(wipe_parser_global_variables, rearrange_tree_beginning)
	(parse_texi_document, parse_texi), tp/Texinfo/XS/parsetexi/separator.c
	(handle_close_brace),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs (copy_tree):
	setup a document global variable named parsed_document early on in
	parsing functions, parse_file, parse_text, parse_string and
	parse_piece and use the document structure for information that end up
	in the document instead of using global variables that are stored at
	the end of parsing.  Add new_document to create an empty document
	and remove store_document, now unused.  Add a document_descriptor
	argument to rearrange_tree_beginning.  Rename wipe_parser_global_info
	as wipe_parser_global_variables.  Remove register_document,
	wipe_errors, forget_errors, forget_small_strings, free_small_strings,
	reset_labels, forget_labels, wipe_identifiers_target,
	reset_internal_xrefs and forget_internal_xrefs functions and
	parser_float_list, error_messages_list, global_info, index_names,
	small_strings, labels_list, identifiers_target, internal_xref_list and
	global_commands global variables as parsed_document is directly used.

2024-05-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_initialize_parsing, _enter_index_entry):
	replace restricted by NO_INDEX where needed.

2024-05-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_initialize_parsing): update parser
	initialization for NO_INDEX and NO_USER_COMMANDS.

	* tp/Texinfo/ParserNonXS.pm: remove close_paragraph_commands and
	close_preformatted_commands as states, as they never change.

2024-05-17  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Global Customization Variables),
	tp/Texinfo/Common.pm (%parser_options), tp/Texinfo/ParserNonXS.pm
	(%parser_inner_configuration, _new_macro, _parse_line_command_args),
	tp/Texinfo/Translations.pm (_replace_convert_substrings),
	tp/Texinfo/XS/main/translations.c (replace_convert_substrings),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (conf_set_NO_INDEX)
	(conf_set_NO_USER_COMMANDS), tp/Texinfo/XS/parsetexi/api.c,
	tp/Texinfo/XS/parsetexi/conf.c (conf_set_NO_INDEX)
	(conf_set_NO_USER_COMMANDS), tp/Texinfo/XS/parsetexi/conf.h (CONF),
	tp/Texinfo/XS/parsetexi/end_line.c (parse_line_command_args),
	tp/Texinfo/XS/parsetexi/indices.c (enter_index_entry),
	tp/Texinfo/XS/parsetexi/macro.c (new_macro),
	tp/Texinfo/XS/parsetexi/parser.c (parse_texi): add customization
	variables NO_INDEX to ignore index commands and NO_USER_COMMANDS
	to ignore @*macro, @alias, @def*index and @definfoenclose.  Replace
	restricted internal variable and associated variables and functions by
	setting those two variables for translations.

2024-05-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_initialize_parsing, get_parser_info)
	(parse_texi_file, _register_global_command, _enter_index_entry)
	(_end_line_misc_line, _end_line_starting_block)
	(_check_register_target_element_label, _handle_line_command)
	(_handle_block_command, _parse_texi, _parse_line_command_args),
	tp/Texinfo/Document.pm (new_document): setup the document in
	_initialize_parsing, by calling a new function in Texinfo::Document,
	new_document.  Associate the document to the parser as the document
	key.  Set directly in the document the information registered in the
	document in the parser.  Remove tp/Texinfo/Document.pm register
	function.

	* tp/Texinfo/ParserNonXS.pm (%parser_state_initialization)
	(%parser_document_state_initialization)
	(%parsing_state_initialization): split %parser_state_initialization
	in two.

2024-05-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm: fix a syntax error.

2024-05-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (%parser_state_initialization)
	(%parser_inner_configuration, %parser_state_configuration)
	(parser, _initialize_parsing, parse_texi_piece, parse_texi_text)
	(get_parser_info, _input_push_text, parse_texi_file, parse_texi_line)
	(_setup_conf):
	put input, some elements of global_info, definfoenclose,
	source_mark_counters, nesting_context, context_stack and
	context_command_stack in %parser_state_initialization.  Classify the
	parsing state keys.  Distinguish parser configuration initialization
	and parser parsing state initialization.  Add _initialize_parsing for
	parser parsing initialization.  Call it in parse_texi_* instead of in
	parser().  Split %parser_inner_configuration out of
	%parser_state_configuration.  Initialize $parser->{'conf'} in
	_setup_conf.

2024-05-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (parser), tp/Texinfo/Translations.pm
	(_replace_convert_substrings), tp/Texinfo/XS/parsetexi/Parsetexi.pm:
	if restricted is set, do the initialization as in simple_parser.
	Remove simple_parser, a parser with restricted set is equivalent.
	Update _replace_convert_substrings to call parser and set restricted.

2024-05-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (parse_texi_piece, parse_texi_line)
	(parse_texi_text, parse_texi_file),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (parse_texi_file)
	(parse_texi_piece, parse_texi_text, parse_texi_line): require a parser
	in argument of parse_texi_* instead of creating one if undef.  Do not
	export any function explicitly.

	* Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm,
	Pod-Simple-Texinfo/pod2texi.pl, tp/t/accents.t,
	tp/t/automatic_nodes.t, tp/t/index_before_item.t,
	tp/t/protect_character_in_texinfo.t, tp/t/test_brace_count.t,
	tp/t/test_fill_gaps_in_sectioning.t, tp/t/test_is_content_empty.t,
	tp/t/test_protect_contents.t, tp/t/test_sort.t: update for need of
	parser in parse_texi_*.

2024-05-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/api.c (parser_set_debug),
	tp/Texinfo/XS/parsetexi/debug_parser.c (set_debug_output): return the
	previous value.

	* tp/Texinfo/XS/main/translations.c (replace_convert_substrings):
	reset better the configuration.  Call reset_parser_except_conf and not
	reset_parser.

	* tp/t/test_tree_copy.t: remove useless use.

2024-05-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/api.c (reset_parser_except_conf),
	tp/Texinfo/XS/parsetexi/input.c: remove input_reset_input_stack as
	it should never be useful.  There are debug messages in parse_texi
	if the input stack is not empty, if needed, the input stack variables
	could be reset there.

2024-05-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_is_index_element): use
	index_entry_commands instead of command_index.

	* tp/Texinfo/ParserNonXS.pm (simple_parser): do not set simple parser
	state hash reference if they are not used at all (for indices), or set
	directly to the default hashes if it is sure that they won't be
	modified.

2024-05-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_misc_line): add missing
	parenthesis.

	* tp/Texinfo/ParserNonXS.pm (_end_line_def_line): add missing
	definition command name with index.

	* tp/Texinfo/ParserNonXS.pm (%index_entry_command_commands)
	(_end_line_misc_line, _is_index_element, _process_remaining_on_line)
	(_parse_line_command_args, simple_parser, parser): do not use
	$self->{'command_index'} to determine if a command is an index
	command, add and use $self->{'index_entry_commands'}, for a clearer
	code more similar to C code.

2024-05-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_misc_line): use command names
	instead of %command_index for @*table commands and @def* commands
	with index entries names, for clearer a code, a code more similar to C
	and to avoid using %command_index for something else that associating
	an index to a command.

	* tp/Texinfo/ParserNonXS.pm (_parse_line_command_args),
	tp/Texinfo/XS/parsetexi/end_line.c (parse_line_command_args): do not
	set synindex, syncodeindex and printindex arguments if in restricted
	parser.

	* tp/Texinfo/XS/main/translations.c (replace_convert_substrings): set
	restricted on the parser used for translations to be in restricted
	mode as if simple_parser had been called from Perl.

	* tp/Texinfo/XS/main/build_perl_info.c (build_index_data),
	tp/Texinfo/XS/parsetexi/indices.c (resolve_indices_merged_in)
	(complete_indices): handle the case of no indices at all.

	* tp/Texinfo/XS/parsetexi/api.c (reset_parser_except_conf),
	tp/Texinfo/XS/parsetexi/parser.c (parse_texi):

	* tp/Texinfo/XS/parsetexi/indices.c (init_index_commands)
	(forget_indices): set num_index_commands and number_of_indices to 0 in
	forget_indices only.

	* tp/t/init/translation_in_parser_in_translation.pm: test more
	index related functions in gdt/parse_texi_line.

2024-05-11  Patrice Dumas  <pertusus@free.fr>

	Handle default index commands similarly to other @-commands

	* tp/Texinfo/ParserNonXS.pm (parser, simple_parser),
	tp/Texinfo/XS/parsetexi/indices.c (struct def, default_indices)
	(init_index_commands), tp/Texinfo/command_data.txt,
	tp/maintain/regenerate_commands_perl_info.pl: add default index
	commands to tp/Texinfo/command_data.txt like other builtin @-commands.

2024-05-11  Patrice Dumas  <pertusus@free.fr>

	Update POD of index_entry extra key.

2024-05-11  Patrice Dumas  <pertusus@free.fr>

	Update documentation POD with new organization of @def* trees.

2024-05-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am: remove an obsolete FIXME on libraries
	being searched for in libdir, as it is not the case (Gavin tests).

2024-05-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (XSParagraph_la_SOURCES),
	tp/Texinfo/XS/xspara.c, tp/Texinfo/XS/xspara.h: use main/text.c.
	Remove Texinfo/XS/xspara_text.c and Texinfo/XS/xspara_text.h.

2024-05-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/text.c (text_alloc): inline fatal() call
	in order not to depend on utils.h.

	* tp/Texinfo/XS/main/utils.c (bug): change message.

	* tp/Texinfo/XS/xspara_text.c: remove unused text_destroy.

	Other minor changes in texts and comments.

2024-05-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree_types.h: remove now unused DEF_ARG.

2024-05-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/def.c (DEF_MAP, parse_def),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line): remove
	arguments field from DEF_MAP, have parse_def return an array of
	ELEMENT and use the type of elements in end_line_def_line instead
	of a string.

2024-05-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_split_delimiters, _split_def_args)
	(_parse_def), tp/Texinfo/XS/parsetexi/def.c (split_delimiters)
	(split_def_args, parse_def): remove completly extra def_role from the
	tree now that definition line arguments container types are used
	instead.

2024-05-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (%def_argument_types_docbook)
	(_convert), tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/Convert/Utils.pm (definition_arguments_content)
	(definition_category_tree), tp/Texinfo/Translations.pm
	(complete_indices), tp/Texinfo/XS/main/convert_utils.c
	(definition_arguments_content, definition_category_tree),
	tp/Texinfo/XS/parsetexi/indices.c (complete_indices): use directly the
	type of definition line argument containers instead of def_role.

2024-05-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/def.c (parse_def): use definition line
	argument element type instead of role string to determine the type of
	argument on definition line.

2024-05-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/ParserNonXS.pm (_parse_def, _end_line_def_line),
	tp/Texinfo/XS/main/element_types.txt, tp/Texinfo/XS/parsetexi/def.c
	(DEF_MAP, def_maps, parse_def), tp/Texinfo/XS/parsetexi/end_line.c
	(end_line_def_line): put definition line arguments in specific
	containers corresponding to the role on the definition line, as
	already in the extra def_role (in order to replace the extra def_role).

2024-05-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm
	(_convert_untranslated_def_line_arg_type, _convert),
	tp/Texinfo/Convert/LaTeX.pm (_convert),
	tp/Texinfo/Convert/Plaintext.pm (_convert),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/Convert/Text.pm (_convert), tp/Texinfo/ParserNonXS.pm
	(_next_bracketed_or_word_agg, _parse_def),
	tp/Texinfo/XS/convert/convert_html.c
	(convert_untranslated_def_line_arg_type, convert_to_html_internal),
	tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal),
	tp/Texinfo/XS/main/element_types.txt, tp/Texinfo/XS/parsetexi/def.c
	(next_bracketed_or_word_agg, parse_def): use def_line_arg for
	def_category and untranslated_def_line_arg instead of
	untranslated_def_category and put them directly on def line, to get
	the same tree as for other def line arguments.

2024-05-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_split_delimiters)
	(_next_bracketed_or_word_agg, _parse_def),
	tp/Texinfo/XS/main/element_types.txt, tp/Texinfo/XS/parsetexi/def.c
	(next_bracketed_or_word_agg) (split_delimiters, parse_def): rename
	def_aggregate type as def_line_arg type.

2024-05-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm (%ignored_types, _convert),
	tp/Texinfo/Convert/Texinfo.pm (_convert_to_texinfo)
	(_expand_cmd_args_to_texi), tp/Texinfo/Convert/TexinfoMarkup.pm
	(_convert), tp/Texinfo/ParserNonXS.pm (_end_line_starting_block),
	tp/Texinfo/XS/main/convert_to_texinfo.c (expand_cmd_args_to_texi)
	(convert_to_texinfo_internal), tp/Texinfo/XS/main/element_types.txt,
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block): rename
	command_as_argument_inserted as command_as_argument and set info
	inserted instead. Remove %ignored_types in Texinfo.pm.

	* tp/Texinfo/Convert/LaTeX.pm (%ignorable_types): remove unused
	variable.

2024-05-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm
	(_convert_untranslated_def_category_type, _convert),
	tp/Texinfo/Convert/LaTeX.pm (_convert),
	tp/Texinfo/Convert/Plaintext.pm (_convert),
	tp/Texinfo/Convert/Texinfo.pm (@ignored_types)
	(_expand_cmd_args_to_texi), tp/Texinfo/Convert/TexinfoMarkup.pm
	(_convert), tp/Texinfo/Convert/Text.pm (_convert),
	tp/Texinfo/ParserNonXS.pm (_parse_def),
	tp/Texinfo/XS/convert/convert_html.c
	(convert_untranslated_def_category_type)
	(types_internal_conversion_table, convert_to_html_internal),
	tp/Texinfo/XS/main/convert_to_texinfo.c (expand_cmd_args_to_texi)
	(convert_to_texinfo_internal), tp/Texinfo/XS/main/convert_to_text.c
	(convert_to_text_internal), tp/Texinfo/XS/main/element_types.c
	(convert_to_text_internal), tp/Texinfo/XS/main/element_types.txt,
	tp/Texinfo/XS/parsetexi/def.c (parse_def): rename
	def_category_inserted as def_category and
	untranslated_def_category_inserted as untranslated_def_category
	and add the inserted information as an info integer.

2024-05-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/extra.c (add_info_integer)
	(lookup_key_pair_integer, lookup_extra_integer, lookup_info_integer):
	add add_info_integer and lookup_info_integer.

	* tp/Texinfo/Convert/Texinfo.pm (@ignored_types, _convert_to_texinfo),
	tp/Texinfo/ParserNonXS.pm (_split_def_args)
	(_next_bracketed_or_word_agg, _parse_def),
	tp/Texinfo/XS/parsetexi/def.c (next_bracketed_or_word_agg),
	tp/Texinfo/XS/main/convert_to_texinfo.c (expand_cmd_args_to_texi)
	(convert_to_texinfo_internal), tp/Texinfo/XS/main/element_types.txt,
	tp/Texinfo/XS/parsetexi/def.c (next_bracketed_or_word_agg)
	(split_def_args, parse_def): rename spaces_inserted as spaces and add
	the inserted information as an info integer.

2024-05-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_split_delimiters),
	tp/Texinfo/XS/parsetexi/def.c (split_delimiters): put text appearing
	along with delimiters in def_aggregate containers.

2024-05-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_split_delimiters)
	(_next_bracketed_or_word_agg, _parse_def),
	tp/Texinfo/XS/parsetexi/def.c (next_bracketed_or_word_agg)
	(split_delimiters, parse_def): put lone commands definition line
	arguments in a def_aggregate type container.  When parsing remaining
	arguments of a definition line, put everything that is not a lone
	bracketed_arg in a def_aggregate.

2024-05-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_def),
	tp/Texinfo/XS/parsetexi/def.c (parse_def): put extra info
	documentlanguage and translation_context in
	untranslated_def_category_inserted element.

	* tp/Texinfo/Convert/HTML.pm
	(_convert_untranslated_def_category_inserted_type, _convert),
	tp/Texinfo/XS/convert/convert_html.c
	(convert_untranslated_def_category_inserted_type)
	(convert_table_definition_type, convert_to_html_internal),
	tp/Texinfo/Convert/LaTeX.pm (_convert),
	tp/Texinfo/Convert/Plaintext.pm (_convert), tp/Texinfo/Convert/Text.pm
	(_convert), tp/Texinfo/XS/main/convert_to_text.c
	(convert_to_text_internal): convert especially the
	untranslated_def_category_inserted element, performing the translation
	of the text string in contents, instead of directly converting the
	untranslated text element.

2024-05-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Texinfo.pm (@ignored_types),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/ParserNonXS.pm (_parse_def),
	tp/Texinfo/XS/main/convert_to_texinfo.c (expand_cmd_args_to_texi)
	(convert_to_texinfo_internal), tp/Texinfo/XS/main/element_types.txt,
	tp/Texinfo/XS/parsetexi/def.c (parse_def): rename bracketed_inserted
	as def_category_inserted or untranslated_def_category_inserted if
	the category should be translated.

2024-05-07  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Setting the Context for Conversion):
	_converted type should only be text.

2024-05-05  Patrice Dumas  <pertusus@free.fr>

	* configure.ac (Perl version and modules, tp-tests)
	(perl-api-texi-build, pod-simple-texinfo-tests): update Perl modules
	and version in checks.

	Add use Data::Dumper in files where it is used, comment out if not
	used.

2024-05-05  Patrice Dumas  <pertusus@free.fr>

	Use use warnings instead of $^W

	* Pod-Simple-Texinfo/pod2texi.pl, tp/texi2any.pl, util/txixml2texi.pl:
	use use warnings instead of setting $^W.

2024-05-05  Patrice Dumas  <pertusus@free.fr>

	Update use use.

	Replace require VERSION by use, do not use use vars, update use Perl
	version to be 5.006 if our is used, use use warnings instead of $^W.

	Remove %EXPORT_TAGS.

2024-05-05  Patrice Dumas  <pertusus@free.fr>

	* doc/generate_html_doc_texi.pl: remove use re => '/a', there is no
	string manipulation in the code.

2024-05-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm (_convert): leave content of
	before_defline as is directly in top level content.

2024-05-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (%type_elements): leave content of
	before_defline as is without any element.

2024-05-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_gather_def_item),
	tp/Texinfo/XS/main/element_types.txt, tp/Texinfo/XS/parsetexi/def.c
	(gather_def_item): put content before @defblock and first @def*line in
	a before_defline container.

	* tp/Texinfo/Convert/DocBook.pm (%type_elements),
	tp/Texinfo/Convert/HTML.pm (%default_types_conversion),
	tp/Texinfo/Convert/LaTeX.pm (_convert),
	tp/Texinfo/Convert/TexinfoMarkup.pm (%type_elements),
	tp/Texinfo/XS/convert/convert_html.c
	(types_internal_conversion_table): update for before_defline.

	* util/texinfo.dtd: update for beforefirstdefline.

2024-05-05  Patrice Dumas  <pertusus@free.fr>

	* tp/t/19def.t (@test_defblock): add full_document for LaTeX output
	tests.

2024-05-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (prepare_special_units)
	(html_default_format_heading_text, html_default_format_contents)
	(convert_style_command, convert_indicateurl_command)
	(convert_heading_command, convert_printindex_command)
	(convert_contents_command, convert_menu_entry_type)
	(contents_shortcontents_in_title): handle FORMAT_MENU MAX_HEADER_LEVEL
	CONTENTS_OUTPUT_LOCATION OPEN_QUOTE_SYMBOL CLOSE_QUOTE_SYMBOL
	MENU_SYMBOL INDEX_ENTRY_COLON MENU_ENTRY_COLON being undef, and thus
	NULL in C, in case they were reset to undef in Perl user-defined code
	after the beginning of the conversion.

2024-05-04  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/regenerate_C_options_info.pl,
	tp/Texinfo/XS/main/option_types.h (global_option_type),
	tp/Texinfo/XS/main/utils.c, tp/Texinfo/XS/convert/converter.c:
	prefix global_option_type enums with GOT_ instead of GO_ to be able to
	add other global options enum.

2024-05-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs
	(get_converter_indices_sorted_by_index): initialize variables.

	* tp/Texinfo/XS/main/manipulate_indices.c (destroy_collator):
	call freelocale to deallocate resources associated with the locale
	created with newlocale.

2024-05-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (_convert): add a newline after
	generated menu if needed.

2024-05-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/19def.t (comment_index_before_defline)
	(text_block_before_defline): add test with content in @defblock before
	@defline.

2024-05-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_def_command),
	tp/Texinfo/XS/convert/convert_html.c (convert_def_command): use
	directly defblock as class name.

2024-05-03  Patrice Dumas  <pertusus@free.fr>

	* util/texinfo.dtd: add nodedescriptionblock and nodedescription.
	Fix defblock to allow definitionitem interspeded with defline.

2024-05-03  Patrice Dumas  <pertusus@free.fr>

	* util/txixml2texi.pl: handle linemacro.

	* util/txixml2texi.pl (_encode): convert upon printing instead of
	using binmode, which is unreliable if not used right on when opening
	and never changing the filter.

2024-05-03  Patrice Dumas  <pertusus@free.fr>

	* util/texinfo.dtd: add defbracketed, defblock, defline and
	deftypeline.

	* configure.ac (TEXINFO_DTD_VERSION): bump.

2024-05-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): add an element for
	bracketed_arg not already associated to another element.

	* tp/Makefile.tres, tp/t/19def.t (bracketed_arg_no_space): add test
	for bracketed arguments not corresponding to one definition line
	argument.

	* tp/t/19def.t: convert @test_defblock to xml.

2024-05-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): fix @inline*
	commands output to include inlinefmtifelse second argument.

	* tp/t/converters_tests.t (inlinefmtifelse_with_commands): update xml
	part of the test to have argument text content match the context.

	* tp/Makefile.tres, tp/t/xml_tests.t (inline_commands): add @inline*
	commands expansion test.

2024-05-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Indices.pm (setup_index_entry_keys_formatting): handle
	undefined OUTPUT_ENCODING_NAME.

2024-05-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_begin_file)
	(html_default_format_node_redirection_page): use empty string for
	PACKAGE_AND_VERSION and PACKAGE_URL if undefined.

	* tp/Texinfo/XS/convert/convert_html.c
	(default_format_special_body_about): add a new line.

2024-05-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/html_tests.t
	(info_js_dir_html_file_js_weblabels_file_undef): add a test with
	INFO_JS_DIR set and JS_WEBLABELS_FILE undef.

2024-05-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/html_tests.t (undef_split_and_big_rule): test
	with SPLIT and BIG_RULE undef.

2024-05-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (converter_initialize): set
	OPEN_QUOTE_SYMBOL and CLOSE_QUOTE_SYMBOL if undef.

	* tp/Texinfo/Convert/LaTeX.pm (_convert),
	tp/Texinfo/Convert/Plaintext.pm (_convert): handle undef
	deftypefnnewline customization value.

	* tp/Makefile.tres, tp/t/converters_tests.t
	(conversion_with_undef_customization): add a test with many
	customization variables undef.

2024-05-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/converters_tests.t (extension_undef): add a
	test with EXTENSION undef.

2024-05-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (converter_initialize)
	(conversion_initialization): set FORMAT_MENU, MAX_HEADER_LEVEL,
	CONTENTS_OUTPUT_LOCATION, INDEX_ENTRY_COLON, MENU_ENTRY_COLON if
	undef in converter_initialize.  Set OPEN_QUOTE_SYMBOL,
	CLOSE_QUOTE_SYMBOL and MENU_SYMBOL if undef after setting the default.

	* tp/Texinfo/Convert/HTML.pm, tp/Texinfo/XS/convert/convert_html.c:
	allow documentlanguage, OUTPUT_ENCODING_NAME,
	NO_NUMBER_FOOTNOTE_SYMBOL, xrefautomaticsectiontitle, DEFAULT_RULE,
	deftypefnnewline, DOCTYPE, BODY_ELEMENT_ATTRIBUTES, AFTER_BODY_OPEN,
	PACKAGE_AND_VERSION, PACKAGE_URL, LINKS_BUTTONS, SECTION_BUTTONS in
	About body, JS_WEBLABELS_FILE, HANDLER_FATAL_ERROR_LEVEL to be undef.

	* tp/Texinfo/Convert/Info.pm (format_node): handle undef TOP_NODE_UP.

	* tp/Texinfo/Convert/HTML.pm (_default_format_special_body_about),
	tp/Texinfo/XS/convert/convert_html.c
	(default_format_special_body_about): different output for the About
	page if the SECTION_BUTTONS are undefined.

	* tp/Texinfo/XS/structuring_transfo/structuring.c
	(set_menus_node_directions), tp/Texinfo/XS/parsetexi/Parsetexi.pm
	(parser), tp/Texinfo/Convert/Plaintext.pm (_convert): handle undef
	FORMAT_MENU.

	* tp/Makefile.tres, tp/t/test_utils.pl (test), tp/t/10menu.t
	(format_menu_undef): add a test with FORMAT_MENU undef.

2024-05-01  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Simple Navigation Panel Customization):
	comment out documentation of buttons specification that is not used in
	code nor tests.

2024-05-01  Patrice Dumas  <pertusus@free.fr>

	Remove skipped test result.

2024-05-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ManipulateTree.pm (_protect_text),
	tp/Texinfo/Transformations.pm (_protect_hashchar_at_line_beginning):
	set the parent of brace_command_arg added for added glyph command
	elements.

2024-05-01  Patrice Dumas  <pertusus@free.fr>

	Remove parent of @include or @setfilename source mark elements

	* tp/Texinfo/ParserNonXS.pm (_end_line_misc_line),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line): remove parent
	of @include or @setfilename element removed from the tree and
	registered as source mark element.

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/80include.t
	(include_in_removed_before_item): add test of @include in @table
	before_item after a comment that holds the source mark, with
	before_item removed from the tree.

	Report from Christoph.

2024-05-01  Patrice Dumas  <pertusus@free.fr>

	Change in comments, minor changes in code.

2024-04-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (_id_to_filename), tp/ext/epub3.pm
	(epub_convert_image_command): handle BASEFILENAME_LENGTH being undef.

	* tp/Texinfo/Convert/HTML.pm (_default_format_button),
	tp/Texinfo/XS/convert/convert_html.c (html_default_format_button):
	handle from_element_direction return being undef.

	* tp/Texinfo/XS/convert/convert_html.c, tp/Texinfo/Convert/HTML.pm:
	handle undefined SPLIT.

	* tp/Texinfo/XS/convert/convert_html.c (from_element_direction):
	handle TOP_NODE_UP being undef.

	* tp/Texinfo/Convert/Plaintext.pm (converter_initialize): handle
	undefined FILLCOLUMN.

	* tp/ext/epub3.pm (epub_setup): use INFO_JS_DIR and JS_WEBLABELS_FILE
	if defined, enven if the empty string or 0.

2024-04-29  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/regenerate_C_options_info.pl: add a better BUG message
	than the default Perl message for customization variable passed to C
	that should be an integer but is not.

2024-04-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_footnote_command)
	(_default_format_element_footer, _prepare_special_units),
	tp/Texinfo/XS/convert/convert_html.c (prepare_special_units)
	(html_default_format_element_footer, convert_footnote_command),
	tp/Texinfo/Convert/Plaintext.pm (process_footnotes, _convert):
	compare footnotestyle customization value to 'separate' only and
	handle an undef value.

2024-04-29  Patrice Dumas  <pertusus@free.fr>

	* tp/TODO: notes on possible optimization after looking at callgrind
	output for HTML output with C.

2024-04-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Config.pm (GNUT_get_stage_handlers),
	tp/Texinfo/Convert/HTML.pm (run_stage_handlers, output): sort handlers
	according to priority in GNUT_get_stage_handlers and return sorted
	stage handlers.  Pass sorted handlers to run_stage_handlers.  Call
	Texinfo::Config::GNUT_get_stage_handlers() in output().

2024-04-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_handle_other_command),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_other_command):
	check that an in_heading_spec command is in an heading_spec command by
	using the basic_inline_stack_on_line nesting_context.

	* tp/Makefile.tres, tp/t/57invalid_nestings.t
	(heading_commands_in_center, heading_commands_in_documentlanguage):
	move two tests from tp/t/02coverage.t.

	* tp/Makefile.tres, tp/t/57invalid_nestings.t
	(heading_separator_in_accent_command)
	thischapter_in_footnote_in_evenfooting)
	(thischapter_in_math_in_evenfooting): new tests of invalid nestings
	for in heading commands.

2024-04-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/command_data.txt (nodedescription): add
	contain_basic_inline flag.

2024-04-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (check_valid_nesting): fix
	condition on contain_plain_text NOBRACE_symbol and CF_in_heading_spec.

2024-04-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (%in_plain_text_commands),
	tp/Texinfo/XS/parsetexi/parser.c (check_valid_nesting): remove @| from
	commands valid in plain text, by adding a check on
	%in_heading_spec_commands.

	* tp/Texinfo/ParserNonXS.pm (%in_full_text_commands)
	(%in_basic_inline_commands): do not put in_heading_spec_commands in
	%in_full_text_commands, only in %in_basic_inline_commands such that
	they can only appear in some @-commands (style brace @-commands).

	* tp/Texinfo/XS/parsetexi/parser.c (check_valid_nesting): remove an
	impossible check of outer_flags & CF_heading_spec for a brace command.

	* tp/Makefile.tres, tp/t/02coverage.t (heading_commands_in_center)
	(heading_commands_in_documentlanguage): add tests of heading commands
	in non heading nor footing line command and in contain_plain_text
	command.

2024-04-20  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/README: explain how test_scripts/*.sh can be
	modified by a sed one liner to be usable when using Makefile.PL.

2024-04-20  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/pod2texi.pl (BEGIN): detect the case of a
	pod2texi command installed from Makefile.PL and in that case do not
	set any path.

	* Pod-Simple-Texinfo/README: explain that pod2texi.pl need to me
	copied before calling perl Makefile.PL.

	* Pod-Simple-Texinfo/test_scripts/*.sh: correct a comment.

2024-04-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_parse_htmlxref_files): warn if the
	htmlxref.cnf entry URL prefix is missing.

2024-04-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_close_command_cleanup)
	(_handle_other_command): remove 'rows_count', instead use
	scalar(@{$parent->{'contents'}}), as in C code.

	* tp/Texinfo/XS/parsetexi/parser.c (reset_parser_counters),
	tp/Texinfo/XS/parsetexi/macro.c (expand_linemacro_arguments),
	tp/Texinfo/XS/parsetexi/counter.c (counter_reset): add debugging
	messages optional argument in counter_reset, set for counters reset in
	reset_parser_counters.

	* tp/Texinfo/ParserNonXS.pm (_handle_close_brace),
	tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace),
	tp/Texinfo/XS/parsetexi/close.c (close_brace_command): in C,
	remove remaining_args in close_brace_command.  Do not
	remove 'remaining_args' in _handle_close_brace, both in Perl and C.

	* tp/Texinfo/XS/parsetexi/close.c (close_command_cleanup),
	tp/Texinfo/XS/parsetexi/counter.c (counter_remove_element): fix removal
	of row count_cells counter, by adding a new function,
	counter_remove_element that remove element counters anywhere in the
	counter list.  This is needed for rows as they are obtained from the
	bottom of the counter list, not from the top.

	* tp/Texinfo/XS/parsetexi/handle_commands.c (handle_other_command):
	remove useless counter management code on row parent element that
	never get a counter.

2024-04-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (_align_lines): remove $bytes_count
	returned value, as it is not used.  Update caller.

2024-04-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c: remove TODO already in
	Texinfo/Convert/HTML.pm.

	* tp/Texinfo/Convert/HTML.pm (_html_convert_convert)
	(_html_convert_output): change TODOs to NOTEs.

2024-04-18  Patrice Dumas  <pertusus@free.fr>

	* tp/init/html32.pm (html32_convert_tab_command): move code around,
	remove comment.

2024-04-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs
	(get_converter_indices_sorted_by_index): check if locale language is
	set before caching the built Perl sorted index.

2024-04-18  Patrice Dumas  <pertusus@free.fr>

	* tp/init/html32.pm (html32_convert_center_command): in string
	context, simply return the argument.

2024-04-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_image_command),
	tp/Texinfo/XS/convert/convert_html.c (convert_image_command): if image
	is not found, do not check if in_multiple_conversions, as it should
	happen very rarely, but check that there is some 'source_info'.

	* tp/Texinfo/Convert/HTML.pm (_convert_raw_command),
	tp/Texinfo/XS/convert/convert_html.c (convert_raw_command): inline call
	of _noticed_line_warn and remove the function.

	* tp/t/html_tests.t (tex_expanded_in_caption_multiple_time),
	tp/Makefile.tres: add test with expanded @teex in HTML in caption,
	such as to have an expansion of raw format multiple times.

2024-04-17  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Other Dynamic Information),
	(in_multiple_conversions, _internal_command_text)
	(convert_tree_new_formatting_context, _noticed_line_warn)
	(_set_multiple_conversions, _unset_multiple_conversions): add an API
	to access to multiple_conversions.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_set_multiple_conversions)
	(html_unset_multiple_conversions, html_in_multiple_conversions),
	tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_formatting_state), tp/Texinfo/XS/convert/convert_html.c
	(convert_tree_new_formatting_context, html_internal_command_text): XS
	interface for multiple_conversions.  Remove previous interface.

2024-04-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_internal_command_text)
	(convert_tree_new_formatting_context, _noticed_line_warn),
	tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_formatting_state), tp/Texinfo/XS/convert/convert_html.c
	(noticed_line_warn, convert_tree_new_formatting_context)
	(html_internal_command_text, html_conversion_finalization),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): rename ignore_notice
	as multiple_conversions.

	* tp/ext/epub3.pm (epub_convert_image_command): use
	converter_line_warn instead of _noticed_line_warn, but note that
	multiple_conversions should be taken into account.

2024-04-17  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm (_accessorize),
	(_preamble): add a texinfo_generate_setfilename accessor to determine
	if a @setfilename is inserted in standalone manuals.

	* Pod-Simple-Texinfo/pod2texi.pl: add a --generate-setfilename option,
	pass to the POD parser.

2024-04-17  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm
	(pod_title_to_file_name, protect_text): remove leading _ for functions
	used in pod2texi.pl.  Update callers.

2024-04-17  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm (print_texinfo_errors),
	Pod-Simple-Texinfo/pod2texi.pl: move _print_texinfo_errors to
	Pod/Simple/Texinfo.pm and improve.  Update callers.

	* Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm (_accessorize, new),
	Pod-Simple-Texinfo/pod2texi.pl: add a texinfo_debug accessor to the
	POD parser, and pass it from pod2texi.pl.

	* Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm
	(_normalize_texinfo_name): add debug level argument and use it to
	set debugging in Texinfo parser used for names normalizations and
	print errors and warnings.  Update callers.

2024-04-17  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/test_scripts/*.sh: use $PERL to use the same perl
	the XS modules were compiled against.

2024-04-16  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/Makefile.am (test_files, EXTRA_DIST),
	Pod-Simple-Texinfo/test_scripts/*.sh: add tests of pod2texi.pl, based
	on tests formerly in manual_tests.

2024-04-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/targets.c (add_element_to_identifiers_target):
	set is_target extra information.

	* tp/Texinfo/XS/main/targets.c (register_label_element): fix existing
	error label error condition.

	* tp/Makefile.tres, tp/t/transformations.t
	(insert_nodes_for_sectioning_commands): add the same test of
	insert_nodes_for_sectioning_commands transformation as in
	t/automatic_nodes.t, here with tree and error messages too.

2024-04-16  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/pod2texi.pl (_print_texinfo_errors)
	(_parsed_manual_tree): better formatting of error messages from
	Texinfo modules.

2024-04-16  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/pod2texi.pl (_parsed_manual_tree): set debugging
	output and get errors if debug is set.

	* Pod-Simple-Texinfo/pod2texi.pl: fix processing file debug message
	with $base_level == 0.

	* Pod-Simple-Texinfo/t/Pod-Simple-Texinfo.t (empty head2): add a test
	with empty =head2.

2024-04-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (%parser_state_initialization): initialize
	'internal_references'.

2024-04-16  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm
	(_pod_title_to_file_name): remove end of lines.

	* Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm
	(_normalize_texinfo_name): return undef in case of parsing errors
	leading to an undefined document.  Update callers.

	* Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm: change in comments.

	* Pod-Simple-Texinfo/t/Pod-Simple-Texinfo.t (end of line in L): new
	test.

2024-04-16  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/pod2texi.pl: minor change in code, change in
	comments.

2024-04-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm (get_conf): remove warning if options are
	initialized in get_conf call.  Add a TODO and a comment.

2024-04-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs
	(reference_to_arg_in_tree): use the tree document as document if no
	document is given in argument.

	* tp/Texinfo/XS/structuring_transfo/transformations.c
	(reference_to_arg_in_tree): cast the third modify_tree argument to
	void *.

2024-04-16  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (@LaTeX{} Customization Variables),
	tp/Texinfo/Convert/LaTeX.pm (%defaults, _latex_header),
	tp/Texinfo/options_data.txt: add new customization variable
	LATEX_FLOATS_FILE_EXTENSION.

2024-04-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/transformations.c
	(reference_to_arg_internal): fix flag set for internal reference
	removal and set it only if an element was actually removed.

	* tp/Texinfo/XS/structuring_transfo/transformations.c
	(regenerate_master_menu): set the flag corresponding to modified
	internal references if needed.

	* tp/Texinfo/Transformations.pm (_reference_to_arg)
	(reference_to_arg_in_tree),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs
	(reference_to_arg_in_tree): add a document argument to
	reference_to_arg_in_tree and _reference_to_arg.  Remove removed
	reference command from document internal references.
	Update callers.

2024-04-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (remove_from_array): add a simple function to
	remove the first occurence of an element in an array.

	* tp/Texinfo/Transformations.pm (regenerate_master_menu): use
	Texinfo::Common remove_from_array to remove the removed menu entries
	from the internal references list.

2024-04-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/transformations.t
	(regenerate_master_menu_with_menu_comment): add test of
	regenerate_master_menu with a menu comment at the end of the Top node.

	Change in comments and spacing.

2024-04-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c
	(get_converter_indices_sorted_by_index)
	(get_converter_indices_sorted_by_letter),
	tp/Texinfo/XS/main/document.c (sorted_indices_by_index)
	(sorted_indices_by_letter): have sorted_indices_by_* return the
	full collation indices information, not only the sorted indices, such
	that the caller may know the language set in collation structure.
	In get_converter_indices_sorted_by_*, get the language from
	sorted_indices_by_* collation indices information and pass it through
	an argument pointer reference.
	Update callers.

	* tp/Texinfo/XS/main/get_perl_info.c
	(get_language_document_hv_sorted_indices),
	tp/Texinfo/XS/convert/ConvertXS.xs
	(get_converter_indices_sorted_by_index)
	(get_converter_indices_sorted_by_letter): cache sorted indices built
	as Perl data in Perl data, such as to build the perl data only once,
	not for every index.  The cached data is retrieved with
	get_language_document_hv_sorted_indices, which also creates the hash
	where the sorted indices are stored, if needed.

2024-04-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/OutputUnits.pm (units_directions),
	tp/Texinfo/XS/main/output_unit.c (units_directions): replace the
	customization options argument by print_debug.  Update callers and set
	the print_debug argument from customization options.

2024-04-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document_types.h, tp/Texinfo/XS/main/document.c
	(sorted_indices_by_index, sorted_indices_by_letter): remove
	F_DOCM_sorted_indices_by_*, it is not accurate and not useful.

	* tp/Texinfo/XS/convert/ConvertXS.xs: add comments on caching
	built perl convert sorted_indices_by_*.

2024-04-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (BUILD_PERL_DOCUMENT_ITEM)
	(BUILD_PERL_DOCUMENT_LIST): change macro definition to have the full
	function name, as first argument, add a flagname argument to have the
	full flag name and use a string for keyname.  For improved
	searchability of the code.

2024-04-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_register_footnote): use
	code more similar to get_perl_info.c find_element_from_sv, removing
	useless cases.

2024-04-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm (%XS_overrides),
	tp/Texinfo/XS/main/DocumentXS.xs: remove rebuild_document, document
	accessors should be used instead.

2024-04-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ManipulateTree.pm (normalized_menu_entry_internal_node)
	(normalized_entry_associated_internal_node, first_menu_node),
	tp/Texinfo/Structuring.pm: move functions, some previously internal,
	from Structuring.pm to ManipulateTree.pm.  Update callers.

	* tp/Texinfo/OutputUnits.pm, doc/tp_api/Makefile.am
	(texi2any_internals_dependencies), tp/Makefile.am (dist_modules_DATA),
	tp/Texinfo/Structuring.pm: move output units related functions from
	Structuring.pm to the new module Texinfo::OutputUnits.  Update
	callers.

2024-04-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (new_detailmenu),
	tp/Texinfo/XS/structuring_transfo/structuring.c (new_detailmenu):
	rename new_master_menu as new_detailmenu, change also variables names.
	Update callers and variables names in callers.

2024-04-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Indices.pm: remove export of functions.

	* tp/Texinfo/*: fix import of modules related to indices.

	Update POD documentation and comments to explain better which method
	should be directly used and why there is no XS override for some
	functions.

2024-04-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_utils.c (output_files_open_out),
	tp/Texinfo/XS/convert/convert_html.c
	(convert_output_output_unit_internal, html_node_redirections): add an
	output argument to output_files_open_out as in Perl, to get the
	information that a file was reused.  Also, as in Perl, add the file
	path to opened_files only if not already there.

2024-04-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c
	(build_output_files_opened_files): update for the change in Perl
	code by building a hash reference.

2024-04-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/transformations.c
	(protect_hashchar_at_line_beginning_internal): define error_messages
	and options only where they are needed.

	* Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm: use
	Texinfo::Transformations methods fully qualified.

2024-04-13  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: use suppressions file for valgrind

2024-04-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/manipulate_tree.c (protect_colon)
	(protect_colon_in_tree, protect_comma, protect_comma_in_tree)
	(protect_node_after_label, protect_node_after_label_in_tree),
	tp/Texinfo/XS/structuring_transfo/structuring.c,
	tp/Texinfo/XS/structuring_transfo/transformations.c: move functions
	calling protect_text and modify_tree out of structuring.c and
	transformations.c to manipulate_tree.c.

2024-04-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ManipulateTree.pm, tp/Texinfo/Common.pm,
	tp/Makefile.am (dist_modules_DATA), doc/tp_api/Makefile.am
	(texi2any_internals_dependencies), : move tree transformation
	functions depending on modify_tree from Texinfo/Common.pm to the new
	Texinfo/ManipulateTree.pm module.  Update callers.

2024-04-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/structuring.c: make some functions
	static.

2024-04-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (locate_file_in_dirs): rename locate_init_file
	as locate_file_in_dirs.  Update callers.

2024-04-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (output_files_opened_files), tp/texi2any.pl
	(merge_opened_files): add NOTE in comment to note that paths are not
	normalized, such that paths with different path names referring to the
	same file will not be caugth as overwritting files and will not
	trigger warning messages.

2024-04-13  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/run_parser_all.sh: do not add a / at the end of $testdir,
	one is already added in all the uses if needed.

	* tp/Texinfo/Common.pm (output_files_opened_files), tp/texi2any.pl
	(merge_opened_files): merge opened files with merge_opened_files in
	texi2any.pl, not in output_files_opened_files,
	output_files_opened_files simply returns the opened_files hash
	reference.  Warn if a file is opened more than once in
	merge_opened_files.

	* tp/tests/Makefile.onetst, tp/tests/formatting/list-of-tests
	(reuse_macro_expand_file): test --macro-expand with the same name as
	output file.

2024-04-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (output_files_open_out),
	tp/Texinfo/Convert/HTML.pm (_do_jslicenses_file): have
	output_files_open_out return the information that a file that was
	already opened is opened again, which means overwritting.  Add a
	warning in the case that can actually happen, with js licenses file.

	* tp/tests/formatting/list-of-tests (js_license_reuse_output_file):
	test with js licences file overwritting an output file.

2024-04-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (output_files_initialize)
	(output_files_open_out, output_files_opened_files), tp/texi2any.pl
	(_exit, %opened_files, handle_errors): use a hash instead of an array
	for opened files, to avoid unlinking twice files opened (and closed)
	twice.

2024-04-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm, tp/texi2any.pl: change in comments for a more
	accurate description of duplicates in opened_files.

2024-04-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Text.pm: change in comments.

2024-04-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Text.pm (convert_tree, convert): fix
	implementations.  Use XS for convert similarly as in output.

	* tp/Makefile.tres, t/raw_text_converter.t: add test of raw text
	converter functions not called elsewhere.

2024-04-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_html_set_pages_files),
	tp/Texinfo/XS/convert/convert_html.c (html_set_pages_files): add
	warnings when a paths is reset from or to a relative path for an
	existing file.
	
	Change in comments.

2024-04-12  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/README, tp/TODO: updates related to manual tests.

2024-04-12  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Predefined Indices): texinfo.texi now has
	three indices, not two.

2024-04-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Indices.pm, tp/Texinfo/Structuring.pm: update POD
	documentation.

2024-04-11  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl: change a TODO to a NOTE.

2024-04-11  Patrice Dumas  <pertusus@free.fr>

	Fix master menu generation with node in its own menus

	* tp/Texinfo/Common.pm (converter_or_registrar_line_warn),
	tp/Texinfo/Indices.pm: move _converter_or_registrar_line_warn from
	Indices.pm to Common.pm and rename as
	converter_or_registrar_line_warn.

	* tp/Texinfo/Structuring.pm (new_master_menu)
	(new_complete_menu_master_menu, _print_down_menus),
	tp/Texinfo/XS/structuring_transfo/structuring.c (print_down_menus)
	(new_master_menu, new_complete_menu_master_menu),
	tp/t/do_master_menu.t: add the list of up nodes in print_down_menus
	arguments and check if a child node is also an up node, to avoid
	infinite recursion.  Add error reporting arguments to
	print_down_menus, and to caller, new_master_menu and
	new_complete_menu_master_menu.  Update callers.

	* tp/Makefile.tres, tp/t/info_tests.t (recursive_down_menu): add a
	test for a node in its own menu with a master menu generation.

2024-04-11  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): initialize test customization variables
	defaults with the same hash as in the main program,
	%Texinfo::Common::default_main_program_customization_options.

	* tp/Texinfo/Convert/Texinfo.pm (target_element_to_texi_label),
	tp/Texinfo/XS/main/convert_to_texinfo.c
	(target_element_to_texi_label): handle links to external nodes.

	* tp/Texinfo/Structuring.pm (complete_node_tree_with_menus),
	tp/Texinfo/XS/structuring_transfo/structuring.c
	(complete_node_tree_with_menus): no warning on menu and node
	directions mismatch if the node direction is to an external manual.

	* tp/t/*.t: update tests by changing node direction or menu,
	adding CHECK_NORMAL_MENU_STRUCTURE set to 0, and comments.

2024-04-10  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (close_files): add a note explaining why this
	function is unlikely to be called.  Die if a file could not be closed.

2024-04-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Report.pm (new): remove the possibility to reuse an
	object.

	Update POD documentation.

2024-04-09  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl: call Texinfo::Convert::Texinfo->import().  Move code
	around.

	* tp/Texinfo/Document.pm: Update POD documentation.

2024-04-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm (%XS_overrides, register_document_options),
	tp/Texinfo/XS/main/DocumentXS.xs (register_document_options),
	tp/t/test_utils.pl (test), tp/texi2any.pl: rename register_options as
	register_document_options.  Pass a hash of customization variables to
	register_document_options, call get_customization_options_hash in the
	calling code.  Remove _XS_set_document_options.

	* tp/t/test_utils.pl (test): remove a useless setting of
	document_descriptor in document.

	Update POD documentation.

2024-04-08  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): rename $main_configuration* variables as
	$test_customization*.

2024-04-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm (%XS_overrides),
	tp/Texinfo/XS/main/DocumentXS.xs (document_get_conf): add an XS
	override for Document.pm get_conf.

	* tp/t/test_utils.pl (test), tp/texi2any.pl: use $document to provide
	customization information.

2024-04-08  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test), tp/texi2any.pl: use $document as
	customization provider.

2024-04-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Transformations.pm (complete_tree_nodes_missing_menu)
	tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs
	(complete_tree_nodes_missing_menu),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(complete_tree_nodes_missing_menu): use a document in argument and
	use it to get the customization information and root of Texinfo tree.

2024-04-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Transformations.pm
	(insert_nodes_for_sectioning_commands, regenerate_master_menu):
	use $document argument to get customization options, remove
	$main_configuration argument.  Update callers and XS interfaces.

	* Pod-Simple-Texinfo/pod2texi.pl: update for change in structuring and
	transformation interfaces with $main_configuration argument removed.

2024-04-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (warn_non_empty_parts)
	(check_nodes_are_referenced, set_menus_node_directions)
	(complete_node_tree_with_menus, nodes_tree): use $document argument to
	get customization options, remove $main_configuration argument.
	Update callers and XS interfaces.

2024-04-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm (get_conf): add to use in pure Perl for the
	get_conf cutomization getting API useing options registerd in the
	parser. Remove options().

	* tp/Texinfo/Structuring.pm (sectioning_structure)
	(associate_internal_references),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs
	(associate_internal_references, sectioning_structure),
	tp/t/automatic_menus.t, tp/t/automatic_nodes.t,
	tp/t/convert_to_text.t, tp/t/do_master_menu.t, tp/t/test_tree_copy.t,
	tp/t/test_utils.pl (test), tp/texi2any.pl: use $document argument to
	get customization options, remove $main_configuration argument for
	sectioning_structure and associate_internal_references.

2024-04-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (%XS_overrides), tp/Texinfo/Config.pm
	(get_customization_options_hash), tp/Texinfo/Document.pm
	(%XS_overrides, register_options, _XS_set_document_options): Replace
	register_XS_document_main_configuration by Texinfo::Document
	register_options.  register_options in turn call
	_XS_set_document_options for XS code.  Add
	get_customization_options_hash based on
	register_XS_document_main_configuration, but without the call to
	set_document_options, to get the options in one hash, call it from
	Texinfo::Document register_options.  Remove set_document_options from
	Texinfo/Common.pm and remove register_XS_document_main_configuration.
	Update callers.
	
	* tp/Texinfo/Document.pm (register_options, options): setup the
	'options' Perl document hash value to be the hash obtained from
	get_customization_options_hash.

	* tp/Texinfo/XS/main/DocumentXS.xs (set_document_options): change the
	order of the arguments.  Update callers.

2024-04-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Config.pm (GNUT_set_customization_default),
	tp/texi2any.pl, tp/t/test_utils.pl (test): rename
	GNUT_set_main_program_default as GNUT_set_customization_default and
	rename GNUT_initialize_config as GNUT_initialize_customization.

2024-04-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_command_formatted_args): set arg_tree in perl hash.

	* tp/Texinfo/Convert/HTML.pm (_translate_names)
	(_reset_unset_no_arg_commands_formatting_context),
	tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_translated_names), tp/Texinfo/XS/convert/convert_html.c
	(html_free_converter, reset_unset_no_arg_commands_formatting_context)
	(html_translate_names), tp/Texinfo/XS/main/converter_types.h
	(HTML_COMMAND_CONVERSION): rename no arg commands tree structure field
	as translated_tree.

2024-04-08  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Command Tree Element Conversion Functions),
	tp/Texinfo/Convert/HTML.pm (_convert_xref_commands, _convert),
	tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_command_formatted_args),
	tp/Texinfo/XS/convert/convert_html.c (convert_xref_commands)
	(destroy_args_formatted, convert_to_html_internal),
	tp/Texinfo/XS/main/converter_types.h (HTML_ARG_FORMATTED),
	tp/init/html32.pm: rename tree field in tree element conversion
	formatted argument structure to arg_tree.

2024-04-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Config.pm: adapt comments and a variable name to being
	called by tests in the same was as by main program.

2024-04-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Config.pm Texinfo::MainConfig (new, get_conf, set_conf)
	(register_XS_document_main_configuration), tp/t/test_sort.t: remove
	the 'standalone' case, now that it is not used anymore.  Simplify the
	Texinfo::MainConfig object structure.

2024-04-07  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): set main_configuration as in the main
	program, by setting up defaults, calling
	Texinfo::Config::GNUT_initialize_config before loading init files,
	calling Texinfo::MainConfig::new without arguments, and calling
	Texinfo::Config::GNUT_set_from_cmdline for options from test
	specification (+DEBUG).

2024-04-07  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): separate better parser options and main
	configuration options used for structuring.  Setup main configuration
	later on.

	* tp/texi2any.pl: add a list of customization options actually
	used in main_configuration and where they are used in comments.

2024-04-07  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi: refer more to the reader as you.  Update for
	changes in the Texinfo manual, to avoid some redundancy, and link to
	the appropriate section.

2024-04-07  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Specific Customization of HTML Formatting): remove
	a @subentry associated to an @item.

2024-04-06  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (HTML Output Structure Customization): add
	a definition of output units and an expanded description of the effect
	of USE_NODES.

	* doc/texinfo.texi (Customization Variables for Multiple Formats):
	define output units when describing the effect of setting USE_NODES.

2024-04-06  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi: add @subentry @r{for HTML} for customization
	variables index entries for variables that are not only for HTML.

	* doc/texinfo.texi (File Names and Links Customization for HTML)
	(HTML Splitting): small changes.

2024-04-06  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XSLoader.pm (XS_parser_enabled, XS_structuring_enabled)
	(XS_convert_enabled): New functions, in order to avoid repeating
	similar blocks of code checking environment variables.

	* tp/Texinfo/Common.pm, tp/Texinfo/Convert/ConvertXS.pm,
	tp/Texinfo/Convert/Converter.pm, tp/Texinfo/Convert/HTML.pm,
	tp/Texinfo/Convert/PlainTexinfo.pm, tp/Texinfo/Convert/Texinfo.pm,
	tp/Texinfo/Convert/Text.pm, tp/Texinfo/Document.pm,
	tp/Texinfo/Indices.pm, tp/Texinfo/IndicesXS.pm, tp/Texinfo/Parser.pm,
	tp/Texinfo/StructTransfXS.pm, tp/Texinfo/Structuring.pm,
	tp/Texinfo/Transformations.pm, tp/t/automatic_nodes.t,
	tp/t/html_tests.t, tp/t/protect_character_in_texinfo.t,
	tp/t/test_utils.pl, tp/texi2any.pl: Use the new functions.

2024-04-06  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (HTML Customization for Math): corrections.

2024-04-06  Patrice Dumas  <pertusus@free.fr>

	* doc/refcard/txivarcheck (read_refman), util/txicustomvars: get
	customization variables from "Invoking \@command{texi2any}" node too
	in txivarcheck, and output program_cmdline_options and
	converter_cmdline_options in txicustomvars.

	* doc/refcard/txivarcheck (read_tp): filter out the 'SILENT'
	customization variable that is not interesting to document as it does
	nothing, and the customization variables starting with XS_ that are
	not documented on purpose.

2024-04-06  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Other Formats Customization Variables): add
	default value of TXI_MARKUP_NO_SECTION_EXTENT.

2024-04-06  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Customization Variables and Options): add index
	entries for customization variables in the table associating them with
	options.

2024-04-06  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Customization Variables for Multiple Formats):
	explicit which formats are concerned by USE_NODES.

2024-04-06  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Other Formats Customization Variables),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/options_data.txt, tp/t/xml_tests.t: add a new customization
	variable, TXI_MARKUP_NO_SECTION_EXTENT, to be used in TexinfoMarkup.pm
	instead of USE_NODES to avoid multiple significations for USE_NODES.

2024-04-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/xml_tests.t ($sectioning_test)
	(sectioning_test_ref, sectioning_test_no_use_nodes): add test of
	USE_NODES set in Texinfo XML.

2024-04-06  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Other Formats Customization Variables): new node
	for customization which apply to specific formats only, for formats
	without separate customization variables description section.

2024-04-06  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Customization Variables): move 'Info and Plaintext
	Customization Variables' before 'LaTeX Customization Variables'.
	Update overall description of customization variables.

2024-04-06  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Customization Variables for Multiple Formats):
	rename 'Other Customization Variables' as 'Customization Variables for
	Multiple Formats'.

2024-04-06  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Other Customization Variables)
	(HTML Customization Variables List): move NODE_NAME_IN_MENU to 'HTML
	Customization Variables List', as it is used in HTML only.

2024-04-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (%parser_options): remove 'restricted' as it is
	an internal parser option.

2024-04-05  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (_get_parser_info):
	Remove $no_build argument.  Only call build_document if $no_store
	is set.  Callers updated.

2024-04-05  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Global Customization Variables)
	(Other Customization Variables): split 'Global Customization
	Variables' out of 'Other Customization Variables'.

2024-04-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (determine_files_and_directory),
	tp/Texinfo/Convert/Text.pm (output), tp/Texinfo/Convert/HTML.pm
	(_prepare_css): use a different variable for file name string bytes
	and file name character string.

	* tp/Texinfo/Convert/HTML.pm (_prepare_css): rename variables.

	* tp/t/test_utils.pl: change in comments.

2024-04-05  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parse_texi_line):
	Pass false $no_build argument in call to _get_parser_info as
	otherwise the $no_store argument does nothing.

2024-04-05  Gavin Smith <gavinsmith0123@gmail.com>

	Remove optional $no_build argument.

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parse_texi_line)
	(parse_texi_text): Remove optional $no_build argument.
	* tp/Texinfo/Translations.pm, tp/t/test_utils.pl: Update calls.

2024-04-05  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parse_texi_piece):
	Remove optional $no_build argument.
	* tp/t/test_utils.pl: Update call to parse_texi_piece.

2024-04-05  Gavin Smith <gavinsmith0123@gmail.com>

	XS parse_texi_file only returns handle for building tree on-demand

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parse_texi_file): Eliminate
	optional argument to decide whether to build the Perl information
	or not.  Always call _get_parser_info with $no_build set.

	* tp/Texinfo/Document.pm (%XS_overrides, %XS_structure_overrides):
	Eliminate %XS_structure_overrides, and do not depend on the
	TEXINFO_XS_STRUCTURE variable.

	* tp/texi2any.pl, tp/t/test_utils.pl:
	Remove extra argument in call to parse_texi_file.
	Pass argument to Texinfo::Document::tree to control whether tree
	is built, depending on the setting of TEXINFO_XS_STRUCTURE.

	* tp/t/protect_character_in_texinfo.t:
	Only call Texinfo::Document::rebuld_tree if TEXINFO_XS_STRUCTURE is on.

2024-04-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/formats_encodings.t
	(accented_character_in_file_name): add to the t/*.t test suite a file
	that is already tested in tp/tests/encoded/ and has an accented letter
	in the Texinfo input file name.

2024-04-04  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): test if $document is undef to determine
	if the parsing failed.

2024-04-04  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Common.pm (debug_print_tree):
	Output 'tree_document_descriptor' hash value to help with
	debugging use of XS code.

2024-04-04  Patrice Dumas  <pertusus@free.fr>

	* tp/t/*.t, tp/t/test_utils.pl (test): move ENABLE_ENCODING setup in
	tests to the converter options, as it is not used in structuring
	anymore.

2024-04-03  Patrice Dumas  <pertusus@free.fr>

	Rename BODYTEXT customization variable as BODY_ELEMENT_ATTRIBUTES

	* NEWS, doc/texinfo.texi (Customization of HTML Code Inserted)
	(HTML Customization Variables List), doc/texi2any_api.texi,
	tp/Texinfo/Convert/HTML.pm (%defaults, _file_header_information)
	(output), tp/Texinfo/XS/convert/convert_html.c
	(BEGIN_FILE_INFORMATION, destroy_begin_file_information)
	(file_header_information, html_default_format_begin_file)
	(html_default_format_node_redirection_page),
	tp/Texinfo/options_data.txt, tp/init/html32.pm b/tp/init/html32.pm,
	tp/t/init/t2h_singular.init: rename BODYTEXT customization variable as
	BODY_ELEMENT_ATTRIBUTES.  Change variable names and structure field to
	be consistent.

2024-04-03  Patrice Dumas  <pertusus@free.fr>

	Remove USE_UP_NODE_FOR_ELEMENT_UP customization variable

	* NEWS, doc/texinfo.texi (Other Customization Variables),
	tp/Texinfo/Convert/HTML.pm (_set_variables_texi2html),
	tp/Texinfo/Structuring.pm (units_directions),
	tp/Texinfo/XS/main/output_unit.c (units_directions),
	tp/Texinfo/options_data.txt: remove USE_UP_NODE_FOR_ELEMENT_UP
	customization variable.  It would only be relevant if @top is not
	present, which should never be the case and is quite confusing as
	it does the reverse as the usual determination of direction based on
	chapter structuring commands.

2024-04-03  Patrice Dumas  <pertusus@free.fr>

	Remove NO_USE_SETFILENAME customization variable

	* NEWS, doc/texinfo.texi (Other Customization Variables),
	tp/Texinfo/Convert/Converter.pm (determine_files_and_directory),
	tp/Texinfo/options_data.txt, tp/Texinfo/Convert/HTML.pm
	(_set_variables_texi2html): remove NO_USE_SETFILENAME customization
	variable.  There are other ways to set setfilename or output file name
	and the @setfilename can be removed from document.

2024-04-03  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi: update cross-references to customization variables
	nodes.

2024-04-03  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi: replace associated to with associated with.

2024-04-03  Patrice Dumas  <pertusus@free.fr>

	Rename COMPLEX_FORMAT_IN_TABLE as INDENTED_BLOCK_COMMANDS_IN_TABLE

	* NEWS, doc/texinfo.texi (Specific Customization of HTML Formatting)
	(HTML Customization Variables List), tp/Texinfo/Convert/HTML.pm
	(%defaults, _convert_indented_command, _convert_preformatted_command),
	tp/Texinfo/XS/convert/convert_html.c (convert_preformatted_command)
	(convert_indented_command), tp/Texinfo/options_data.txt,
	tp/init/html32.pm: rename COMPLEX_FORMAT_IN_TABLE customization
	variable as INDENTED_BLOCK_COMMANDS_IN_TABLE.

2024-04-03  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Customization of HTML Code Inserted) <BODYTEXT>:
	Add information about "lang" attribute.

2024-04-03  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Specific Customization of HTML Formatting):
	Move COMPLEX_FORMAT_IN_TABLE to the right place.

2024-04-03  Patrice Dumas  <pertusus@free.fr>

	* info/scan.c (scan_reference_marker): If a file name component
	was read, allow what follows to be blank.  This supports cross
	references like '*note (manual)::'.

2024-04-02  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Syntax Highlighting, HTML Xref):
	Add @nodedescriptions.  (The content of these is not particularly
	important, but it looks consistent in the menu in the parent node.)

2024-04-03  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (HTML CSS, EPUB Output File and Directory)
	(Syntax Highlighting): add customization variables index entries in
	these nodes where the customization variables effect is described in
	the context of use.

2024-04-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (_convert): add a Top node in
	cross-ref when there is a file but no node, as the Texinfo Info reader
	cannot follow a cross-reference with a file but no node name.  Gavin
	report.

2024-04-02  Patrice Dumas  <pertusus@free.fr>

	Remove AVOID_MENU_REDUNDANCY customization option

	* NEWS, doc/texinfo.texi (HTML Customization Variables List),
	tp/Texinfo/Convert/HTML.pm (%defaults, _convert_menu_entry_type),
	tp/Texinfo/XS/convert/convert_html.c (simplify_text_for_comparison)
	(convert_menu_entry_type), tp/Texinfo/options_data.txt: remove
	AVOID_MENU_REDUNDANCY customization variable.  The associated
	case is unlikely to happen, not important, and the user can easily
	avoid the need for the variable by leaving the menu description blank.

2024-04-02  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (EPUB HTML): Add a @nodedescription.  Make
	explicit that it is texi2any setting variables internally, not
	anything that the user needs to or can do.

2024-04-02  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Customization of Navigation and Headers):
	Remove index entries for ACTIVE_ICONS and PASSIVE_ICONS.  This
	stops them being reported by "make vcheck" under doc/refcard.
	(They are reported because they are not listed in the main
	hashes in Texinfo/Options.pm that util/txicustomvars checks.)
	(HTML Output Customization): Add a @nodedescription.

2024-04-02  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/refcard/txivarcheck: Search more of the manual for
	customization variables.

2024-04-02  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (File Names and Links Customization for HTML):
	Refer to the user of the program as "you".

	* doc/texinfo.texi (Customization of Navigation and Headers): use
	active voice.

2024-04-02  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (File Names and Links Customization for HTML):
	Refer to the user of the program as "you".

2024-04-02  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (HTML Output Structure Customization)
	(JavaScript Interface and Licenses): add the 'JavaScript Interface and
	Licenses' node from content formerly in 'HTML Output Structure
	Customization'.  Leave USE_NEXT_HEADING_FOR_LONE_NODE description in
	'HTML Output Structure Customization'.

	* doc/texinfo.texi (HTML Features Customization)
	(Customization of HTML Code Inserted): split 'General Customization of
	HTML Code' in two, with 'HTML Features Customization', containing the
	beginning of th eremoved node and COPIABLE_LINKS description and
	'Customization of HTML Code Inserted'.

	* doc/texinfo.texi (HTML Features Customization): add examples of
	DOCTYPE setting. Refer to the user of the program as "you". 

	* doc/texinfo.texi (Customization of HTML Code Inserted): explain how
	opening and closing quotes are formatted by using a @table.

2024-04-02  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (HTML Customization for Math): Refer to the user
	of the program as "you".

	* doc/texinfo.texi: replace 'In the default case' by 'By default'.
	Gavin suggestion.

2024-04-02  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (HTML Customization Variables List):
	Shorten introductory text.

2024-04-02  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (HTML Customization Variables List):
	Move to a subsection of "HTML Output Customization".
	(Customization Variables): Reference node in new location.

2024-04-02  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (HTML Customization Variables List)
	(HTML CSS, HTML Output Structure Customization): Eliminate uses
	of "associate to", which is not correct English.

2024-04-01  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (HTML Output Customization):
	Refer to the user of the program as "you".

2024-04-02  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Command Index, Variables Index): do not
	merge variable index in general index, there are now many
	customization variables, a separate index is relevant.  Add 'Variables
	Index' node.

2024-04-02  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (HTML Output Customization): rename
	'HTML Output Advanced Customization' as 'HTML Output Customization'.
	Gavin idea.

	* doc/texinfo.texi (HTML Customization Variables List)
	(HTML Customization for Math): move 'MathJax Customization Variables',
	'@command{latex2html} Customization Variables' and '@command{tex4ht}
	Customization Variables' to 'HTML Customization for Math'.

2024-04-01  Gavin Smith <gavinsmith0123@gmail.com>

	Edits to manual

	* doc/texinfo.texi (HTML Output Advanced Customization)
	(HTML Output Structure Customization)
	(File Names and Links Customization for HTML)
	(Customization of Navigation and Headers)
	(General Customization of HTML Code)
	(Specific Customization of HTML Formatting):

	Refer to the user of the program as "you" in many places in order
	to be clearer as to semantic agency.

2024-04-01  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (HTML Output Advanced Customization): add
	TEXI2HTML customization variable description.

2024-04-01  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Info and Plaintext Customization Variables)
	(Other Customization Variables): new node for Info and plaintext
	specific customization variables.

	* doc/texinfo.texi (HTML Customization Variables List): move
	TEXI2HTML to the 'HTML Customization Variables List' node.

2024-04-01  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (HTML Customization Variables List): move
	EPUB_CREATE_CONTAINER_FILE, EPUB_KEEP_CONTAINER_FOLDER,
	HIGHLIGHT_SYNTAX and HIGHLIGHT_SYNTAX_DEFAULT_LANGUAGE to the 'HTML
	Customization Variables List' node.

2024-04-01  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Other Customization Variables): fix
	OPEN_QUOTE_SYMBOL numeric entity for HTML.

	* doc/texinfo.texi (General Customization of HTML Code): add
	CLOSE_QUOTE_SYMBOL and OPEN_QUOTE_SYMBOL for HTML customization
	description.

2024-04-01  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi: update internal references to use more the new
	HTML customization nodes.

	* doc/texinfo.texi (Customization of Navigation and Headers): add
	OUTPUT_ENCODING_NAME use description in the section.

	* doc/texinfo.texi (HTML Output Structure Customization)
	(File Names and Links Customization for HTML): minor corrections.

2024-04-01  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Menus): HTML menus are also automatically
	generated.

	* doc/texinfo.texi (EPUB HTML): minor change on customization
	variables used.

	* doc/texinfo.texi (HTML Output Structure Customization): add
	FORMAT_MENU nomenu to explanations.

	* doc/texinfo.texi: add index entries in HTML Customization nodes and
	references to those nodes.

2024-04-01  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Customization Variables)
	(HTML Output Advanced Customization): add the 'HTML Output Advanced
	Customization' node in 'Generating HTML' for the description of HTML
	customization variables use.

2024-04-01  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (HTML Customization for Math): add a node for HTML
	customization for Math with more details.

2024-04-01  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (HTML Customization Variables List): fix
	INDEX_ENTRY_COLON default.

	* doc/texinfo.texi (Specific Customization of HTML Formatting): add.

	* doc/texinfo.texi (General Customization of HTML Code): add
	OUTPUT_CHARACTERS.

	* doc/texinfo.texi (File Names and Links Customization for HTML): add
	index entries.  Add NODE_NAME_IN_MENU.

2024-03-31  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (HTML Customization Variables List): mention that
	COPIABLE_LINKS are output for headings too.

	* doc/texinfo.texi (File Names and Links Customization for HTML)
	(Customization of Navigation and Headers)
	(General Customization of HTML Code): review.  Add USE_ISO and
	COPIABLE_LINKS description to 'General Customization of HTML Code'.

2024-03-30  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Customization of Navigation and Headers)
	(General Customization of HTML Code): add nodes describing HTML
	customization in a more pedagoical way.

	* doc/texinfo.texi (HTML CSS): add the information on CSS related
	customization variables directly in the 'HTML CSS' node.

2024-03-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_converted_output_info): avoid
	having _string the type of a container containing directly the content
	of another tree element.

	* tp/Texinfo/XS/convert/convert_html.c (convert_value_command): fix
	explanation argument.

2024-03-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_default_format_special_body_about):
	reorder code to be in the same order as C code, to get the same debug
	output.

2024-03-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (units_directions): fix getting
	associated_section for NodeForward.  Fix one case of FastBack setting.

2024-03-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/structuring.c
	(new_complete_node_menu): call copy_contents instead of copy_tree on
	part argument.

	* tp/Texinfo/Convert/HTML.pm (_convert_printindex_command): call
	convert_tree instead of convert_tree_new_formatting_context for the
	reference part of seealso when there is no need for multiple pass.

	* tp/Texinfo/Convert/HTML.pm (_convert_value_command)
	(_default_format_program_string, _default_format_special_body_about),
	tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_program_string, html_default_format_end_file)
	(convert_value_command, default_format_special_body_about): add/fix
	explanation argument for tree conversion functions.

	* tp/Texinfo/Convert/HTML.pm (_html_convert_output): add unit number
	in debug message, as in C.

	* tp/Texinfo/XS/convert/convert_html.c
	(html_get_css_elements_classes): simplify and comment out C specific
	debug message.

2024-03-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_printindex_command),
	tp/Texinfo/XS/convert/convert_html.c (convert_printindex_command): do not
	setup a subentry tree for conversion with empty contents.

	* tp/Texinfo/Convert/HTML.pm (_convert_heading_command)
	(_convert_printindex_command, _convert_def_line_type)
	(_default_format_end_file, _default_format_node_redirection_page),
	tp/Texinfo/XS/convert/convert_html.c (html_default_format_end_file)
	(html_default_format_node_redirection_page, convert_heading_command)
	(printindex_letters_head_foot_internal, convert_printindex_command)
	(convert_def_line_type): add explanation argument to tree conversion.

	* tp/Texinfo/XS/convert/converter.c
	(register_normalize_case_filename): same debug message as in Perl.

	* tp/Texinfo/XS/main/convert_to_texinfo.c
	(root_heading_command_to_texinfo): also check that there are contents
	to set a tree for output.

2024-03-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(html_prepare_converted_output_info): call message_list_document_warn
	if the input_file_name is not set for missing title message as in
	Perl.

	* tp/Texinfo/Convert/HTML.pm (_prepare_converted_output_info): remove
	debug message of little use.

	* tp/Texinfo/Convert/HTML.pm (_convert),
	tp/Texinfo/XS/convert/convert_html.c (convert_to_html_internal):
	distinguish undefined text and empty text in debug message.

	* tp/Texinfo/XS/convert/converter.c (table_item_content_tree): keep
	information on definfoenclose original command name.

	* tp/Texinfo/XS/main/builtin_commands.c (element_command_name): treat
	especially internal commands corresponding to command classes,
	CM_index_entry_command and CM_definfoenclose_command.

	* tp/Texinfo/XS/main/errors.c
	(message_list_document_formatted_message): no warning with debug
	message as in Perl.

	* tp/Texinfo/XS/main/get_perl_info.c (get_line_message): fix condition
	to issue a warning.

2024-03-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Utils.pm (find_innermost_accent_contents): return
	undef for the inner accent command text element if there is no
	argument at all.  Update callers.

	* tp/Texinfo/Convert/HTML.pm (unit_is_top_output_unit)
	(_default_format_element_header): return 0 and not an empty string for
	better looking debug messages.

	* tp/Texinfo/Structuring.pm (unsplit): take into account the XS sub
	return.

	* tp/Texinfo/Structuring.pm (@relative_directions_order)
	(@file_directions_order, @all_directions_order)
	(print_output_unit_directions): use the same aorder as in C/XS for the
	output unit directions output message.

	* tp/Texinfo/Convert/Converter.pm (convert_accents),
	tp/Texinfo/Convert/HTML.pm (_convert_printindex_command)
	(_convert_def_line_type, _convert),
	tp/Texinfo/XS/convert/convert_html.c (convert_printindex_command)
	(convert_def_line_type, convert_to_html_internal),
	tp/Texinfo/XS/convert/converter.c (convert_accents): add explanation
	argument to tree conversion functions calls.

	* tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_element_header): actually output debug message.

	* tp/Texinfo/XS/convert/convert_html.c (direction_string)
	(convert_explained_command): correct and update debug messages.

2024-03-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (html_convert_css_string)
	(_reset_unset_no_arg_commands_formatting_context),
	tp/Texinfo/XS/convert/convert_html.c (html_convert_css_string)
	(reset_unset_no_arg_commands_formatting_context): set the string
	context directly instead of using a type _string in Perl.  In C, call
	html_set_string_context.  Call html_open_command_update_context and
	html_convert_command_update_context in C for
	reset_unset_no_arg_commands_formatting_context preformatted context,
	as in Perl.

2024-03-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (@global_directions): use the same order
	as in C code HTML_GLOBAL_DIRECTIONS_LIST.

	* tp/Texinfo/XS/convert/convert_html.c
	(html_prepare_conversion_units): do not call
	set_global_document_commands on contents commands, as it is already
	done in Perl.

2024-03-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_element_footer): use TOP_FOOTER_BUTTONS.

2024-03-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/debug.c (debug_protect_eol): protect all the
	newlines and do not truncate the string at the first newline.

	* tp/Texinfo/XS/parsetexi/source_marks.c (source_marks_names): fix
	source marks name table.

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser): call parser_set_debug
	even if DEBUG is undef.

	* tp/Texinfo/XS/parsetexi/parser.c (parse_texi),
	tp/Texinfo/XS/parsetexi/input.c (next_text): add after_end_fetch_nr to
	diagnose cases of text being demanded after having reached once the
	end of input, as in Perl.

	* tp/Texinfo/XS/main/translations.c (replace_convert_substrings): add
	same error message as in Perl.

2024-03-26  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (HTML Customization Variables List): change in
	wording based on Gavin reports.

2024-03-26  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (HTML Output Structure Customization)
	(File Names and Links Customization for HTML): more pedagogical
	presentation of HTML customization through customization variables.

2024-03-24  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi: minor changes.

	Changes in code comments.

2024-03-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%html_default_commands_args): rename
	%default_commands_args as %html_default_commands_args.

	* doc/html_default_commands_args.texi, doc/Makefile.am
	(texinfo_TEXINFOS, TXI_MODULES_ENV, html_default_commands_args.texi)
	(EXTRA_DIST), doc/texi2any_api.texi, tp/Texinfo/Convert/HTML.pm,
	doc/generate_html_doc_texi.pl: generate texinfo table of HTML
	default commands args based on %html_default_commands_args from
	Texinfo/Convert/HTML.pm in the doc/html_default_commands_args.texi
	file and include in texi2any_api.texi.

	* doc/texi2any_api.texi, tp/init/documentation_examples.pm,
	tp/t/init_files_tests.t ($documentation_examples_text): add more
	examples, add examples in documentation_examples.pm.

2024-03-23  Patrice Dumas  <pertusus@free.fr>

	* tp/init/documentation_examples.pm: use pl instead of de, with
	a maintained po_document translation.  Add use of
	texinfo_register_direction_string_info.

	* tp/t/init_files_tests.t ($documentation_examples_text)
	(documentation_examples, documentation_examples_texi2html): add a
	documentation examples init file use with texi2html style.

2024-03-23  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): remove symbols added in init files
	at the end of a test.

2024-03-23  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi: corrections, add examples, move nodes.

2024-03-19  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi: move "Command Tree Element Opening Functions"
	after "Command Tree Element Conversion Functions".

	* doc/texi2any_api.texi (Text Tree Elements Conversion): add a
	subsection for text holding Texinfo tree elements.  Move "Text
	Formatting Context" to that subsection.

	* doc/texi2any_api.texi: more examples, fixes in text.

2024-03-19  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi: use $converter instead of $self.

	* doc/texi2any_api.texi: move format_button_icon_img and the whole
	content of "Directions@comma{} Links@comma{} Labels and Files"
	where it is used.

	* doc/texi2any_api.texi: move "Tree Element Opening Functions" after
	"Type Tree Element Conversion Functions". Add more examples.

	* tp/init/documentation_examples.pm: update.

	* tp/Texinfo/Convert/HTML.pm (get_element_root_command_element):
	rename $root_element as $output_unit.

2024-03-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/html_tests.t (anchor_on_vtable_item): add
	test with @anchor on @vtable @item line.  Based on a report of
	Georg-Johann Lay.

2024-03-17  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi: use $converter instead of $self.

	* doc/texi2any_api.texi (Formatting HTML Output): add and additional
	section level structure in the node.  Move some information
	from "Dynamic Conversion Information" on "Alignment and Multiple
	Expansion Contexts" and "Dynamic Converter Formatting
	Information".  Remove "Dynamic Conversion Information".

	* doc/texi2any_api.texi (Customization and Use of Formatting Functions),
	(Tree Element Conversion Customization, Output Units Conversion
	Functions): reorganize, add information previously in "Dynamic
	Conversion Information" and "Heading Commands Formatting", move
	"Opening and Closing Sectioning Commands Extent" content to "Heading
	Commands Formatting".

	* doc/texi2any_api.texi (Shared Conversion State): make it a chapter.

	* doc/texi2any_api.texi (Associating Information to an Output File):
	move to "Beginning and Ending Files".

	* doc/texi2any_api.texi (Conversion to Plain Text): new node based on
	the expansion of information in "Setting the Context for Conversion".

	* doc/texi2any_api.texi: some rewriting, add more examples.

2024-03-17  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi: reorganize, by adding "Formatting HTML
	Output" and "Error Reporting, Customization Variables and
	Paths Manipulation in User Defined Functions" and moving there
	information from "User Defined Functions", "Protection of
	URLs" and more generally "Mandatory Conversion Function Calls", which
	is removed.

2024-03-17  Patrice Dumas  <pertusus@free.fr>

	* README-hacking: mention pod2man.

2024-03-17  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (@code{@@itemize}): Shorten discussion of
	moving index entries and comments.

2024-03-17  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Introducing Lists, @code{@@itemize}): use {} in
	examples with mark commands @itemize arguments.

	* doc/texinfo.texi (@code{@@bullet}, Click Sequences): remove text
	stating that mark commands @itemize arguments braces are normally
	omitted that are also of dubious interest.

2024-03-16  Patrice Dumas  <pertusus@free.fr>

	Add TOP_FOOTER_BUTTONS customization variable

	* doc/texi2any_api.texi (Simple Navigation Panel Customization),
	tp/Texinfo/Convert/HTML.pm (%defaults, _default_format_element_footer)
	(_set_variables_texi2html), tp/Texinfo/options_data.txt,
	tp/init/book.pm: add a TOP_FOOTER_BUTTONS to be able to specify
	seprately the Top node/@top header and footer.

2024-03-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_default_format_navigation_panel),
	tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_navigation_panel),
	tp/Texinfo/XS/main/get_perl_info.c
	(html_get_button_specification_list),
	tp/maintain/regenerate_C_options_info.pl: handle a string passed for a
	buttons list customization variable.  Handle an undef buttons list in
	C.

	* tp/Texinfo/Convert/HTML.pm (_default_format_navigation_panel)
	(_default_format_navigation_header),
	tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_navigation_panel)
	(html_default_format_navigation_header): return an empty string instead
	of an empty <div> for navigation panel when the panel buttons is an
	empty string.  Do not output an horizontal rule if there is no
	navigation panel.

	* tp/Makefile.tres, tp/t/layout.t (navigation_test_undef_top_buttons)
	(navigation_test_zero_top_buttons): tests of TOP_BUTTONS set to undef
	and set to '0'.

2024-03-15  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Special Unit Body Formatting Functions): fix
	crossref node name.

2024-03-15  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi: explain better the effect of some
	customization variables.  Use @subentry.  Other changes.

2024-03-15  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (CSS Customization, Customization of CSS Rules
	Imports and Selectors, Customizing the CSS Lines): move all the
	information related to CSS Customization to the same place, in the CSS
	Customization new node.

2024-03-15  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi: replace 'element direction' by 'output unit
	direction' everywhere.  Other changes and fixes.

2024-03-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_title_titlepage)
	(_html_convert_output, tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_title_titlepage, html_convert_convert)
	(html_convert_output): change arguments orders if it simplifies
	ignoring unused arguments in XS.  Ignore unused arguments in XS.
	Update callers.

2024-03-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_convert_convert)
	(html_convert_output): use directly C document associated to
	converter.

	Other minor changes.

2024-03-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/call_html_perl_function.c: remove conditions
	on self->hv and special_unit->hv that should never change.

2024-03-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (add_tree_to_build)
	(remove_tree_to_build): add functions to add/remove an element to
	self->tree_to_build.  add/remove to tree_to_build only if
	self->external_references_number > 0.

2024-03-13  Patrice Dumas  <pertusus@free.fr>

	* po/Makevars (XGETTEXT_OPTIONS): fix message_list_document_* options.

	Update po files.

2024-03-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/main/tree_types.h: add const.

	* tp/Texinfo/XS/convert/convert_html.c (normalized_label_id_file):
	reorganize code, add const.

	* tp/Texinfo/XS/structuring_transfo/transformations.c
	(protect_first_parenthesis): reorganiza code, add const.

2024-03-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_units_directions_files): always return undef, as the
	return value is ignored if XS overrides are used for the conversion.

2024-03-12  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (@itemize):
	Do not say that the argument has to "result in a single character
	in the Info file", as multiple characters do work fine as an argument.
	Remove description of what @bullet outputs in different output
	formats, for brevity.  Move discussion of optional braces after
	the example.  Move discussion of having at least one @item, index
	entries and comments, and blank lines after the example usage.

2024-03-12  Patrice Dumas  <pertusus@free.fr>

	No information to Perl if no Perl functions are potentially called

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_title_titlepage)
	(html_convert_convert, html_convert_output),
	tp/Texinfo/XS/convert/convert_html.c (html_convert_convert)
	(html_prepare_title_titlepage, html_convert_output): get output units
	descriptors from converter.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_conversion_units),
	tp/Texinfo/XS/convert/convert_html.c (html_converter_initialize),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): set a counter based
	on total Perl function references potentially called.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_conversion_units)
	(html_prepare_units_directions_files)
	(html_prepare_output_units_global_targets)
	(html_prepare_converted_output_info, html_prepare_title_titlepage),
	tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_formatting_state),
	tp/Texinfo/XS/convert/convert_html.c (html_translate_names),
	tp/Texinfo/XS/main/build_perl_info.c (setup_output_units_handler):
	do not pass information to Perl if Perl functions are not called.

2024-03-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_units_directions_files),
	tp/Texinfo/XS/convert/convert_html.c
	(html_prepare_units_directions_files): get output units descriptors
	from converter.

2024-03-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_conversion_units)
	(html_prepare_output_units_global_targets),
	tp/Texinfo/XS/convert/convert_html.c (html_get_tree_root_element)
	(prepare_special_units, html_prepare_conversion_units)
	(set_special_units_targets_files)
	(prepare_associated_special_units_targets, html_internal_command_href)
	(html_prepare_conversion_units_targets)
	(html_prepare_output_units_global_targets)
	(html_prepare_units_directions_files),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER)
	(enum output_units_descriptor_type): add output_units_descriptors
	to converter store all types of output units descriptors.  Remove
	output_units_descriptors.  Use that informaton to get output units
	descriptors instead of going through Perl.

2024-03-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER): count the number of file_id_setting references actually set.

2024-03-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h
	(HTML_FILE_ID_SETTING_NAMES_LIST, enum html_file_id_setting)
	(CONVERTER), tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_file_id_setting_*): get the file_id_setting function references
	keys only once in html_converter_initialize_sv, store them in the
	converter.

2024-03-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_file_id_setting_*): check if special_unit->hv exist after
	getting the function to call such that the Perl data may be rebuilt at
	that time.

2024-03-11  Patrice Dumas  <pertusus@free.fr>

	Count Perl functions used

	* tp/Texinfo/XS/convert/convert_html.c
	(register_type_conversion_function, register_type_open_function)
	(register_command_conversion_function, register_command_open_function)
	(register_output_unit_conversion_function)
	(register_special_unit_body_formatting_function)
	(html_converter_initialize): register_* return 1 if a function was
	registered.  Setup counters of perl functions registerd and not
	replaced by C functions.

	* tp/Texinfo/XS/main/get_perl_info.c
	(html_get_button_specification_list),
	tp/Texinfo/XS/main/option_types.h (BUTTON_SPECIFICATION_LIST),
	tp/maintain/regenerate_C_options_info.pl: add and set counters of the
	number of functions used in buttons for directions, of type
	BIT_function, that are not default functions.  Count for a
	BUTTON_SPECIFICATION_LIST and for all BUTTON_SPECIFICATION_LIST
	OPTIONS.

2024-03-11  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): collect
	Texinfo::Config::GNUT_initialize_config init files customization
	variables information return value and use it in converter options.

	* tp/t/init_files_tests.t (redefined_buttons_functions),
	t/init/redefined_buttons.pm, tp/Makefile.am (test_files),
	tp/Makefile.tres: add a test of redefinition of button formatting
	functions in init file.

2024-03-11  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm,
	tp/t/automatic_menus.t, tp/t/convert_to_text.t,
	tp/t/index_before_item.t, tp/t/reference_to_text_in_tree.t,
	tp/t/test_fill_gaps_in_sectioning.t, tp/t/test_tree_copy.t: call
	tree() to rebuild the tree from a document instead of using
	Texinfo::Document::rebuild_tree.

	* Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm: do not return the tree
	when its root is a container and is not modified by transformations.
	Use parse_texi_piece instead of parse_texi_text for pieces of Texinfo.

2024-03-10  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/pod2texi.pl (_parsed_manual_tree)
	(_fix_texinfo_tree): comment out calls to
	Texinfo::Document::rebuild_document.

	* tp/Texinfo/XS/convert/ConvertXS.xs: comments for unused overrides.

2024-03-10  Patrice Dumas  <pertusus@free.fr>

	* po/Makevars (XGETTEXT_OPTIONS), tp/Texinfo/XS/main/errors.c
	(vmessage_list_line_error, message_list_command_warn)
	(pmessage_list_command_warn): add a translation context to
	vmessage_list_line_error.  Add the pmessage_list_command_warn function
	with a translation context and continuation.  Add a continuation
	argument for message_list_command_warn.  Update callers.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_node_redirections),
	tp/Texinfo/XS/convert/convert_html.c (html_node_redirections):
	implement html_node_redirections and add an XS override.

	* tp/Texinfo/Convert/HTML.pm (_node_redirections): remove extension
	related ocde, it is not used.  Rename $out_filename as $out_filepath.

2024-03-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c
	(destroy_document_information_except_tree): free
	document->parser_error_messages.

	* tp/Texinfo/XS/main/translations.c (replace_convert_substrings): show
	and clear parser error messages, not other document errors.

2024-03-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_node_redirections): use labels_list
	instead of labels_information.

	* tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_units_directions_files),
	tp/Texinfo/XS/convert/convert_html.c (html_reset_files_source_info)
	(html_free_files_source_info, html_destroy_files_source_info)
	(html_set_pages_files, html_reset_converter, html_free_converter),
	tp/Texinfo/XS/main/converter_types.h (FILE_SOURCE_INFO)
	(FILE_SOURCE_INFO_LIST, CONVERTER), tp/Texinfo/XS/main/utils.h:
	add files_source_info to converter, move FILE_SOURCE_INFO and
	FILE_SOURCE_INFO_LIST definition to converter_types.h.  Use converter
	files_source_info in html_set_pages_files, add functions to reset and
	free FILE_SOURCE_INFO_LIST and use those functions in converter reset
	and free, instead of destroying the files_source_info in
	html_prepare_units_directions_files.

2024-03-10  Patrice Dumas  <pertusus@free.fr>

	* tp/t/automatic_nodes.t, tp/t/do_master_menu.t,
	tp/t/protect_character_in_texinfo.t,
	tp/t/test_protect_hashchar_at_line_beginning.t: comment out
	Texinfo::Document::rebuild_document calls, as it is not needed anymore.

2024-03-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_conversion_units):
	setup the Perl Texinfo tree before building output units to Perl as
	output units refer to the root commands.

	* tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash): allow
	element associated_unit hv not to be already set, in case the tree is
	rebuilt before the output units, while there are already output units
	in XS/C.

2024-03-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (determine_files_and_directory),
	tp/Texinfo/Convert/Text.pm (output): remove useless calls to
	global_commands_information.

2024-03-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_node_redirections): move code related
	to node files redirections to a function, in particular to prepare for
	XS overriding.

2024-03-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (copy_option): handle NULL source
	string.

2024-03-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_handle_line_command)
	(_handle_block_command): fix global commands state key.

2024-03-10  Patrice Dumas  <pertusus@free.fr>

	XS interface for Texinfo::Convert::Converter::set_global_document_commands

	* tp/Texinfo/Convert/Converter.pm (%XS_overrides),
	tp/Texinfo/XS/convert/ConvertXS.xs
	(converter_set_global_document_commands): add an XS interface for
	set_global_document_commands.

2024-03-10  Patrice Dumas  <pertusus@free.fr>

	Put dircategory_direntry in global_commands

	* tp/Texinfo/ParserNonXS.pm (_register_global_command)
	(_handle_block_command), tp/Texinfo/XS/main/document_types.h,
	tp/Texinfo/XS/main/utils.c (delete_global_info)
	(delete_global_commands), tp/Texinfo/XS/parsetexi/handle_commands.c
	(handle_line_command, handle_block_command),
	tp/Texinfo/XS/parsetexi/parser.c (store_document),
	tp/Texinfo/XS/main/command_data.awk, tp/Texinfo/Convert/IXIN.pm,
	tp/Texinfo/Convert/Info.pm (_info_header): put dircategory_direntry
	in global_commands.

	* tp/Texinfo/XS/main/DocumentXS.xs (document_global_information),
	tp/Texinfo/Document.pm (global_information),
	tp/Texinfo/XS/main/build_perl_info.c (build_global_commands)
	(document_global_information): remove optional argument of
	global_information.  Remove build_global_info_tree_info.  Update
	callers.

2024-03-10  Patrice Dumas  <pertusus@free.fr>

	Add setfilename value to global_info

	* tp/Texinfo/Convert/Converter.pm (determine_files_and_directory),
	tp/Texinfo/Convert/Text.pm (output), tp/Texinfo/ParserNonXS.pm
	(get_parser_info), tp/Texinfo/XS/main/build_perl_info.c
	(build_global_info): add the setfilename text argument to global_info
	as it is used to determine output file name.

2024-03-09  Patrice Dumas  <pertusus@free.fr>

	Do not call rebuild_document

	* tp/texi2any.pl, tp/t/test_utils.pl (test): do not call
	rebuild_document, the document information should be built to Perl
	when called through the accessors.

	* tp/texi2any.pl: remove a useless call to labels_information.

	* t/test_utils.pl: remove a useless call to
	global_commands_information.

	* tp/Texinfo/Document.pm (global_information),
	tp/Texinfo/XS/main/DocumentXS.xs (document_global_information),
	tp/Texinfo/XS/main/build_perl_info.c (document_global_information),
	tp/texi2any.pl, t/test_utils.pl: add an argument to
	global_information/document_global_information such that only
	information that do not require building the Perl tree is returned if
	set.  Similar to calling only get_document, called that way from the
	main program.

2024-03-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm (%XS_structure_overrides)
	(setup_indices_sort_strings, indices_sort_strings),
	tp/Texinfo/XS/main/DocumentXS.xs (setup_indices_sort_strings),
	tp/texi2any.pl: add setup_indices_sort_strings that does the same as
	indices_sort_strings but does not return anything, to avoid building
	Perl data in XS if not needed.

2024-03-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash): store
	associated_unit in element.

	* tp/Texinfo/XS/main/document.c (register_document_sections_list):
	fix document->modified_information flag used.

	* tp/Texinfo/Document.pm (labels_list), tp/Texinfo/Convert/HTML.pm
	(_set_root_commands_targets_node_files): add an interface for Document
	'labels_list'.

	* tp/Texinfo/XS/main/DocumentXS.xs (document_tree): no warning if
	XS document is not found.

	* tp/Texinfo/XS/main/DocumentXS.xs (document_tree),
	tp/Texinfo/XS/main/build_perl_info.c (store_texinfo_tree): split
	store_texinfo_tree out of document_tree to be able to call
	build_texinfo_tree if needed.

	* tp/Texinfo/Document.pm (%XS_structure_overrides),
	tp/Texinfo/XS/main/DocumentXS.xs (document_global_information)
	(document_indices_information, document_global_commands_information)
	(document_labels_information, document_nodes_list)
	(document_sections_list, document_floats_information)
	(document_internal_references_information, document_labels_list),
	tp/Texinfo/XS/main/build_perl_info.c (BUILD_PERL_DOCUMENT_ITEM)
	(BUILD_PERL_DOCUMENT_LIST, document_global_information): add an XS
	override for document accessors.

	* tp/Texinfo/XS/convert/ConvertXS.xs
	(get_converter_indices_sorted_by_index)
	(get_converter_indices_sorted_by_letter),
	tp/Texinfo/XS/main/DocumentXS.xs  (indices_sort_strings): get index
	entries by calling document_indices_information.

2024-03-09  Patrice Dumas  <pertusus@free.fr>

	XS override for Texinfo::Document tree

	* tp/Texinfo/XS/main/DocumentXS.xs (document_tree),
	tp/Texinfo/Document.pm (%XS_structure_overrides, tree): add an XS
	override for Texinfo::Document tree.  Add an optional argument to
	tree() to avoid building the Perl tree if only a handler on XS data is
	needed.

	* tp/texi2any.pl, tp/t/test_utils.pl (test): set the new argument of
	tree() when tree handler only is needed.

2024-03-09  Patrice Dumas  <pertusus@free.fr>

	Set document->modified_information when modified, unset when passed to
	Perl

	* tp/Texinfo/XS/main/DocumentXS.xs (set_document_global_info),
	tp/Texinfo/XS/main/build_perl_info.c (get_document, fill_document_hv),
	tp/Texinfo/XS/main/document.c, tp/Texinfo/XS/main/output_unit.c
	(split_by_node, split_by_section, unsplit),
	tp/Texinfo/XS/main/targets.c (add_element_to_identifiers_target),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs,
	tp/Texinfo/XS/structuring_transfo/structuring.c,
	tp/Texinfo/XS/structuring_transfo/transformations.c: set
	document->modified_information flags when set or modified in C;
	Remove the flags when passed to Perl document structure.

2024-03-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm (indices_sort_strings),
	tp/Texinfo/XS/main/DocumentXS.xs (indices_sort_strings),
	tp/Texinfo/XS/main/document.c (document_indices_sort_strings): remove
	prefer_reference_element argument, as the result is cached, therefore
	the first call prefer_reference_element argument only would be
	used.  Also the possibility associated to that argument probably do
	not make much sense when doing a document indices_sort_strings.

2024-03-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_conversion_units)
	(_html_convert_convert, run_stage_handlers, _html_convert_output),
	tp/Texinfo/Structuring.pm (split_by_node, split_by_section)
	(_XS_unsplit, unsplit), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_convert_convert, html_convert_output),
	tp/Texinfo/XS/main/output_unit.c (split_by_node, split_by_section)
	(unsplit), tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs
	(split_by_node, split_by_section, unsplit): pass a document instead of
	a tree in argument.  Update callers.

2024-03-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document_types.h (DOCUMENT): add a
	modified_information flags field to DOCUMENT to keep track of which
	information is passed to Perl.

	* tp/Texinfo/XS/main/DocumentXS.xs (indices_sort_strings),
	tp/Texinfo/XS/main/document.c (document_indices_sort_strings): build
	Perl indices_sort_strings information only once based on a DOCUMENT
	modified_information flag, and cache the Perl indices_sort_strings
	information in the Perl document hash, as is done in Perl overriden
	code.

2024-03-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/DocumentXS.xs,
	tp/Texinfo/XS/main/build_perl_info.c: remove pass_document_errors.

	* tp/Texinfo/XS/main/build_perl_info.c: move functions around.

2024-03-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (registrar),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (registrar): get self argument.

	* tp/Texinfo/XS/main/build_perl_info.c
	(pass_document_parser_errors_to_registrar),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (_get_parser_info),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs
	(pass_document_parser_errors_to_registrar): pass directly document
	prser errors to registrar. Remove pass_document_parser_errors.

2024-03-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (errors),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (errors): add errors as the main
	way to get parser errors.  Remove registered_errors.  Update callers
	of registered_errors to call directly errors.

	* tp/Texinfo/ParserNonXS.pm (registrar),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (registrar): add Texinfo::Report
	registrar accessors to have the same interface as document, only
	currently used in a test.

2024-03-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm (%XS_overrides, errors),
	tp/Texinfo/XS/main/DocumentXS.xs (document_errors),
	tp/Texinfo/XS/main/build_perl_info.c (add_formatted_error_messages)
	(pass_errors_to_registrar): override directly
	Texinfo::Document::errors.  Rename pass_converter_errors as
	add_formatted_error_messages and return error_nrs and errors_warnings
	Perl references too.

2024-03-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_starting_block),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block): change
	warning message based on mailing list feedback.  Use command_data in C.

2024-03-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (rebuild_document): do not
	clear the existing document HV.

2024-03-06  Patrice Dumas  <pertusus@free.fr>

	Get errors from XS independently of document build/rebuild

	* tp/Texinfo/XS/main/build_perl_info.c (pass_document_parser_errors),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (_get_parser_info),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (pass_document_parser_errors):
	pass XS parser errors through the pass_document_parser_errors XS
	interface and remove them from XS data.

	* tp/Texinfo/Document.pm (%XS_overrides, _XS_pass_document_errors)
	(errors), tp/Texinfo/XS/main/DocumentXS.xs (pass_document_errors),
	tp/Texinfo/XS/main/build_perl_info.c (pass_document_errors):
	pass directly XS errors to Perl through pass_document_errors
	independentely of document rebuild, and remove errors from XS data.

	* tp/Texinfo/XS/main/build_perl_info.c (get_document)
	(fill_document_hv): do not build parser nor document errors lists.

	* tp/Texinfo/Document.pm (%XS_overrides): remove XS interface for
	clear_document_errors.

	* tp/Texinfo/XS/parsetexi/Parsetexi.xs: remove clear_document_errors
	and clear_document_parser_errors XS interfaces.

	* tp/Texinfo/Document.pm (register): remove 'parser_registrar' field
	and $parser_registrar register function argument.  Update caller.

	* tp/t/test_utils.pl (test): do not call indices_sort_strings early
	anymore, and do not call $document->errors() right after rebuilding
	document, now that there are no link between retrieving errors and
	building document to Perl.

2024-03-05  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Command List): @bullet is often associated with
	@itemize, not @table.

2024-03-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_starting_block),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block): add a
	warning when a command as @itemize argument is a brace command, do not
	have braces and is not a mark (noarg) command.

2024-03-03  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/main/get_perl_info.c: Remove unnecessary #include.

2024-03-03  Patrice Dumas  <pertusus@free.fr>

	Update POD documentation.

2024-03-03  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/pod2texi.pl (_parsed_manual_tree): update calls
	to Texinfo::Transformations and Texinfo::Structuring methods by
	removing registrar and using document when needed.

2024-03-03  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_protect_hashchar_at_line_beginning.t (run_test): store
	tree transformation error messags in document registrar.  Use document
	error function to get errors and merge with parser registrar errors.

2024-03-03  Patrice Dumas  <pertusus@free.fr>

	Change name of registrar variables to clarify the type of registrar

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (_get_parser_error_registrar):
	rename _get_error_registrar as _get_parser_error_registrar.

2024-03-03  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): use document registrar in tree
	transformation test.

	* tp/t/test_utils.pl (test): rename $registrar as $parser_registrar.

2024-03-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm (_existing_label_error)
	(set_labels_identifiers_target)
	(register_label_element), tp/Texinfo/Transformations.pm (_new_node):
	pass registrar as argument of _existing_label_error and
	register_label_element.  Set the argument in
	set_labels_identifiers_target as should be done for a parser, and in
	_new_node as a document.

2024-03-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm (registrar), tp/Texinfo/Structuring.pm: add 
	accessor for registrar.

2024-03-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (sectioning_structure),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs
	(sectioning_structure): use a document in argument, to avoid the
	possibility to use the parser error registrar.  Update callers.

	* tp/t/test_utils.pl (test): call
	Texinfo::Document::sorted_indices_by_index instead of
	Texinfo::Indices::sort_indices_by_index, in particular to use the
	document errors registrar more simply.

2024-03-03  Patrice Dumas  <pertusus@free.fr>

	Separate Parser and Document errors and registrars

	* tp/Texinfo/Document.pm (register),
	tp/Texinfo/XS/main/build_perl_info.c (get_document, fill_document_hv),
	tp/Texinfo/XS/main/document.c (register_document)
	(clear_document_parser_errors), tp/Texinfo/XS/main/document_types.h
	(DOCUMENT), tp/Texinfo/XS/parsetexi/Parsetexi.pm (_get_parser_info),
	tp/t/test_parser_registrar.t, tp/t/test_utils.pl (test),
	tp/texi2any.pl: add a separate Texinfo::Report error registrar in
	perl, and separate parser_error_messages ERROR_MESSAGE_LIST in C.
	Merge parser and document errors in texi2any.pl and test_utils.pl.
	Remove handle_document_errors in texi2any.pl as the code is inlined
	for the merging of errors in the main loop.

2024-03-03  Gavin Smith <gavinsmith0123@gmail.com>

	Remove some perl_only_* wrappers

	* tp/Texinfo/XS/main/build_perl_info.c
	(perl_only_xasprintf, perl_only_xvasprintf): Remove as wrappers,
	as it is likely that Perl does not define its own versions
	of these.  It's not worth implementing them ourselves as this is
	not trivial to do, and they are not currently needed.

	* tp/Texinfo/XS/main/utils.c
	(non_perl_xasprintf, non_perl_xvasprintf): Add.

	* tp/Texinfo/XS/main/get_perl_info.c
	(get_sv_index_entries_sorted_by_letter): Replace calls to
	perl_only_xasprintf and perl_only_free with calls to non_perl_xasprintf
	and non_perl_free.

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_translated_names): Replace call to perl_only_xasprintf
	with calls to perl_only_malloc and sprintf.

2024-03-03  Gavin Smith <gavinsmith0123@gmail.com>

	Reimplement perl_only_* wrappers

	* tp/Texinfo/XS/main/build_perl_info.c
	(perl_only_strdup, perl_only_strndup): Reimplement as it is
	likely that Perl does not define its own versions of these.

2024-03-03  Gavin Smith <gavinsmith0123@gmail.com>

	Consolidate "#undef free" comment.

	* tp/Texinfo/XS/XSParagraph.xs,
	* tp/Texinfo/XS/MiscXS.xs,
	* tp/Texinfo/XS/convert/ConvertXS.xs,
	* tp/Texinfo/XS/convert/build_html_perl_state.c,
	* tp/Texinfo/XS/convert/call_html_perl_function.c,
	* tp/Texinfo/XS/convert/get_html_perl_info.c,
	* tp/Texinfo/XS/main/api_to_perl.c,
	* tp/Texinfo/XS/misc.c,
	* tp/Texinfo/XS/parsetexi/Parsetexi.xs,
	* tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs,
	* tp/Texinfo/XS/xspara.c:
	Refer to comment in XSParagraph.xs for why we "#undef free" and
	expand on this comment.

2024-03-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.h (initialize_cmd_list): fix
	definition.

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/convert/convert_html.c
	(new_special_unit_info_type): replace
	initialize_special_unit_info_type by new_special_unit_info_type.

	* tp/Texinfo/XS/convert/convert_html.c, tp/Texinfo/XS/main/utils.c:
	use new_string_list.

2024-02-26  Patrice Dumas  <pertusus@free.fr>

	Wrappers around functions to avoid mixing Perl and non-Perl

	* tp/Texinfo/XS/convert/convert_html.c (initialize_cmd_list)
	(new_htmlxref_manual_list, initialize_js_categories_list)
	(initialize_jslicense_files, initialize_css_selector_style_list)
	(new_directions_strings_translated_type, new_directions_strings_type)
	(new_special_unit_formatting_references)
	(initialize_special_unit_info_type),
	tp/Texinfo/XS/convert/get_html_perl_info.c: add and use initialization
	functions, and use more wrappers.

2024-02-25  Patrice Dumas  <pertusus@free.fr>

	Homogenize the reference to the NOTE in build_perl_info.c

2024-02-25  Patrice Dumas  <pertusus@free.fr>

	Add wrappers around functions to avoid mixing Perl and non-Perl

	* tp/Texinfo/XS/convert/call_html_perl_function.h,
	tp/Texinfo/XS/main/utils.h (TARGET_CONTENTS_FILENAME, FILE_NAME_PATH)
	(TARGET_DIRECTORY_FILENAME): move to main/utils.h.

	* tp/Texinfo/XS/*/*.xs, tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_translated_names),
	tp/Texinfo/XS/convert/call_html_perl_function.c,
	tp/Texinfo/XS/convert/get_html_perl_info.c,
	tp/Texinfo/XS/main/api_to_perl.c, tp/Texinfo/XS/main/build_perl_info.c
	(perl_only_free, perl_only_malloc, perl_only_strdup)
	(perl_only_strndup, perl_only_xvasprintf, perl_only_xasprintf),
	tp/Texinfo/XS/main/call_perl_function.c,
	tp/Texinfo/XS/main/get_perl_info.c, tp/Texinfo/XS/main/utils.c
	(non_perl_free, non_perl_strdup, non_perl_strndup, new_string_list)
	(new_target_filename, new_target_contents_filename, new_file_name_path)
	(new_target_directory_filename, new_formatted_button_info),
	tp/maintain/regenerate_C_options_info.pl: add and use wrappers for
	some of free, strdup, strndup, malloc, xvasprintf and xasprintf with
	Perl only variants defined in files including only Perl headers (no
	gnulib headers) and non Perl variants defined in files not including
	Perl headers.  Also add constructors to call malloc in main/utils.c.

2024-02-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/DocumentXS.xs, tp/Texinfo/XS/main/IndicesXS.xs,
	tp/Texinfo/XS/main/build_perl_info.c,
	tp/Texinfo/XS/main/call_perl_function.c,
	tp/Texinfo/XS/main/get_perl_info.c,
	tp/maintain/regenerate_C_options_info.pl: remove code avoiding
	redefinition by gnulib as gnulib headers are not included.  Update
	comments.

	* tp/Texinfo/XS/Makefile.am (DocumentXS_la_L*, ConvertXS_la_LIBADD):
	add libgnu.la and $(LTLIBICONV) $(LTLIBUNISTRING) is not there for
	XS that are likely to use code related to those libraries.

	* tp/Texinfo/XS/Makefile.am (IndicesXS_la_CPPFLAGS): remove gnulib
	includes, they are not needed.

2024-02-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/errors.c (message_list_line_formatted_message)
	(message_list_document_formatted_message)
	(vmessage_list_line_error, message_list_document_error_internal):
	call strdup in message_list_line_formatted_message and
	message_list_document_formatted_message directly when registering the
	message, and set const on the argument.  Free the messages in
	vmessage_list_line_error and message_list_document_error_internal
	after registering them.  This is so directly calling
	message_list_*_formatted_message does not require calling strdup.

	Add const.

2024-02-25  Gavin Smith <gavinsmith0123@gmail.com>

	Reset parsetexi counters

	* tp/Texinfo/XS/parsetexi/parser.c (reset_parser_counters): New.
	* tp/Texinfo/XS/parsetexi/api.c (reset_parser_except_conf): Call it.

	There were intermittent failures in the t/03coverage_braces.t
	definfoenclose_texinfo_commands test due to one of the counters
	not being reset.

2024-02-25  Gavin Smith <gavinsmith0123@gmail.com>

	Reset parsetexi counters

	* tp/Texinfo/XS/parsetexi/counter.c (counter_reset): New function.
	* tp/Texinfo/XS/parsetexi/macro.c: Call it on 'count_toplevel_braces'.

2024-02-25  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Document.pm
	(sorted_indices_by_letter, sorted_indices_by_index):
	Remove "registrar" argument.

2024-02-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/build_html_perl_state.c,
	tp/Texinfo/XS/main/build_perl_info.c (build_tree_to_build),
	tp/Texinfo/XS/main/call_perl_function.c
	(call_latex_convert_to_latex_math),
	tp/Texinfo/XS/convert/convert_html.c (convert_to_html_internal): move
	build_tree_to_build to build_perl_info.c.  Use it in
	call_latex_convert_to_latex_math to rebuild the tree if needed.
	Prepare in convert_to_html_internal.

	Add const.

2024-02-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Utils.pm (find_innermost_accent_contents),
	tp/Texinfo/XS/main/convert_utils.c (find_innermost_accent_contents):
	take everything and do not nest if current accent command is
	tieaccent.

	* tp/Texinfo/XS/convert/convert_html.c (css_string_accent): call
	text_init early and once.  Fixes in tieaccent code.

	* tp/Makefile.tres, tp/t/html_tests.t (itemize_tieaccent): add test of
	tieaccent in itemize argument.

2024-02-25  Patrice Dumas  <pertusus@free.fr>

	Add const.

2024-02-25  Gavin Smith <gavinsmith0123@gmail.com>

	Remove separate error registrar arguments

	* tp/Texinfo/Document.pm, tp/Texinfo/XS/main/DocumentXS.xs
	(indices_sort_strings):
	* tp/Texinfo/Structuring.pm,
	tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs
	(check_nodes_are_referenced, set_menus_node_directions)
	(complete_node_tree_with_menus, nodes_tree):
	Remove separate Texinfo::Report 'registrar' arguments, and access
	errors through 'registrar' key on Texinfo::Document arguments.

2024-02-25  Gavin Smith <gavinsmith0123@gmail.com>

	Remove separate error registrar argument

	* tp/Texinfo/Structuring.pm (warn_non_empty_parts),
	* tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs,
	(warn_non_empty_parts):
	Remove separate Texinfo::Report 'registrar' argument, and access
	errors through 'registrar' key on Texinfo::Document argument.

2024-02-25  Gavin Smith <gavinsmith0123@gmail.com>

	Remove separate error registrar argument

	* tp/Texinfo/Structuring.pm (associate_internal_references),
	* tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs
	(associate_internal_references):
	Remove separate Texinfo::Report 'registrar' argument, and access
	errors through 'registrar' key on Texinfo::Document argument.

2024-02-25  Gavin Smith <gavinsmith0123@gmail.com>

	Remove separate error registrar argument

	* tp/Texinfo/Transformations.pm
	(insert_nodes_for_sectioning_commands, _new_node),
	* tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs
	(insert_nodes_for_sectioning_commands),
	* tp/Texinfo/Document.pm (_existing_label_error)
	(_add_element_to_identifiers_target, register_label_element):
	Remove "registrar" argument and access errors through 'registrar'
	key on Texinfo::Document argument.

2024-02-24  Patrice Dumas  <pertusus@free.fr>

	Add const.  Replace some int by size_t.

2024-02-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/manipulate_tree.c (add_source_mark): correct used
	sizeof.  Allocate space one by one as more than one source mark in
	list is uncommon.

2024-02-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (set_file_source_info)
	(html_destroy_files_source_info, html_set_pages_files),
	tp/Texinfo/XS/main/utils.h (FILE_SOURCE_INFO): free filepath coming
	from user-defined file_id_setting unit_file_name function.
	Copy filepath in FILE_SOURCE_INFO.

2024-02-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files),
	tp/t/init/set_unit_file_name_filepath.pm, tp/Makefile.tres,
	tp/t/html_tests.t (set_unit_file_name_filepath): add test of
	unit_file_name user-defined file setting filepath.

2024-02-24  Patrice Dumas  <pertusus@free.fr>

	Add const.

2024-02-24  Gavin Smith <gavinsmith0123@gmail.com>

	Reference Texinfo::Report in Texinfo::Document object.

	* tp/Texinfo/Document.pm (register): Take an extra argument, a
	Texinfo::Report reference, and keep it in the 'registrar' value.
	* tp/Texinfo/XS/parsetexi/Parsetexi.pm: (_get_parser_info):
	Save reference to Texinfo::Document object in 'registrar' .
	* tp/Texinfo/ParserNonXS.pm (_parse_texi): Update call to "register".
	* tp/Texinfo/XS/main/build_perl_info.c (rebuild_document):
	Do not clear 'registrar' key on hash.

	* tp/Texinfo/Document.pm (errors):
	New function.  Return errors, including any errors in
	the 'errors' array.  Wipe 'errors' array after adding the errors
	to the Texinfo::Report object to allow calling multiple times.
	* tp/Texinfo/XS/parsetexi/Parsetexi.pm: (_get_parser_info):
	Wipe 'errors' array after propagating to Texinfo::Report.

	* tp/texi2any.pl (handle_document_errors, handle_errors)
	(_handle_errors): Add new function handle_document_errors to
	get errors from Texinfo::Document.
	* tp/t/test_parser_registrar.t,
	* tp/t/test_utils.pl: Call Texinfo::Document::errors instead
	of Texinfo::Report::errors.

	* tp/texi2any.pl, tp/t/test_utils.pl [XS structuring]:
	Eliminate loop copying errors with
	Texinfo::Report::add_formatted_message, as this is dealt with in
	Texinfo::Document::errors instead.

2024-02-24  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XSLoader.pm (init): Remove $warning_message and
	$fatal_message arguments.

2024-02-24  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Parser.pm: Always call Texinfo::XSLoader::init with
	"Texinfo::Parser" as the first argument.  This is needed to call
	the import function loaded from Texinfo/ParserNonXS.pm.  Undef
	the "Parsetexi" argument if TEXINFO_XS_PARSER is 0.
	* tp/Texinfo/XSLoader.pm (init): Check if argument giving the name
	of the Libtool file is undefined.

	Running with TEXINFO_XS_PARSER=0 was broken.

2024-02-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/input.c (input_push_text): call strdup in
	input_push_text for the value_flag instead of having it called by the
	caller.  Make value_flag const.

	* tp/Texinfo/XS/parsetexi/input.c (input_push_file): add const.

2024-02-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/input.c (input_push_file): use save_string
	if needed on input filename to store the path in input_file_path.

2024-02-24  Patrice Dumas  <pertusus@free.fr>

	Add const.

2024-02-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/extra.c (add_extra_contents): replace the input
	list argument by no_lookup.  If not set, first check that the array
	does not exist before creating it.  Update callers.

2024-02-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/extra.c (add_extra_directions): check if the
	extra directions already exist and create them only if they do not
	exist.  Update callers.

2024-02-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/extra.c (add_extra_directions): remove input
	element list argument, it is never set.  Update callers.

2024-02-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree.c: remove now unused
	element_set_empty_contents.

2024-02-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (build_additional_info),
	tp/Texinfo/XS/main/extra.c (add_extra_directions)
	(lookup_extra_directions), tp/Texinfo/XS/main/manipulate_tree.c
	(copy_associated_info, associate_info_references),
	tp/Texinfo/XS/main/tree.c (destroy_associated_info)
	(list_set_empty_contents): use ELEMENT_LIST for extra_directions.
	Update callers.

2024-02-23  Patrice Dumas  <pertusus@free.fr>

	Add const.

2024-02-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/extra.c (add_extra_contents)
	(lookup_extra_contents): remove create argument of
	lookup_extra_contents.  If value is 0, create a list in
	add_extra_contents.  Return the list from add_extra_contents.
	Update callers.

	* tp/Texinfo/XS/main/extra.c (add_extra_directions)
	(lookup_extra_directions, lookup_extra_element): remove create
	argument of lookup_extra_directions.  If value is 0, create an
	element in add_extra_directions.  Do not accept extra_directions as a
	possible type for lookup_extra_element.  Update callers and replace
	calls to lookup_extra_element for directions by calls to
	lookup_extra_directions.

2024-02-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/call_html_perl_function.c: replace G_ARRAY by
	G_LIST and use ppport.h which should provide compatibility.  ppport.h
	do not proposes to include ppport.h, but it is likely that it is
	needed.

	* README-hacking: only propose to check the changes proposed by
	ppport.h, as it may be wrong.

2024-02-23  Patrice Dumas  <pertusus@free.fr>

	Remove/add ppport.h includes based on perl ppport.h output

	* README-hacking: add instructions on calling ppport.h.

2024-02-23  Patrice Dumas  <pertusus@free.fr>

	update ppport.h

	* README-hacking: add instructions on updating tp/Texinfo/XS/ppport.h.

2024-02-23  Patrice Dumas  <pertusus@free.fr>

	remove duplicate ppport.h file

2024-02-23  Gavin Smith <gavinsmith0123@gmail.com>

	Stop calling hv_fetch with null argument

	* tp/texi2any.pl: Avoid calling Texinfo::Document::remove_document
	with undef argument.

	* tp/Texinfo/XS/main/get_perl_info.c (get_document_or_warn):
	Check if hash obtained from argument is null.

	This is the case in test_scripts/formatting_info_extension_warning.sh.

2024-02-23  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/t/test_parse_texi_line.t: invert order of Test::More::is test
	to put expected result second, not first.

2024-02-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/manipulate_indices.c: add const.

	Remove TODOs.

2024-02-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/manipulate_indices.c
	(INDEX_COLLATOR, setup_collator, destroy_indices_sortable_entries):
	remove INDEX_COLLATOR language field.

2024-02-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/errors.c  (message_list_document_error)
	(message_list_document_warn): add continuation argument.  Update
	callers.

2024-02-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(prepare_index_entries_targets): remove test of index having entries
	as indices in sorted_index_names always have entries.

2024-02-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_get_shared_conversion_state): check if index_nr is not 0.

	* tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/convert/get_html_perl_info.c,
	tp/Texinfo/XS/main/converter_types.h (SORTED_INDEX_NAMES),
	tp/Texinfo/XS/main/get_perl_info.c: add static and const.

2024-02-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/node_name_normalization.c
	(convert_to_normalized_internal): change order of condition in if,
	change comments.

2024-02-23  Patrice Dumas  <pertusus@free.fr>

	* /tp/Texinfo/XS/convert/convert_html.c
	(prepare_index_entries_targets, html_initialize_output_state),
	tp/Texinfo/XS/main/converter_types.h (SORTED_INDEX_NAMES),
	tp/Texinfo/XS/main/get_perl_info.c
	(find_sorted_index_names_index_entry_extra_index_entry_sv),
	tp/Texinfo/XS/main/utils.c (index_number_index_by_name): keep only
	indices with entries in sorted_index_names.  Have SORTED_INDEX_NAMES
	hold a list of INDEX pointers.  Remove INDEX_NUMBER.

2024-02-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/unicode.c (string_from_utf8): cast to char *
	before using strdup.

	* tp/Texinfo/XS/main/unicode.c (utf8_from_string, string_from_utf8):
	change comment to avoid compiler warning.

2024-02-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/targets.c (existing_label_error)
	(register_label_element),
	tp/Texinfo/XS/structuring_transfo/transformations.c (new_node)
	(insert_nodes_for_sectioning_commands): use message_list_* functions
	in existing_label_error.  Pass error_messages to existing_label_error
	through new_node and register_label_element.

2024-02-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_texi), tp/Texinfo/Translations.pm
	(complete_indices), tp/Texinfo/XS/parsetexi/indices.c
	(complete_indices), tp/Texinfo/XS/parsetexi/parser.c (parse_texi):
	pass debug_level as complete_indices argument.  Set debug_level in C
	for complete_indices based on debug_output.

2024-02-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/translations.c (gdt, gdt_tree, pgdt_tree)
	(gdt_string), tp/Texinfo/XS/main/DocumentXS.xs (gdt): remove options
	argument, pass debug_level as argument.  Update callers.

2024-02-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Translations.pm (gdt, gdt_string): pass debug_level
	as an argument, change argument order, use customization_information
	as translate_string_method first argument only.  Update callers.

2024-02-22  Patrice Dumas  <pertusus@free.fr>

	Update po files.

2024-02-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_line_command_args): use the same
	messages as in C for definfoenclose related messages.

2024-02-22  Patrice Dumas  <pertusus@free.fr>

	Update po files.

2024-02-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Utils.pm (@month_name): use Texinfo::Common::gdt
	to mark strings at the same time as filling @month_name.

	Update/change/remove some FIXME.

2024-02-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Utils.pm (expand_today): use cdt with converter.

2024-02-22  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: Update which gnulib modules now depend on gperf.

2024-02-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (set_output_units_files),
	tp/Texinfo/Convert/Plaintext.pm (output): move output implementation
	out of Converter.pm to Plaintext.pm. Rename _set_output_units_files as
	set_output_units_files.

	* tp/Texinfo/Convert/Plaintext.pm (output): set
	$self->{'encoding_disabled'} if not outputting to a file, before any
	conversion is done.

	* tp/Texinfo/Convert/Plaintext.pm: move code around.

2024-02-21  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/pod2texi.pl (_fix_texinfo_tree)
	(_parsed_manual_tree): update Texinfo::Document::rebuild_document
	call.

2024-02-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (output), tp/Texinfo/Convert/HTML.pm
	(_internal_command_href, _html_get_tree_root_element)
	(_html_set_pages_files, _prepare_special_units, _html_convert_convert)
	(output_internal_links, _html_convert_output),
	tp/Texinfo/Convert/IXIN.pm, tp/Texinfo/Convert/Info.pm (output),
	tp/Texinfo/Convert/Plaintext.pm (convert),
	tp/Texinfo/XS/convert/convert_html.c  (html_get_tree_root_element)
	(prepare_special_units, html_internal_command_href)
	(html_set_pages_files, html_convert_convert, html_convert_output):
	remove all the codes that are never run as they correspond to
	no output unit since output units are always set if split_by_*
	have been called.

2024-02-20  Patrice Dumas  <pertusus@free.fr>

	Fix memory leaks found with valgrind

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line): free
	fullpath of verbatiminclude after adding to global_info included_files.

	* tp/Texinfo/XS/convert/convert_html.c (mini_toc_internal): set href
	after it is sure that the section is non empty and processed.

2024-02-20  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS:
	Run "gnulib --remove-import uniconv/u8-strconv-to-enc" and
	"gnulib --remove-import uniconv/u8-strconv-from-enc" and
	"gnulib --remove-import uniconv/u32-strconv-from-enc".

2024-02-20  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/main/unicode.c (utf8_from_string, string_from_utf8):
	Replace calls to u8_strconv_from_encoding and u8_strconv_to_encoding
	with call to strdup followed by cast.
	(format_eight_bit_accents_stack): Replace call to
	u8_strconv_from_encoding with call to utf8_from_string.

	This eliminates the requirement for gnulib uniconv modules, which
	indirectly required the iconv_open module.

2024-02-20  Gavin Smith  <gavinsmith0123@gmail.com>, and
            Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (convert):
	Set $self->{'encoding_disabled'} to 1 so that 'convert' will
	always return an unencoded character string.
	* tp/t/test_utils.pl (convert_to_plaintext, convert_to_info):
	Do not set OUTPUT_PERL_ENCODING to prevent encoding.
	* tp/Texinfo/Convert/Info.pm (output): Set
	$self->{'encoding_disabled'} if not outputting to a file, before
	any conversion is done.

2024-02-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm (rebuild_document),
	tp/Texinfo/XS/main/DocumentXS.xs (rebuild_document),
	tp/Texinfo/XS/main/build_perl_info.c (fill_document_hv)
	(build_document, rebuild_document): distinguish building document and
	rebuilding an existing HV.  Reuse the reference given as
	rebuild_document argument, do not return anything. Update callers of
	Texinfo::Document::rebuild_document.

	* tp/Texinfo/XS/main/build_perl_info.c (rebuild_output_units_list):
	add a debug message.

	* tp/Texinfo/XS/main/DocumentXS.xs (rebuild_tree): handle better
	no_store.

	* tp/Texinfo/XS/main/DocumentXS.xs: move code around.

2024-02-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (rebuild_output_units),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs
	(rebuild_output_units): reuse the input reference instead of creating
	a new one.  Do that by calling rebuild_output_units_list in XS.
	Do not return anything.  Update callers.

	* tp/Texinfo/XS/convert/build_html_perl_state.c: make a function
	static, add const.

	* tp/Texinfo/XS/main/build_perl_info.c: move code around.

	* tp/Texinfo/Convert/Info.pm (output): move code around.  Rename
	variables as output_unit*.

	* tp/Texinfo/XS/parsetexi/end_line.c (parse_line_command_args): remove
	a useless TODO.

2024-02-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c
	(fill_output_units_descriptor_av): inline fill_output_units in
	fill_output_units_descriptor_av.

2024-02-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c
	(fill_output_units_descriptor_av, build_output_units_list)
	(rebuild_output_units_list): add fill_output_units_descriptor_av with
	code common to build_output_units_list and rebuild_output_units_list.

2024-02-20  Patrice Dumas  <pertusus@free.fr>

	Wrapper for u8_strconv_to_encoding

	* tp/Texinfo/XS/main/unicode.c (string_from_utf8):
	Create wrapper for u8_strconv_from_encoding to do the reverse of
	utf8_from_string.  All callers of u8_strconv_from_encoding updated.
	Also replace some incorrect calls of utf8_from_string by
	string_from_utf8.

2024-02-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (output_unit_to_perl_hash)
	(fill_output_units, build_output_units_list)
	(rebuild_output_units_list): remove status, call fatal if an hv
	expected to be present is not there.

2024-02-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/languages.t
	(documentlanguage_generated_master_menu): add test of generated master
	menu with @documentlanguage set.

2024-02-19  Gavin Smith <gavinsmith0123@gmail.com>

	Wrapper for u8_strconv_from_encoding

	* tp/Texinfo/XS/main/unicode.c (utf8_from_string):
	Create wrapper for u8_strconv_from_encoding.  This simplifies
	the code that calls it as it is always called in the same way,
	with a "UTF-8" encoding specified, and allows potentially swapping
	out this implementation with e.g. a simple cast.  All callers of
	u8_strconv_from_encoding updated.

2024-02-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (sectioning_structure),
	tp/Texinfo/XS/structuring_transfo/structuring.c
	(sectioning_structure): start appendix numbering only if at the top
	level.

2024-02-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/10menu.t (part_appendix_in_generated_menu)
	(appendix_and_associated_part_in_generated_menu): add tests with
	part and appendices in generated top menu.

2024-02-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (new_complete_node_menu),
	tp/Texinfo/XS/structuring_transfo/structuring.c
	(new_complete_node_menu): use section to find associated part.

2024-02-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (_insert_menu_comment_content)
	(new_complete_node_menu, _print_down_menus),
	tp/Texinfo/Transformations.pm (complete_tree_nodes_menus),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs
	(complete_tree_nodes_missing_menu),
	tp/Texinfo/XS/structuring_transfo/structuring.c
	(insert_menu_comment_content, new_complete_node_menu)
	(print_down_menus),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(complete_tree_nodes_missing_menu): Add comment lines in generated
	main menus for the start of the appendices or @part's.  Add
	$customization_information argument for translations.  Add
	insert_menu_comment_content for the comment insertion based on
	_print_down_menus code.
	Update callers.

2024-02-18  Patrice Dumas  <pertusus@free.fr>

	Only allow highlighting commands to be redefined with @definfoenclose

	* tp/Texinfo/ParserNonXS.pm (_parse_line_command_args),
	tp/Texinfo/XS/parsetexi/end_line.c (parse_line_command_args):
	before redefining with definfoenclose, verify that the command is not
	a builtin command, or, if it is, that it is a brace command and a
	style* brace command.

	* tp/Makefile.tres, tp/t/03coverage_braces.t
	(definfoenclose_texinfo_commands): add tests of redefinition of
	builtin @-commands by @definfoenclose.

2024-02-18  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_stream_encode):
	Set $self->{'encoding_disabled'} if no encoding is taking place.
	This avoids attempting to initialise $self->{'encoding_object'}
	each time this runs.  Report from Patrice.

2024-02-18  Roland Clobus <rclobus@rclobus.nl> (tiny change)

	* install-info/install-info.c (compare_entries_text):
	If two strings compare identical, check which is longer.
	* install-info/tests/ii-0060-test: New test.

	This ensures reproducible results.
	See <https://reproducible-builds.org/>.

2024-02-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/errors.c (message_list_line_formatted_message):
	change a translation context string as in Perl.

	Update po files.

2024-02-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Report.pm (format_line_message): change a translation
	context string.

	* tp/Texinfo/Structuring.pm: set re => /a.

	Minor modifications of FIXME/TODO.

2024-02-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (url_protect_url_text)
	(url_protect_file_text), tp/Texinfo/XS/convert/convert_html.c
	(url_protect_url_text, url_protect_file_text): replace end of lines by
	spaces before percent encoding.

2024-02-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_heading_command),
	tp/init/book.pm (book_convert_heading_command): if USE_NODES = 0 and
	there are no sectioning commands, $output_unit->{'unit_command'} does
	not exist.

2024-02-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Report.pm (format_line_message, line_warn, line_error):
	add a bug message if error_location_info argument is undef.

2024-02-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm: modify/remove FIXMEs.

	* tp/Makefile.tres, tp/t/converters_tests.t (sections_and_printindex):
	focused test of printindex with sectioning commands and converters
	called through convert.

2024-02-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm, doc/texi2any_api.texi: remove/handle
	FIXMEs.

	* tp/Makefile.tres, tp/t/html_tests.t (menu_in_documentdescription):
	add a test of menu in documentdescription, which leads to menu being
	formatted in string context.

2024-02-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_heading_command),
	tp/Texinfo/XS/convert/convert_html.c (convert_heading_command): update
	the condition used to determine if the node is used for heading.

	* tp/init/book.pm (book_convert_heading_command): avoid doing a
	sub toc for @top only if CONTENTS_OUTPUT_LOCATION is after_title.

	* tp/init/book.pm (book_convert_heading_command): sync with HTML.pm.

2024-02-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_contents_inline_element),
	tp/Texinfo/XS/convert/convert_html.c (contents_inline_element):
	change element-*contents class name to region-*contents.  Not perfect,
	but better as element is better left for tree elements only.

2024-02-17  Patrice Dumas  <pertusus@free.fr>

	Add some const for *find_element_from_sv and similar functions.

2024-02-17  Patrice Dumas  <pertusus@free.fr>

	* main/utils.c (html_command_text_type_name): remove target.

2024-02-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_command_id): set return
	const.

	* tp/Texinfo/XS/convert/ConvertXS.xs: set const for elements returned
	by element_converter_from_sv.

2024-02-17  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Element Direction Information Type),
	tp/Texinfo/Convert/HTML.pm (%valid_direction_return_type)
	(from_element_direction), tp/Texinfo/XS/convert/convert_html.c
	(from_element_direction), tp/Texinfo/XS/main/converter_types.h (enum
	html_text_type): remove the target direction information type of
	from_element_direction, it is not used anymore and it is in general
	better to get the href.

2024-02-17  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Dynamic Converter Formatting Information),
	tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides)
	(current_output_unit), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_current_output_unit), tp/Texinfo/XS/convert/convert_html.c
	(convert_output_unit), tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_formatting_state): add a function accessor for
	convert_output_unit.  Add an XS override for the.  Do not pass
	current_output_unit through build_html_formatting_state anymore, the
	accessor function should be always be used instead.

	* tp/Texinfo/Convert/HTML.pm (_convert_printindex_command),
	tp/Texinfo/XS/convert/convert_html (convert_printindex_command):
	instead of calling from_element_direction('This', 'target'), call
	directly command_id on current_output_unit unit_command.

2024-02-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_contents_inline_element),
	tp/Texinfo/XS/convert/convert_html.c (contents_inline_element):
	remove code that was different before when called as convert, but
	should be the same now.

	* tp/Texinfo/XS/convert/convert_html.c: add const for command_id
	return variables when possible.

2024-02-17  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Texinfo Tree Conversion Functions),
	tp/Texinfo/Convert/HTML.pm (convert_tree_new_formatting_context),
	tp/Texinfo/XS/convert/convert_html.c
	(convert_tree_new_formatting_context): make context string a mandatory
	argument.

	Reindent.

2024-02-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_default_format_special_body_about):
	reindent.

2024-02-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (direction_string),
	tp/Texinfo/XS/convert/convert_html.c (direction_string): do not
	access untranslated direction strings types for translated
	translations strings.

	* tp/Texinfo/Convert/HTML.pm (%default_converted_directions_strings):
	keep one empty direction string undef.

	* tp/Texinfo/Convert/HTML.pm (_default_panel_button_dynamic_direction)
	(_default_format_button, _default_format_special_body_about)
	(conversion_initialization), tp/Texinfo/XS/convert/convert_html.c
	(default_panel_button_dynamic_direction_internal)
	(html_default_format_button, default_format_special_body_about),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_conversion_initialization_sv): handle undef direction strings.

	* tp/Makefile.am (test_files), tp/Makefile.tres,
	tp/t/init_files_tests.t ($direction_strings_test_text)
	(directions_string_base, direction_strings_test_text)
	(directions_string_undef_texi2html),
	tp/t/init/directions_string_undef.pm: test directions strings undef.

2024-02-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%format_context_commands),
	tp/Texinfo/XS/convert/convert_html.c (html_format_init): do not set
	raw format block commands as format_context_command, it is not needed
	as they only contain raw text.

	* tp/Texinfo/Convert/HTML.pm (_file_header_information): do not output
	mathjax script if there was no math in the page.

	Changes in comments and indentation.

2024-02-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%default_shared_conversion_states)
	(_convert_listoffloats_command), tp/Texinfo/XS/convert/convert_html.c
	(convert_listoffloats_command, html_initialize_output_state)
	(html_reset_converter), tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_set_shared_conversion_state, html_get_shared_conversion_state),
	tp/Texinfo/XS/main/converter_types.h (HTML_SHARED_CONVERSION_STATE),
	doc/texi2any_api.texi (Shared Conversion State in Defaut Formatting):
	add listoffloats formatted_listoffloats shared state to record the
	number of time a listoffloat type was converted.

2024-02-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (html_convert_css_string),
	tp/Texinfo/XS/convert/convert_html.c (html_convert_css_string): make
	third argument mandatory and consider it to be a context string.
	Update html_convert_css_string in C to lead to the same context and
	explanation strings as in Perl.

2024-02-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_current_filename): handle
	non-ASCII filenames.

	* tp/Texinfo/Convert/HTML.pm (command_text, _file_header_information),
	tp/Texinfo/XS/convert/convert_html.c (html_command_text)
	(file_header_information): make sure that there is a non empty context
	string in the convert_tree_new_formatting_context call even if there
	is no command name.

	* tp/Texinfo/XS/main/utils.h: rename HMSF_converter_state as
	HMSF_ignore_notice.  Update users.

	* tp/Texinfo/XS/convert/convert_html.c
	(convert_tree_new_formatting_context): use xasprintf and char * for
	context_string_str instead of TEXT.

	* tp/Texinfo/Convert/HTML.pm: reindent
	convert_tree_new_formatting_context calls to view more easily how many
	arguments there are and their values.

2024-02-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides): add missed
	override for footnote_location_href.

	* tp/Texinfo/Convert/HTML.pm (from_element_direction): use the
	current_filename function.

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_formatting_state): do not pass current_filename anymore,
	it is not needed, the current_filename function should be used instead.

	* tp/Texinfo/Common.pm (debug_print_element): remove useless end of
	lines.

2024-02-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (current_filename): set $self.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_current_filename): add XS
	override for current_filename.

2024-02-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (current_filename)
	(%available_converter_info): add a specific accessor to get the
	current_filename.  Remove from %available_converter_info.  Update
	callers of get_info('current_filename').

	* doc/texi2any_api.texi: update.

2024-02-15  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi: update.

2024-02-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/manipulate_indices.c (get_sort_key)
	(setup_sortable_index_entries): do not uppercase sort strings in
	get_sort_key, as it is not right to do so for letters that are already
	uppercased.  Instead uppercase sort string in
	setup_sortable_index_entries before calling get_sort_key.

	* tp/t/09indices.t ($encoding_index_text): add @ordf{} and @ordm{},
	which are interesting to test as their uppercase representation is a
	lowercase letter.

	* tp/Texinfo/XS/main/manipulate_indices.c (print_bytes): add to help
	debugging.

	* tp/Texinfo/Indices.pm (sort_indices_by_letter): rename $entry_key as
	$sort_string.

2024-02-14  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: minor tweaks

2024-02-14  Gavin Smith <gavinsmith0123@gmail.com>

	Document DOCUMENTLANGUAGE_COLLATION.

	* doc/texinfo.texi (Other Customization Variables):
	Document DOCUMENTLANGUAGE_COLLATION.
	(@documentlanguage): Reference DOCUMENTLANGUAGE_COLLATION.

2024-02-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/manipulate_indices.c (setup_collator): warn if
	the collation_locale is not found.

2024-02-14  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/other/index_collation_test.texi: modify test file to have
	the difference between strxfrm_l and Perl Unicode::Collate used in
	texi2any with Non-ignorable variable weighting show up in test
	output.

	* tp/tests/Makefile.onetst, tp/tests/other/list-of-tests
	(index_collation_test_collation_locale_en_US): test with
	XS_STRXFRM_COLLATION_LOCALE='en_US.utf-8' to find the collating
	locale on my Debian testing.

2024-02-14  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/run_parser_all.sh (check_strxfrm_ok): skip test if
	TEXINFO_XS_CONVERT is not set or 0 and XS_STRXFRM_COLLATION_LOCALE
	is set.
	Change in spacing.

2024-02-14  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Conversion General Information),
	tp/Texinfo/Convert/HTML.pm (%available_converter_info, get_info)
	(_convert_printindex_command, output_internal_links): remove
	'index_entries_by_letter' from converter info, call directly
	get_converter_indices_sorted_by_letter instead, such that the current
	value of @documentlanguage can be used if it is used for tailoring
	the collation of indices.

2024-02-14  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_sort.t: call Texinfo::Document::indices_sort_strings
	instead of Texinfo::Indices::setup_index_entries_sort_strings for
	one of the two tests to this interface too.

2024-02-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm (sorted_indices_by_letter)
	(sorted_indices_by_index), tp/Texinfo/XS/main/document.c
	(sorted_indices_by_letter, sorted_indices_by_index): set the document
	argument to be the first argument.  Update callers.

	* tp/Texinfo/Indices.pm (_setup_sortable_index_entries): rename
	setup_sortable_index_entries as _setup_sortable_index_entries.

	* tp/Texinfo/XS/main/manipulate_indices.c: make internal functions
	static.

	Update POD documentation.

2024-02-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Indices.pm (_setup_sort_sortable_strings_collator)
	(sort_indices_by_index, sort_indices_by_letter),
	tp/Texinfo/XS/main/manipulate_indices.c
	(setup_sort_sortable_strings_collator, sort_indices_by_index)
	(sort_indices_by_letter): require a document argument.  Remove
	merged_index_entries and indices_information arguments, put document
	as first argument.  Update callers.

2024-02-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c
	(new_collation_sorted_indices_by_index)
	(find_collation_sorted_indices_by_index, sorted_indices_by_index)
	(destroy_document_information_except_tree),
	tp/Texinfo/XS/main/document_types.h (INDEX_SORTED_BY_INDEX)
	(COLLATION_INDICES_SORTED_BY_INDEX, COLLATIONS_INDICES_SORTED_BY_INDEX)
	(DOCUMENT), tp/Texinfo/XS/main/manipulate_indices.c
	(destroy_indices_sorted_by_index, compare_sortable_index_entry)
	(sort_indices_by_index): implement index sorting by index.  Separate
	compare_sortable_index_entry and functions called from qsort,
	compare_sortable_index_entry_refs and
	compare_sortable_index_entry_wrapper.

	* tp/Texinfo/XS/main/document.c
	(new_collation_sorted_indices_by_letter)
	(find_collation_sorted_indices_by_letter):
	Rename new_collation_sorted_indices and find_collation_sorted_indices
	to avoid ambiguity.

	* tp/Texinfo/Convert/Converter.pm (%XS_overrides),
	tp/Texinfo/XS/convert/ConvertXS.xs
	(get_converter_indices_sorted_by_index),
	tp/Texinfo/XS/convert/converter.c
	(get_converter_indices_sorted_by_index),
	tp/Texinfo/XS/main/build_perl_info.c (build_sorted_indices_by_index):
	XS interface for sorted_indices_by_index through
	get_converter_indices_sorted_by_index.

2024-02-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_reset_converter),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): no sorted index
	entries in converter anymore, they are in document.

2024-02-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (%XS_overrides)
	(get_converter_indices_sorted_by_letter),
	tp/Texinfo/XS/convert/ConvertXS.xs
	(get_converter_indices_sorted_by_letter),
	tp/Texinfo/XS/main/build_perl_info.c (build_sorted_indices_by_letter):
	override directly get_converter_indices_sorted_by_letter, find indices
	information in XS through perl hashes.  Remove
	_XS_get_converter_indices_sorted_by_letter.  Have
	build_sorted_indices_by_letter use HV in argument and return HV
	instead of SV.

2024-02-13  Patrice Dumas  <pertusus@free.fr>

	Use DOCUMENTLANGUAGE_COLLATION.

	* NEWS: update.

	* tp/Texinfo/Convert/Converter.pm
	(get_converter_indices_sorted_by_letter)
	(get_converter_indices_sorted_by_index),
	tp/Texinfo/XS/convert/converter.c
	(get_converter_indices_sorted_by_letter): add
	get_converter_indices_sorted_by_index.  Handle
	DOCUMENTLANGUAGE_COLLATION.  Return undef if there is no document or
	no index information.

	* tp/Texinfo/Convert/IXIN.pm, tp/Texinfo/Convert/Plaintext.pm
	(process_printindex), tp/init/chm.pm (chm_init): use
	get_converter_indices_sorted_by_index.

2024-02-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/manipulate_indices.c (get_sort_key): use upper
	cased sort string to obtain the sort key for all the collation types.

2024-02-13  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): pass USE_UNICODE_COLLATION option.

	* tp/t/09indices.t (encoding_index_utf8_no_use_unicode),
	tp/Makefile.tres: add test of USE_UNICODE_COLLATION set to 0.

	* tp/tests/Makefile.onetst, tp/tests/other/Makefile.am (EXTRA_DIST),
	tp/tests/other/index_collation_test.texi,
	tp/tests/other/list-of-tests: add index_collation_test_plaintext,
	index_collation_test_collation_language,
	index_collation_test_collation_locale_en,
	index_collation_test_collation_locale_sv and
	index_collation_test_documentlanguage_collation to test all the cases
	of collation customization.

2024-02-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/manipulate_indices.c: remove TODO, replace FIXME
	by TODO.

2024-02-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm (indices_sort_strings),
	tp/Texinfo/XS/main/DocumentXS.xs (indices_sort_strings),
	tp/Texinfo/XS/main/document.c (document_indices_sort_strings): change
	arguments order, to have document first.  Update callers.

	* tp/Texinfo/XS/main/call_perl_function.c: remove
	get_call_index_entries_sorted_by_letter, which is not used anymore.

2024-02-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/options_data.txt (DOCUMENTLANGUAGE_COLLATION)
	(XS_STRXFRM_COLLATION_LOCALE): add customization variables.

	* tp/Texinfo/XS/main/call_perl_function.c (call_setup_collator)
	(call_collator_getSortKey), tp/Texinfo/XS/main/document_types.h
	(BYTES_STRING, enum collation_type_name),
	tp/Texinfo/XS/main/manipulate_indices.c (INDEX_COLLATOR, get_sort_key)
	(setup_collator, compare_byte_strings, compare_index_letter)
	(compare_sortable_subentry_keys),
	tp/Texinfo/XS/main/manipulate_indices.h (SORTABLE_INDEX_SUBENTRY):
	add an enum for the types of collations, and a structure for a
	collator.  Add the possibility to call perl code to get a collator
	object and get Perl sort keys as a possibility for collation sort
	strings.  Use bytes strings with length through the BYTES_STRING
	structure, to be able to use strings with NUL within as collation
	string keys.  This is needed for collation keys coming from Perl and a
	logical structure in C for collation binary strings.  Use memcmp to
	compare.

	* tp/Texinfo/XS/main/document.c (document_indices_sort_strings)
	(destroy_document_information_except_tree),
	tp/Texinfo/XS/main/document_types.h (INDEX_SUBENTRY_SORT_STRING)
	(INDEX_ENTRY_SORT_STRING, INDEX_SORT_STRINGS, INDICES_SORT_STRINGS)
	(DOCUMENT), tp/Texinfo/XS/main/manipulate_indices.c
	(destroy_index_entries_sort_strings),
	tp/Texinfo/XS/main/manipulate_indices.c
	(setup_index_entries_sort_strings, setup_sortable_index_entries)
	(setup_sort_sortable_strings_collator, sort_indices_by_letter): add
	setup_index_entries_sort_strings based on setup_sortable_index_entries
	code and add setup_sort_sortable_strings_collator, as in Perl.  Add
	document_indices_sort_strings.

	* tp/Texinfo/XS/main/manipulate_indices.c
	(destroy_indices_sortable_entries): add.

	* tp/Texinfo/XS/main/document.c (new_collation_sorted_indices)
	(find_collation_sorted_indices, sorted_indices_by_letter)
	(destroy_document_information_except_tree),
	tp/Texinfo/XS/main/document_types.h
	(COLLATION_INDICES_SORTED_BY_LETTER)
	(COLLATIONS_INDICES_SORTED_BY_LETTER): add sorted_indices_by_letter
	as in Perl.

	* tp/Texinfo/XS/convert/converter.c
	(get_converter_indices_sorted_by_letter): call document
	sorted_indices_by_letter. Remove converter_sort_indices_by_letter.

	* tp/Texinfo/Convert/Converter.pm
	(get_converter_indices_sorted_by_letter),
	tp/Texinfo/XS/convert/ConvertXS.xs
	(get_converter_indices_sorted_by_letter): return index sorted by
	letter instead of caching it in the converter, it is already cached in
	the document.

	* tp/Texinfo/Document.pm (%XS_structure_overrides),
	tp/Texinfo/XS/main/DocumentXS.xs (indices_sort_strings),
	tp/Texinfo/XS/main/build_perl_info.c (build_document)
	(find_idx_name_entry_number_sv, build_indices_sort_strings)
	(build_sorted_indices_by_letter): add XS interface for
	indices_sort_strings and sorted_indices_by_letter.

	* tp/t/test_utils.pl (test), tp/texi2any.pl: call indices_sort_strings
	early such that error messages from XS can be collected.

2024-02-11  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Other Customization Variables)
	<COLLATION_LANGUAGE>: Minor edits for grammar and style.
	<USE_UNICODE_COLLATION>: Do not say that "Perl's built-in"
	comparison is used if this variable is set to 0, because it may
	in fact be strcmp in C that is used in XS code.

2024-02-11  Gavin Smith <gavinsmith0123@gmail.com>

	* Makefile.am (grand-replace): Add target to run grand-replace.sh
	script.
	* README-hacking: update

2024-02-11  Gavin Smith <gavinsmith0123@gmail.com>

	* info/nodes.c (adjust_nodestart): Increase the "fudge size"
	the later in the file the node is supposed to start.

2024-02-11  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: mention COLLATION_LANGUAGE

2024-02-11  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Printing Japanese and Chinese): Document
	the heretofore undocumented texinfo-ja.tex and texinfo-zh.tex files.

2024-02-11  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Print with lpr): Remove node, as some of
	the information may be outdated and we don't need to maintain
	information on how a user may print a dvi or pdf file.

2024-02-11  Gavin Smith <gavinsmith0123@gmail.com>

	* info/variables.c (set_variable_to_value): Reorder code
	slightly.  No functional change.

2024-02-11  Gavin Smith <gavinsmith0123@gmail.com>

	Avoid "M-x set-variable RET highlight-searches" inconsistency

	* info/variables.c (set_variable_to_value, update_highlight_searches):
	Split out code updating match_rendition.  Do not do anything if
	it is already set to a non-zero value.  This avoids an inconsistency
	with M-x set-variable, where selecting the default value "On" by
	just pressing Return did nothing, while typing in "On" and
	pressing Return would switch to using the "standout" style.

2024-02-11  Gavin Smith <gavinsmith0123@gmail.com>

	* info/variables.c (set_variable): Split out code getting the
	default value of a variable so it is easier to read, not using
	the ternary conditional operator.  No functional change.

2024-02-11  Gavin Smith <gavinsmith0123@gmail.com>

	Avoid crash from undefined style.

	* info/variables.c (set_variable_to_value)
	(update_rendition_from_string): Split code dealing with
	rendition variables into a new function.  Null terminate an
	array to avoid crash from undefined style.

	Report from Francesco Turco <fturco@posteo.net> and fix
	from Andreas Schwab <schwab@linux-m68k.org>.

2024-02-09  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\unmacro): Allow calling with undefined
	macro, matching texi2any and the long-standing documentation.
	Report from Werner Lemberg.
	* NEWS: mention

2024-02-09  Gavin Smith <gavinsmith0123@gmail.com>

	Fix unnumbered sections in PDF outline.

	* doc/texinfo.tex (\unnumbered, \unnumberedsec, \unnumberedsubsec)
	(\unnumberedsubsubsec): Only increment \unnumberedno, not \secno,
	\subsecno or \subsubsecno.  Only place \unnumberedno in the auxiliary
	.toc file.  There was a bug where the section identifier might
	not be unique due to \unnumberedno only being incremented for the
	top-level @unnumbered command, not for any of the lower levels.
	For example, if two @chapter's had an @unnumberedsec in position
	8 in the chapter, the identifier 10001.8 would occur twice.  PDF
	readers such as evince had trouble making sense of the ensuing
	PDF "outline".

	Report from Arnold Robbins.

2024-02-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Indices.pm (format_index_entries_sort_strings)
	(setup_sortable_index_entries, _setup_sort_sortable_strings_collator)
	(sort_indices_by_index, sort_indices_by_letter), tp/t/test_sort.t,
	tp/t/test_utils.pl (test): add format_index_entries_sort_strings
	to obtain $index_entries_sort_strings from output of
	setup_index_entries_sort_strings.  Do not output
	$index_entries_sort_strings in setup_sortable_index_entries,
	_setup_sort_sortable_strings_collator, sort_indices_by_index and
	sort_indices_by_letter.  Update callers.

2024-02-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm (indices_sort_strings), tp/Texinfo/Indices.pm
	(setup_index_entries_sort_strings)
	(_setup_sort_sortable_strings_collator, sort_indices_by_index)
	(sort_indices_by_letter): add indices_sort_strings in Document.pm
	and cache setup_index_entries_sort_strings result in this function.
	Add _setup_sort_sortable_strings_collator for code common to
	sort_indices_by_index and sort_indices_by_letter.

2024-02-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Indices.pm (setup_index_entries_sort_strings)
	(setup_sortable_index_entries, sort_indices_by_index)
	(sort_indices_by_letter): split setup_index_entries_sort_strings out
	of setup_sortable_index_entries, to setup sort strings.
	setup_sortable_index_entries takes now sort strings structure in
	argument and use a collator to setup the same structure as before.
	Remove _index_entry_element_sort_string_key.
	setup_index_entries_sort_strings store sort strings structure in the
	document if passed as argument.  Update most callers to pass a
	document.

2024-02-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm (sorted_indices_by_letter)
	(sorted_indices_by_index), tp/init/chm.pm,
	tp/Texinfo/Convert/Plaintext.pm (process_printindex),
	tp/Texinfo/Convert/Converter.pm
	(get_converter_indices_sorted_by_letter), tp/Texinfo/Convert/IXIN.pm:
	add Texinfo::Document sorted_indices_by_letter and
	sorted_indices_by_index that call the corresponding methods in
	Texinfo::Indices and cache the result in a document, distinguishing
	unicode collation or not and collation locale/language if given.
	Call those methods in converters.

2024-02-08  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: update instructions on updating copyright
	years.

2024-02-08  Gavin Smith <gavinsmith0123@gmail.com>

	Copyright years updating script

	* grand-replace.sh: Ignore tp/t/include to avoid clobbering
	tp/t/include/include_noeol.texi.

2024-02-08  Gavin Smith <gavinsmith0123@gmail.com>

	Copyright years updating script

	* grand-replace.sh: Add script.  Name and idea of script comes from
	GNU Lilypond.

2024-02-08  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: Advertise gperf dependency.

2024-02-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Indices.pm (sort_indices_by_index)
	(sort_indices_by_letter): get $use_unicode_collation and $locale_lang
	information from the caller.  Update callers.

2024-02-05  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_sort.t: no need to register the configuration in XS
	document as it is the default configuration.

2024-02-05  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/setup_converters_code_tables.pl: fix package of
	text_brace_no_arg_commands.

	* tp/t/test_sort.t: no need to setup encoding anymore for index
	entries sorting.

	* tp/Texinfo/Indices.pm (setup_sortable_index_entries): move code.

2024-02-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Indices.pm (_setup_collator)
	(setup_sortable_index_entries, sort_indices_by_index)
	(sort_indices_by_letter): add _setup_collator to setup a collator,
	call it in sort_indices_by_* before calling
	setup_sortable_index_entries and pass it to
	setup_sortable_index_entries instead of getting it from
	setup_sortable_index_entries.

	* tp/Texinfo/Indices.pm: remove Texinfo::CollateStub cmp, it is not
	used anymore.

2024-02-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Indices.pm (sort_indices_by_letter): setup a sort string
	for letters sorting.  Do not sort explicitly symbols before letters.
	Remove _collator_sort_string.

2024-02-05  Patrice Dumas  <pertusus@free.fr>

	* Texinfo/Indices.pm (_index_entry_element_sort_string_key)
	(setup_sortable_index_entries, sort_indices_by_index)
	(sort_indices_by_letter): always use a collator to sort index enties.
	Remove now unused _collator_sort_key and _collator_sort_index_entries.

2024-02-04  Patrice Dumas  <pertusus@free.fr>

	Add COLLATION_LANGUAGE for linguistic tailoring of indices sorting

	* tp/Texinfo/options_data.txt (COLLATION_LANGUAGE),
	tp/Texinfo/Indices.pm (setup_sortable_index_entries), doc/texinfo.texi
	(Other Customization Variables): add COLLATION_LANGUAGE to set
	linguistic tailoring for index sorting.  Not set in the default case.
	Requires Unicode::Collate::Locale to be effective.
	For a discussion about this customization option, see bug-texinfo, 4
	Feb 2024.

2024-02-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (%text_brace_no_arg_commands),
	tp/Texinfo/Convert/NodeNameNormalization.pm,
	tp/Texinfo/Convert/Text.pm: move %text_brace_no_arg_commands to
	Texinfo/Common.pm to avoid a dependency of NodeNameNormalization.pm on
	Text.pm as it leads to a circular dependency as Text.pm depends
	indirectly on NodeNameNormalization.pm.

2024-02-04  Patrice Dumas  <pertusus@free.fr>

	* Texinfo/Convert/NodeNameNormalization.pm (_convert): rename $command
	as $cmdname and use it more through the code.

2024-02-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Indices.pm (setup_sortable_index_entries),
	tp/Texinfo/XS/main/manipulate_indices.c
	(setup_sortable_index_entries): do not set INCLUDE_DIRECTORIES, as it
	is only useful for @verbatiminclude, which cannot appear in index
	entries.

2024-02-04  Patrice Dumas  <pertusus@free.fr>

	Update po files

2024-02-04  Patrice Dumas  <pertusus@free.fr>

	Make indices sorting independent of the output encodings

	* NEWS, tp/Texinfo/Indices.pm (setup_sortable_index_entries),
	tp/Texinfo/XS/main/manipulate_indices.c
	(setup_sortable_index_entries): do not use
	setup_index_entry_keys_formatting to setup the conversion to text of
	sort strings.  Instead setup the conversion to always use unicode if
	possible and never pass a converter.

	* tp/Texinfo/Indices.pm (setup_index_entry_keys_formatting): rename
	$customization_info as $customization_information.

2024-02-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_printindex_command),
	tp/Texinfo/XS/convert/convert_html.c (convert_printindex_command): if
	the first command in the first index entry in a letter is a no
	arg command, format the command, possibly using the upper case command 
	to format the letter.

	* tp/Texinfo/XS/main/manipulate_indices.c (strip_index_ignore_chars)
	(index_entry_element_sort_string, new_index_entry_text_or_command)
	(idx_leading_text_or_command)
	(index_entry_first_letter_text_or_command),
	tp/Texinfo/XS/main/manipulate_indices.h (INDEX_ENTRY_TEXT_OR_COMMAND):
	add strip_index_ignore_chars based onindex_entry_element_sort_string
	code.  Implement index_entry_first_letter_text_or_command in C.

	* test_files_generated_list, tp/t/html_tests.t
	(letter_command_in_index, U_in_index): new tests with @-commands in
	index entries that should be used for letter formatting.

2024-02-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (is_content_empty): do not consider text set to
	'0' to be empty.

	* tp/Texinfo/Convert/HTML.pm (_convert_printindex_command),
	tp/Texinfo/XS/convert/convert_html.c (convert_printindex_command):
	normalize and transliterate letter to use it as an identifier. Gather
	the first formatted index entry in a letter. Format the letter only
	once.

	* tp/Texinfo/Indices.pm (_idx_leading_text_or_command)
	(index_entry_first_letter_text_or_command): add a function that finds
	the first letter as an @-command, or the first letter text.

2024-02-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Utils.pm (definition_category_tree),
	tp/Texinfo/XS/main/convert_utils.c (definition_category_tree):
	set translation using the documentlanguage extra information from the
	tree element if there are no options available.

2024-02-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Text.pm (_convert),
	tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal):
	translate untranslated type using the documentlanguage extra
	information from the tree element if there is no converter
	available.

2024-02-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c
	(unregister_document_merge_with_document): merge
	unregister_document_descriptor_tree in
	unregister_document_merge_with_document.  Remove TREE_AND_STRINGS.

2024-02-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c
	(unregister_document_merge_with_document),
	tp/Texinfo/XS/main/translations.c (gdt_tree): add based on gdt_tree
	code.

	* tp/Texinfo/XS/convert/convert_html.c (html_gdt, html_gdt_tree)
	(html_cdt_tree): redo functions based on new codes.

2024-02-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/translations.c (replace_convert_substrings):
	call reset_parser.

	* tp/Texinfo/XS/convert/convert_html.c (html_cdt),
	tp/Texinfo/XS/main/translations.c (replace_convert_substrings, gdt):
	pass debug_level instead of options to replace_convert_substrings.
	Set parser debug level in replace_convert_substrings.

2024-02-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Translations.pm (translate_string, gdt, gdt_string):
	remove unused translate_string first argument.  Do not remove the
	first argument of the user-defined $translate_string_method optionally
	passed to gdt and gdt_string.  Update callers.

	* tp/Texinfo/Translations.pm (_replace_substrings)
	(_replace_convert_substrings): rename to make clear that the functions
	are internal.  Replace _replace_convert_substrings
	$customization_information by $debug_level as it is the only variable
	that is used and we want to keep it like this.

	* tp/Texinfo/XS/main/translations.c (translate_string): remove unused
	first argument.  Update callers.

2024-02-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (pcdt): call cdt.

	* tp/Texinfo/Translations.pm (gdt, gdt_string): add a
	$translate_string_method to allow customization of translate_string
	instead of using can on the $customization_information argument.

	* tp/Texinfo/Convert/HTML.pm (@ISA, html_translate_string)
	(cdt, cdt_string): do not inherit Texinfo::Translations.
	Rename translate_string as html_translate_string.  Redefine cdt and
	cdt_string to pass html_translate_string to gdt and gdt_string
	to customize translate_string.

2024-02-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_utils.c (cdt_tree): add to replace
	gdt_tree when only converter is used.  Update caller of gdt_tree.

	* tp/Texinfo/XS/convert/convert_html.c (html_translate_string),
	tp/Texinfo/XS/main/translations.c (translate_string): change order of
	arguments.  Use passed lang as is.  Update callers.

	* tp/Texinfo/XS/main/translations.c (gdt, gdt_tree, gdt_string)
	(pgdt_tree), tp/Texinfo/XS/main/DocumentXS.xs: change arguments order.
	Update callers.

	* tp/Texinfo/XS/convert/convert_html.c (html_cdt, html_cdt_tree)
	(html_cdt_string, html_pcdt_tree): use instead of html_gdt,
	html_gdt_tree and html_gdt_string and html_pgdt_tree.  Determine lang
	from converter in html_cdt_tree and html_cdt_string, use converter
	document.  Update callers.

	* tp/Texinfo/XS/structuring_transfo/structuring.c (new_master_menu):
	separate better cases of options defined or not.

2024-02-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Translations.pm (pgdt): call gdt directly.

	* tp/Texinfo/Convert/Converter.pm (@ISA), tp/Texinfo/Convert/HTML.pm
	(@ISA): do not inherit Texinfo::Translations in Converter.pm.  Inherit
	Texinfo::Translations in HTML.pm, only to be able to redefine
	translate_string.

2024-02-02  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Translations Output and Customization),
	(Internationalization of Strings Function), po_document/Makevars
	(XGETTEXT_OPTIONS), tp/Texinfo/Convert/Converter.pm (cdt, cdt_string)
	(pcdt), tp/Texinfo/Convert/*.pm, tp/Texinfo/Translations.pm
	(translate_string, gdt, gdt_string, pgdt): do not set language in
	gdt, gdt_string, pgdt, instead get it as argument.  Change the
	arguments order to have $lang appear earlier.  Add wrappers for
	converters, called cdt, cdt_string and pcdt that set the language with
	get_conf('documentlanguage').  Update callers.

2024-02-02  Patrice Dumas  <pertusus@free.fr>

	No encoding, no us-ascii added to locale for document translations

	* NEWS, doc/texinfo.texi (Internationalization of Document Strings),
	tp/Texinfo/Translations.pm (translate_string),
	tp/Texinfo/XS/main/translations.c (translate_string): do not prepend
	the encoding nor us-ascii to the locale name to find the translations.
	For the encoding it is not done in XS, not useful since long in Perl
	and encoding was never available when translating from parser.  Note
	that this does not constrain the actual encoding declared in the po/mo
	file (which could be us-ascii) and do not prevent from using accented
	@-commands in translations (which would be needed for accented letters
	if the encoding is us-ascii).

2024-02-02  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/Makefile.onetst, tp/tests/coverage/list-of-tests: disable
	the test of --trace-includes as it leads to a different result in out
	of sources build.

2024-02-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/get_perl_info.c
	(copy_sv_options_for_convert_text): fetch ASCII_GLYPH, NUMBER_SECTIONS
	and set_case.

	* tp/t/convert_to_text.t: test 'set_case' value set as a
	Texinfo::Convert::Text::convert_to_text call option.

2024-02-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files),
	t/input_files/formatting_customizations_input.texi, tp/Makefile.tres,
	tp/t/converters_tests.t (reference_for_formatting_customizations)
	(test_formatting_customizations), tp/tests/Makefile.onetst,
	tp/tests/formatting/list-of-tests: add tests of customizations on
	formatting.  Setup a separate test in tests/formatting/list-of-tests
	to be able to test rawtext too, as in t/*.t raw text does not take
	into account customization.

	* tp/Texinfo/Convert/Text.pm (brace_no_arg_command),
	tp/Texinfo/Convert/Unicode.pm (unicode_point_decoded_in_encoding),
	tp/Texinfo/XS/main/convert_to_text.c (text_brace_no_arg_command),
	tp/Texinfo/XS/main/unicode.c (unicode_point_decoded_in_encoding):
	consider that encoding is the default, UTF-8 in
	unicode_point_decoded_in_encoding if undef.  Check that encoding is
	defined in text brace_no_arg_command and do not call unicode
	brace_no_arg_command if not.

	* tp/Texinfo/Translations.pm (import),
	tp/Texinfo/XS/main/DocumentXS.xs
	(configure_output_strings_translations),
	tp/Texinfo/XS/main/translations.c
	(configure_output_strings_translations): rename
	translations_configure as configure_output_strings_translations.

	* tp/Texinfo/XS/main/translations.c
	(configure_output_strings_translations): add error message if
	bindtextdomain failed.

	* tp/Texinfo/XS/convert/convert_html.c (html_translate_names): add
	document to html_gdt_tree call.

2024-02-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/call_html_perl_function.c,
	tp/Texinfo/XS/main/call_perl_function.c
	(get_call_index_entries_sorted_by_letter): move
	get_call_index_entries_sorted_by_letter to call_perl_function.c.

	* tp/Texinfo/XS/convert/converter.c
	(converter_sort_indices_by_letter),
	tp/Texinfo/XS/main/manipulate_indices.c: move
	converter_sort_indices_by_letter to converter.c.

	* tp/Texinfo/Convert/Converter.pm (%XS_overrides)
	(_XS_get_converter_indices_sorted_by_letter)
	(get_converter_indices_sorted_by_letter),
	tp/Texinfo/Convert/HTML.pm (get_info),
	tp/Texinfo/Indices.pm (%XS_convert_overrides),
	tp/Texinfo/XS/convert/ConvertXS.xs
	(get_converter_indices_sorted_by_letter),
	tp/Texinfo/XS/main/IndicesXS.xs,
	tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/convert/converter.c
	(get_converter_indices_sorted_by_letter): add
	get_converter_indices_sorted_by_letter based on get_info in HTML.pm
	and associated _XS_get_converter_indices_sorted_by_letter based on
	get_converter_indices_sorted_by_letter in Texinfo::Indices.
	Remove Texinfo::Indices::get_converter_indices_sorted_by_letter.
	Move get_converter_indices_sorted_by_letter to ConvertXS.xs.
	Rename html_get_info_index_entries_by_letter as
	get_converter_indices_sorted_by_letter and move to converter.c.

2024-01-31  Patrice Dumas  <pertusus@free.fr>

	Sort index entries on demand in HTML

	* tp/Texinfo/Convert/HTML.pm (get_info, convert, output): sort indices
	when get_info is called for 'index_entries_by_letter'.

	* tp/Texinfo/XS/main/IndicesXS.xs
	(get_converter_indices_sorted_by_letter),
	tp/Texinfo/XS/main/manipulate_indices.c
	(converter_sort_indices_by_letter): add
	converter_sort_indices_by_letter to sort index entries by letter with
	a converter.  Call it in get_converter_indices_sorted_by_letter.

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(get_call_index_entries_sorted_by_letter),
	tp/Texinfo/XS/convert/convert_html.c
	(html_get_info_index_entries_by_letter, convert_printindex_command):
	add get_call_index_entries_sorted_by_letter to get sorted indices from
	HTML by calling Texinfo::Convert::HTML::get_info and
	get_sv_index_entries_sorted_by_letter.  Add
	html_get_info_index_entries_by_letter and call it when sorted indices
	are needed.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides),
	tp/Texinfo/XS/convert/ConvertXS.xs: remove
	_XS_get_index_entries_sorted_by_letter, _NonXS_sort_index_entries,
	_XS_only_sort_index_entries, _sort_index_entries,
	get_index_entries_sorted_by_letter, html_sort_index_entries.

2024-01-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c (document_merged_indices): rename
	merged_indices as document_merged_indices.

	* tp/Texinfo/XS/convert/convert_html.c (html_sort_index_entries): use
	document_merged_indices.

	* tp/Texinfo/XS/main/manipulate_indices.c
	(index_entry_element_sort_string, index_entry_element_sort_string_key)
	(setup_sortable_index_entries, sort_indices_by_letter): use const for
	merged_indices.

2024-01-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (locate_include_file): change code used to
	concatenate directories and file to get the same result as with XS/C
	in tests.

2024-01-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (locate_include_file): simplify code.

2024-01-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_misc_line): check if
	verbatiminclude path is defined.

2024-01-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (nodist_IndicesXS_la_SOURCES),
	tp/Texinfo/XS/main/IndicesXS.xs: move IndicesXS.xs to main/.

2024-01-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES)
	(IndicesXS_la_SOURCES, ConvertXS_la_SOURCES),
	tp/Texinfo/XS/main/manipulate_indices.c: move indices_in_conversion.c
	to main/ and rename as manipulate_indices.c.

	* tp/Texinfo/Convert/HTML.pm (_NonXS_sort_index_entries),
	tp/Texinfo/Convert/IXIN.pm (output_ixin), tp/Texinfo/Convert/LaTeX.pm
	(_prepare_indices), tp/Texinfo/Convert/Plaintext.pm
	(process_printindex), tp/Texinfo/Document.pm (merged_indices),
	tp/init/chm.pm, tp/t/test_sort.t, tp/t/test_utils.pl: add
	merged_indices in Texinfo::Document to store and get merged indices in
	document.

	* tp/Texinfo/XS/convert/convert_html.c (html_sort_index_entries),
	tp/Texinfo/XS/main/converter_types.h, tp/Texinfo/XS/main/document.c
	(merged_indices, destroy_document_information_except_tree),
	tp/Texinfo/XS/main/document_types.h (MERGED_INDEX, MERGED_INDICES)
	(DOCUMENT), tp/Texinfo/XS/main/manipulate_indices.c (merge_indices)
	(destroy_merged_indices, setup_sortable_index_entries)
	(sort_indices_by_letter): add merged_indices in document to store and
	get merged indices in document.  Remove index_entries from CONVERTER.
	Move MERGED_INDEX to document_types.h, add MERGED_INDICES struct for a
	list of merged indices.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides)
	(_NonXS_sort_index_entries), tp/Texinfo/XS/convert/ConvertXS.xs,
	tp/Texinfo/XS/convert/convert_html.c: remove
	_XS_html_merge_index_entries and html_merge_index_entries.

2024-01-31  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Conversion General Information),
	tp/Texinfo/Convert/HTML.pm (%available_converter_info)
	(_NonXS_sort_index_entries), tp/init/chm.pm (chm_init): remove
	'index_entries' from the HTML general information API, it can easily
	be setup in user code.

	* tp/Texinfo/XS/main/build_perl_info.c
	(build_sorted_indices_by_letter): add to be able to build Perl sorted
	indices from C data.

	* tp/Texinfo/Indices.pm (%XS_convert_overrides)
	(get_converter_indices_sorted_by_letter),
	tp/Texinfo/XS/convert/IndicesXS.xs
	(get_converter_indices_sorted_by_letter): add an XS interface to get
	indices sorted by letter from a converter.

	* tp/Texinfo/Convert/HTML.pm (get_info): get 'index_entries_by_letter'
	on demand from XS if not already set.

2024-01-30  Patrice Dumas  <pertusus@free.fr>

	Add gnulib module for XS

	* tp/Texinfo/XS:
	Run "gnulib-tool --add-import unictype/category-Mn"

2024-01-30  Patrice Dumas  <pertusus@free.fr>

	* contrib/mass_test/generate_perlVSC.sh: do not remove the directories
	if only one test is done.

	* contrib/mass_test/check_perlVSC.sh: add the possibility to check the
	diff for one test only.

2024-01-30  Patrice Dumas  <pertusus@free.fr>

	Index sorting in C

	* tp/Texinfo/Indices.pm (setup_sortable_index_entries): rename
	variables.  Simplify code that determine that there is one non empty
	entry/subentry.

	* tp/Texinfo/XS/parsetexi/indices.c (enter_index_entry),
	tp/Texinfo/XS/main/tree_types.h (INDEX_ENTRY): add index
	entry number in index entry structure.

	* tp/Texinfo/XS/convert/indices_in_conversion.c (set_sort_key)
	(INDEX_SORT_STRING_KEY, index_entry_element_sort_string_key)
	(setup_sortable_index_entries, LETTER_SORTABLE_ENTRIES)
	(INDEX_LETTERS_SORTABLE_ENTRIES, compare_index_letter)
	(compare_sortable_subentry_keys, compare_sortable_index_entry)
	(sort_indices_by_letter),
	tp/Texinfo/XS/convert/indices_in_conversion.h
	(SORTABLE_INDEX_SUBENTRY, SORTABLE_INDEX_ENTRY)
	(INDEX_SORTABLE_ENTRIES, INDICES_SORTABLE_ENTRIES): implement
	index sorting by letter in C.
	* tp/Texinfo/XS/configure.ac: check for newlocale and strxfrm_l.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides)
	(_NonXS_sort_index_entries, _XS_only_sort_index_entries)
	(_sort_index_entries), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_sort_index_entries), tp/Texinfo/XS/convert/convert_html.c
	(html_sort_index_entries): XS interface for index sorting in HTML,
	if TEST is not set.

2024-01-29  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Other Customization Variables),
	* NEWS: Document USE_UNICODE_COLLATION.

2024-01-29  Patrice Dumas  <pertusus@free.fr>

	Add @verbatiminclude files to --trace-includes output

	* tp/Texinfo/ParserNonXS.pm (_end_line_misc_line),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line): add
	@verbatiminclude file to included_files if found and readable.  No
	errors if not found or not readable.

	* tp/tests/Makefile.onetst, tp/tests/coverage/list-of-tests
	(formatting_trace_includes): add a test of --trace-includes.

	* doc/texinfo.texi: fix a typo.

2024-01-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Indices.pm (setup_sortable_index_entries): use
	Unicode::Collate if possible if USE_UNICODE_COLLATION is undef.

	* tp/Texinfo/options_data.txt (TRACE_INCLUDES): reclassify as
	program_cmdline.

2024-01-28  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl, tp/t/init/redefine_need.init (my_need_formatting),
	doc/texi2any_api.texi (Getting Build Constants), tp/Texinfo/Common.pm
	b/tp/Texinfo/Common.pm (%build_constants, set_build_constant)
	(get_build_constant): rename get_constant as get_build_constant and
	set_constant as set_build_constant (Gavin).

2024-01-28  Gavin Smith <gavinsmith0123@gmail.com>

	USE_UNICODE_COLLATION

	* tp/Texinfo/options_data.txt: Add USE_UNICODE_COLLATION, 1 by default.
	* tp/Texinfo/Indices.pm (setup_sortable_index_entries): If
	USE_UNICODE_COLLATION is false, use the Texinfo::CollateStub
	module instead of Unicode::Collate.

2024-01-28  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl: set also PACKAGE*_CONFIG to have the same symbols
	defined as in C.

	* tp/t/init/redefine_need.init (my_need_formatting): also test
	PACKAGE_CONFIG.

2024-01-28  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Info.pm (format_node):
	Remove commented-out line of code.

2024-01-28  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Unicode.pm (string_width):
	Do not reset the counter to zero at a newline, as this only
	occurs for malformed input and it is not worth the complication.
	* tp/Texinfo/XS/main/utils.c (width_multibyte): Make the same
	change.  Reverses change on 2023-12-31.

2024-01-28  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm
	(ensure_end_of_line, _ensure_end_of_line):
	Move function in file to be right after _add_newline_if_needed,
	as the implementation is similar.  Rename with leading underscore
	to mark as "internal", and do not call with method call syntax
	throughout.  No functional change intended.

2024-01-28  Gavin Smith <gavinsmith0123@gmail.com>

	* info/infodoc.c (describe_key): Fix handling of keys with
	"invalid" mappings.

	Report from Bugsy Abatantuono <bugsyabatantuono@proton.me>.

2024-01-28  Gavin Smith <gavinsmith0123@gmail.com>

	* info/doc.h (FUNCTION_DOC, InfoCommand): Use "InfoCommand" as
	the sole name for this type.

2024-01-28  Gavin Smith <gavinsmith0123@gmail.com>

	* info/info.h (Function, CFunction): Remove unused typedefs.

2024-01-28  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: update for PACKAGE_* name change

2024-01-28  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/options_data.txt: Remove _OPTION suffixes from
	PACKAGE_* variables in order to maintain backwards compatability,
	especially for customization files (e.g. for ffmpeg).
	Report from Arsen Arsenović <arsen@gentoo.org>.

	* tp/texi2any.pl: Set the variables from the "configured information"
	without adding a suffix.
	* tp/Texinfo/Convert/Converter.pm, tp/Texinfo/Convert/HTML.pm,
	tp/Texinfo/Convert/Info.pm, tp/Texinfo/XS/convert/convert_html.c,
	tp/t/init/t2h_singular.init, tp/t/layout.t: Consequent changes.

	* tp/maintain/regenerate_C_options_info.pl: #undef the PACKAGE_*
	symbols to avoid a clash with symbols defined by autoconf.
	Analysis by Patrice.

	* tp/Texinfo/XS/configure.ac: Propagate PACKAGE, PACKAGE_NAME,
	PACKAGE_URL and PACKAGE_VERSION using AC_DEFINE_UNQUOTED, with
	a _CONFIG suffix, in order to make these symbols still accessible
	in the XS sources.  Suggestion from Patrice.
	* tp/Texinfo/XS/main/build_perl_info.c (init): Refer to PACKAGE_CONFIG
	rather than PACKAGE.

2024-01-27  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Invoking texi2any),
	* tp/texi2any.pl (makeinfo_help): Reword description of
	--trace-includes option.

2024-01-27  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Invoking @command{texi2any})
	(Customization Variables and Options), tp/Texinfo/options_data.txt,
	tp/texi2any.pl: rename SHOW_INCLUDE_FILE_PATHS as TRACE_INCLUDES
	and add --trace-includes command-line option.  Name from Gavin.

2024-01-27  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl: avoid \n in translated strings, split each option in
	a translatable string.  Report from Benno Schulenberg.

2024-01-27  Patrice Dumas  <pertusus@free.fr>

	* tp/t/init/redefine_need.init (my_need_formatting): get PACKAGE
	instead of PACKAGE_AND_VERSION to have a string independent of the
	Texinfo package version.

2024-01-26  Patrice Dumas  <pertusus@free.fr>

	* doc/Makefile.am (gendocs_envvars, wwwdoc-build): link texinfo.tex
	and add environnement variables to gendocs_envvars to build with
	in-source commands.

2024-01-26  Patrice Dumas  <pertusus@free.fr>

	* TODO: update.

2024-01-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/options_data.txt: set CHECK_NORMAL_MENU_STRUCTURE to 1
	in the default case.

	* NEWS: update.

2024-01-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/options_data.txt, tp/texi2any.pl: add customization
	variable SHOW_INCLUDE_FILE_PATHS with which included file paths are
	output.

	* tp/texi2any.pl: remove document even when there is no conversion, but
	parse, structure, dump or similar.

2024-01-26  Patrice Dumas  <pertusus@free.fr>

	Gather include file paths in document global information

	* tp/Texinfo/ParserNonXS.pm (_end_line_misc_line),
	tp/Texinfo/XS/main/build_perl_info.c (build_global_info),
	tp/Texinfo/XS/main/document_types.h (GLOBAL_INFO),
	tp/Texinfo/XS/main/utils.c (delete_global_info),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line),
	tp/Texinfo/XS/parsetexi/parser.c (store_document): store include file
	paths in included_files global information new field.

2024-01-26  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Getting Constants), tp/Texinfo/Common.pm
	(set_constant, get_constant): add setting/getting constants.

	* tp/texi2any.pl: set PACKAGE* as constants.

	* tp/t/init/redefine_need.init (my_need_formatting): use constants by
	get_constant.

2024-01-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/extra.c (add_associated_info_string_dup): add.

	* tp/Texinfo/XS/main/DocumentXS.xs (set_document_global_info),
	tp/Texinfo/XS/main/build_perl_info.c (store_additional_info)
	(build_additional_info, build_global_info),
	tp/Texinfo/XS/main/document_types.h (GLOBAL_INFO),
	tp/Texinfo/XS/main/utils.c (delete_global_info): split
	build_additional_info out of store_additional_info, to build
	additional info on a passed hash.  Pass other set document global info
	in a associated_info.

	* tp/texi2any.pl: set configured_information PACKAGE* variables and
	pass them as set_document_global_info.

	* tp/t/init/redefine_need.init (my_need_formatting): test getting
	PACKAGE_AND_VERSION.

2024-01-25  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (set_converter_option_defaults, convert_to_*)
	(test): remove unused $main_configuration argument. Add a $debug
	argument to set_converter_option_defaults $debug argument and set
	converted_format and DEBUG options in set_converter_option_defaults.

	* tp/t/test_utils.pl (test): move code around, small changes.

2024-01-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm: update POD documentation.

2024-01-25  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/pod2texi.pl (_parsed_manual_tree),
	tp/t/test_utils.pl (test), tp/texi2any.pl: do not get a return value
	from Texinfo::Transformations::insert_nodes_for_sectioning_commands.

	* tp/t/test_utils.pl (test), tp/texi2any.pl: do not get a return value
	from Texinfo::Transformations::fill_gaps_in_sectioning.

	Update POD documentation.

2024-01-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XSLoader.pm (init): simply use _fatal if the libtool name
	was not found.

2024-01-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_default_format_element_footer): use
	an explicit list of characters to be considered as spaces to cope with
	all the perl versions.

	* tp/Texinfo/XS/convert/convert_html.c (word_number_more_than_level)
	(html_default_format_element_footer): return the count by reference
	in word_number_more_than_level.

	* tp/Texinfo/XS/convert/convert_html.c (word_number_more_than_level):
	count words, not spaces.

2024-01-24  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (add_newline_if_needed):
	Implement checking end of a string for newline using "use bytes".

2024-01-24  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert): Rename a variable.

2024-01-24  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Info.pm (format_node): Pass return value of
	node_name to Texinfo::Convert::Plaintext::_decode if interpolating
	into an error message.

2024-01-24  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (convert_line_new_context):
	Unconditionally disable encoding in the nested count context
	and remove a parameter.  All callers updated.
	(node_name): Call _stream_encode on the result of
	convert_line_new_context in order still to work with an encoded
	node name.

2024-01-24  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (process_printindex)
	<node name quoting>: Do not increment
	$self->{'count_context'}->[-1]->{'bytes'} as this is taken care
	of in _stream_output.

2024-01-24  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (process_printindex)
	<(outside of any node>: Call convert_line_new_context with
	encoding disabled.

2024-01-24  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (convert_new_context):
	Inline into the two places it is called and remove function.
	Set 'encoding_disabled' on the nested count context and pass
	result to _stream_output instead of _stream_output_encoded.

2024-01-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XSLoader.pm (init): if fallback module is not set, return
	undef instead of calling die.  For many XS modules there is no perl
	module fallback, instead, if the perl methods are used instead of the
	XS methods the output should be fine.  For the other cases, the return
	value of init should be checked.

	* tp/Texinfo/Convert/ConvertXS.pm ($XS_package, BEGIN),
	tp/Texinfo/Convert/Converter.pm (get_conf),
	tp/Texinfo/Convert/PlainTexinfo.pm (convert_tree),
	tp/Texinfo/Convert/Text.pm (convert_to_text, output),
	tp/Texinfo/StructTransfXS.pm ($XS_package, BEGIN),
	tp/Texinfo/Transformations.pm (_new_node): set $XS_package with
	Texinfo::XSLoader::init return value for ConvertXS and StructTransfXS,
	and check the value in codes that need to know if the module was
	loaded, for instance if th eperl functions that are not overriden
	should not be called.

	* tp/Texinfo/Document.pm (%XS_overrides): remove
	remove_document_descriptor override, it is not defined in perl.

2024-01-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/ConvertXS.pm (BEGIN),
	tp/Texinfo/Convert/Paragraph.pm (BEGIN), tp/Texinfo/DocumentXS.pm
	(BEGIN), tp/Texinfo/IndicesXS.pm (BEGIN), tp/Texinfo/MiscXS.pm
	(BEGIN), tp/Texinfo/Parser.pm (BEGIN), tp/Texinfo/StructTransfXS.pm
	(BEGIN): leave out Texinfo::XSLoader::init warning and fatal message
	arguments when they are undef.

2024-01-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/DocumentXS.pm (BEGIN), tp/Texinfo/IndicesXS.pm (BEGIN),
	tp/Texinfo/StructTransfXS.pm (BEGIN): set the Texinfo::XSLoader::init
	fallback_module module argument to undef when there is no actual
	fallback module.

2024-01-23  Patrice Dumas  <pertusus@free.fr>

	* configure.ac (AM_INIT_AUTOMAKE): decrease required automake version
	to 1.16.1, which requires @setfilename in Texinfo manuals, but it also
	the version still found for some platforms.

2024-01-23  Patrice Dumas  <pertusus@free.fr>

	* info/Makefile.am (AUTOMAKE_OPTIONS): remove no-dist-built-sources,
	it does not seems to be useful.  If it is readded, the automake
	required version should be increased.

2024-01-23  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi: add @setfilename to simplify using old
	automake versions.

2024-01-23  Patrice Dumas  <pertusus@free.fr>

	* doc/refcard/Makefile.am (pdf-local): use pdf-local instead of all
	for the txirefcard target, to avoid depending on tex being installed
	when building from development sources.

2024-01-23  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Translations.pm (gdt_string_encoded): Remove now
	unused function.

2024-01-23  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_text_heading): Return
	an unencoding string to be output with _stream_output
	rather than _stream_output_encoded.  Callers updated.  Call
	convert_line_new_context with encoding disabled.  Call gdt_string
	rather than gdt_string_encoded and get display width of result
	with string_width.

2024-01-23  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_stream_output): Interchange
	second and third parameters, to simplify calling when the
	formatter argument is undef.  All callers updated.

2024-01-23  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert, format_contents):
	Call convert_line_new_context with encoding disabled in more
	places and pass the result to _stream_output rather than
	_stream_output_encoded.

2024-01-23  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (convert_line_new_context):
	Take a new parameter, $encoding_disabled, and set the
	'encoding_disabled' flag if set.
	* tp/Texinfo/Convert/Info.pm (_info_header): Output copying
	block directly by calling _convert, rather than passing the
	result of convert_tree to _stream_output_encoded.  Use new
	argument to convert_line_new_context to convert @dircategory
	commands.  Convert and output @dircategory and @direntry commands
	without calling _stream_output_encoded.

2024-01-23  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_stream_byte_count):
	Recognize an 'encoding_disabled' flag on the count context, and
	if set, do not encode the output.
	(process_printindex): Set this flag when converting an index
	entry and output the result with _stream_output rather than
	_stream_output_encoded, and to get the display width call
	string_width rather than string_width_encoded.

2024-01-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_tab_command): round using
	%.0f to be more accurate than with %d.

	* tp/Makefile.tres, tp/t/html_tests.t (fractions_rounding): add a test
	that shows an incorrect percent rounding with %d with perl.

2024-01-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/html_tests.t (contents_with_only_top_node)
	(top_node_top_contents): tests of html_text and file_html for
	@contents with @node only or @node and @top only.

	* tp/Texinfo/XS/convert/convert_html.c (prepare_special_units): do
	contents/shortcontents directions only if there is more than one
	section.

2024-01-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/html_tests.t (end_of_line_in_uref): add test
	of end of line in uref.

	* tp/Texinfo/XS/convert/convert_html.c (url_protect_url_text)
	(url_protect_file_text), tp/Texinfo/XS/main/utils.c
	(encode_with_iconv): pad x percent format with 0.

2024-01-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/html_tests.t
	(empty_node_in_html_title_no_sec_name, empty_chapter_in_html_title)
	(empty_chapter_in_html_title_no_node_no_use_nodes): tests with empty
	node/chapter in html <title> formatting.

2024-01-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_mini_toc),
	tp/Texinfo/XS/convert/convert_html.c (mini_toc_internal): handle empty
	sectioning command in mini toc.

	* tp/Makefile.tres, tp/t/30sectioning.t (empty_section_in_chapter):
	test empty @section in @chapter conversion.

2024-01-22  Patrice Dumas  <pertusus@free.fr>

	* contrib/mass_test/generate_perlVSC.sh: show command line when doing
	only one test.

2024-01-21  Patrice Dumas  <pertusus@free.fr>

	* contrib/mass_test/*.sh: add more manuals, separate script to
	output HTML, separate generating HTML and checking the differences.

2024-01-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm: comments covering, hopefully, all
	the things to change for DocBook 5, following Jean-Christophe Helary
	mail on bug-texinfo.

2024-01-22  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (process_footnotes)
	(format_contents, _menu, process_printindex): Change some uses
	of _stream_output_encoded to _stream_output.

2024-01-22  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm:
	When outputting a single newline, call _stream_output instead
	of _stream_output_encoded.  This reduces calls to _stream_byte_count
	to encode the output and allows output to be encoded in fewer,
	bigger chunks.

2024-01-22  Gavin Smith <gavinsmith0123@gmail.com>

	Eliminate empty lines counting

	* tp/Texinfo/Convert/Plaintext.pm (conversion_initialization)
	(_add_newline_if_needed, process_footnotes, _convert),
	* tp/Texinfo/Convert/Info.pm (_info_header, format_node):
	Eliminate all updating of $self->{'empty_lines_count'}.

2024-01-22  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert) <empty_line>:
	Unconditionally call _get_form_feeds to propagate form feeds in
	the input to the output regardsless of 'empty_lines_count'.

2024-01-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Transformations.pm (_new_node): call confess if _new_node
	is called with XS.

	* tp/t/accents.t: do not set document_descriptor as an option for the
	converter.

2024-01-21  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_add_newline_if_needed):
	Replace with implementation that checks the end of the output
	stream rather than the 'empty_lines_count' counter.
	* tp/Texinfo/Convert/Info.pm (_info_header): Call
	_add_newline_if_needed to ensure a blank line at the end of
	the header.

2024-01-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (%common_converters_defaults):
	remove document_descriptor, which should not be passed from perl, but
	added in XS only.

2024-01-21  Patrice Dumas  <pertusus@free.fr>

	Do not remove .inf or .info from manual name for HTML cross references

	* NEWS, tp/Texinfo/Convert/HTML.pm (_external_node_href),
	tp/Texinfo/XS/convert/convert_html.c (external_node_href): do not
	remove a .inf or .info at the end of manual name argument for
	cross-references to external nodes.  This is not done for other
	formats, does not comply with the HTML cross references specification
	and is probably a remnant of times long gone.

2024-01-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (output_tree)
	(conversion_output_begin, conversion_output_end),
	tp/Texinfo/Convert/DocBook.pm (conversion_output_begin)
	(conversion_output_end, output), tp/Texinfo/Convert/PlainTexinfo.pm
	(output), tp/Texinfo/Convert/TexinfoMarkup.pm
	(conversion_output_begin, conversion_output_end, output),
	tp/Texinfo/Convert/TextContent.pm (output), tp/Texinfo/DebugTree.pm
	(output): add output_tree in Converter.pm, a generic method to convert
	a Texinfo tree to a file, to be called from output.  output_tree calls
	conversion_output_begin and conversion_output_end.  Call output_tree
	in output in converters that convert a whole tree.  Rename
	_output_beginning as conversion_output_begin and _output_end as
	conversion_output_end in TexinfoMarkup.pm and DocBook.pm.
	Update Converter.pm POD documentation.

	* tp/Texinfo/Convert/PlainTexinfo.pm (convert): call convert_tree.

2024-01-21  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert) <float>:
	Call _add_newline_if_needed instead of checking
	$self->{'empty_lines_count'} and outputing a newline directly.

2024-01-21  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert) <empty_line>:
	Try to separate form feed handling from code that actually adds
	an empty line to the output.  Call _add_newline_if_needed to
	output the newline and increment the count of empty lines.

2024-01-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_output_beginning, output)
	(_output_end), tp/Texinfo/Convert/TexinfoMarkup.pm (_output_beginning)
	(output, _output_end): add _output_beginning to prepare output
	appearing before tree conversion, and _output_end for output after
	tree conversion.

2024-01-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_convert): do not ignore especially
	sectionning commands with in_skipped_node_top, let the output be
	generated and discarded as for the remaining of the output.

2024-01-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm: update POD documentation.

2024-01-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm, tp/maintain/template.pod: remove
	document from converter argument.  Add conversion_initialization,
	conversion_finalization and set_document documentation.

2024-01-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (set_document),
	tp/Texinfo/Convert/DocBook.pm (_index_entry),
	tp/Texinfo/Convert/HTML.pm (_convert_printindex_command)
	(_sort_index_entries, _prepare_index_entries_targets)
	(output_internal_links), tp/Texinfo/Convert/IXIN.pm,
	tp/Texinfo/Convert/LaTeX.pm (_prepare_indices, _index_entry),
	tp/Texinfo/Convert/Plaintext.pm (process_printindex),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_index_entry, _convert),
	tp/init/chm.pm): do not set 'indices_information', instead use
	document indices_information to get indices information.

2024-01-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (set_document)
	(_set_output_units_files), tp/Texinfo/Convert/HTML.pm (label_command)
	(_get_top_unit, _convert_heading_command)
	(_set_root_commands_targets_node_files, _html_set_pages_files)
	(_prepare_units_directions_files, output), tp/Texinfo/Convert/IXIN.pm,
	tp/Texinfo/Convert/Info.pm (output), tp/Texinfo/Convert/LaTeX.pm
	(_convert), tp/Texinfo/Convert/Plaintext.pm (_convert): do not set
	'identifiers_target', instead use document labels_information to get
	document labels information identifiers_target.

2024-01-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (set_document),
	tp/Texinfo/Convert/HTML.pm (_convert_heading_command)
	(_convert_contents_command, _contents_shortcontents_in_title)
	(_set_root_commands_targets_node_files, _prepare_special_units)
	(_default_format_contents), tp/Texinfo/Convert/IXIN.pm,
	tp/Texinfo/Convert/LaTeX.pm (_begin_document, _convert),
	tp/Texinfo/Convert/Plaintext.pm (_convert), tp/ext/epub3.pm,
	tp/init/book.pm (book_convert_heading_command), tp/init/chm.pm
	(chm_init): do not set 'sections_list', instead use document
	sections_list to get document sections list.

2024-01-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (set_document),
	tp/Texinfo/Convert/HTML.pm (get_value): do not set
	'document_descriptor' nor 'document_values'.

	* tp/Texinfo/Convert/Converter.pm (set_document),
	tp/Texinfo/Convert/HTML.pm (_convert_listoffloats_command),
	tp/Texinfo/Convert/IXIN.pm, tp/Texinfo/Convert/LaTeX.pm
	(_prepare_floats, _latex_header, _convert),
	tp/Texinfo/Convert/Plaintext.pm (_convert): do not set 'floats',
	instead use document floats_information to get document floats
	information.

2024-01-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (set_output_encodings): use document in input
	argument.  Update callers.

	* tp/Texinfo/Convert/Converter.pm (set_document)
	(determine_files_and_directory), tp/Texinfo/Convert/HTML.pm
	(_prepare_converted_output_info), tp/Texinfo/Convert/IXIN.pm,
	tp/Texinfo/Convert/Info.pm (output, _info_header),
	tp/Texinfo/Convert/Utils.pm (encoded_output_file_name)
	(encoded_input_file_name): do not set 'document_info', instead use
	document global_information to get document information.

2024-01-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (find_parent_root_command),
	tp/Texinfo/Convert/Converter.pm (set_document)
	(determine_files_and_directory, set_global_document_commands),
	tp/Texinfo/Convert/DocBook.pm (output, _convert),
	tp/Texinfo/Convert/HTML.pm (_get_top_unit, get_file_information)
	(%available_converter_info, _convert_insertcopying_command)
	(_default_format_titlepage, _set_heading_commands_targets)
	(_html_get_tree_root_element, _prepare_special_units)
	(_prepare_output_units_global_targets, _prepare_footnotes_targets)
	(_has_contents_or_shortcontents, _prepare_simpletitle)
	(_prepare_converted_output_info), tp/Texinfo/Convert/IXIN.pm,
	tp/Texinfo/Convert/Info.pm (_info_header), tp/Texinfo/Convert/LaTeX.pm
	(_prepare_conversion, _begin_document, _convert),
	tp/Texinfo/Convert/Plaintext.pm (_convert): remove 'global_commands'
	from converter.  The 'document' is used instead to get the global
	commands information.  in HTML.pm, remove 'global_commands' from
	%available_converter_info and add 'document'.

	* tp/Texinfo/Common.pm (get_global_document_command): change order of
	ifs.

2024-01-18  Gavin Smith <gavinsmith0123@gmail.com>

	Use foreach loop for Info output

	* tp/Texinfo/Convert/Info.pm (output): Move block of code
	dealing with split output from the end to the beginning of
	a loop, but do not execute it the first time around by checking
	a variable.  This allows changing the loop to a simple foreach
	loop rather than popping from an array each time round.

2024-01-18  Gavin Smith <gavinsmith0123@gmail.com>

	Change handling of blank lines between Info nodes

	* tp/Texinfo/Convert/Info.pm (format_node): Do not check
	'empty_lines_count' or add a newline at the beginning of the node
	if it is zero.  This makes the conversion of the node more independent
	of other nodes and sections of the Info file.
	(output): Each time after calling 'convert_output_unit', add
	an extra newline to the output if the result did not end in
	an empty line.	This compensates for not adding a line at the
	beginning in format_node.  Do not output an extra newline before
	the tag table, just after the last node.
	* tp/Texinfo/Convert/Plaintext.pm (_convert): Ensure that
	the 'before_node_section' ends in a newline by calling
	ensure_end_of_line, as it is no longer altered in format_node.

	This is aimed towards eliminating 'empty_lines_count' counting with
	simplicity and performance benefits.

2024-01-18  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Common.pm (debug_print_tree): Also print 'unit_contents'
	keys to allow printing an "output unit".

2024-01-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (sort_element_counts): call
	conversion_initialization and conversion_finalization.

	* tp/Texinfo/Convert/TexinfoMarkup.pm (output, convert): give document
	argument to conversion_initialization.

	* tp/Texinfo/Convert/Converter.pm (conversion_initialization)
	(converter), tp/Texinfo/Convert/DocBook.pm
	(conversion_initialization), tp/Texinfo/Convert/HTML.pm
	(conversion_initialization), tp/Texinfo/Convert/LaTeX.pm
	(conversion_initialization), tp/Texinfo/Convert/Plaintext.pm
	(conversion_initialization), tp/Texinfo/Convert/TexinfoMarkup.pm
	(conversion_initialization), tp/t/test_utils.pl (convert_to_*),
	tp/texi2any.pl: call set_document in conversion_initialization, do not
	pass a document to converter initialization.

	* tp/Texinfo/Convert/Text.pm (converter, output): get document in
	output.  Do not st global_information and global_commands_information
	in converter state, they are only used in output().

	* tp/t/convert_to_text.t: call set_document to set converter
	document.

2024-01-17  Gavin Smith <gavinsmith0123@gmail.com>

	Find menu with hide-note-references=On

	* info/session.c (info_find_menu): If "*Menu:" marker not
	found, try to move cursor to the first menu entry in the node.

	Report from Bugsy Abatantuono <bugsyabatantuono@proton.me>.

2024-01-17  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Reporting Bugs): Change reference to "Change Log"
	node in "standards" manual to "Change Logs" as the latter is the
	name that is used in that manual.

2024-01-17  Gavin Smith <gavinsmith0123@gmail.com>

	Fix info 'invalid' key mapping segfault

	* info/infodoc.c (dump_map_to_text_buffer): Check for "invalid"
	entry in key map by checking if a function pointer is null.  This
	prevents a crash in 'function_documentation' from dereferencing
	a null pointer if an "invalid" entry was provided in the infokey
	file.

	Report from Bugsy Abatantuono <bugsyabatantuono@proton.me>.

2024-01-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_load_htmlxref_files): use
	$Texinfo::ModulePath::top_srcdir to setup search directory with TEST
	to avoid using the document information before calling output or
	convert.

	* tp/Texinfo/Convert/HTML.pm (converter_initialize): use
	converter_descriptor and not document_descriptor to verify if the
	converter will be found in XS.

	* tp/Texinfo/XS/convert/convert_html.c (html_converter_initialize)
	(html_initialize_output_state): move code needing information in
	document to html_initialize_output_state.

	* tp/Texinfo/XS/convert/converter.c (free_generic_converter),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER),
	tp/Texinfo/XS/main/get_perl_info.c (get_line_message): add
	small_strings in converter to store small strings from
	get_line_message.

	* tp/Texinfo/Convert/Converter.pm (set_document, converter): call
	set_document after converter_initialize.  Set convert_text_options in
	set_document.

2024-01-17  Patrice Dumas  <pertusus@free.fr>

	Add initialization and finalization of conversion, separate document
	from converter

	* tp/Texinfo/Convert/Converter.pm (conversion_initialization)
	(conversion_finalization, output), tp/Texinfo/Convert/DocBook.pm
	(converter_initialize, conversion_initialization, convert)
	(conversion_initialization, output), tp/Texinfo/Convert/HTML.pm
	(%XS_conversion_overrides, _XS_html_converter_initialize)
	(converter_initialize, conversion_initialization)
	(conversion_finalization, convert, output), tp/Texinfo/Convert/IXIN.pm
	(output_ixin), tp/Texinfo/Convert/Info.pm (output),
	tp/Texinfo/Convert/LaTeX.pm (conversion_initialization, output)
	(convert, convert_to_latex_math), tp/Texinfo/Convert/Plaintext.pm
	(conversion_initialization, converter_initialize, convert_output_unit)
	(convert), tp/Texinfo/Convert/TexinfoMarkup.pm (converter_initialize)
	(conversion_initialization, output, convert),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_converter_initialize_sv)
	(html_initialize_output_state, html_conversion_finalization),
	tp/Texinfo/XS/convert/convert_html.c (html_initialize_output_state),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv, html_conversion_initialization_sv),
	tp/t/accents.t: use systematically conversion_initialization and
	conversion_finalization at the beginning and end of output and convert
	to initialize and finalize the conversion of one document.  Keep in
	converter_initialize only the code that do not depend on a document.
	In HTML.pm rename existing functions,
	_initialize_XS_NonXS_output_state as conversion_initialization and
	_finalize_output_state as conversion_finalization, and move code from
	converter_initialize.  In Plaintext.pm, this replaces
	_initialize_converter_state.

	* tp/Texinfo/Convert/Converter.pm (set_document),
	tp/Texinfo/Convert/HTML.pm (get_value): rename 'value' key in
	converter as 'document_values'.

	* tp/Texinfo/Convert/Converter.pm (%XS_overrides, set_document)
	(_XS_set_document, converter), tp/Texinfo/XS/convert/ConvertXS.xs
	(converter_set_document), tp/Texinfo/XS/main/get_perl_info.c
	(converter_set_document, converter_initialize): move setting the
	document of a converter to a separate function, for now called from
	converter.

	* tp/Texinfo/XS/convert/convert_html.c (html_initialize_output_state),
	tp/Texinfo/XS/main/get_perl_info.c
	(find_element_extra_index_entry_sv): handle NUL document.

	* tp/Texinfo/Convert/Plaintext.pm (pop_top_formatter)
	(process_footnotes, conversion_finalization): add a function to pop
	the top formatter and use it in conversion_finalization.

	* tp/Texinfo/Convert/DocBook.pm (convert_tree): minor change in code.

	* tp/Texinfo/Convert/IXINSXML.pm (converter_initialize): pass
	document, not tree.

2024-01-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (determine_files_and_directory):
	make $output_format non-optional.  Update callers.

2024-01-16  Gavin Smith <gavinsmith0123@gmail.com>

	Prevent M-x visit-menu segfault

	* info/session.c (info_visit_menu): Copy the node structure from the
	current window before calling info_follow_reference, similarly to
	code in info_split_window.  This prevents a shared node in the
	window history, leading to possible memory problems.

	Segmentation fault following 'M-x visit-menu' and 'M-x delete-window'
	reported by Bugsy Abatantuono <bugsyabatantuono@proton.me>.

2024-01-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (text_convert_tree): handle an
	undefined options_in.

	* tp/Texinfo/Convert/Text.pm (_initialize_options_encoding)
	(copy_options_for_convert_text, converter): do not use
	copy_options_for_convert_text in converter to setup text options, as
	the options are very similar to converter options, even if they are of
	a different nature.  Add _initialize_options_encoding to setup
	enable_encoding both for converter and in
	copy_options_for_convert_text.

2024-01-15  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Info.pm (output): Rename a variable
	to be less confusing.  Explain in comment that setting
	'text_before_first_node' was a side-effect of calling
	convert_output_unit, and explain the purpose of saving it.  Reorder
	code slightly for clarity.  No functional changes intended.

2024-01-15  Patrice Dumas  <pertusus@free.fr>

	* doc/tp_api/Makefile.am (texi2any_internals_dependencies):
	add Indices.pm.

2024-01-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (dist_modules_DATA), tp/Texinfo/Indices.pm,
	tp/Texinfo/IndicesXS.pm, tp/Texinfo/XS/Makefile.am
	(StructuringTransfoXS_la_SOURCES, StructuringTransfoXS_la_CPPFLAGS),
	(xs_LTLIBRARIES, IndicesXS_la_*), tp/Texinfo/XS/convert/IndicesXS.xs,
	tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs: move code
	related to indices to a new XS file convert/IndicesXS.xs out of
	StructuringTransfoXS.xs.

2024-01-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Indices.pm, tp/Texinfo/Structuring.pm, tp/Makefile.am
	(dist_modules_DATA): move code related to indices to a new file,
	Indices.pm out of Structuring.pm.

2024-01-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_set_heading_commands_targets),
	tp/Texinfo/XS/convert/convert_html.c (heading_commands_list): sort in
	perl and setup heading_commands_list order such as to have the same
	order in perl and XS and obtain the same disambiguation of targets.

	* tp/Texinfo/Convert/Converter.pm (converter),
	tp/Texinfo/Convert/HTML.pm (_set_root_commands_targets_node_files):
	use 'labels_list' instead of 'identifiers_target' for efficiency and
	to be more like XS code.

2024-01-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(html_get_css_elements_classes): set the values based on global
	selectors when there are only global selectors.

	* tp/Makefile.tres, tp/t/html_tests.t (command_in_node_redirection*):
	add test of commands in node redirection @-commands and in documment
	@top, to test CSS rules output.

2024-01-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line): map gb2312
	to euc-cn to get the same output as with perl Encode mime_name.  Note
	that this mapping looks wrong, as GB2312 seems to be the preferred
	mime name in IANA encoding registry
	https://www.iana.org/assignments/character-sets/character-sets.xhtml
	but we still do it to match with the Perl output.

2024-01-14  Patrice Dumas  <pertusus@free.fr>

	* contrib/mass_test/check_perlVSC.sh: do only the manual given in
	argument if an argument is given.

2024-01-14  Patrice Dumas  <pertusus@free.fr>

	* contrib/mass_test/*.sh: add copyright notices.

	* contrib/mass_test/extract_manuals.sh: call sed portably.

2024-01-14  Patrice Dumas  <pertusus@free.fr>

	contrib/mass_test for tests on manuals found on GNU website

	* contrib/mass_test/get_manuals.sh,
	contrib/mass_test/extract_manuals.sh: scripts to download and
	extract manuals found on the GNU website in software/*/manual/*.texi*.

	* contrib/mass_test/setup_reference_perlVSC.sh,
	contrib/mass_test/check_perlVSC.sh: check C against perl HTML output.

2024-01-14  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/t/21multitable.t (fullwidth_in_prototype): New test.
	* tp/t/21multitable.t: add "use utf8;" declaration in order to
	use UTF-8 in test case.

2024-01-14  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (add_text_to_count):
	Remove function, replacing all calls with calls to _stream_output
	or _stream_output_encoded.

2024-01-13  Gavin Smith <gavinsmith0123@gmail.com>

	Encode output and count bytes in Plaintext.pm

	* tp/Texinfo/Convert/Plaintext.pm (_stream_output, _stream_result)
	(_stream_output_encoded, _stream_byte_count, _stream_encode):
	New functions.	Convert results of conversion to output
	encoding as the conversion is done, accumulating the result.
	This simplifies keeping track of byte offsets in files (for nodes
	and anchors in the tag table), and potentially has performance
	benefits as output text does not need to be converted an extra
	time for the sole purpose of counting bytes.  It is potentially
	more reliable as byte offsets will be correct automatically
	rather than having to be kept up-to-date separately from the
	conversion result.

	(converter_initialize): Initialise result string in count context.
	(_count_added, _count_bytes): Remove.
	(add_text_to_count): Make this a simple wrapper around _stream_output
	with comment to remove in future.
	(update_count_context): Remove function.  Callers updated.
	(add_location, _update_locations_counts): Call _stream_byte_count
	to get byte count, rather than accessing count context hash
	directly.

	* tp/Texinfo/Convert/Plaintext.pm (_convert_output_unit): Update.
	Clear current result string before converting.
	(_convert_tree): Update.  Use a new count context to capture
	conversion result.
	(_convert_line_new_context): Return encoded text.  Return display
	width as well as end line count of result.  Callers updated.
	(_string_width_encoded): New.
	(_convert) <multitable row>,
	(process_printindex, _text_heading): Use _string_width_encoded
	to get display width of already-encoded text.
	(convert_new_context): New.
	(_convert) <menu_entry_node, menu_entry_name>:
	Use convert_new_context to capture result of conversion.

	* tp/Texinfo/Convert/Plaintext.pm (ensure_end_of_line): Do not
	take a string argument; instead, check the output stream for an
	end of line.
	(_align_lines): Take a text argument that is already encoded.
	(_align_environment): Do not update byte count, as it is done in
	calling code.
	(node_name): Encode the returned node name.  Return column
	width of result, rather than byte count.  Callers updated.

	* tp/Texinfo/Convert/Plaintext.pm (_convert, convert_line)
	(_add_newline_if_needed, process_footnotes, format_contents)
	(_menu, process_printindex, format_node, _anchor)
	(ensure_end_of_line, _text_heading),
	* tp/Texinfo/Convert/Info.pm (format_node): Do not return any
	return value.  Call _stream_output or _stream_output_encoded
	with text to be added to the result of the conversion.

	* tp/Texinfo/Convert/Info.pm (output): Update to use new
	_stream_output interface.
	(_info_header): Return an encoded string and do not change
	the current count context.

	* tp/Texinfo/Convert/Plaintext.pm (_decode): New function.
	* tp/Texinfo/Convert/Info.pm (format_node): Use _decode for
	printing an error message using an already encoded node name.

	* tp/Texinfo/Translations.pm (gdt_string_columns, gdt_string_encoded):
	Rename to gdt_string_encoded, and encode the returned string.

	* tp/Texinfo/Common.pm (output_files_disable_encoding):
	Add function to disable encoding of output, as the output from
	the converter is already encoded.
	(output_files_open_out): Obey this setting.
	* tp/Texinfo/Convert/Plaintext.pm (converter_initialize):
	Call output_files_disable_encoding.

2024-01-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (item_line_parent): use
	element_builtin_cmd.

	* tp/Texinfo/XS/main/utils.c (informative_command_value): if there is
	only one rawline argument, returns it.  Return a newly allocated
	text only if there is more than one argument.  In that case, the
	returned text won't be freed, but this is not an issue as it could
	only happen with @set, which is ignored.

	Add, modify, change status of TODO/FIXME.

2024-01-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs: add warn
	strings fior all the functions that are fully overriden, and modify
	comments for the other functions.

2024-01-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Transformations.pm (_new_node): if $XS_structuring, abort
	as the output cannot be correct.

	* tp/t/automatic_nodes.t ($XS_structuring): set $XS_structuring
	instead of $with_XS and skip tests calling _new_node if
	$XS_structuring is set.  Update comment on _new_node.

2024-01-14  Patrice Dumas  <pertusus@free.fr>

	* Texinfo/Convert/Converter.pm, Texinfo/Structuring.pm: add explicit
	scalar().

2024-01-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Text.pm (_convert): switch arguments and make
	options argument non optional.

2024-01-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES),
	tp/Texinfo/XS/main/option_types.h (enum direction_unit_direction)
	(FIRSTINFILE_*, NODE_DIRECTIONS_OFFSET, NON_SPECIAL_DIRECTIONS_NR)
	(enum button_specification_type, enum button_information_type)
	(enum button_function_type, BUTTON_SPECIFICATION_LIST)
	(BUTTON_SPECIFICATION_INFO, BUTTON_SPECIFICATION, BUTTON_FUNCTION)
	(FORMATTED_BUTTON_INFO, DIRECTION_ICON_LIST, OPTION),
	tp/maintain/regenerate_C_options_info.pl: move definitions related to
	an option to a separate header file, option_types.h.  Update users.

2024-01-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/call_perl_function.c
	(call_nodenamenormalization_unicode_to_transliterate)
	(call_latex_convert_to_latex_math): convert returned strings to UTF-8.
	Use strndup instead of strdup using the len set by SvPV* functions.

	* tp/Texinfo/Convert/Texinfo.pm: move functions around.

	* tp/Texinfo/XS/convert/ConvertXS.xs (plain_texinfo_convert_tree): set
	warning string get_sv_tree_document argument.

2024-01-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (ConvertXS_la_SOURCES),
	tp/Texinfo/XS/convert/ConvertXS.xs (text_convert_tree): call directly
	convert_to_text. remove convert/convert_text.c.

	* tp/Texinfo/XS/main/convert_utils.c (encoded_input_file_name),
	tp/Texinfo/XS/main/utils.c (get_encoding_conversion, decode_string)
	(encode_string): add some const.

2024-01-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (ConvertXS_la_SOURCES),
	tp/Texinfo/XS/convert/ConvertXS.xs (plain_texinfo_convert_tree):
	remove convert/convert_plain_texinfo.c, call convert_to_texinfo
	directly.

2024-01-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/call_html_perl_function.c: use strndup instead
	of strdup and text_append_n instead of text_append using the len
	set by SvPV* functions.

2024-01-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_file_id_setting*): use newSVpv_utf8 to pass strings if they
	could be encoded, and convert returned strings to UTF-8.

2024-01-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/targets.c (set_labels_identifiers_target)
	tp/Texinfo/XS/main/tree_types (LABEL),
	tp/Texinfo/XS/parsetexi/labels.c (register_label): if a label element
	is a duplicate, add a reference to the element used in the LABEL
	structure used in labels_lists.

	* tp/Texinfo/XS/convert/convert_html.c
	(set_root_commands_targets_node_files): use labels_lists instead of
	identifiers_target to set up targets to process in the document order,
	to have less sorting to do later on in sort_cmd_targets.

2024-01-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_no_arg_command): use
	letter_no_arg_commands to determine if the command name upper-cased
	string is a command name too.

	* tp/Texinfo/XS/convert/converter.c
	(no_brace_command_accent_upper_case): mapping of lower case letter no
	arg commands to the corresponding upper case commands.

	* tp/Texinfo/XS/convert/convert_html.c (HTML_COMMAND_STRUCT)
	(convert_no_arg_command, css_string_convert_no_arg_command)
	(html_format_init): add upper case command information in
	HTML_COMMAND_STRUCT based on no_brace_command_accent_upper_case.

2024-01-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c
	(register_document_convert_index_text_options),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs
	(setup_index_entry_keys_formatting): free previously set
	convert_index_text_options before replacing.

	* tp/Texinfo/XS/convert/convert_html.c (add_to_unit_file_name_paths):
	simplify.

	* tp/Texinfo/XS/convert/convert_html.c (html_set_pages_files): use
	unit_file_name_paths entry directly as filename.

	* tp/Texinfo/XS/convert/convert_html.c (html_convert_output): call
	text_reset only if needed.

	* tp/Texinfo/XS/convert/convert_html.c (html_convert_output): setup
	conversion to output encoding only if it is not utf-8.

2024-01-12  Patrice Dumas  <pertusus@free.fr>

	* NEWS: add the converters in C and use of TEXINFO_XS_CONVERT
	environment variable to NEWS, now that the HTML C conversion code is
	complete.

2024-01-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/unicode.h (DIACRITIC_UNICODE),
	tp/maintain/setup_converters_code_tables.pl (unicode_diacritics): add
	hexadecimal representation of diacritics to the unicode_diacritics
	table.

	* tp/Texinfo/XS/convert/convert_html.c
	(set_case_if_only_word_characters)
	(html_accent_entities_html_accent_internal)
	(after_escaped_characters, css_string_accent)
	(css_string_convert_accent_command, html_converter_initialize):
	implement css_string_convert_accent_command in C.  Create
	set_case_if_only_word_characters based on
	html_accent_entities_html_accent_internal tu use common code.

2024-01-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c: make two functions static.

2024-01-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Text.pm: move functions around.

	* tp/Texinfo/XS/main/convert_to_text.c (text_brace_no_arg_command):
	rename brace_no_arg_command as text_brace_no_arg_command.

	* tp/Texinfo/XS/main/convert_to_text.c: move code around, make
	functions static or declare them in .h.

2024-01-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/indices_in_conversion.c
	(index_entry_element_sort_string): always initialize returned text to
	the empty string.

2024-01-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (xml_accent),
	tp/Texinfo/Convert/HTML.pm (_css_string_accent),
	tp/Texinfo/Convert/NodeNameNormalization.pm (_convert): do not use
	ascii_accent as a last resort formatting, return directly the accent
	command argument as the last resort situation should only happen with
	dotless and a non recognized argument for dotless.

	* tp/Texinfo/Convert/Text.pm (_ascii_accent): make ascii_accent
	private, renamed to _ascii_accent.

	* tp/Texinfo/Convert/Text.pm (@text_indicator_converter_options):
	remove 'DEBUG', it is never used.

	* tp/Texinfo/Convert/Text.pm: remove error() function as converters
	are no longer Texinfo::Report objects.

2024-01-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (%XS_overrides, %XS_convert_overrides)
	($XS_convert, import): override index_entry_element_sort_string and
	setup_index_entry_keys_formatting only if XS is used for conversion.

2024-01-10  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi b/doc/texinfo.texi (@code{@@link}): add a missing
	not.  Replace these by some as it is not clear what these refers to.

2024-01-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (setup_sortable_index_entries): remove the
	$silent argument, not used.

	* tp/Texinfo/XS/main/utils.c (set_expanded_formats_from_options): add
	to be able to set expanded formats based on EXPANDED_FORMATS
	customization option, without a converter information.

	* tp/Texinfo/XS/convert/indices_in_conversion.c
	(index_entry_element_sort_string), tp/Texinfo/XS/main/get_perl_info.c
	(find_index_entry_sv, get_sv_index_entries_sorted_by_letter),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs
	(index_entry_element_sort_string): return as reference the INDEX in
	find_index_entry_sv.  Pass in_code argument to
	index_entry_element_sort_string and use it to modify the text options
	directly in the function.

	* tp/Texinfo/XS/main/convert_to_text.c (copy_options_for_convert_text)
	(copy_converter_options_for_convert_text, destroy_text_options), 
	tp/Texinfo/XS/main/convert_to_text.h (TEXT_OPTIONS),
	tp/Texinfo/XS/main/get_perl_info.c (converter_initialize): use OPTIONS in
	copy_options_for_convert_text argument, and add another variant with a
	converter in argument, copy_converter_options_for_convert_text.

	* tp/Texinfo/XS/main/document.c
	(register_document_convert_index_text_options)
	(destroy_document_information_except_tree),
	tp/Texinfo/XS/convert/converter.c (free_generic_converter),
	tp/Texinfo/XS/main/document_types.h (DOCUMENT),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): add
	convert_index_text_options to register text options used for index
	sorting keys conversion.

	* tp/Texinfo/Structuring.pm (%XS_overrides),
	tp/Texinfo/XS/main/convert_to_text.c
	(set_additional_index_entry_keys_options)
	(setup_index_entry_keys_formatting)
	(setup_converter_index_entry_keys_formatting),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs
	(setup_index_entry_keys_formatting, index_entry_element_sort_string):
	add an override for setup_index_entry_keys_formatting that triggers
	initializing TEXT_OPTIONS for a converter or a document to be used for
	index sorting in index_entry_element_sort_string.

	* tp/t/test_sort.t: call register_XS_document_main_configuration to
	have the customization available in document for the
	setup_index_entry_keys_formatting override.

2024-01-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (copy_strings, set_conf_string)
	(set_informative_command_value): add copy_strings and set_conf_string
	functions.  Use set_conf_string in set_informative_command_value.

	* tp/Texinfo/XS/main/convert_to_text.c
	(copy_options_for_convert_text): allocate text options fields that can
	be reset if converter options are reset.

	* tp/Texinfo/XS/main/convert_to_text.c
	(copy_options_for_convert_text, text_set_options_encoding)
	(text_set_options_encoding_if_not_ascii, text_reset_options_encoding):
	remove copy_options_for_convert_text enable_encoding_if_not_ascii
	argument.  Add text_set_options_encoding,
	text_set_options_encoding_if_not_ascii and text_reset_options_encoding
	to modify text options encoding field.

	* tp/Texinfo/XS/convert/convert_html.c (external_node_href)
	(convert_def_line_type, html_prepare_converted_output_info)
	(convert_to_html_internal), tp/Texinfo/XS/convert/converter.c
	(free_generic_converter), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER), tp/Texinfo/XS/main/get_perl_info.c
	(converter_initialize): add convert_text_options field to the
	CONVERTER, set it in converter_initialize and free it in
	free_generic_converter.  Use those text options in HTML formatting and
	use the new text_*set_options* functions to set and reset the text
	options, instead of settng up new text options each time one is used.

	* tp/Texinfo/XS/main/get_perl_info.c (converter_initialize),
	tp/Texinfo/XS/main/utils.c (set_output_encoding): implement
	set_output_encoding without setting the perl specific variable.  Set
	output encoding early enough to have it available for
	copy_options_for_convert_text call, as the corresponding perl function
	is called just ater.

2024-01-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Text.pm (copy_options_for_convert_text): replace
	the $enable_encoding_if_not_ascii argument by additional options
	argument.  Change return to be a reference on an hash, not an hash.
	Update callers.

2024-01-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_formatting_state): do not return anything.  This probably
	fixes a wrong refcount too.

2024-01-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (converter),
	tp/Texinfo/Convert/LaTeX.pm (converter_initialize),
	tp/Texinfo/Convert/Plaintext.pm (converter_initialize): set
	'convert_text_options' conversion to text options state with
	copy_options_for_convert_text, to be used in converters instead of
	calling copy_options_for_convert_text each time conversion to text
	options are needed.  Remove the equivalent code from specific
	converters.

	* tp/Texinfo/Convert/Text.pm (set_options_code, reset_options_code)
	(set_options_encoding_if_not_ascii, set_options_encoding)
	(reset_options_encoding, convert_to_text),
	tp/Texinfo/XS/main/get_perl_info.c (copy_sv_options_for_convert_text):
	add functions to modify the conversion to text options without redoing
	the whole options hash.  Do not use 'code' in text options to set
	code, only set_options_code().

	* tp/Texinfo/Convert/DocBook.pm, tp/Texinfo/Convert/HTML.pm,
	tp/Texinfo/Convert/IXIN.pm, tp/Texinfo/Convert/Info.pm,
	tp/Texinfo/Convert/LaTeX.pm, tp/Texinfo/Convert/Plaintext.pm,
	tp/Texinfo/Convert/TexinfoMarkup.pm,
	tp/Texinfo/Convert/TextContent.pm, tp/Texinfo/Structuring.pm,
	tp/ext/epub3.pm, tp/ext/highlight_syntax.pm, tp/init/chm.pm: do not
	use copy_options_for_convert_text in converters, instead use converter
	'convert_text_options' and modify it and reset it with the
	set_options_* and reset_options_* new functions of
	Texinfo/Convert/Text.pm.

2024-01-08  Patrice Dumas  <pertusus@free.fr>

	* tp/t/accents.t: initialize converter with
	_initialize_XS_NonXS_output_state.

2024-01-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs
	(index_entry_element_sort_string): free sort_string.

	* tp/Texinfo/Convert/Text.pm (text_accents, brace_no_arg_command)
	(_convert): use 'set_case' for case, that can be positive for upper
	casing and negative for lower casing instead of 'sc', as in XS.

	* tp/Texinfo/Structuring.pm (setup_sortable_index_entries): rename
	$options as $convert_text_options and set code directly and pass
	$convert_text_options directly instead of copying.

	* tp/Texinfo/Convert/LaTeX.pm (_prepare_indices, _index_entry): set
	index_formatting_text_options state once for all in _prepare_indices
	instead of for each index entry.  Set code directly in the state and
	pass the state insetad of copying it in _index_entry.

	* tp/Texinfo/XS/main/convert_to_text.c (destroy_text_options),
	tp/Texinfo/XS/main/get_perl_info.c (copy_sv_options_for_convert_text):
	if an XS converter is associated to the text optins, set it in
	TEXT_OPTIONS and directly use its conf for other_converter_options. Do
	not destroy other_converter_options if converter is set. 
	Set self_converter_options only if other_converter_options is not set.

	* tp/Texinfo/XS/main/convert_to_text.c (text_accents_options)
	(text_options): use static text_accents_options in text_options
	instead of allocating and freeing.

2024-01-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (setup_index_entry_keys_formatting):
	remove ascii_punctuation obsolete option set.

	* tp/Texinfo/Structuring.pm (index_entry_element_sort_string)
	(_index_entry_element_sort_string_key)
	(setup_sortable_index_entries), tp/t/test_sort.t, tp/t/test_utils.pl:
	add an argument with document information for XS for
	index_entry_element_sort_string and
	_index_entry_element_sort_string_key to retrieve the document
	descriptor in XS.  Use setup_sortable_index_entries
	$customization_information as a source of that information.  If it is
	a converter based on Texinfo::Convert::Converter, the information is
	there, if not, it needs to be added explcitely.  Add the information
	explicitly setting 'document_descriptor' to
	document->document_descriptor() in test_sort.t and test_utils.pl.

	* tp/Texinfo/XS/convert/indices_in_conversion.c
	(index_entry_element_sort_string): implement in C.

	* tp/Texinfo/XS/main/get_perl_info.c (find_index_entry_sv): add based
	on get_sv_index_entries_sorted_by_letter code.

	* tp/Texinfo/XS/main/get_perl_info.c
	(copy_sv_options_for_convert_text): get 'code' from perl.

	* tp/Texinfo/XS/main/get_perl_info.c (find_index_entry_subentry)
	(subentry_hv_parent, find_subentry_index_command_sv)
	(find_element_from_sv): find subentry C element based on perl element,
	by finding the 'subentry parent' index entry C element going down
	subentry levels, and then find the C subentry element going up
	subentry levels.

	* tp/Texinfo/XS/main/get_perl_info.c
	(find_element_extra_index_entry_sv)
	(find_index_entry_associated_hv, find_element_from_sv): have
	find_element_extra_index_entry_sv return an index entry, such that the
	caller can find the element based on entry_associated_element or
	entry_element.  Add find_index_entry_associated_hv to go through both
	entry_associated_element and entry_element to find the C element
	associated to a perl element.  Use that code in find_element_from_sv.

	* tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs
	(index_entry_element_sort_string): XS interface for
	index_entry_element_sort_string.  Not used as it is slower than the
	perl...

	* tp/Texinfo/XS/main/get_perl_info.c (debug_print_element_hv)
	(debug_print_element_sv): add debug functions that print information
	on perl tree elements.

2024-01-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_printindex_command):
	always free entry_tree, found with valgrind.

2024-01-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_printindex_command),
	tp/Texinfo/XS/convert/convert_html.c (convert_printindex_command):
	convert subentries with seealso and seeentry too.

2024-01-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_handle_close_brace),
	tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace): asociate
	seealso and seeentry to the main index entry only, not to @subentry.

2024-01-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm
	(_set_non_ignored_space_in_index_before_command): fix a variable name.

2024-01-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line),
	tp/Texinfo/ParserNonXS.pm (_end_line_misc_line): call
	_set_non_ignored_space_in_index_before_command in any case, enven is
	there is no extra information on @-commands letting
	space_in_index_before_command to be more independent of the extra
	information and where it is stored.

	* tp/Texinfo/ParserNonXS.pm (_end_line_misc_line)
	(_set_non_ignored_space_in_index_before_command): pass an argument to
	_set_non_ignored_space_in_index_before_command and change variable
	names.

2024-01-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_handle_line_command),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command): add
	'subentry_parent' for @subentry to be able to easily find the
	containing subentry or index entry.

	* tp/Texinfo/ParserNonXS.pm (_handle_close_brace),
	tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace): associate the
	@seeentry and @seealso to the main index entry command in addition to
	a @subentry.

	* tp/Texinfo/Convert/LaTeX.pm (_index_entry): update to the change in
	tree.

	* tp/t/09indices.t (seealso_duplicate): also add a duplicate entry
	with @seeentry.

2024-01-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (index_entry_element_sort_string)
	(_index_entry_element_sort_string_key, setup_sortable_index_entries):
	replace index_entry_sort_string by index_entry_element_sort_string,
	using the element associated to the index entry or @subentry as
	argument, and determining the sortas and content in the function.
	Update callers.

	* tp/Texinfo/Convert/LaTeX.pm (_index_entry): simplify code by using
	only an array of index entry element commands, for the main entry and
	the @subentry.  Rename variables.

2024-01-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_find_element_from_sv), tp/Texinfo/XS/main/get_perl_info.c
	(find_sorted_index_names_index_entry_extra_index_entry_sv)
	(find_document_index_entry_extra_index_entry_sv)
	(find_element_extra_index_entry_sv, find_root_command)
	(find_element_from_sv): separate HTML specific code from
	find_element_from_sv and move generic code to get_perl_info.c. Rename
	the function in get_html_perl_info.c as html_find_element_from_sv.
	Update callers.
	Merge find_index_entry_numbers_extra_index_entry_sv in
	find_index_entry_extra_index_entry_sv and rename
	find_index_entry_extra_index_entry_sv as
	find_sorted_index_names_index_entry_extra_index_entry_sv.  Add
	find_document_index_entry_extra_index_entry_sv to find index entry
	element based on on DOCUMENT only.

2024-01-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (index_entry_sort_string)
	(_index_entry_sort_string_key): have index_entry_sort_string return
	only the sort_string, not the sort_key used from the collator.  Add
	_index_entry_sort_string_key that returns both the sort_string and the
	sort_key, meant to be used internally only.  Update callers.

	* tp/Texinfo/Convert/LaTeX.pm (_index_entry): rename $sortas as
	$sort_string.

2024-01-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/get_perl_info.c
	(copy_sv_options_for_convert_text): use a FETCH macro to simplify
	code.

	* tp/Texinfo/Convert/Text.pm (convert_to_text, output),
	tp/Texinfo/XS/convert/ConvertXS.xs (text_convert_tree),
	tp/Texinfo/XS/main/get_perl_info.c (copy_sv_options_for_convert_text):
	pass text options directly to XS.  Remove select_text_options.  Remove
	code that cannot be reached.

2024-01-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_converter_initialize),
	tp/Texinfo/options_data.txt (XS_EXTERNAL_CONVERSION)
	(XS_EXTERNAL_FORMATTING), tp/t/test_utils.pl, tp/texi2any.pl:
	add customization variables that can also be set through environment
	variables to have perl and not C code used for formatting functions,
	with XS_EXTERNAL_FORMATTING set, and for conversion functions, with
	XS_EXTERNAL_CONVERSION set.  Not documented for now, not clear if this
	should be kept in the long term.

2024-01-06  Gavin Smith <gavinsmith0123@gmail.com>

	* util/dir-example: Change Karl's email address to
	bug-texinfo@gnu.org.

2024-01-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/t/init/test_css_info_functions.pm,
	tp/Makefile.tres, tp/t/html_tests.t (base_for_css_info_in_init_test)
	(text_css_info_in_init): add text_css_info_in_init, a test of
	css_add_info and css_set_selector_style use, and a test without the
	init file used, base_for_css_info_in_init_test, for comparison.

2024-01-06  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Simple Customization of CSS),
	tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides)
	(css_get_selector_style), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_css_get_selector_style), tp/Texinfo/XS/convert/convert_html.c
	(html_css_get_selector_style): rename *css_selector_style functions as
	*css_get_selector_style.

2024-01-06  Patrice Dumas  <pertusus@free.fr>

	* tp/t/18itemize.t (enumerate_argument, enumerate_argument_item):
	add test of @enumerate 0.

2024-01-06  Patrice Dumas  <pertusus@free.fr>

	* po/Makevars (XGETTEXT_OPTIONS): fix index of
	message_list_command_warn and message_list_command_error, add
	message_list_document_*, noticed_line_warn and
	message_list_line_error_ext.

	* po/POTFILES.in: add tp/Texinfo/XS/convert/convert_html.c.

	update po files.

2024-01-06  Patrice Dumas  <pertusus@free.fr>

	update po files

2024-01-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/transformations.c
	(reference_to_arg_internal, reference_to_arg_in_tree): add document as
	argument to reference_to_arg_in_tree and reference_to_arg_internal.
	Update callers.  Remove destroyed element from
	document->internal_references.

2024-01-06  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/Makefile.am (AM_TESTS_ENVIRONMENT): set for out
	of source builds.

	* Pod-Simple-Texinfo/pod2texi.pl (BEGIN): Pod-Simple-Texinfo is
	not in builddir, but in srcdir.

	* Pod-Simple-Texinfo/prove.sh,
	Pod-Simple-Texinfo/t/Pod-Simple-Texinfo.t (BEGIN): use a similar setup
	as for other scripts to find the perl modules.

2024-01-06  Patrice Dumas  <pertusus@free.fr>

	Fix memory leaks found with valgrind

	* tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_css_lines): destroy css_element_classes.

	* tp/Texinfo/XS/convert/convert_html.c (convert_printindex_command):
	do not reset multiple_pass_str.

	* tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_node_redirection_page, convert_style_command)
	(convert_def_line_type): free/destroy variables.

	* tp/Texinfo/XS/convert/convert_html.c (html_free_converter): free css
	info data.

2024-01-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_default_format_button): avoid 2 if for
	the most common case of ICONS not being set, instead recopy code.

2024-01-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (preformatted_cmd_list)
	(html_format_init, html_converter_initialize): use a COMMAND_STACK for
	preformatted_cmd, rename as preformatted_cmd_list and let the
	functions allocate memory.

	* tp/Texinfo/XS/convert/convert_html.c (convert_def_command)
	(commands_internal_conversion_table, def_cmd_list, html_format_init)
	(html_converter_initialize): put def commands command_id in
	def_cmd_list, implement convert_def_command and use it.

2024-01-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_def_command): move code to be
	with other commands conversion.

	* tp/Texinfo/XS/convert/convert_html.c (convert_def_item_type)
	(convert_table_definition_type, types_internal_conversion_table):
	implement convert_def_item_type and convert_table_definition_type in
	C.

2024-01-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/options_data.txt (CSS_REFS): set type to char_string_list
	as it is decoded in the main program.

	* tp/maintain/regenerate_C_options_info.pl: fix the name of
	char_string_list.

	* tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_css_lines): fix output and css_element_classes can
	be 0.

	* tp/Texinfo/XS/convert/convert_html.c (format_css_lines): use
	html_default_format_css_lines.

2024-01-06  Patrice Dumas  <pertusus@free.fr>

	XS interface for getting/setting CSS information

	* tp/Texinfo/Convert/HTML.pm (_prepare_css): use css_add_info
	instead of accessing directly css_rule_lines and css_import_lines.

	* tp/Texinfo/XS/convert/convert_html.c (sort_css_element_class_styles)
	(html_css_set_selector_style, html_css_selector_style)
	(html_css_add_info, html_css_get_info),
	tp/Texinfo/XS/convert/convert_html.h (enum css_info_type),
	tp/Texinfo/XS/main/converter_types.h (CSS_SELECTOR_STYLE_LIST)
	(CONVERTER): add functions and data fields to implement the css
	information getting/setting interface.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides)
	(_initialize_output_state), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_css_add_info, html_css_set_selector_style, html_css_get_info)
	(html_css_selector_style), tp/Texinfo/XS/convert/convert_html.c
	(css_info_type_names, html_converter_initialize)
	(html_converter_prepare_output),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv, html_converter_prepare_output_sv)
	(html_get_css_info_spec): add an XS interface for css information
	setting/getting.  Get css_element_class_styles earlier from perl.

	* tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_css_lines): implement.  Not used.

2024-01-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_default_format_node_redirection_page):
	convert the body before the header in case there is CSS to be
	collected.  Add filename argument.

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_formatting_function_format_node_redirection_page): add.

	* tp/Texinfo/XS/convert/convert_html.c (add_new_css_page)
	(collect_css_element_class, html_get_css_elements_classes)
	(html_set_pages_files, setup_output_simple_page)
	(html_reset_converter), tp/Texinfo/XS/main/converter_types.h
	(PAGES_CSS_LIST): add the possibility to add more files to
	self->page_css in addition to output files.  Use page_name for those
	file names, otherwise it is 0 for output units found with their
	number/index.  Only use the latest added file, under the assumption
	that each file not associated to output units are processed
	sequentially.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides)
	(_prepare_node_redirection_page, output),
	tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_node_redirection_page),
	tp/Texinfo/XS/convert/convert_html.c
	(html_prepare_node_redirection_page, format_node_redirection_page):
	setup a function to be overriden and an override wrapping setting the
	current file and calling format_node_redirection_page.

	* tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_node_redirection_page,
	format_node_redirection_page): implement in C.

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/html_tests.t
	(css_in_node_redirection_page),
	tp/t/init/css_in_node_redirection_page.pm: test CSS in node
	redirection file.

2024-01-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_printindex_command):
	create entry_ref_tree only after making sure that the entry is
	formatted.

2024-01-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_float_command)
	(convert_quotation_command): free cancelled
	pending_formatted_inline_content.

	* tp/Texinfo/XS/convert/convert_html.c (convert_printindex_command):
	destroy elements created for subentries formatting.

2024-01-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_default_format_element_footer):
	rearrange code for rules.  Make a condition clearer.

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_formatting_function_format_element_footer): make element
	argument const.

	* tp/Texinfo/XS/convert/convert_html.c: move functions round.

	* tp/Texinfo/XS/convert/convert_html.c (word_number_more_than_level)
	(html_default_format_element_footer, format_element_footer): implement
	html_default_format_element_footer.

2024-01-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(prepare_index_entries_targets): do not reset the parent of the index
	element.

	* tp/Texinfo/XS/convert/convert_html.c
	(html_accent_entities_html_accent_internal, convert_item_command)
	(convert_tab_command, convert_preformatted_type, convert_row_type),
	tp/Texinfo/XS/main/unicode.c (unicode_accent): call
	element_builtin_cmd where a command could be user-defined.

	* tp/Texinfo/XS/convert/convert_html.c (convert_item_command)
	(convert_printindex_command): free variables (found with valgrind).

	* tp/Texinfo/XS/convert/convert_html.c (convert_to_html_internal):
	improve debug messages.

2024-01-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_default_format_element_footer): to
	count word split at splaces only, no need to have true words in
	the array, it is only used for the counting.

2024-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_menu_comment_type)
	(convert_before_item_type, types_internal_conversion_table): implement
	convert_menu_comment_type and convert_before_item_type.

2024-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_menu_entry_type): use a
	condition with node_content before using it.

2024-01-04  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert) <process contents>:
	Remove zeroing of 'empty_lines_count' from here for 'preformatted'
	and 'rawpreformatted' elements also.
	<close preformatted>: Move it into a code block dealing with
	other preformatted content.  Base the zeroing on inspection of
	the document tree rather than conversion output.

2024-01-04  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert) <process contents>:
	Limit zeroing of 'empty_lines_count' to elements of type 'preformatted'
	or 'rawpreformatted'.  Previously, this code was also used
	for processing the contents of whole @menu blocks (as the local
	variable '$preformatted' was set) but the two cases are quite
	different and not well handled by the same code.
	(_convert) <menu_entry>:
	Unconditionally zero $self->{'empty_lines_count'} when processing
	the 'menu_entry' element itself, which is contained within the
	@menu block.

2024-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_menu_entry_type): do not
	replace the menu_description with the nodedescription derived
	elements.  Avoid using contents and not element.  Rearrange code.

	* tp/Texinfo/XS/convert/convert_html.c (menu_entry_a)
	(simplify_text_for_comparison, convert_menu_entry_type)
	(types_internal_conversion_table): implement convert_menu_entry_type.

	* tp/Texinfo/XS/convert/convert_html.c (html_translate_names):
	reindent.

2024-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_definfoenclose_type)
	(convert_multitable_head_type, convert_multitable_body_type)
	(types_internal_conversion_table): implement
	convert_definfoenclose_type, convert_multitable_head_type and
	convert_multitable_body_type.  Move code around.

2024-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_balanced_braces_type)
	(convert_index_entry_command_type, types_internal_conversion_table):
	implement convert_balanced_braces_type and
	convert_index_entry_command_type.

2024-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (free_option): free icons and strings,
	found with valgrind.

2024-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_preformatted_class): fix prototype.

	* tp/Texinfo/Convert/HTML.pm (_convert_preformatted_type): rearrange
	code.

	* tp/Texinfo/XS/convert/convert_html.c (trim_trailing_content): add
	from convert_tab_command.

	* tp/Texinfo/XS/convert/convert_html.c (convert_paragraph_type):
	change code to use a TEXT and free memory in all the situations.

	* tp/Texinfo/XS/convert/convert_html.c (preformatted_class)
	(convert_preformatted_type, types_internal_conversion_table):
	add preformatted_class, implement convert_preformatted_type.

2024-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_paragraph_type),
	(types_internal_conversion_table): implement convert_paragraph_type.

2024-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm, tp/Texinfo/XS/convert/convert_html.c:
	move functions around, to group better commands formatting and types
	formatting.

2024-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_default_format_button)
	(_default_format_special_body_about): avoid calling get_conf multiple
	times.

2024-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (html_build_direction_icons):
	return the icon as value.

	* tp/maintain/regenerate_C_options_info.pl (build_sv_option): return
	icons.

	* tp/Texinfo/Convert/HTML.pm (_default_format_special_body_about):
	check if get_conf('ACTIVE_ICONS') is defined before using it.

2024-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_XS_reset_output_init_conf),
	tp/Texinfo/XS/convert/ConvertXS.xs (reset_output_init_conf),
	tp/Texinfo/XS/main/get_perl_info.c (reset_output_init_conf): remove
	warn_string argument of reset_output_init_conf, always use one.

2024-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_XS_reset_output_init_conf): define for
	Non XS.

	* tp/Texinfo/XS/main/utils.c (set_informative_command_value):
	rearrange code.

	* tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_converted_output_info): do not copy configuration from
	perl, it should be already set in XS through the overriden functions.

	* tp/Texinfo/XS/main/get_perl_info.c (init_copy_sv_options)
	(copy_converter_conf_sv): rename copy_sv_options as
	init_copy_sv_options and recopy_converter_conf_sv as
	copy_converter_conf_sv.  Update callers.

	* tp/Texinfo/XS/main/get_perl_info.c (copy_converter_conf_sv)
	(html_get_direction_icons_sv), tp/Texinfo/XS/main/utils.c
	(html_clear_direction_icons, clear_option),
	tp/maintain/regenerate_C_options_info.pl (clear_options): add the
	possibility to clear options without freeing them with clear_option
	and clear_options.  Do that in copy_converter_conf_sv if the conf is
	already set.  Allocate icons in html_get_direction_icons_sv only if
	the number was 0.

	* tp/Texinfo/XS/main/get_perl_info.c (get_sv_options)
	(get_sv_configured_options, copy_converter_conf_sv, set_conf)
	(force_conf), tp/maintain/regenerate_C_options_info.pl
	(set_option_key_configured): separate setting configured field, with
	get_sv_configured_options and set_option_key_configured, from setting
	options values.  Add a force argument to functions to force setting
	options by ignoring the option configured field if set.

	* tp/Texinfo/XS/main/get_perl_info.c (converter_initialize):
	call directly new_options and call copy_converter_conf_sv to copy
	options values.

2024-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (converter, set_conf),
	tp/Texinfo/XS/convert/converter.c (set_global_document_commands),
	tp/Texinfo/XS/main/converter_types.h (OPTION),
	tp/Texinfo/XS/main/get_perl_info.c (get_sv_options),
	tp/Texinfo/XS/main/utils.c (set_informative_command_value),
	tp/maintain/regenerate_C_options_info.pl: rename 'set'
	as 'configured'.

2024-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv): call recopy_converter_conf_sv in
	html_converter_initialize_sv as soon as format specific information
	has been gathered.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides)
	(_XS_reset_output_init_conf, output),
	tp/Texinfo/XS/convert/ConvertXS.xs (reset_output_init_conf)
	(html_prepare_conversion_units), tp/Texinfo/XS/main/get_perl_info.c
	(reset_output_init_conf): add a specific override,
	reset_output_init_conf called after 'output_init_conf' is reset
	instead of doing it in html_prepare_conversion_units.
	Remove set_output_converter_sv, which did it previously.

2024-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (copy_option, new_option_value)
	(command_init, set_global_document_commands): simplify command_init
	by simply copying the option.  Properly initialize all the fields in
	new_option_value.  Add copy_option to copy an option in another and
	use it in set_global_document_commands.  Only copy option if set field
	is not on.

2024-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.h: remove COMMAND_OPTION_REF and
	COMMAND_OPTION_VALUE that are not used anymore.

2024-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (build_string_list)
	(html_build_direction_icons): add.

	* tp/Texinfo/XS/main/converter_types.h (enum sv_string_type):
	move to converter_types.h.

	* tp/Texinfo/XS/*/*.c, tp/Texinfo/XS/convert/converter.c
	(new_option_value, command_init, set_global_document_commands),
	tp/Texinfo/XS/main/converter_types.h (enum global_option_type)
	(OPTION), tp/Texinfo/XS/main/utils.c (set_informative_command_value)
	(new_options, free_option, initialize_option),
	tp/Texinfo/XS/main/utils.h, tp/Texinfo/options_data.txt,
	tp/maintain/regenerate_C_options_info.pl,
	tp/maintain/regenerate_perl_options_info.pl: modify OPTIONS structure
	to have an intermediate OPTION structure that is a union of the
	possible types instead of the value being directly in OPTIONS.  rename
	enum global_option_command_type as enum global_option_type and add all
	the possible types of global options.  Use the types of
	global_option_type in options_data.txt instead of C types.  Add
	free_option and initialize_option to handle all the possible types.

	* tp/Texinfo/Convert/Converter.pm (%XS_overrides, _XS_force_conf)
	(force_conf, _XS_get_conf, get_conf, converter),
	tp/Texinfo/XS/convert/ConvertXS.xs (force_conf, get_conf),
	tp/Texinfo/XS/main/build_perl_info.c (get_conf),
	tp/Texinfo/XS/main/get_perl_info.c (get_sv_options, copy_sv_options)
	(recopy_converter_conf_sv, set_conf, force_conf),
	tp/Texinfo/XS/main/utils.c (set_informative_command_value),
	tp/maintain/regenerate_C_options_info.pl: use XS to access
	customization variables preferrentially to make sure that perl and XS
	are synchronized.  Override get_conf, and use a specific override for
	force_conf.  Reorganize converter function code to use get_conf only
	when the XS converter has been initialized.  Generate build_sv_option
	for get_conf.  Add set field in OPTION to avoid overriding the value
	if not called as force_conf.  Set set field based on perl value in
	converter.

	* tp/Texinfo/XS/convert/convert_html.c (convert_informative_command)
	(commands_internal_conversion_table): implement
	convert_informative_command.

2024-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (convert, output): use get_conf instead
	of accessing directly 'conf'.

	* tp/t/accents.t (test_enable_encoding): use set_conf instead of
	accessing directly 'conf'.

2024-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (Commands.pm, Options.pm): have generated files
	depend on the script generating them.

2024-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_enumerate_command):
	output a start of 0 with digits.

	* tp/Texinfo/Convert/HTML.pm (_convert_printindex_command): rearrange
	code.  Avoid using contents separately from elements.  Use an array
	and not an array reference for normalized_entry_levels, renamed as
	prev_normalized_entry_levels.  Rename seenentry as seeentry.  Use
	$subentry_level to determine the last level index early, do not remove
	the last level from @entry_trees.  Redo the loop over levels to use
	only one index variable and use only one loop, not two.

	* tp/Texinfo/XS/convert/convert_html.c
	(get_element_root_command_element): add.

	* tp/Texinfo/XS/convert/convert_html.c (clear_normalized_entry_levels)
	(normalized_upper_case, printindex_letters_head_foot_internal)
	(convert_printindex_command, commands_internal_conversion_table):
	implement convert_printindex_command.

2024-01-03  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (ensure_end_of_line):
	Adjust implementation slightly so not to take a newline off
	before putting one back on.  No functional changes intended.

2023-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_tab_command): reorder code.
	Rename $fraction as $percent.

	* tp/Texinfo/XS/convert/convert_html.c (convert_tab_command)
	(commands_internal_conversion_table): implement convert_tab_command.

2023-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (width_multibyte): start counting from
	the last end of line if there is one, to get the same result as in
	Perl Unicode.pm string_width where count is reset at a newline.

2023-12-31  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert) <menu entries>:
	Correctly include any DEL quoting characters in the count context.

2023-12-31  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Unicode.pm (string_width):
	Reset count at a newline.  Add a comment saying what the
	different character classes mean.

2023-12-31  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Translations.pm (gdt_string_columns): Adjust to
	only count width of text that comes from the translated string,
	itself, not counting substituted text.
	* tp/Texinfo/Convert/Plaintext.pm (_text_heading):
	Count width of heading in three parts: the heading, the number,
	and additional text returned from gdt_string_columns.

	No functional changes intended.

2023-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (get_copiable_anchor): return 0
	if there is no copiable anchor.  Update callers.

	* tp/Texinfo/XS/convert/ConvertXS.xs
	(html_preformatted_classes_stack),
	tp/Texinfo/XS/convert/convert_html.c (HTML_COMMAND_STRUCT)
	(html_preformatted_classes_stack, register_pre_class_command)
	(reset_unset_no_arg_commands_formatting_context)
	(html_open_command_update_context, html_open_type_update_context)
	(html_convert_type_update_context),
	tp/Texinfo/XS/main/converter_types.h (HTML_DOCUMENT_CONTEXT): use a
	COMMAND_OR_TYPE_STACK for preformatted_classes_stack, with a command
	id for a preformatted command and a type id for a preformatted type.
	Turn to strings only when passing to perl.

	* tp/Texinfo/XS/convert/convert_html.c
	(conversion_function_cmd_conversion): new function that selects the
	function called for conversion based on a COMMAND_CONVERSION_FUNCTION
	argument, not on the command id or element argument.  Allows to call a
	conversion function associated to a command conversion different from
	the command id or element arguments.

	* tp/Texinfo/XS/convert/converter.c (new_tree_added_elements)
	(clear_tree_added_elements, free_tree_added_elements)
	(destroy_tree_added_elements, new_element_added): move
	TREE_ADDED_ELEMENTS related functions from convert_html.c to
	converter.c to be usable more generally than in the html converter.

	* tp/Texinfo/XS/convert/converter.c (table_item_content_tree): add.

	* tp/Texinfo/XS/convert/convert_html.c (convert_item_command)
	(commands_internal_conversion_table): implement convert_item_command.

2023-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_item_command): rename $index_id
	as $index_entry_id.

2023-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_get_copiable_anchor): return undef if
	there is no copiable anchor.  Update callers.

	* tp/Texinfo/Convert/HTML.pm (_default_format_heading_text): let
	_get_copiable_anchor determine if there is a copiable anchor or not.

	* tp/Texinfo/Convert/HTML.pm (_convert_item_command): reorganize code
	to set the result in order.

2023-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (table_item_content_tree): do not
	set the parent of the returned element.

2023-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (table_item_content_tree),
	tp/Texinfo/Convert/Plaintext.pm (_convert): remove
	table_item_content_tree contents element, instead always use
	$element->{'args'}->[0] in the function.  Return the @-command
	used to format the item argument directly, undef if there is no
	command_as_argument.  Update callers to set tree to
	$element->{'args'}->[0] if the return value is undef.  Also do not
	modify the element returned in Plaintext.pm.

2023-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_multitable_command)
	(_convert_xtable_command): rearrange code.

	* tp/Texinfo/XS/convert/convert_html.c (convert_multitable_command)
	(convert_xtable_command), commands_internal_conversion_table):
	implement convert_multitable_command and convert_xtable_command.

2023-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_enumerate_command)
	(commands_internal_conversion_table): implement
	convert_enumerate_command.

2023-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_cartouche_command)
	(commands_internal_conversion_table): implement
	convert_cartouche_command.

	* tp/Texinfo/XS/convert/convert_html.c: move convert_itemize_command
	after convert_cartouche_command.

2023-12-31  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Info.pm (output) <Local Variables>:
	Output "Info-documentlanguage" if available.
	* doc/texinfo.texi (Info Format Local Variables): update
	* NEWS: mention

2023-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_quotation_command): rearrange
	for clearer code and to avoid intermediary variable.

	* tp/Texinfo/XS/convert/convert_html.c (convert_quotation_command)
	(commands_internal_conversion_table): implement
	convert_quotation_command.

2023-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (float_name_caption): rename
	$caption as $caption_element.  Use $substrings variable.

	* tp/Texinfo/Convert/HTML.pm (_convert_float_command): rename $caption
	as $caption_element.  Avoid using contents when an element can be
	used.  Reorder code, use less intermediate variables.

	* tp/Texinfo/XS/convert/convert_html.c (convert_float_command)
	(commands_internal_conversion_table),
	tp/Texinfo/XS/convert/converter.c (float_name_caption),
	tp/Texinfo/XS/convert/converter.h (FLOAT_CAPTION_PREPENDED_ELEMENT):
	add float_name_caption, implement convert_float_command.

2023-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_menu_command)
	(commands_internal_conversion_table): implement convert_menu_command.

2023-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_footnote_command):
	remove spurious end of line in identifiers.

	* tp/Texinfo/XS/convert/convert_html.c (convert_titlefont_command):
	destroy classes.

	* tp/Texinfo/XS/convert/convert_html.c (convert_listoffloats_command)
	(commands_internal_conversion_table): implement
	convert_listoffloats_command.

	* tp/Texinfo/Convert/HTML.pm (_convert_listoffloats_command): rename
	$caption as $caption_element.

2023-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_insertcopying_command)
	(commands_internal_conversion_table): implement
	convert_insertcopying_command.

2023-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_title_command)
	(convert_subtitle_command, commands_internal_conversion_table):
	implement convert_title_command and convert_subtitle_command.

2023-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_author_command),
	(commands_internal_conversion_table): implement
	convert_author_command.

2023-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_center_command)
	(commands_internal_conversion_table): implement
	convert_center_command.

2023-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_exdent_command)
	(commands_internal_conversion_table): implement
	convert_exdent_command.

2023-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_sp_command)
	(commands_internal_conversion_table): implement convert_sp_command.

2023-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_command_simple_block)
	(commands_internal_conversion_table): implement
	convert_command_simple_block.

2023-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(convert_verbatiminclude_command, commands_internal_conversion_table):
	implement convert_verbatiminclude_command.

2023-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_displaymath_command)
	(commands_internal_conversion_table): implement
	convert_displaymath_command.

2023-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_verbatim_command)
	(commands_internal_conversion_table): implement
	convert_verbatim_command.

2023-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_indented_command): modify code
	to handle first the cases leading to returning contents or nothing.

	* tp/Texinfo/XS/convert/convert_html.c (convert_indented_command)
	(commands_internal_conversion_table): implement
	convert_indented_command.

2023-12-30  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert) <'menu_entry'>:
	Add explicit handling of 'menu_entry_leading_text' (for "* "),
	rather than leaving it to a catch-all case.  Flush output for
	before outputting both 'menu_entry_node' and 'menu_entry_name'
	elements in order to capture node names or labels correctly
	and quote correctly if needed, without including any surrounding
	spaces.

2023-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_preformatted_command): modify
	code to handle first the cases leading to returning contents or
	nothing.

	* tp/Texinfo/Convert/HTML.pm (_indent_with_table): minor change in
	code.

	* tp/Texinfo/XS/convert/convert_html.c (indent_with_table)
	(convert_preformatted_command, preformatted_cmd, html_format_init)
	(html_converter_initialize): seup indented preformated, small block
	commands and preformatted_cmd list.  Implement and use
	convert_preformatted_command in C.

	* tp/Texinfo/XS/convert/convert_html.c (html_converter_initialize)
	(html_free_converter), tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER): rename converter accent_formatted_cmd as accent_cmd.

2023-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_inline_command): do not modify
	$args.

	* tp/Texinfo/XS/convert/converter.c (convert_inline_command)
	(commands_internal_conversion_table): implement
	convert_inline_command.

2023-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm, tp/Texinfo/XS/convert/converter.c:
	move contents_inline_element up in source file.

	* tp/Texinfo/XS/convert/converter.c: move mini_toc_internal and
	convert_heading_command up in source file.

2023-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (xml_comment): add.

	* tp/Texinfo/XS/convert/convert_html.c (html_default_format_comment)
	(format_comment): implement format_comment.

2023-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_U_command)
	(commands_internal_conversion_table): implement convert_U_command.

2023-12-27  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/t/test_utils.pl (convert_to_info): If not outputting to
	a file, set OUTPUT_PERL_ENCODING to an empty string to disable
	any character encoding.

	This is in order to minimise changes to the test results when
	Texinfo::Convert::Plaintext::convert starts returning an encoded
	string in the future.  This changes some byte offsets in the
	test results to meaningless values.  If these offsets needed to be
	tested, a separate Info output file would have to be used instead.

2023-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_default_format_special_body_about):
	rename $button as $direction.

	* tp/Texinfo/XS/convert/convert_html.c
	(translate_convert_to_html_internal): add a function to translate and
	convert.

	* tp/Texinfo/XS/convert/convert_html.c
	(default_format_special_body_about)
	(special_unit_body_internal_formatting_table): implement
	default_format_special_body_about.

2023-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(default_format_special_body_footnotes)
	(special_unit_body_internal_formatting_table): implement
	format_special_body_footnotes.

2023-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(default_format_special_body_shortcontents)
	(special_unit_body_internal_formatting_table): implement
	special_body_shortcontents.

2023-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(SPECIAL_UNIT_BODY_INTERNAL_CONVERSION)
	(default_format_special_body_contents, html_converter_initialize)
	(special_unit_body_internal_formatting_table): add the possibility to
	format special unit bodies.  Implement special_body_contents.

	* tp/Texinfo/Convert/HTML.pm (_contents_inline_element),
	tp/Texinfo/XS/convert/convert_html.c (contents_inline_element): rename
	a variable.

2023-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_heading_text): handle the case of being in
	string.

	* tp/Texinfo/XS/convert/convert_html.c (convert_titlefont_command)
	(commands_internal_conversion_table): implement in C.

2023-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_accent_entities_html_accent): do not
	call xml_accent if accents are not formatted in the end as the only
	case where it should happen is @dotless with an unknown argument, and
	xml_accent will not handle it better, simply return the formatted
	accent argument.  Same as in C.

2023-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_command_filename): set
	file number for regular output units only.

	* tp/Texinfo/XS/convert/convert_html.c (convert_footnote_command)
	(html_image_file_location_name), tp/Texinfo/XS/convert/converter.c
	(next_for_tieaccent): free variables (found with valgrind).

2023-12-30  Patrice Dumas  <pertusus@free.fr>

	Fix memory leaks (found with valgrind)

	* tp/Texinfo/XS/convert/convert_html.c (convert_image_command): free
	image_path_info.

	* tp/Texinfo/XS/convert/convert_html.c (convert_math_command):
	properly free memory before exiting.

	* tp/Texinfo/XS/main/unicode.c (format_eight_bit_accents_stack):
	free encoded_u8, new_eight_bit and prev_eight_bit.

2023-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (direction_string)
	(html_internal_command_text, html_command_text)
	(convert_string_tree_new_formatting_context, file_header_information)
	(convert_def_line_type): do not use TREE_ADDED_ELEMENTS if the tree
	root element is destroyed in the same function.

2023-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(html_accent_entities_html_accent_internal): remove debugging message.

	* tp/Texinfo/XS/main/unicode.c (format_eight_bit_accents_stack): use
	%X in format instead of using %x and uppercasing.

2023-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/unicode.c (format_eight_bit_accents_stack): fix
	level instack at the end of the first phase of gathering codepoints.
	Do not double free new_eight_bit.

	* tp/Texinfo/XS/main/utils.c (word_bytes_len_multibyte): add a
	function that counts the bytes in contiguous word characters in a
	string, emulating \p{Word} or \w with unicode in perl.

	* tp/maintain/setup_converters_code_tables.pl (unicode_diacritics),
	tp/Texinfo/XS/main/unicode.h (DIACRITIC_UNICODE),
	tp/Texinfo/XS/main/unicode.c (unicode_accent): add the diacritic
	numeric representation in addition to the UTF-8 encoded string.

	* tp/Texinfo/XS/convert/converter.c (convert_accents),
	tp/Texinfo/XS/main/convert_to_text.c (ascii_accent),
	tp/Texinfo/XS/main/unicode.c (format_eight_bit_accents_stack)
	(format_unicode_accents_stack_internal): add convert accents. Use
	converter in accent formatting functions arguments passed to the
	accents stacks conversion functions.  Update callers.

	* tp/Texinfo/XS/convert/converter.c (next_for_tieaccent)
	(UNICODE_ACCENT_LETTER, xml_numeric_entity_accent): implement
	xml_numeric_entity_accent.

	* tp/Texinfo/XS/convert/convert_html.c
	(html_accent_entities_html_accent_internal)
	(html_accent_entities_html_accent)
	(html_accent_entities_numeric_entities_accent)
	(convert_accent_command, html_converter_initialize)
	(html_free_converter, html_free_converter),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h
	(ACCENT_ENTITY_INFO, CONVERTER): add a list of accent commands,
	converter->accent_formatted_cmd, collected while getting the
	formatting references.  Get accent_entities information from perl to
	C.  Implement convert_accent_command in C.

2023-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (convert_accents): reorganize code
	for more clarity.

	* tp/Texinfo/Convert/HTML.pm (_accent_entities_html_accent): do not
	consider an end of line in an accent command argument to allow to use
	the entity.

	* tp/Texinfo/Convert/Unicode.pm (%unicode_accented_letters): fix a
	codepoint.

2023-12-29  Patrice Dumas  <pertusus@free.fr>

	Add gnulib module for XS

	* tp/Texinfo/XS:
	Run "gnulib-tool --add-import unictype/property-test"

2023-12-29  Patrice Dumas  <pertusus@free.fr>

	Add gnulib modules for XS

	* tp/Texinfo/XS:
	Run "gnulib-tool --add-import unistr/u8-strmbtouc unictype/property-join-control unictype/property-alphabetic unictype/category-M unictype/category-Nd".

2023-12-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_math_command)
	(commands_internal_conversion_table): implement convert_math_command
	in C.

2023-12-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (url_protect_file_text): cast
	char to (unsigned char) before giving to text_printf with %x format,
	as the %x modifier expects an unsigned int parameter and a char will
	usually be promoted to an int when passed to a varargs function.

	* tp/Texinfo/XS/convert/convert_html.c (image_files_extensions)
	(find_image_extension_file, IMAGE_FILE_LOCATION_INFO)
	(free_image_file_location_info, html_image_file_location_name)
	(convert_image_command, commands_internal_conversion_table):
	implement convert_image_command in C.

2023-12-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (html_image_file_location_name)
	(_convert_image_command), tp/ext/epub3.pm
	(epub_convert_image_command): pass $image_basefile to
	html_image_file_location_name instead of returning it.

	* tp/Texinfo/Convert/HTML.pm (_convert_image_command): minor
	change for $alt_string setting.

	* tp/ext/epub3.pm (epub_convert_image_command): sync with
	_convert_image_command.

2023-12-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (url_protect_url_text): cast
	char to (unsigned char) before giving to text_printf with %x format,
	as the %x modifier expects an unsigned int parameter and a char will
	usually be promoted to an int when passed to a varargs function.

	* tp/Texinfo/XS/convert/convert_html.c (convert_uref_command)
	(commands_internal_conversion_table): implement convert_uref_command
	in C.

2023-12-28  Patrice Dumas  <pertusus@free.fr>

	* * tp/Texinfo/XS/convert/convert_html.c
	(commands_internal_conversion_table): enable footnote commands
	conversion in C.

2023-12-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(find_element_target_number_linear, compare_element_target)
	(find_element_target_search, find_element_target)
	(find_element_special_target, sort_cmd_targets)
	(html_prepare_conversion_units_targets, reset_html_targets)
	(html_reset_converter, html_free_converter): sort target elements and
	use bsearch in find_element_target through find_element_target_search.
	Rename find_element_target_number as
	find_element_target_number_linear.

	* tp/Texinfo/XS/convert/convert_html.c (reset_html_targets)
	(html_reset_converter), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER): add html_target_cmds, a list of cmd identifiers with
	associated targets to free only those when resetting parser.  Free
	targets lists when resetting parser, not when freeing it.

2023-12-27  Gavin Smith <gavinsmith0123@gmail.com>

	* contrib/txipsfonts-gildea.diff, contrib/txipsfonts-bronger.tex:
	Remove these files (from 2002 and 2003).  These files are
	not integrated into texinfo.tex and may no longer be useful.
	They were to use PostScript fonts.
	* contrib/README: Update.

2023-12-27  Gavin Smith <gavinsmith0123@gmail.com>

	* man/info.5, man/texinfo.5: Use https:// for Texinfo
	homepage URI.  From Mike Frysinger.

2023-12-27  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/texi2any.pl (makeinfo_help): Use https:// in URI.

2023-12-27  Gavin Smith <gavinsmith0123@gmail.com>

	* info/info.c (info_short_help),
	* install-info/install-info.c (print_help),
	* util/texi2dvi (usage),
	* Pod-Simple-Texinfo/pod2texi.pl (pod2texi_help),
	* doc/texinfo.texi (Reporting Bugs, Printed Books)
	(Testing for Texinfo Commands, Invoking pod2texi),
	* doc/texi2oldapi.texi (Texi2HTML history, Texi2HTML changes),
	* doc/refcard/txirefcard.tex,
	* doc/Makefile.am,
	* util/htmlxref.cnf:

	Use https:// instead of http:// for Texinfo homepage URI throughout.
	From Mike Frysinger <vapier@gentoo.org>.

2023-12-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (find_element_target)
	(find_element_special_target, add_element_target)
	(reset_html_targets_list, reset_html_targets)
	(html_reset_converter, html_free_converter),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): setup one list of
	targets per command id for regular targets (not for special targets).
	Update callers.

2023-12-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_get_target)
	(_set_heading_commands_targets, _prepare_conversion_units),
	tp/Texinfo/XS/convert/convert_html.c (html_get_target)
	(heading_commands_list, set_heading_commands_targets)
	(html_prepare_conversion_units_targets): prepare heading command
	targets in advance, not dynamically during the conversion.

2023-12-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm: document functions in converter for
	error and warning messages registration.

	* doc/texi2any_api.texi (Converter Object and Conversion Functions)
	(Error Reporting in User Defined Functions): replace Texinfo::Report
	functions by Texinfo::Converter::Convert uses for error reporting.

2023-12-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_html_perl_info.c,
	tp/Texinfo/XS/main/build_perl_info.c (build_expanded_formats): rename
	get_expanded_formats as build_expanded_formats and move to
	build_perl_info.c.

	* tp/Texinfo/Convert/Converter.pm (converter): do not inherit
	Texinfo::Report. 

	* tp/t/test_utils.pl (convert_to_*), tp/texi2any.pl: use separate
	registrar from converters to store and get the errors.

	* tp/Texinfo/XS/main/build_perl_info.c (pass_converter_errors):
	rename converter_hv as report_hv and verify that the errors_warnings
	key is set to clarify and make sure that the function is applied to a
	report object.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_conversion_units):
	do not call pass_converter_errors, the converter is not a
	Texinfo::Report object anymore and all the messages are stored in the
	C converter.

2023-12-26  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/convert/get_html_perl_info.c (get_expanded_formats):
	Add missing dTHX.

2023-12-26  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_align_lines):
	Remove unused variable.

2023-12-26  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi: do not use Perl tree as it could also be a
	tree in C.  Other misc changes.

2023-12-26  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Conversion Customization Variables):
	add get_conf return value.

	* doc/texi2any_api.texi (Shared Conversion State)
	(Define Get and Set Shared Conversion State)
	(Shared Conversion State in Defaut Formatting): document the new API.

2023-12-26  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Conversion General Information),
	tp/Texinfo/Convert/HTML.p (%available_converter_info)
	(_convert_heading_command), tp/init/book.pm: add expanded_formats to
	available_converter_info.

	* tp/Texinfo/Convert/HTML.pm (%default_shared_conversion_states),
	tp/Texinfo/XS/convert/convert_html.c (html_initialize_output_state)
	(html_reset_converter), tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_set_shared_conversion_state, html_get_shared_conversion_state)
	(get_expanded_formats), tp/Texinfo/XS/main/converter_types.h
	(HTML_SHARED_CONVERSION_STATE): remove expanded_format_raw shared
	conversion state.

2023-12-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_html_perl_info.c (find_element_from_sv):
	use output_units_descriptor only if set.

	* tp/Texinfo/XS/main/utils.c (expanded_formats_number): add.

	* tp/Texinfo/XS/main/utils.c (index_number_index_by_name): add.

	* tp/Texinfo/XS/convert/convert_html.c (prepare_index_entries_targets)
	(html_initialize_output_state, html_reset_converter),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER, INDEX_NUMBER)
	(SORTED_INDEX_NAMES): sort index names
	and add a corresponding structure.

	* tp/Texinfo/XS/convert/convert_html.c (html_reset_converter),
	tp/Texinfo/XS/main/converter_types.h (HTML_SHARED_CONVERSION_STATE):
	add formatted_index_entries shared_conversion_state.

	* tp/Texinfo/XS/convert/convert_html.c (html_reset_converter),
	tp/Texinfo/XS/main/converter_types.h (HTML_SHARED_CONVERSION_STATE): add
	expanded_format_raw shared_conversion_state.

	* tp/Texinfo/XS/main/converter_types.h (HTML_TARGET): add
	formatted_nodedescription_nr for formatted_nodedescriptions
	shared_conversion_state.

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(find_index_entry_numbers_extra_index_entry_sv)
	(find_index_entry_extra_index_entry_sv): rename
	find_index_entry_element as find_element_extra_index_entry_sv, add
	find_index_entry_numbers_extra_index_entry_sv.

	* tp/Texinfo/Convert/HTML.pm (%default_shared_conversion_states)
	(define_shared_conversion_state, get_shared_conversion_state)
	(set_shared_conversion_state, register_footnote)
	(_convert_explained_command, _convert_footnote_command)
	(_convert_heading_command, _convert_menu_command)
	(_convert_printindex_command, _convert_menu_entry_type)
	(_initialize_XS_NonXS_output_state),
	tp/Texinfo/XS/convert/convert_html.c (html_register_footnote)
	(prepare_index_entries_targets, convert_heading_command),
	tp/init/book.pm b/tp/init/book.pm: change shared_conversion_state API,
	replace with define_shared_conversion_state, which sets the data
	specification, get_shared_conversion_state and
	set_shared_conversion_state.  Add %default_shared_conversion_states
	for the share_conversion_state data description used in default HTML
	conversion code.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides)
	(_XS_get_shared_conversion_state, get_shared_conversion_state)
	(_get_shared_conversion_state, _XS_set_shared_conversion_state)
	(get_shared_conversion_state, _initialize_output_state),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_set_shared_conversion_state)
	(html_get_shared_conversion_state),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(find_index_entry_numbers_index_entry_sv)
	(find_node_target_info_nodedescription_sv)
	(html_set_shared_conversion_state, html_get_shared_conversion_state):
	XS override for get_shared_conversion_state and
	set_shared_conversion_state for the share_conversion_state data used
	in default HTML conversion code.

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_formatting_state),
	tp/Texinfo/XS/convert/call_html_perl_function.c,
	tp/Texinfo/XS/convert/convert_html.c (html_finalize_output_state)
	(html_free_converter), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER): remove code for passing information to and from C and
	perl for previous shared_conversion_state.  Remove
	get_shared_conversion_state, get_shared_conversion_state_integer and
	register_modified_shared_conversion_state_integer.

	* tp/Texinfo/XS/*/*.*: add some const, with some minor code
	modification when needed.

2023-12-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%default_commands_args)
	(_convert_explained_command), tp/Texinfo/XS/convert/convert_html.c
	(default_commands_args, convert_explained_command): set 'normal'
	command arg for the second argument of explained commands and use
	it instead of calling convert_tree in convert_explained_command.

2023-12-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_def_line_type): call
	convert_tree and not _convert.

2023-12-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/build_html_perl_state.c: remove
	build_html_formatting_context_ctx, build_html_formatting_context,
	build_html_formatting_context_stack,
	build_html_composition_context_stack,
	build_html_preformatted_classes_stack and
	build_html_block_commands_stack, which are not used since the states
	are accessed through overrides and not passed to perl.

2023-12-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(html_command_root_element_command): rename
	command_root_element_command as html_command_root_element_command.

	* tp/Texinfo/Convert/HTML.pm (_internal_command_href, command_href),
	tp/Texinfo/XS/convert/convert_html.c (html_command_href)
	(html_internal_command_href): remove source_command argument, it is not
	used.

	* tp/Texinfo/Convert/HTML.pm (from_element_direction),
	tp/Texinfo/XS/convert/convert_html.c (from_element_direction): do not
	access targets state directly for the target, but through command_id
	for target type and command_text.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_command_id)
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(element_converter_from_sv): add element_converter_from_sv to get both
	the converter and element in C based on perl input.

	* tp/Texinfo/XS/convert/build_html_perl_state.c (build_tree_to_build),
	tp/Texinfo/XS/convert/call_html_perl_function.c: move
	build_tree_to_build to build_html_perl_state.c.

	* tp/Texinfo/XS/convert/convert_html.c (html_command_node),
	tp/Texinfo/XS/main/converter_types.h (HTML_TARGET): add.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_command_contents_target)
	(html_footnote_location_target, html_command_filename)
	(html_command_root_element_command, html_command_node)
	(html_internal_command_href, html_command_contents_href)
	(html_footnote_location_href, html_internal_command_tree)
	(html_internal_command_text):

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_conversion_units),
	tp/Texinfo/Convert/HTML.pm (_initialize_XS_NonXS_output_state)
	(_initialize_output_state),
	tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_translated_names, build_html_formatting_state),
	tp/Texinfo/XS/convert/convert_html.c (html_get_target)
	(html_reset_converter, html_check_transfer_state_finalization)
	(html_free_converter, html_translate_names),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): remove functions and
	code used to pass targets state information to perl, as now all the
	accesses are through overriden functions, such that perl targets state
	needs not to be set.  Remove add_html_element_target,
	build_html_element_targets, pass_html_element_targets,
	build_html_special_targets, pass_html_special_targets.  Remove also
	register_added_target_number and HTML_ADDED_TARGET_LIST.  Also remove
	build_html_seen_ids and pass_html_seen_ids that are unused too. 

2023-12-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(html_special_unit_variety_direction_index, html_get_target): rename
	special_unit_variety_direction_index
	as html_special_unit_variety_direction_index and get_target as
	html_get_target.

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_formatting_state), tp/Texinfo/XS/convert/convert_html.c
	(find_element_target_number, find_element_target)
	(register_added_target_number, html_get_target),
	tp/Texinfo/XS/main/converter_types.h (HTML_ADDED_TARGET_LIST): pass
	added targets as the target number instead of the target info pointer,
	as the list may be reallocated in the mean time.

	* tp/Texinfo/Convert/HTML.pm (_external_node_href),
	tp/Texinfo/XS/convert/convert_html.c (external_node_href): remove
	unused source_filename argument.

	* tp/Texinfo/Convert/HTML.pm (from_element_direction),
	tp/Texinfo/XS/convert/convert_html.c (from_element_direction): call
	_external_node_href directly for external node.

	* tp/Texinfo/Convert/HTML.pm (_internal_command_href, command_href)
	(command_tree, _internal_command_tree, _external_command_tree)
	(_internal_command_text, command_text),
	tp/Texinfo/XS/convert/convert_html.c (html_command_href)
	(html_internal_command_href, html_command_tree)
	(html_internal_command_tree, html_external_command_tree)
	(html_internal_command_text, html_command_text): split
	*internal_command* out of html_command_tree, html_command_text and
	command_text, for clearer code and to prepare to override these
	functions only.

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(find_index_entry_element, find_root_command, find_element_from_sv):
	add find_element_from_sv to get the C tree element based on perl
	element, for elements with targets.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_get_target)
	(html_command_id), tp/Texinfo/XS/convert/get_html_perl_info.c
	(get_output_units_descriptor_converter_sv): prepare overriding
	_get_target and command_id. Not set up as an override for now as all
	the functions accessing targets need to be overriden at once.

2023-12-24  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/t/languages.t (appendix_translated): Check translated
	appendix heading in Spanish rather than French, as the accented
	character in "Apéndice" is more problematic than the French "Annexe".

2023-12-24  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Translations.pm (replace_substrings)
	(replace_convert_substrings): Remove comment stating origin
	of a line of code, which is distracting and unnecessary.  (It was
	"# next line taken from libintl perl, copyright Guido. sub __expand".)

2023-12-23  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Text.pm (text_heading, _text_heading):
	Rename with leading _ to indicate that this function is not
	called from outside the module any more.  Fix spelling and
	grammar in a comment.

2023-12-23  Gavin Smith <gavinsmith0123@gmail.com>

	Headings in Plaintext.pm

	* tp/Texinfo/Convert/Plaintext.pm (_text_heading): Incorporate
	code from 'text_heading' in Texinfo/Convert/Text.pm and
	'add_heading_number' in Texinfo/Convert/Utils.pm.  Make $self
	the first argument.  Take an element argument for the heading
	text rather than an already-converted string, and convert it
	with convert_line_new_context.  Centralise code for getting the
	width of the heading text in screen columns.
	* tp/Texinfo/Translations.pm (gdt_string_columns): New function.

	This has no effect at present, but is in preparation for encoding
	the output throughout the conversion in Plaintext.pm in order to
	keep track of byte offsets in a simpler and more reliable way.

2023-12-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_register_footnote): use
	extra global_command_number to find footnote in C global commands
	data.

2023-12-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (output_unit_to_perl_hash): add
	unit_index to output unit perl data.

	* tp/Texinfo/ParserNonXS.pm (_register_global_command),
	tp/Texinfo/XS/parsetexi/parser.c (register_global_command),
	tp/t/test_utils.pl (new_test): add global_command_number extra
	information. 

2023-12-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/command_data.txt: set chapheading, heading, subheading,
	subsubheading and majorheading as global such that they could be
	retrieved more easily in C Texinfo tree.

2023-12-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (_relate_index_entries_to_table_items_in),
	tp/Texinfo/XS/main/tree_types.h (INDEX_ENTRY_AND_INDEX),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(lookup_index_entry, relate_index_entries_to_table_items_in): add an
	extra associated_index_entry reference to the index entry information
	in the item reassociated to an index entry.

2023-12-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (compare_footnote_id)
	(find_footnote_id_number, prepare_footnotes_targets)
	(convert_footnote_command, html_reset_converter),
	tp/Texinfo/XS/main/converter_types.h (FOOTNOTE_ID_NUMBER,
	HTML_SHARED_CONVERSION_STATE): setup and free shared conversion state
	footnote_id_numbers and associated functions.  Implement
	convert_footnote_command in C.  Do not use, because the shared
	conversion states are not passed properly between C and perl.

2023-12-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_footnote_command): distinguish
	footnote id and docid and output footid and docid after disambiguation
	for footnote elements converted more than once.

2023-12-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_anchor_command): get id only if
	it will be used.

	* tp/Texinfo/XS/convert/convert_html.c (convert_anchor_command)
	(commands_internal_conversion_table): implement convert_anchor_command
	in C.

2023-12-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_explained_command): remove
	$with_explanation, use directly $explanation_result.

	* tp/Texinfo/XS/convert/convert_html.c (find_explained_command_string)
	(register_explained_command_string, convert_explained_command)
	(commands_internal_conversion_table, html_reset_converter)
	(html_free_converter), tp/Texinfo/XS/main/converter_types.h
	(EXPLAINED_COMMAND_TYPE, EXPLAINED_COMMAND_TYPE_LIST)
	(HTML_SHARED_CONVERSION_STATE): finalize type of explained commands
	strings. Implement convert_explained_command.

2023-12-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_email_command)
	(commands_internal_conversion_table): implement in C.

2023-12-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_explained_command): remove
	element_explanation_content now that it is not required as there is
	no possibility of infinite recursive expansions any more.

2023-12-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_explained_command): convert
	explanation string only once, where it appears initially and reuse the
	string instead of re-converting when an explanation is needed.

2023-12-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (direction_a): rename
	direction_anchor as direction_a.  Update callers.

	* tp/Texinfo/XS/convert/convert_html.c
	(default_panel_button_dynamic_direction_internal): rearrange code
	and free href.

	* tp/Texinfo/XS/convert/convert_html.c (convert_xref_commands):
	allocate and free file, free href, destroy label_element and tree,
	removing leaks found by valgrind.

	* tp/Texinfo/XS/convert/convert_html.c (external_node_href):
	free parentheses_manual_name, removing leaks found by valgrind.

2023-12-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_value_command)
	(commands_internal_conversion_table): implement convert_value_command
	in C.

2023-12-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%style_commands_formatting): do not put
	indicateurl in %style_commands_formatting and do not associate it,
	even temporarily, to _convert_style_command, as it has its own
	formatting function.

2023-12-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv): increment
	converter->no_arg_formatted_cmd.number only if there was no error on
	the command and it is not undef.

	* tp/Texinfo/XS/convert/convert_html.c (html_free_converter),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER): add style_formatted_cmd, the list of style formatted
	commands, set and free associated data fully.

	* tp/Texinfo/XS/convert/convert_html.c (convert_style_command)
	(convert_indicateurl_command, commands_internal_conversion_table)
	(html_converter_initialize): implement convert_style_command and
	convert_indicateurl_command.

2023-12-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_button_icon_img, format_button_icon_img):
	implement format_button_icon_img in C.

2023-12-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_format_button_function):
	use default_panel_button_dynamic_direction_section_footer and
	default_panel_button_dynamic_direction C functions for dynamic buttons
	formatting.

2023-12-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (external_node_href): call
	url_protect_file_text and not url_protect_url_text for files.

	* tp/Texinfo/XS/convert/convert_html.c (html_command_href)
	(html_command_contents_href): return 0 if there is no href, or the
	string is empty.  Update callers.

	* tp/Texinfo/XS/convert/convert_html.c (html_command_href): set
	filename based on the first output unit if the filename is null, not
	only if the target_filename is null.

	* tp/Texinfo/XS/convert/convert_html.c (convert_xref_commands)
	(commands_internal_conversion_table): implement convert_xref_commands
	in C.

	* tp/Texinfo/XS/convert/converter.c (float_type_number): float_number
	extra information is a string.

2023-12-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_xref_commands): remove
	file_arg_tree intermediary variable.

	* tp/Texinfo/Convert/HTML.pm (_convert_xref_commands): if @*ref
	book argument is set, do not use the node name as section name.

	* tp/Texinfo/Convert/HTML.pm (_convert_xref_commands): do not set
	$reference to $name for a clearer code.

	* tp/t/30sectioning.t (novalidate): move to @tests_info.

2023-12-21  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi, tp/Texinfo/Convert/HTML.pm (command_href)
	(command_contents_href, from_element_direction): return undef if there
	is no href, or the string is empty.  Update callers.

	* tp/Texinfo/Convert/HTML.pm (_convert_xref_commands): do not set
	variables to empty strings if not set, leave them undef.

	* tp/Texinfo/Convert/HTML.pm (_convert_xref_commands): reorganize code
	to setup substrings once for all the possible commands.

	* tp/Texinfo/XS/main/debug.c (print_associate_info_debug): add some
	const.

2023-12-21  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert)
	<@item in @enumerate/@itemize>:
	Use Texinfo::Convert::Paragraph::counter rather than
	Texinfo::Convert::Unicode::string_width.

2023-12-21  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/t/test_utils.pl (convert_to_plaintext): If not outputting to
	a file, set OUTPUT_PERL_ENCODING to an empty string to disable
	any character encoding.

	This currently has no effect on the test suite results, but
	is needed for when Texinfo::Convert::Plaintext::convert starts
	returning an encoded string in the future.

2023-12-20  Gavin Smith <gavinsmith0123@gmail.com>

	Paragraph formatter for @listoffloats output

	* tp/Texinfo/Convert/Plaintext.pm (_convert) <@listoffloats>:
	Use a single paragraph formatter to convert a whole entry in the
	list of floats.  Use 'indent_length_next' setting for indenting
	subsequent lines, rather than adding spaces to the results string.
	Do not process the result of converting a caption twice.  Do not
	process the converted caption with a regex splitting into words.
	Do not truncate caption at a fixed column or append "...".
	Eliminate use of Texinfo::Convert::Unicode::string_width on
	converted output.

2023-12-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.h: properly comment unused code.

2023-12-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides)
	(_push_referred_command_stack_command, _pop_referred_command_stack)
	(_command_is_in_referred_command_stack, command_text)
	(_convert_xref_commands), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_push_referred_command_stack_command)
	(html_pop_referred_command_stack)
	(html_command_is_in_referred_command_stack),
	tp/Texinfo/XS/convert/convert_html.c (html_command_text),
	tp/Texinfo/XS/main/command_stack.c
	(push_element_reference_stack_element)
	(pop_element_reference_stack, command_is_in_referred_command_stack),
	tp/Texinfo/XS/main/converter_types.h (ELEMENT_REFERENCE)
	(ELEMENT_REFERENCE_STACK, CONVERTER): add accessors around
	referred_command_stack state and override them to make sure that the
	state viewed from perl and C is the same, both from C to perl and perl
	to C.

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_formatting_state): remove the previous way to synchronize
	referred_command_stack from C to perl.

	* tp/Texinfo/Convert/HTML.pm (_initialize_output_state)
	(_initialize_XS_NonXS_output_state): move
	check_htmlxref_already_warned and referred_command_stack
	initialization to _initialize_output_state.

2023-12-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm
	(_default_panel_button_dynamic_direction): rearrange conditions to
	avoid redundant code.

	* tp/Texinfo/XS/main/converter_types.h (enum button_function_type)
	(BUTTON_FUNCTION, BUTTON_SPECIFICATION_INFO),
	tp/Texinfo/XS/main/get_perl_info.c (button_function_type_string)
	(html_get_button_specification_list): get the function reference name
	used to format buttons with directions.  Based on the name, associate
	to an enum, one for each of the default button formatting functions.

	* tp/Texinfo/XS/main/converter_types.h (NODE_DIRECTIONS_OFFSET),
	tp/Texinfo/XS/main/tree_types.h (RUD_DIRECTIONS_TYPES_LIST): move
	NodeNext directions such that there is a fix offset between non
	prefixed Prev, Next, Up directions and Node prefixed corresponding
	directions.  NodeBack is now the last relative direction.

	* tp/Texinfo/XS/convert/convert_html.c (direction_anchor)
	(default_panel_button_dynamic_direction_internal)
	(default_panel_button_dynamic_direction)
	(default_panel_button_dynamic_direction_node_footer)
	'default_panel_button_dynamic_direction_section_footer):
	add omit_rel argument to direction_anchor, update callers.  Implement
	default_panel_button_dynamic_direction*.

	* tp/Texinfo/XS/convert/convert_html.c (html_format_button_function)
	(button_direction_function, html_default_format_button): add
	html_format_button_function array and button_direction_function to
	call the C functions for the buttons formatting for default button
	formatting functions.

2023-12-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv): to_convert key in translated direction
	strings can be undef if set through Config.

2023-12-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_command_href)
	(from_element_direction, mini_toc_internal): return 0 instead of an
	empty string.

	* tp/Texinfo/XS/convert/convert_html.c, tp/Texinfo/XS/main/utils.c
	(html_command_text_type_name): move html_command_text_type_name to
	utils.c and complete.

	* tp/Texinfo/XS/convert/convert_html.c (html_converter_initialize)
	(html_free_converter), tp/Texinfo/XS/convert/convert_html.c
	(direction_string), tp/Texinfo/XS/main/api_to_perl.h (CONVERTER),
	tp/Texinfo/XS/main/get_perl_info.c (html_get_direction_index):
	setup self->direction_unit_direction_name with all the direction
	names.  In direction_string, distinguish index in the full direction
	units array, to use self->direction_unit_direction_name and index in
	direction_string data.  Use in html_get_direction_index.

	* tp/Texinfo/XS/main/converter_types.h (DIRECTION_ICON_LIST),
	tp/Texinfo/XS/main/get_perl_info.c (html_get_direction_icons_sv),
	tp/Texinfo/XS/main/utils.c (html_free_direction_icons),
	tp/Texinfo/options_data.txt, tp/maintain/regenerate_C_options_info.pl:
	use a specific type for icon direction associated file list, get them
	from perl.

	* tp/Texinfo/XS/main/api_to_perl.h (enum button_specification_type),
	tp/Texinfo/XS/main/get_perl_info.c
	(html_get_button_specification_list): use two different types of
	button_information_type, with selected and href
	direction_information_type, and determine the type index in
	html_get_button_specification_list.

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_formatting_function_format_button_icon_img)
	(call_button_simple_function, call_button_direction_function),
	tp/Texinfo/XS/convert/convert_html.c (format_button_icon_img): add
	call_formatting_function_format_button_icon_img and functions called
	for button formatting.

	* tp/Texinfo/XS/main/api_to_perl.c (get_perl_scalar_reference_value):
	add a function to get a perl text reference value, used in buttons
	formatting.

	* tp/Texinfo/XS/convert/convert_html.c (direction_href_attributes)
	(direction_anchor, html_default_format_button, format_button):
	implement format_button in C.

2023-12-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(get_shared_conversion_state), tp/Texinfo/XS/main/converter_types.h
	(HTML_SHARED_CONVERSION_STATE), tp/Texinfo/XS/convert/convert_html.c
	(html_finalize_output_state, html_free_converter): add key_strings
	STRING_LIST field in HTML_SHARED_CONVERSION_STATE to allocate and save
	key strings, such that they can be freed in the end.

	* tp/Texinfo/XS/convert/converter.c (free_generic_converter): wipe
	error messages memory.

	* tp/Texinfo/XS/main/convert_to_text.c (brace_no_arg_command)
	(convert_to_text_internal), tp/Texinfo/XS/main/convert_utils.c
	(add_heading_number), tp/Texinfo/XS/convert/convert_html.c
	(html_get_tree_root_element, convert_to_html_internal): destroy tree
	elements and free data to fix memory leaks detected by valgrind.

2023-12-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (add_string): return the newly duplicated
	string.

	* tp/Texinfo/XS/main/get_perl_info.c (get_line_message): replace
	strings in source_info by the strings saved in
	self->document->small_strings.

2023-12-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/call_html_perl_function.c: free memory/destroy
	elements to fix memory leaks shown by valgrind.

2023-12-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_file_id_setting_label_target_name): allow null label_element.

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_formatting_function_format_css_lines),
	tp/Texinfo/XS/convert/convert_html.c (format_css_lines): add.

	* tp/Texinfo/XS/convert/convert_html.c
	(convert_string_tree_new_formatting_context)
	(html_prepare_converted_output_info): add to replace similar
	code used in diverse places.

	* tp/Texinfo/XS/convert/convert_html.c (html_default_entity_nbsp)
	(substitute_html_non_breaking_space, close_html_lone_element):
	implement substitute_html_non_breaking_space and
	close_html_lone_element in C.

	* tp/Texinfo/XS/main/converter_types.h (enum html_text_type)
	(direction_unit_direction), tp/Texinfo/XS/main/get_perl_info.c
	(html_get_direction_index): rename enum html_command_text_type as enum
	html_text_type, rename HCTT_* as HTT_* add possibilities of
	from_element_direction.  Rename enum button_unit_direction as enum
	direction_unit_direction.  Rename D_button_* as D_direction_*.  Define
	FIRSTINFILE_MIN_IDX, FIRSTINFILE_MAX_IDX, FIRSTINFILE_OFFSET,
	FIRSTINFILE_NR, NON_SPECIAL_DIRECTIONS_NR.

	* tp/Texinfo/XS/convert/convert_html.c (from_element_direction):
	implement in C.

	* tp/Texinfo/XS/convert/convert_html.c (BEGIN_FILE_INFORMATION)
	(destroy_begin_file_information, root_html_element_attributes_string)
	(file_header_information, html_reset_converter, html_convert_output),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): implement
	file_header_information in C, set date_in_header in converter.

	* tp/Texinfo/XS/convert/convert_html.c (direction_string_type_names)
	(direction_string_context_names, clear_direction_string_type)
	(direction_type_translation_context, direction_string)
	(html_free_converter, html_translate_names),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h
	(enum direction_string_context, enum direction_string_type)
	(HTML_DIRECTION_STRING_TRANSLATED, CONVERTER): get direction strings and
	translated direction s trings information from perl. implement
	direction_string in C.  Rename enum direction_string as enum
	direction_string_type.

	* tp/Texinfo/XS/convert/convert_html.c (get_links): implement in C.

	* tp/Texinfo/XS/convert/convert_html.c (html_command_text): fix case
	of string type, by removing element in tree to build, using
	add_to_contents_as_array instead of add_to_element_contents and
	destroying elements.

	* tp/Texinfo/XS/convert/convert_html.c (html_command_text): return an
	empty string instead of 0.

	* tp/Texinfo/XS/convert/convert_html.c (normalized_label_id_file):
	label_element can be null.

	* tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_begin_file, format_begin_file): implement in C.

	* tp/Texinfo/Convert/HTML.pm (_check_htmlxref_already_warned)
	(_external_node_href), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_check_htmlxref_already_warned),
	tp/Texinfo/XS/convert/convert_html.c
	(html_check_htmlxref_already_warned, external_node_href)
	(source_info_id, html_reset_converter, html_free_converter),
	tp/Texinfo/XS/main/converter_types.h (CONVERT): use a
	function for check_htmlxref_already_warned in perl, rename function to
	html_check_htmlxref_already_warned in C, add source_info_id, use
	source_info information to avoid duplicate messages for missing
	htmlxref.cnf entry in C.  Make check_htmlxref_already_warned a
	STRING_LIST, remove HTMLXREF_MANUAL_ELEMENT_WARNED_LIST and
	HTMLXREF_MANUAL_ELEMENT_WARNED.

	* tp/Texinfo/XS/convert/convert_html.c (external_node_href): bugfix
	setting up paths of external hrefs.

	* tp/Texinfo/Convert/HTML.pm (_source_info_id): remove code without
	effect.

2023-12-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (from_element_direction): remove
	unreachable code.

	* tp/Texinfo/Convert/HTML.pm (direction_string): rename variable
	$context_string as $translation_context.

	* tp/Texinfo/Convert/HTML.pm (_convert_xref_commands): rename $root as
	$command, $command as $target_root and $node as $target_node.

	* tp/Texinfo/Convert/HTML.pm (_source_info_id, _external_node_href):
	use source_info information to avoid duplicate messages for missing
	htmlxref.cnf entry, not tree element.

	* tp/Texinfo/Convert/HTML.pm (_file_header_information): change order
	of code.  Add intermediary variable $protected_jsdir.

	* tp/Texinfo/Convert/HTML.pm (_get_links): rename $element as
	$output_unit.

	* tp/Texinfo/options_data.txt (SECTION_NAME_IN_TITLE):
	SECTION_NAME_IN_TITLE is an int.

2023-12-17  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: tweak instructions for updating translations
	to stop po files changing again in a released distribution

2023-12-17  Gavin Smith <gavinsmith0123@gmail.com>

	Do not distribute xsubpp-generated files

	* tp/Texinfo/XS/Makefile.am (TestXS_la_SOURCES, MiscXS_la_SOURCES)
	(XSParagraph_la_SOURCES, Parsetexi_la_SOURCES, DocumentXS_la_SOURCES)
	(StructuringTransfoXS_la_SOURCES, ConvertXS_la_SOURCES):
	Do not distribute *.c files generated from *.xs files by
	xsubpp.  List these files in the corresponding nodist_* variable.
	(CLEANFILES): Add these *.c files.
	(.xs.c): Generate in builddir not srcdir.

	This avoids the possibility of one of the distributed
	files being overwritten with no way to get back the original
	contents, while users expect "make distclean" to restore the
	original state of a distribution.

	Report from Hilmar Preuße <hille42@web.de>.

2023-12-17  Gavin Smith <gavinsmith0123@gmail.com>

	* configure.ac (AM_INIT_AUTOMAKE): Remove dist-xz for speed
	when testing.

2023-12-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_default_format_begin_file): do not set
	$command_for_title to an output unit, it should be a tree element.
	The associated element should be defined anyway.

	* tp/Texinfo/Convert/HTML.pm (output): keep file_info_label_element
	conflicting with redirection file, not the associated contents.

2023-12-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides)
	(_initialize_output_state, _initialize_XS_NonXS_output_state): add
	_initialize_XS_NonXS_output_state, which sets up the states that need
	to be set up both in perl and XS, and calls _initialize_output_state,
	now directly overriden, that sets up the states that only need to be
	setup if there is no XS.

2023-12-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (%XS_overrides, reset_converter),
	tp/Texinfo/XS/convert/ConvertXS.xs (reset_converter)
	(html_finalize_output_state), tp/texi2any.pl, tp/t/test_utils.pl
	(test): split reset_converter out of html_finalize_output_state, and
	call reset_converter later than html_finalize_output_state, when the
	converter data is not needed anymore.  In html_finalize_output_state
	the finalization of the converting state is kept.

	* tp/Texinfo/Convert/HTML.pm (output): call count_elements_in_filename
	instead of accessing directly 'elements_in_file_count'.

	* tp/Texinfo/XS/convert/convert_html.c (find_page_name_number): return
	0 if the file is not found.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_count_elements_in_filename),
	tp/Texinfo/XS/convert/convert_html.c (count_elements_in_filename_type)
	(html_count_elements_in_filename, count_elements_in_file_number),
	tp/Texinfo/XS/convert/convert_html.h
	(enum count_elements_in_filename_type):
	rename count_elements_in_filename as count_elements_in_file_number.
	Update callers. Add html_count_elements_in_filename. Add an XS
	interface for count_elements_in_filename.

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_formatting_state), tp/Texinfo/XS/convert/convert_html.c
	(html_new_document_context, document_global_context)
	(html_set_pages_files, html_finalize_output_state),
	tp/Texinfo/XS/main/converter_types.h (FILE_NAME_PATH_COUNTER)
	(CONVERTER): remove document_global_context, and file_counters
	information passed to perl it is not needed with overrides.  Remove
	corresponding structures in C, file_changed_counter in converter, and
	counter_changed in FILE_NAME_PATH_COUNTER.

2023-12-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_initialize_output_state)
	(converter_initialize): move document_context and multiple_pass
	initialization to _initialize_output_state.

2023-12-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_utils.c (add_heading_number): implement
	the case of translations, with a converter with translations support
	present.

	* tp/t/convert_to_text.t: test a call of
	Texinfo::Convert::Utils::add_heading_number from
	Texinfo::Convert::Text with a converter associated to the text
	options.  This cannot happen otherwise, as either there is a converter
	with translations support associated but no conversion of sectioning
	commands, or the converter is the simple Text converter without
	support for translations.

2023-12-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_today_command)
	(commands_internal_conversion_table),
	tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal),
	tp/Texinfo/XS/main/convert_utils.c (expand_today): implement
	expand_today.  Use it in convert_to_text and in implementation of
	convert_today_command for HTML in C.

2023-12-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (copy_options_for_convert_text)
	(brace_no_arg_command, convert_to_text_internal),
	tp/Texinfo/XS/main/convert_to_text.h (TEXT_OPTIONS): add converter to
	text options, use it for untranslated text, translated commands
	without arguments, verbatiminclude errors.  Use options for
	definition_category_tree.

	* tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_converted_output_info),
	tp/Texinfo/XS/main/get_perl_info.c (recopy_converter_conf_sv)
	(set_output_converter_sv): add recopy_converter_conf_sv to reset a
	converter value based on perl converter, use in
	html_prepare_converted_output_info and set_output_converter_sv.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides): use
	_prepare_converted_output_info override.

2023-12-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm (%XS_overrides, _XS_set_document_global_info)
	(set_document_global_info), tp/Texinfo/XS/main/DocumentXS.xs
	(set_document_global_info, rebuild_document),
	tp/Texinfo/XS/main/build_perl_info.c (build_global_info),
	tp/Texinfo/XS/main/document_types.h (GLOBAL_INFO),
	tp/Texinfo/XS/main/utils.c (delete_global_info),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (_get_parser_info),
	tp/t/test_utils.pl (test): setup an method in Texinfo::Document,
	set_document_global_info to set document global info.  Add an XS
	interface and add the input_perl_encoding to the global info known in
	XS even though it is used in perl only.  Remove from rebuild_document
	the code copying perl data from the input document to the rebuilt
	perl document, as it is now stored in C.

2023-12-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (set_conf, force_conf): no need to
	encode in perl, it is done in C.

	* tp/Texinfo/XS/main/get_perl_info.c (add_svav_to_string_list)
	(html_get_button_specification_list),
	tp/maintain/regenerate_C_options_info.pl: clear strings list before
	setting them.  Handle undef value for all the types.

2023-12-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/build_html_perl_state.c (build_simpletitle):
	add missing dTHX. Report from Gavin.

2023-12-12  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/regenerate_C_options_info.pl: really output
	html_free_button_specification_list for options.  Add missing include
	files for options_init_free.c.

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES, EXTRA_DIST)
	(libtexinfoxs_la_SOURCES), tp/Texinfo/XS/main/get_perl_info.c,
	tp/Texinfo/XS/main/get_perl_info.h, tp/Texinfo/XS/main/utils.c,
	tp/Texinfo/XS/main/utils.h: do not include options_init_free.c nor
	options_get_perl.c directly in code.  Move .c files declaration form
	EXTRA_DIST to *la_SOURCES if they are not included in other file and
	move .h files declarations too.

2023-12-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/get_perl_info.c (get_source_info): do not check
	the length of macro and file_name anymore, as the key should not be
	there if they are not set.

2023-12-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree_types.h (enum tree_added_elements_status):
	rename tree_added_status_normal as tree_added_status_elements_added.

	* tp/Texinfo/XS/convert/convert_html.c (new_tree_added_elements): add
	status argument to have status set to something else than none.
	TREE_ADDED_ELEMENTS that are not allocated through
	new_tree_added_elements still need to have the status field set.
	Update callers.

	* tp/Texinfo/XS/convert/convert_html.c (convert_def_line_type)
	(convert_no_arg_command, convert_to_html_internal): free strings that
	need to (found with valgrind), and destroy parsed_def.

	* tp/Texinfo/XS/convert/convert_html.c (convert_def_line_type)
	(html_prepare_converted_output_info): remove tree root from
	tree_to_build after conversion before it is destroyed as a tree added
	element.

2023-12-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/debug.c (debug_protect_eol): add handling of NULL
	string.

	* tp/Texinfo/XS/main/translations.c (replace_convert_substrings): add
	OPTIONS argument, and use that argument and document error messages
	information for translations and debug messages, to avoid using
	internal parser data.  Update callers.

	* tp/Texinfo/XS/main/debug.c, tp/Texinfo/XS/parsetexi/debug_parser.c:
	move all the functions that depend on debug_output internal parser
	value from debug.c to debug_parser.c, corresponding to
	set_debug_output, debug, debug_nonl, debug_print_element and
	debug_print_protected_string.

2023-12-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES),
	tp/Texinfo/XS/main/errors.c (vmessage_list_line_error),
	tp/Texinfo/XS/parsetexi/errors_parser.c,
	tp/Texinfo/XS/parsetexi/errors_parser.h: rename
	message_list_line_error_internal as vmessage_list_line_error. Update
	callers.
	Add errors_parser.c and move functions using parser internal
	structures, current_source_info, error_messages_list and debug_output
	from errors.c to errors_parser.c.  This corresponds to
	line_error_internal, line_error_ext, line_error, line_warn,
	command_warn, command_error, forget_errors, bug_message_internal
	and bug_message.

2023-12-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/errors.c (message_list_line_error_internal)
	(line_error_internal, message_list_line_error_ext)
	(message_list_command_warn, vmessage_list_command_warn)
	(message_list_command_error): add an explicit warn argument to
	message_list_line_error_internal.  Pass OPTIONS information to
	message_list_line_error_ext, message_list_command_warn,
	vmessage_list_command_warn and message_list_command_error.
	Update callers.

2023-12-12  Patrice Dumas  <pertusus@free.fr>

	No empty file_name in source info

	* tp/Texinfo/ParserNonXS.pm (_input_push_text, _bug_message)
	(_next_text), tp/Texinfo/XS/main/build_perl_info.c
	(element_to_perl_hash, build_source_info_hash): do not set source info
	'file_name' to an empty string if not parsing a file, always check if
	defined before using.

2023-12-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Report.pm (format_line_message): only check if macro is
	defined.

2023-12-12  Patrice Dumas  <pertusus@free.fr>

	No empty macro in source info

	* tp/Texinfo/ParserNonXS.pm (_input_push_text, _input_push_file)
	(_bug_message, _next_text, _check_line_directive),
	tp/Texinfo/Report.pm (format_line_message),
	tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash)
	(build_source_info_hash): do not set source info 'macro' to an empty
	string if not in macro a context, leave out the key, and check that it
	is defined.

2023-12-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/get_perl_info.c (get_source_info): use SvPVbyte
	for file_name.

2023-12-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (converter_line_error)
	(converter_line_warn), tp/Texinfo/XS/convert/ConvertXS.xs
	(converter_line_error, converter_line_warn),
	tp/Texinfo/XS/main/get_perl_info.c (get_line_message): remove 'silent'
	argument.

2023-12-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (setup_sortable_index_entries): fix
	function name.

2023-12-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Report.pm (format_line_message): add empty macro if there
	are lines numbers.  This is not good, but is for consistency with what
	is done for Parser messages.

	* tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash): store
	empty string for macro and file_name only if line_nr is set.

	* tp/Texinfo/XS/main/get_perl_info.c (get_document_or_warn): document
	descriptor in converter can be undef.

	* tp/Texinfo/XS/main/build_perl_info.c (build_errors): rename
	get_errors as build_errors. Update callers.

	* tp/Texinfo/Report.pm (format_document_message, document_warn)
	(document_error, format_line_message, line_error, line_warn): make
	format_document_message and format_line_message independent of
	converter/Report object.  Move the corresponding code back to
	document_warn, document_error, line_error, line_warn.

	* tp/Texinfo/XS/main/errors.c (message_list_line_error_internal)
	(message_list_line_formatted_message)
	(message_list_document_error_internal)
	(message_list_document_formatted_message): split
	message_list_line_formatted_message out of
	message_list_line_error_internal and
	message_list_document_formatted_message out of
	message_list_document_error_internal to be able to format/register an
	already translated message.

	* tp/Texinfo/Convert/Converter.pm (%XS_overrides)
	(_XS_converter_initialize, converter, _XS_html_converter_initialize),
	tp/Texinfo/XS/convert/ConvertXS.xs (converter_initialize),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/get_perl_info.c
	(converter_initialize): separate generic converter initialization from
	HTML converter initialization and initialize generic converter in
	Converter.pm converter/get_perl_info.c converter_initialize. 

	* tp/Texinfo/Convert/Converter.pm (converter_line_error,
	converter_line_warn, converter_document_error)
	(converter_document_warn, get_converter_errors),
	tp/Texinfo/Convert/Plaintext.pm (plaintext_line_warn)
	(plaintext_line_error), tp/Texinfo/Convert/Text.pm
	(converter_line_error, converter_document_warn),
	tp/Texinfo/Convert/Utils.pm (expand_verbatiminclude),
	tp/Texinfo/Structuring.pm (_converter_or_registrar_line_warn)
	(setup_sortable_index_entries): use specific error reporting for
	converters, which use Texinfo::Report for formatting, but register in
	converter.  Use get_converter_errors to get errors to
	Texinfo::Register, both for XS and perl converters.  Update all calls
	to Texinfo::Report to be converter_* calls.  Rename
	converter_line_error and converter_line_warn in Plaintext.pm as
	plaintext_line_error and plaintext_line_warn as the method names are
	now the generic converter method names.  Use only one argument for
	converter in expand_verbatiminclude.  setup_sortable_index_entries
	error messages can be both called from converters or Texinfo::Report
	object separate from customization information, so use a specific
	function to call Texinfo::Report or converter functions.

	* tp/Texinfo/XS/convert/ConvertXS.xs (%XS_overrides),
	tp/Texinfo/XS/convert/ConvertXS.xs (converter_line_error)
	(converter_line_warn, converter_document_error)
	(converter_document_warn), tp/Texinfo/XS/main/get_perl_info.c
	(get_source_info, get_line_message), tp/t/test_utils.pl
	(convert_to_plaintext, convert_to_info, convert_to_html)
	(convert_to_xml, convert_to_docbook, convert_to_latex):
	override converter_line_*, converter_document_* in XS.  This is for
	all the converters.

2023-12-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (%XS_overrides),
	tp/Texinfo/Report.pm (format_line_message, line_warn, line_error)
	(format_document_message, document_warn, document_error): split
	formatting messages out of line_* and document_*, adding
	format_line_message for line messages and format_document_message for
	document messages, using only one function for both errors and
	warnings, as in XS.

2023-12-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_texi): rename global
	information info key as global_info in document registering.

2023-12-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_converted_output_info)
	(output): new function to be able to override setting up titles,
	copying comment and documentdescription.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_translate_names): do not
	get conf, set_conf is already overriden.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_simpletitle),
	tp/Texinfo/XS/convert/build_html_perl_state.c (build_simpletitle):
	separate function to build simpletitle for perl.

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_formatting_function_format_comment),
	tp/Texinfo/XS/convert/convert_html.c (format_comment): add.

	* tp/Texinfo/Document.pm (register, global_information),
	tp/Texinfo/ParserNonXS.pm (%parser_state_initialization)
	(get_parser_info, parse_texi_file, _handle_line_command)
	(_handle_block_command), tp/Texinfo/XS/main/DocumentXS.xs
	(rebuild_document), tp/Texinfo/XS/main/build_perl_info.c
	(get_document, build_document), tp/Texinfo/XS/parsetexi/Parsetexi.pm
	(_get_parser_info), tp/t/test_utils.pl (test): rename global
	information info key as global_info.

	* tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_converted_output_info),
	tp/Texinfo/XS/convert/convert_html.c
	(html_prepare_converted_output_info, html_finalize_output_state),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): implementation of
	_prepare_converted_output_info in C and XS interface.  Not activated,
	as the output is not correct for now, because of incorrect
	synchronization with perl state.

2023-12-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_command_warn, _command_error): only use
	the command source info.  Update callers.

	* tp/Texinfo/ParserNonXS.pm (_end_line_starting_block),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block): use
	multitable command for "unexpected argument on @%s line" warning.

	* tp/Texinfo/ParserNonXS.pm (_end_line_misc_line),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line): use
	_line_error for @columnfraction error, as @columnfraction does not
	have a command source info.

	* tp/Texinfo/ParserNonXS.pm (_handle_open_brace),
	tp/Texinfo/XS/parsetexi/separator.c (handle_open_brace): always put a
	source info in bracketed_arg type, as there are related errors.

	* tp/Texinfo/XS/main/errors.c (message_list_line_error_internal)
	(line_error, line_warn): do not use current_source_info in
	message_list_line_error_internal, set it in line_error and line_warn.

	* tp/Texinfo/XS/main/build_perl_info.c (build_source_info_hash):
	complete macro and file_name with empty string only if line_nr is set.

	* tp/Texinfo/XS/main/errors.c (message_list_line_error_ext): add.

2023-12-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_navigation_panel): free result_buttons.

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_prepare_output_sv): allocate jslicenses.list only if
	not empty.

	* tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_program_string, format_program_string): implement
	format_program_string in C.

2023-12-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/options_data.txt (PROGRAM_NAME_IN_FOOTER): type is int.

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_formatting_function_format_program_string),
	tp/Texinfo/XS/convert/convert_html.c (format_program_string): add.

	* tp/Texinfo/XS/convert/get_html_perl_info.
	(html_converter_initialize_sv, html_converter_prepare_output_sv): move
	getting jslicenses information to html_converter_prepare_output_sv.

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(html_default_format_end_file): implement in C.

2023-12-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_finalize_output_state),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h
	(JSLICENSE_FILE_INFO, JSLICENSE_FILE_INFO_LIST)
	(JSLICENSE_CATEGORY_LIST, CONVERTER): get jslicenses information from
	perl.

2023-12-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_default_format_end_file): avoid using
	intermediary variables.

	* doc/texi2any_api.texi (Associating Information to an Output File),
	tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_register_file_information)
	(html_get_file_information), tp/Texinfo/XS/convert/convert_html.c
	(html_register_file_information, html_get_file_information)
	(html_set_pages_files, setup_output_simple_page)
	(html_finalize_output_state), tp/Texinfo/XS/main/converter_types.h
	(ASSOCIATED_INFO_LIST, CONVERTER): implement get_file_information and
	register_file_information and add an XS interface.

2023-12-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (format_simpletitle)
	(html_default_format_titlepage, format_titlepage): implement
	format_titlepage in C.

	* tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_title_titlepage): return the result.

2023-12-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_default_format_title_titlepage): avoid
	intermediary variables.

	* tp/Texinfo/Convert/HTML.pm (_prepare_simpletitle, convert, output):
	add _prepare_simpletitle.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_simpletitle),
	tp/Texinfo/XS/convert/convert_html.c (html_prepare_simpletitle),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): implement
	html_prepare_simpletitle and an XS interface.

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_formatting_function_format_titlepage),
	tp/Texinfo/XS/convert/convert_html.c (contents_shortcontents_in_title)
	(format_titlepage, html_default_format_title_titlepage)
	(format_title_titlepage, html_prepare_title_titlepage): have
	format_title_titlepage return a char *. Add
	contents_shortcontents_in_title,
	call_formatting_function_format_titlepage and format_titlepage.
	Implement html_default_format_title_titlepage in C.

2023-12-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_footnotes_sequence): destroy pending footnotes in
	the end.

	* tp/Texinfo/Convert/HTML.pm (_default_format_contents): rename
	$contents variable as $is_contents and $toplevel_contents as
	$has_toplevel_contents.  Avoid some intermediary variables.

	* tp/Texinfo/XS/convert/convert_html.c (command_root_element_command):
	return the command if it is already set.

	* tp/Texinfo/XS/convert/convert_html.c (html_command_contents_target):
	fix name of command.

	* tp/Texinfo/XS/convert/convert_html.c (html_command_contents_href):
	target_filename filename can be NULL.

	* tp/Texinfo/XS/convert/convert_html.c (html_default_format_contents)
	(format_contents): implement html_default_format_contents in C.

2023-12-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (format_protect_text)
	(html_convert_css_string, html_initialize_output_state),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): add
	current_format_protect_text function reference in converter to switch
	from html to css formatting in C in format_protect_text.

2023-12-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_formatting_function_format_*),
	tp/Texinfo/XS/convert/convert_html.c (format_translate_message)
	(format_contents, format_title_titlepage, format_element_footer)
	(format_end_file, format_begin_file): pass formatting_reference to all
	the call_formatting_function_format_* functions.  Add wrappers for all
	those functions in convert_html.c.  Update callers.

2023-12-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_css_string_convert_text)
	(css_string_convert_no_arg_command, SPECIAL_LIST_MARK_CSS_NO_ARGS_CMD)
	(html_convert_css_string_for_list_mark, html_converter_initialize):
	implement css strings formatting in C.

	* tp/Texinfo/XS/convert/convert_html.c (convert_itemize_command):
	implement in C.

2023-12-08  Gavin Smith <gavinsmith0123@gmail.com>

	Line length using counter for @listoffloats

	* tp/Texinfo/Convert/Plaintext.pm (_convert) <@listoffloats>:
	Eliminate call to convert_line, followed by call to
	Texinfo::Convert::Unicode::string_width.  Instead, format the entry
	using a line formatter object, followed by a call to
	Texinfo::Convert::Paragraph::counter to get the line length.

	This is needed for future plans for this code, where convert_line
	will return an already-encoded string which can't be passed
	to string_width.

2023-12-08  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/Makefile.am (main/accent_tables_8bit_codepoints.c)
	(main/cmd_normalization.c): Make generated files depend on the
	scripts that generate them.  I could not build the program because
	one of these files was stale.

2023-12-08  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert) <@listoffloats>:
	Eliminate default of ':' for "float entry text" as it does
	not appear to be used for valid input and would produce malformed
	Info output if used.  Simply skip the entry if the "entry text"
	cannot be obtained.

2023-12-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_no_arg_command)
	(text_element_conversion, html_converter_initialize): implement
	convert_no_arg_command.

2023-12-08  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (convert_to_html): get XS error messages by
	calling get_converter_errors.

	* tp/init/documentation_examples.pm (my_convert_paragraph_type): call
	get_associated_formatted_inline_content as it should be.

2023-12-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_noticed_line_warn): do not return a
	value.

	* tp/Texinfo/XS/convert/convert_html.c (noticed_line_warn),
	tp/Texinfo/XS/main/errors.c (vmessage_list_command_warn): add
	noticed_line_warn. Add a "v" version of message_list_command_warn that
	takes a va_list as argument instead of a variable length argument to
	be used in case the caller already has a variable length argument, as
	is the case with noticed_line_warn.

	* tp/Texinfo/XS/convert/convert_html.c (convert_raw_command):
	implement in C.

2023-12-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(get_associated_inline_content_number)
	(html_associate_pending_formatted_inline_content)
	(html_get_associated_formatted_inline_content)
	(html_finalize_output_state), tp/Texinfo/XS/main/converter_types.h
	(HTML_ASSOCIATED_INLINE_CONTENT): use a TEXT in
	HTML_ASSOCIATED_INLINE_CONTENT to accumulate content, and allow the
	same element to be found more than once when text appears.

2023-12-08  Patrice Dumas  <pertusus@free.fr>

	* tp/ext/highlight_syntax.pm (highlight_open_inline_container_type):
	do not call get_pending_formatted_inline_content at example opening if
	the code calling get_associated_formatted_inline_content will not be
	called for example conversion, to have a correct pairing of calls by
	the preformatted element eventually formatted.

2023-12-08  Patrice Dumas  <pertusus@free.fr>

	Pass XS converter errors to texi2any

	* tp/Texinfo/Convert/Converter.pm (%XS_overrides)
	(get_converter_errors), tp/Texinfo/Convert/Text.pm
	(get_converter_errors), tp/Texinfo/XS/convert/ConvertXS.xs
	(get_converter_errors), tp/texi2any.pl: add an XS interface to get
	converter error. Add them to the Texinfo::Report associated to the
	perl converter.

2023-12-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_def_line_type): avoid
	intermediate variables, move code around.

	* tp/Texinfo/XS/convert/convert_html.c (html_in_multi_expanded): add.

	* tp/Texinfo/XS/main/utils.c (def_aliases), tp/Texinfo/XS/main/utils.h
	(DEF_ALIAS), tp/Texinfo/XS/parsetexi/def.c (parse_def): move DEF_ALIAS
	to utils.h and def_aliases to utils.c from def.c.
	Add aliases of def*x commands.

	* tp/Texinfo/XS/convert/convert_html.c (convert_def_line_type)
	(types_internal_conversion_table): implement convert_def_line_type in
	C.

	* tp/Texinfo/XS/convert/convert_html.c
	(reset_translated_special_unit_info_tree): remove a destroyed element
	from tree to build.
	(convert_to_html_internal) <untranslated>: add tree to build.

	* tp/Texinfo/XS/convert/convert_html.c (html_finalize_output_state):
	free tree_to_build.list after the corresponding messages have been
	issued.
	Show the tree_to_build elements remaining.  The elements could have
	been destroyed, so only show if DEBUG is set.  With DEBUG, this could
	produce a segfault, but using valgrind should give an idea where the
	tree_to_build element was created/destroyed.

	* tp/Texinfo/XS/convert/convert_html.c (html_free_converter): show the
	ignored error messages.

2023-12-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/call_html_perl_function.c (call_types_open):
	call build_tree_to_build only if not exiting immediately.

	* tp/Texinfo/Convert/Converter.pm (import, %XS_overrides): use a hash
	for XS overrides.

2023-12-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (nav_panel_array)
	(nav_panel_classes, html_default_format_navigation_panel)
	(foot_body_heading_array, foot_body_heading_classes)
	(html_default_format_footnotes_sequence, mini_toc_array)
	(mini_toc_classes, mini_toc_internal): use static data for classes
	arrays that are not dynamic.

2023-12-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (footnote_location_href): rename
	$special_target as $footnote_location_target_info.

	* tp/Texinfo/Convert/HTML.pm (_default_format_heading_text): Avoid
	intermediary variables.

	* tp/Texinfo/Convert/HTML.pm (_get_copiable_anchor): Allow id to be 0.

	* tp/Texinfo/XS/convert/convert_html.c (copiable_link_array)
	(copiable_link_classes, get_copiable_anchor)
	(html_default_format_heading_text, format_heading_text): implement
	get_copiable_anchor and format_heading_text in C.  Update callers of
	call_formatting_function_format_heading_text to call
	format_heading_text instead.

2023-12-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (footnote_location_target): explicit
	return undef.

	* tp/Texinfo/XS/convert/convert_html.c (get_footnote_location_target)
	(html_footnote_location_target, html_footnote_location_href)
	(html_default_format_footnotes_sequence, format_footnotes_sequence)
	(default_format_footnotes_segment): implement
	html_footnote_location_target, html_footnote_location_href and
	html_default_format_footnotes_sequence in C.

2023-12-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_separate_anchor, format_separate_anchor)
	(convert_heading_command): implement
	html_default_format_separate_anchor in C.

2023-12-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_default_format_navigation_panel):
	ignore leading space button also if the button specificatio is a
	reference on an array.

	* tp/Texinfo/XS/main/tree_types.h (HTML_GLOBAL_DIRECTIONS_LIST)
	(enum global_unit_direction), tp/Texinfo/XS/main/utils.h: move
	HTML_GLOBAL_DIRECTIONS_LIST to tree_types.h.

	* tp/Texinfo/XS/main/api_to_perl.c (unregister_perl_button),
	tp/Texinfo/XS/main/converter_types.h (enum button_unit_direction)
	(BUTTON_SPECIFICATION_INFO, BUTTON_SPECIFICATION),
	tp/Texinfo/XS/main/get_perl_info.c (get_sv_options, copy_sv_options)
	(converter_initialize, set_output_converter_sv)
	(html_get_direction_index, html_get_button_specification_list),
	tp/Texinfo/XS/main/utils.c (html_button_direction_names)
	(html_free_button_specification_list),
	tp/maintain/regenerate_C_options_info.pl: get perl buttons information
	into C with html_get_direction_index and
	html_get_button_specification_list, add
	html_free_button_specification_list to free that information.  Add a
	converter argument to *_sv_options to obtain the special output units
	direction strings.  Update callers.

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_formatting_function_format_button),
	tp/Texinfo/XS/convert/convert_html.c
	(html_global_unit_direction_names, format_button)
	(html_default_format_navigation_panel, format_navigation_panel),
	tp/Texinfo/XS/main/converter_types.h (FORMATTED_BUTTON_INFO):
	add call_formatting_function_format_button, implement
	format_navigation_panel in C.

	* tp/Texinfo/XS/convert/call_html_perl_function.c: add const.

2023-12-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_navigation_header, format_navigation_header):
	implement html_default_format_navigation_header.

2023-12-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_formatting_function_format_navigation_panel),
	tp/Texinfo/XS/convert/convert_html.c (unit_is_top_output_unit)
	(format_navigation_panel, format_navigation_header)
	(html_default_format_element_header, format_element_header)
	(convert_heading_command): implement
	html_default_format_element_header, add corresponding
	format_element_header.
	Prepare format_navigation_panel and format_navigation_header, add
	call_formatting_function_format_navigation_panel.

2023-12-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_heading_command):
	destroy the menu that was automatically generated.

	* tp/Texinfo/XS/convert/convert_html.c (convert_heading_command)
	(convert_special_unit_type): free closed_strings list, classes,
	heading.

	* tp/Texinfo/XS/convert/convert_html.c (html_finalize_output_state)
	(html_free_converter): reset and free added_targets.

	* tp/Texinfo/XS/structuring_transfo/structuring.c (print_down_menus):
	destroy the new menu created if there was none in the node.

	* tp/Texinfo/XS/structuring_transfo/structuring.c
	(new_complete_menu_master_menu): destroy temporary menus list.

2023-12-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_formatting_function_format_contents): command can be 0.

	* tp/Texinfo/XS/convert/convert_html.c (convert_heading_command):
	register menu tree to be built to perl.

	* tp/Texinfo/XS/structuring_transfo/structuring.c (print_down_menus):
	do not create menus when looking for them.

	* tp/Texinfo/XS/convert/convert_html.c
	(commands_internal_conversion_table): use convert_heading_command for
	all the heading commands.

	* tp/Texinfo/Convert/HTML.pm (_contents_inline_element),
	tp/Texinfo/XS/convert/convert_html.c (contents_inline_element): rename
	$command argument as $element and other $command as $unit_command.
	Rearrange code.

2023-12-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_register_id, _id_is_registered)
	(%XS_conversion_overrides), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_register_id, html_id_is_registered): access 'seen_ids' through
	functions, _register_id and _id_is_registered.  Add overrides for
	those functions.

2023-12-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_unique_target)
	(_new_sectioning_command_target, _prepare_index_entries_targets): use
	a _unique_target function as in C.

2023-12-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_new_sectioning_command_target): align
	contents and shhortcontents targets code on C code.

	* tp/Texinfo/Convert/HTML.pm (_new_sectioning_command_target),
	tp/Texinfo/XS/convert/convert_html.c (new_sectioning_command_target):
	if @top is empty, set the normalized to be the target base for
	contents_target and shortcontents_target. put contents_target and
	shortcontents_target in seen_ids.

2023-12-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/converter_types.h (FILE_NUMBER_NAME): rename
	CURRENT_FILE_INFO as FILE_NUMBER_NAME.

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_formatting_state), tp/Texinfo/XS/convert/convert_html.c
	(html_command_text, html_free_converter),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): make
	referred_command_stack a stack instead of a list.

	* tp/Texinfo/XS/main/get_perl_info.c (converter_initialize): add and
	use FETCH macro.

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_formatting_state), tp/Texinfo/XS/convert/convert_html.c
	(html_free_converter, get_shared_conversion_state_integer)
	(register_modified_shared_conversion_state_integer),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): add functions to
	pass shared_conversion_state modified integers to perl.

	* tp/Texinfo/XS/convert/convert_html.c (format_protect_text)
	(url_protect_url_text, url_protect_file_text),
	tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_formatting_function_format_protect_text): add.

	* tp/Texinfo/XS/convert/convert_html.c (html_command_id):
	add some const.  Rename target as target_info.

	* tp/Texinfo/XS/convert/convert_html.c (html_get_tree_root_element)
	(new_sectioning_command_target, get_target): use
	element_builtin_data_cmd and variables for the flags to get the
	expected result even with user-defined @-commands.

	* tp/Texinfo/XS/main/get_perl_info.c (converter_initialize),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): add output_format
	and pass from perl.

	* tp/Texinfo/XS/convert/convert_html.c (external_node_href)
	(htmlxref_split_type_names, htmlxref_entries)
	(compare_htmlxref_manual, find_htmlxref_manual)
	(check_htmlxref_already_warned, html_initialize_output_state)
	(html_free_converter), tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_file_id_setting_external_target_split_name)
	(call_file_id_setting_external_target_non_split_name),
	tp/Texinfo/XS/main/converter_types.h (enum htmlxref_split_type)
	(HTMLXREF_MANUAL, HTMLXREF_MANUAL_LIST)
	(HTMLXREF_MANUAL_ELEMENT_WARNED, HTMLXREF_MANUAL_ELEMENT_WARNED_LIST)
	(CONVERTER): get htmlxref from perl, add related functions, set
	self->document_htmlxref_split_type, sort htmlxref information, add
	functions to get and warn if htmlxref not found.  Implement
	external_node_href.

	* tp/Texinfo/XS/convert/call_html_perl_function.c: use SvPVutf8 more.

	* tp/Texinfo/XS/convert/convert_html.c (html_command_filename)
	(command_root_element_command, html_command_href)
	(html_command_contents_target, html_command_contents_href)
	(mini_toc_internal, contents_inline_element, convert_contents_command)
	(convert_heading_command),
	tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_formatting_function_format_contents)
	(call_formatting_function_format_separate_anchor)
	(call_formatting_function_format_element_header)
	tp/Texinfo/XS/convert/call_html_perl_function.h
	(TARGET_DIRECTORY_FILENAME),: implement html_command_filename,
	command_root_element_command, html_command_href,
	html_command_contents_target, html_command_contents_href,
	mini_toc_internal contents_inline_element . Add conversion functions
	convert_contents_command and convert_heading_command. Add perl
	functions call.

2023-12-04  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/setup_converters_code_tables.pl: add include
	command_ids.h in generated cmd_structuring.c.

	* tp/Texinfo/XS/main/errors.c, tp/Texinfo/XS/main/debug.c,
	tp/Texinfo/XS/main/extra.c, tp/Texinfo/XS/main/tree_types.h,
	tp/Texinfo/XS/main/utils.c, tp/Texinfo/XS/main/manipulate_tree.c,
	tp/Texinfo/XS/main/build_perl_info.c: add some const.

	* tp/Texinfo/XS/main/unicode.c (compare_strings): make static.

	* tp/Texinfo/XS/main/utils.c (section_level_adjusted_command_name):
	implement.

	* tp/Texinfo/XS/main/convert_utils.c
	(find_root_command_next_heading_command): implement.

	* tp/Texinfo/XS/main/utils.c (is_content_empty),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(fill_gaps_in_sectioning), tp/Texinfo/XS/main/convert_to_texinfo.c
	(root_heading_command_to_texinfo), tp/Texinfo/XS/main/convert_utils.c
	(find_innermost_accent_contents), tp/Texinfo/XS/main/output_unit.c
	(split_by_node, split_by_section): use element_builtin_data_cmd and
	variables for the flags to get the expected result even with
	user-defined @-commands.

	* tp/Texinfo/XS/main/command_stack.c (push_stack_element)
	(pop_stack_element), tp/Texinfo/XS/main/utils.c: move
	push_stack_element and pop_stack_element to command_stack.c.

	* tp/Texinfo/XS/structuring_transfo/structuring.c (compare_strings):
	make static.

	* tp/Texinfo/XS/structuring_transfo/structuring.c (protect_colon)
	(protect_colon_in_tree, new_complete_menu_master_menu),
	tp/Texinfo/XS/main/manipulate_tree.c (modify_tree)
	(new_asis_command_with_text, protect_text),
	tp/Texinfo/XS/structuring_transfo/transformations.c,
	tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES)
	(StructuringTransfoXS_la_SOURCES, ConvertXS_la_CPPFLAGS): move
	functions from transformations.c to structuring.c and
	manipulate_tree.c to avoid a dependency of structuring.c to
	transformations.c.  Move structuring.c to libtexinfo.la such that
	converters can use functions in structuring.c.

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES, EXTRA_DIST),
	tp/Texinfo/XS/main/utils.c: move cmd_structuring.c out of utils.c.

2023-12-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (command_tree): copy tree in substituted
	strings in argument of gdt to obtain the same output as with XS code.

	* tp/Texinfo/Convert/HTML.pm (_convert_heading_command): fix code
	setting expanded_format_raw sared state.

	* tp/Texinfo/Convert/HTML.pm (_convert_heading_command): rearrange
	code, defining @heading_classes only where it is used.

	* tp/Texinfo/Convert/HTML.pm (_external_node_href): tighten the regexp
	used to remove inf or info extension.  Rename $href as $htmlxref_href.
	Move code.

	* tp/Texinfo/Convert/HTML.pm (_mini_toc): remove useless code.

	* tp/t/html_tests.t ($check_htmlxref_text): add test of .inf as manual
	name extension.

2023-12-02  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (node_line): Rename to
	'node_name' as node_line is a confusing name, the result not
	being a full line but usually only part of a line.

2023-12-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (preformatted_classes_stack),
	doc/texi2any_api.texi (Conversion in Preformatted Context): return a
	reference on an array instead of an array.  Update callers.

	* tp/Texinfo/Convert/HTML.pm
	(_reset_unset_no_arg_commands_formatting_context): use
	_open_command_update_context to set the context of a preformatted
	command.

	* tp/Texinfo/Convert/HTML.pm (_set_code_context, _pop_code_context)
	(_set_string_context, _unset_string_context, _set_raw_context)
	(_unset_raw_context, _convert): add functions to encapsulate
	modification of document context to be able to override them with XS.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_new_document_context)
	(html_pop_document_context, html_open_command_update_context)
	(html_convert_command_update_context, html_open_type_update_context)
	(html_convert_type_update_context, html_set_code_context)
	(html_pop_code_context, html_set_string_context)
	(html_unset_string_context, html_set_raw_context)
	(html_unset_raw_context, html_debug_print_html_contexts)
	(html_in*, html_paragraph_number, html_preformatted_number)
	(html_top_block_command, html_preformatted_classes_stack),
	tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_formatting_state), tp/Texinfo/XS/convert/convert_html.c
	(html_in*, html_paragraph_number html_preformatted_number)
	(html_top_block_command, html_preformatted_classes_stack)
	(html_in_align, html_set_code_context, html_pop_code_context)
	(html_set_string_context) (html_unset_string_context)
	(html_set_raw_context, html_unset_raw_context)
	(html_new_document_context, html_check_transfer_state_finalization)
	(html_open_command_update_context, html_open_type_update_context)
	(html_convert_command_update_context)
	(html_convert_type_update_context, convert_to_html_internal),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): override all
	the functions setting or accessing document context instead of
	keeping track of modifications to pass information to perl.
	Remove code and data related to the previous design, in particular
	remove build_html_document_context_ctx and build_html_document_context

2023-12-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm: use non object oriented call when not
	useful and possibly harmful as we do not want replacement of those
	calls.  For in_preformatted_context, in_math, in_upper_case,
	in_multi_expanded, top_block_command, inside_preformatted.

2023-12-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_text): revert inlining of calls
	to get state information for speed, to be able to override the
	function calls in XS.

	* tp/Texinfo/Convert/HTML.pm: use non object oriented call for in_string
	and _debug_print_html_contexts.

2023-12-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (default_commands_args): reorder to
	have an arg formatting done in the same order in perl and C.

	* tp/Texinfo/XS/convert/convert_html.c (default_commands_args):
	use F_AFT_none as flag for commands that do not have flag set but
	should not have their argument considered as normal.

	* tp/Texinfo/Convert/HTML.pm (_debug_print_html_contexts, _convert),
	tp/Texinfo/XS/convert/convert_html.c (debug_print_html_contexts)
	(convert_to_html_internal): separate the code showing the contexts to
	be able to use it for debugging.

	* tp/Texinfo/XS/convert/convert_html.c (convert_w_command)
	(commands_internal_conversion_table): implement and use
	convert_w_command.

	* tp/Texinfo/XS/convert/convert_html.c (open_quotation_command)
	(commands_internal_open_table): implement and use
	open_quotation_command.

	* tp/Texinfo/XS/convert/convert_html.c (open_inline_container_type):
	implement.

2023-12-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (COMMAND_INTERNAL_CONVERSION)
	(COMMAND_INTERNAL_OPEN, TYPE_INTERNAL_OPEN, types_internal_open_table)
	(commands_internal_conversion_table, commands_internal_open_table)
	(command_open_external, type_open_external)
	(register_type_open_function, register_command_open_function)
	(html_converter_initialize, convert_to_html_internal),
	tp/Texinfo/XS/main/converter_types.h (TYPE_OPEN_FUNCTION)
	(COMMAND_OPEN_FUNCTION, CONVERTER): add type_open_function and
	command_open_function to converter structure and functions to register
	command_open_external (renamed from command_open) and
	type_open_external (renamed from type_open).  Use the function
	references in conversion.  Add commands_internal_conversion_table,
	commands_internal_open_table and types_internal_open_table to list
	functions in C replacing perl functions if the default perl function
	is used.

2023-11-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(default_format_footnotes_segment): free foot_lines.

	* tp/Texinfo/XS/convert/convert_html.c (convert_unit_type)
	(convert_special_unit_type): free closed strings strings.

	* tp/Texinfo/XS/convert/convert_html.c (html_finalize_output_state)
	(html_free_converter): clear pending_inline_content,
	associated_inline_content and shared_conversion_state.integers in
	html_finalize_output_state and free the stack/lists/associated_info
	in html_free_converter.

2023-11-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm
	(associate_pending_formatted_inline_content): remove useless code.

	* tp/Texinfo/Convert/HTML.pm
	(register_pending_formatted_inline_content): do not register undef
	inline_content.

	* tp/Texinfo/Convert/HTML.pm
	(cancel_pending_formatted_inline_content): fix prototype, simpler code
	without intermediary array.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides),
	tp/Texinfo/XS/convert/ConvertXS.xs
	(html_register_pending_formatted_inline_content)
	(html_cancel_pending_formatted_inline_content)
	(html_get_pending_formatted_inline_content)
	(html_associate_pending_formatted_inline_content)
	(html_get_associated_formatted_inline_content),
	tp/Texinfo/XS/convert/convert_html.c
	(html_register_pending_formatted_inline_content)
	(html_cancel_pending_formatted_inline_content)
	(html_get_pending_formatted_inline_content)
	(html_associate_pending_formatted_inline_content)
	(html_get_associated_formatted_inline_content),
	tp/Texinfo/XS/main/converter_types.h (HTML_INLINE_CONTENT)
	(HTML_INLINE_CONTENT_STACK, HTML_ASSOCIATED_INLINE_CONTENT)
	(HTML_ASSOCIATED_INLINE_CONTENT_LIST, CONVERTER): implement
	register_pending_formatted_inline_content,
	cancel_pending_formatted_inline_content and
	get_pending_formatted_inline_content in C and XS interface.
	Implement associate_pending_formatted_inline_content and
	get_associated_formatted_inline_content in C and XS interface.

2023-11-30  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (format_contents):
	Use convert_line_new_context instead of convert_line.

2023-11-29  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (convert_line_new_context):
	New function, like convert_line but with a new context pushed
	onto $self->{'count_context'}.
	(_convert): Use convert_line_new_context wherever we previously
	surrounded a call to convert_line with pushing and popping
	a new context.

2023-11-29  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert_unfilled):
	Inline into the only call site, and remove function.

2023-11-28  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Customizing Footnotes),
	tp/Texinfo/Convert/HTML.pm (get_pending_footnotes)
	(_default_format_footnotes_sequence): have get_pending_footnotes
	return a reference on an array.

	* doc/texi2any_api.texi (Customizing Footnotes),
	tp/Texinfo/Convert/HTML.pm (_convert_footnote_command)
	(_default_format_footnotes_sequence, _convert_footnote_command):
	always pass the number of the footnote to register_footnote.

	* tp/Texinfo/Convert/HTML.pm (shared_conversion_state)
	(_initialize_output_state),
	tp/Texinfo/XS/convert/call_html_perl_function.c
	(get_shared_conversion_state, call_*),
	tp/Texinfo/XS/main/converter_types.h (HTML_SHARED_CONVERSION_STATE)
	(CONVERTER), tp/Texinfo/XS/main/extra.c (add_associated_info_integer):
	register in $self->{'shared_conversion_state_integers'} the conversion
	states that are integers.  Register in
	$self->{'shared_conversion_accessed_integers'} the integer conversion
	states that were accessed such that XS code can get their values.  Get
	the accessed integers at the end of call_* function by calling
	get_shared_conversion_state that add the integer to the C converter
	shared_conversion_state.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_register_footnote)
	(html_get_pending_footnotes),
	tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_pending_footnotes), tp/Texinfo/XS/convert/convert_html.c
	(html_register_footnote, html_get_pending_footnotes)
	(destroy_pending_footnotes), tp/Texinfo/XS/main/converter_types.h
	(HTML_PENDING_FOOTNOTE, HTML_PENDING_FOOTNOTE_STACK, CONVERTER):
	implement register_footnote and get_pending_footnotes in C, add XS
	interface.

	* tp/Texinfo/Convert/HTML.pm (_convert_explained_command):
	rename element_explanation_contents shared_conversion_state as
	element_explanation_content. Avoid using contents separate from the
	associated element.

2023-11-28  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (%parser_state_configuration):
	Add default value for 'restricted'.

2023-11-28  Gavin Smith <gavinsmith0123@gmail.com>

	restricted flag for XS parser

	* tp/Texinfo/XS/parsetexi/end_line.c (parse_line_command_args)
	<@alias, @definfoenclose, @defindex, @defcodeindex>,
	* tp/Texinfo/XS/parsetexi/indices.c (enter_index_entry):
	Do nothing if global_restricted is set.

2023-11-28  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/api.c (reset_parser):
	Reset global_restricted.

2023-11-27  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/parser.c (set_restricted, global_restricted):
	New.
	* tp/Texinfo/XS/parsetexi/macro.c (new_macro): Do nothing if
	global_restricted is set.

	* tp/Texinfo/XS/parsetexi/Parsetexi.xs,
	* tp/Texinfo/XS/parsetexi/api.c (parser_set_restricted):
	New function.  Call set_restricted.

	* tp/Texinfo/Common.pm (%parser_options): Add 'restricted'.
	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (simple_parser):
	Set 'restricted' flag.
	(parser): If 'restricted' flag is set, call parser_set_restricted.

	* tp/t/init_files_tests.t
	(macro_defined_txiinternalvalue_in_translation): Re-add test,
	to check what is done with this input and init file.  From Patrice.

2023-11-27  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (_new_macro),
	(_parse_line_command_args) <@alias, @definfoenclose>
	<@defindex, @defcodeindex>: Do nothing if 'restricted' flag set.

	* tp/t/init_files_tests.t
	(macro_defined_txiinternalvalue_in_translation): Remove test,
	as @macro no longer works inside a translated string.

2023-11-27  Gavin Smith <gavinsmith0123@gmail.com>

	Parser 'restricted' flag

	* tp/Texinfo/ParserNonXS.pm (simple_parser): Add 'restricted'
	flag on parser.
	(_enter_index_entry): Do nothing if flag is set.  This prevents
	index information leaking among simple_parser objects.
	(simple_parser): Re-use indices information.

	* tp/t/init/translation_in_parser_in_translation.pm:
	Do not access index information from translation parser, as it
	isn't there.

2023-11-27  Gavin Smith <gavinsmith0123@gmail.com>

	Re-add simple_parser

	* tp/Texinfo/ParserNonXS.pm, tp/Texinfo/XS/parsetexi/Parsetexi.pm
	(parser, simple_parser): Re-add simple_parser, used for document
	translations.  The only difference from before is that we
	do not share the indices between parsers.
	* tp/Texinfo/Translations.pm (replace_convert_substrings):
	Call simple_parser again.

	This reverses the change on 2023-08-10.

2023-11-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv): fix comparison of default reference
	formatting and customized reference formating to use SvRV.

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_formatting_function_format_footnotes_sequence),
	tp/Texinfo/XS/convert/convert_html.c
	(default_format_footnotes_segment, format_footnotes_segment)
	(convert_unit_type, html_convert_convert, html_convert_output): add
	call_formatting_function_format_footnotes_sequence, implement
	default_format_footnotes_segment in C.

2023-11-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_unit_type)
	(output_units_internal_conversion_table): implement convert_unit_type.

	* tp/Texinfo/Convert/HTML.pm (_convert_unit_type): only use
	$output_unit as variable name.

2023-11-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Transformations.pm (fill_gaps_in_sectioning),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs
	(fill_gaps_in_sectioning),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(fill_gaps_in_sectioning): new optional Texinfo tree argument for
	fill_gaps_in_sectioning to use for all the added commands headings
	instead of an empty @asis.

	* Pod-Simple-Texinfo/pod2texi.pl,
	Pod-Simple-Texinfo/manual_tests/reference_Th1.texi,
	Pod-Simple-Texinfo/manual_tests/reference_sectioning_gap.texi:
	setup a Texinfo tree with the manual name to use as
	fill_gaps_in_sectioning argument if the sectioning base level is > 0.

	* Pod-Simple-Texinfo/manual_tests/manual_sectioning_gap_test.sh,
	manual_tests/Module1.pod, manual_tests/Module2.pod,
	manual_tests/reference_includes/
	manual_tests/reference_modules_main.texi: new manual test with two
	modules.

2023-11-26  Gavin Smith <gavinsmith0123@gmail.com>

	No 'first_indent_length' option for new_formatter

	* tp/Texinfo/Convert/Plaintext.pm (new_formatter):
	Eliminate 'first_indent_length' as a possible configuration
	option.  This is not used by the paragraph formatting module
	itself, and was only used at place new_formatter was called.
	This means the options passed to new_formatter are now the
	same as those used for the paragraph formatter.
	(_convert) <paragraph indent>: Set 'indent_length' and
	'indent_length_next' here, rather than 'first_indent_length'.

2023-11-26  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (new_formatter):
	Propagate two formatter options directly rather than in a loop.

2023-11-26  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (new_formatter):
	Do not set 'indent_level' on config structure passed to paragraph
	formatter, as it is not used.
	(_convert): Do not call new_formatter with 'indent_level' in the
	conf, setting 'indent_length' instead.

2023-11-26  Gavin Smith <gavinsmith0123@gmail.com>

	new_formatter tweaks

	* tp/Texinfo/Convert/Plaintext.pm (new_formatter):
	Save value of a configuration variable to reuse it.
	Reorder conditional to check for 'paragraph' formatter first
	as this is the most frequently used.

2023-11-26  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (new_formatter):
	Do no save the "type" of the formatter (line/paragraph/unfilled).
	(_convert) <@image>: Reset 'empty_lines_count' regardless of
	formatter type.
	<"format raw commands">: Always flush the output of the current
	formatter, not just for "paragraph" formatters.  Do not output
	an extra end of line afterwards.

2023-11-26  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/pod2texi.pl (_parsed_manual_tree): modify code to
	avoid using separately contents and elements clarify what is actually
	done.  Update information in FIXME comment.

2023-11-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/ParagraphNonXS.pm: remove a FIXME comment fixed.
	* tp/TODO: update.

2023-11-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am b/tp/Makefile.am (dist_init_DATA): add
	init/sc_formatting_with_css.pm.

2023-11-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XSLoader.pm (init): call $module->import when falling
	back on pure perl module, not Texinfo::Parser->import.

2023-11-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/DocumentXS.xs (gdt): update build_texinfo_tree
	call.

	* tp/Makefile.am (dist_modules_DATA), tp/Texinfo/StructTransfXS.pm,
	tp/Texinfo/XS/Makefile.am (StructuringTransfoXS*),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfoXS.xs: rename
	StructTransf to StructTransfXS and StructuringTransfo to
	StructuringTransfoXS.

2023-11-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/DocumentXS.xs (gdt): move from TranslationsXS to
	DocumentXS.  Remove TranslationsXS.pm and TranslationsXS.xs.

	* tp/Texinfo/XSLoader.pm (init): update message.

2023-11-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (section_level),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block)
	(end_line_misc_line), tp/Texinfo/XS/parsetexi/handle_commands.c
	(handle_other_command), tp/Texinfo/XS/parsetexi/separator.c
	(handle_comma): use lookup_extra_* functions with a specific type and
	dynaic type checking, when possible.

	* tp/Texinfo/XS/parsetexi/macro.c: reindent.

	* tp/Texinfo/XS/parsetexi/separator.c (handle_open_brace): use a
	variable name for clearer code.

2023-11-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/debug.c (print_associate_info_debug),
	tp/Texinfo/XS/main/extra.c (lookup_extra_integer),
	tp/Texinfo/XS/main/manipulate_tree.c (increase_ref_counter)
	(get_copy_ref), tp/Texinfo/XS/main/tree_types.h (KEY_PAIR),
	tp/Texinfo/XS/main/utils.c (section_level),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_other_command)
	(handle_line_command): use int for the integer field in KEY_PAIR values
	union. Update declarations and remove casts.

2023-11-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree.c (remove_from_element_list): do not accept
	a where index equal to list->number.  Do not call memmove if it is not
	needed.

	* tp/Texinfo/XS/convert/convert_html.c (count_elements_in_filename):
	fix result with CEFT_current.

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv): use simplified_special_unit_info
	instead of special_unit_info to get all the information.

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_formatting_state), tp/Texinfo/XS/convert/convert_html.c
	(html_free_converter), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER): add referred_command_stack, add code to free and pass to
	perl.

	* tp/Texinfo/XS/convert/convert_html.c (new_tree_added_elements)
	(clear_tree_added_elements, free_tree_added_elements)
	(destroy_tree_added_elements, new_element_added),
	tp/Texinfo/XS/main/tree_types.h (enum tree_added_elements_status)
	(TREE_ADDED_ELEMENTS): add functions and structure to handle trees
	with added elements and Texinfo tree elements, or new tree obtained
	from gdt, in order to manage memory correctly, and unregister elements
	that were scheduled to be built for perl but are destroyed.

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(build_tree_to_build, call_*), tp/Texinfo/XS/convert/convert_html.c
	(special_unit_info_tree, html_finalize_output_state)
	(html_check_transfer_state_finalization)
	(reset_unset_no_arg_commands_formatting_context),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER),
	tp/Texinfo/XS/main/tree.c (add_element_if_not_in_list): change
	tree_to_build to be a list.  Add and remove from the list, and add
	build_tree_to_build to build all the elements to perl in call_*
	functions.

	* tp/Texinfo/XS/main/build_perl_info.c (element_to_perl_hash)
	(build_perl_array, build_perl_container, build_perl_directions)
	(store_additional_info, build_texinfo_tree): add an argument,
	avoid_recursion, to recurse into children or out of tree elements only
	if hv is not already set.  Update callers.

	* tp/Texinfo/XS/convert/converter.c (float_type_number): add.

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_formatting_function_format_heading_text)
	(call_formatting_function_format_element_footer): add.

	* tp/Texinfo/XS/convert/convert_html.c (html_command_tree)
	(html_command_text, reset_html_targets, html_translate_names)
	tp/Texinfo/XS/main/converter_types.h (enum html_command_text_type)
	(HTML_TARGET): add. Update HTML_TARGET. Set and free html_target tree,
	tree_nonumber and command_text.

	* tp/Texinfo/XS/convert/convert_html.c (convert_special_unit_type)
	(output_units_internal_conversion_table): finish implementation of
	convert_special_unit_type.

	* tp/Texinfo/XS/main/translations.c (replace_substrings)
	(add_element_to_named_string_element_list)
	(add_string_to_named_string_element_list),
	tp/Texinfo/XS/main/translations.h (NAMED_STRING_ELEMENT): add some
	const.

	* tp/Texinfo/XS/main/output_unit.c (output_unit_texi),
	tp/Texinfo/Structuring.pm (output_unit_texi): better debug
	message.

2023-11-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (count_elements_in_filename)
	(_convert_special_unit_type): do not pass an undefined file name to
	count_elements_in_filename.

	* tp/Texinfo/Convert/Converter.pm (float_type_number): simplify code.

	* tp/Texinfo/Convert/HTML.pm (command_tree): remove code never run.
	Simplify code.

	* tp/Texinfo/Convert/HTML.pm (command_text): reorganize code. Handle
	string_nonumber similarly to text_nonumber. Introduce more
	intermediate variables, change variables names.

2023-11-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/03coverage_braces.t
	(two_footnotes_in_nodes_separate_no_header): add test with special
	output unit, HEADERS == 0 and conversion through convert.

2023-11-25  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_process_text):
	Inline into the only call site for efficiency, as this is
	a very frequently called function.

2023-11-25  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/api.c (find_locales_dir):
	Remove unused function (it is also incorrect according to
	the comments).

2023-11-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/manipulate_tree.c (increase_ref_counter)
	(get_copy_ref): do not use intptr_t anymore for _counter associated
	integer, now that the integer is accessed more directly.

2023-11-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/extra.c (lookup_extra_string)
	(lookup_extra_integer, lookup_extra_contents): more check of
	consistency of lookup_* function with extra_* type.

2023-11-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/output_unit.h (relative_unit_direction_name),
	tp/Texinfo/XS/main/tree_types.h: move relative_unit_direction_name
	from tree_types.h to output_unit.h.  Gavin idea.

2023-11-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_free_converter): free
	self->special_unit_body and self->special_unit_body_formatting.

2023-11-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/indices_in_conversion.c
	(index_content_element): def_command extra information is a string.

	* tp/Texinfo/XS/main/extra.c (lookup_extra_element): runtime check for
	extra_* type.

	* tp/Texinfo/XS/main/build_perl_info.c (store_additional_info),
	tp/Texinfo/XS/main/debug.c (print_associate_info_debug),
	tp/Texinfo/XS/main/extra.c (add_extra_contents)
	(lookup_extra_contents), tp/Texinfo/XS/main/manipulate_tree.c
	(copy_associated_info, associate_info_references),
	tp/Texinfo/XS/main/tree.c (destroy_associated_info),
	tp/Texinfo/XS/main/tree_types.h (KEY_PAIR): use an ELEMENT_LIST to
	hold extra_contents extra information type data.

	* tp/Texinfo/XS/main/manipulate_tree.c (first_menu_node),
	tp/Texinfo/XS/main/output_unit.c (units_directions),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command)
	(handle_block_command),
	tp/Texinfo/XS/structuring_transfo/structuring.c (sectioning_structure)
	(get_node_node_childs_from_sectioning, check_nodes_are_referenced)
	(set_menus_node_directions, complete_node_tree_with_menus, nodes_tree)
	(print_down_menus, new_master_menu),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(reassociate_to_node, prepend_new_menu_in_node_section)
	(complete_node_menu, complete_tree_nodes_missing_menu)
	(regenerate_master_menu): use ELEMENT_LIST, lookup_extra_contents,
	add_extra_contents with extra_contents extra items.

2023-11-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (store_additional_info): readd
	cast to intptr_t, as it should be tested on the platforms where it
	could matter.

	* tp/Texinfo/XS/main/extra.c (lookup_info_string): add
	lookup_info_string.

	* tp/Texinfo/XS/main/builtin_commands.c (element_command_name),
	tp/Texinfo/XS/main/convert_to_texinfo.c (expand_cmd_args_to_texi),
	tp/Texinfo/XS/parsetexi/close.c (close_brace_command),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): use
	lookup_info_string.

2023-11-24  Patrice Dumas  <pertusus@free.fr>

	Use an union for KEY_PAIR value.

	* tp/Texinfo/XS/main/tree_types.h (KEY_PAIR),
	tp/Texinfo/XS/main/build_perl_info.c (store_additional_info),
	tp/Texinfo/XS/main/debug.c (print_associate_info_debug),
	tp/Texinfo/XS/main/extra.c (get_associated_info_key, add_*, lookup_*),
	tp/Texinfo/XS/main/manipulate_tree.c (copy_associated_info)
	(associate_info_references), tp/Texinfo/XS/main/tree.c
	(destroy_associated_info): use a union for the KEY_PAIR value instead
	of casting.  Replace add_associated_info_key by
	get_associated_info_key which does not set the value.
	Update other codes to use the union instead of value.

2023-11-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (parse_node_manual), tp/Texinfo/Convert/HTML.pm
	(command_tree, _convert_xref_commands, _convert_menu_entry_type)
	(_normalized_label_id_file, _external_node_href),
	tp/Texinfo/Convert/Info.pm (format_node), tp/Texinfo/Convert/LaTeX.pm
	(_convert), tp/Texinfo/Convert/Plaintext.pm (node_line),
	tp/Texinfo/Convert/Texinfo.pm (link_element_to_texi)
	(check_node_same_texinfo_code), tp/Texinfo/Convert/TexinfoMarkup.pm
	(_convert), tp/Texinfo/ParserNonXS.pm (_end_line_misc_line)
	(_register_extra_menu_entry_information, _handle_close_brace),
	tp/Texinfo/Structuring.pm (associate_internal_references)
	(new_node_menu_entry), tp/Texinfo/XS/main/build_perl_info.c
	(build_perl_container, store_additional_info),
	tp/Texinfo/XS/main/debug.c (print_associate_info_debug),
	tp/Texinfo/XS/main/extra.c (add_extra_container),
	tp/Texinfo/XS/main/manipulate_tree.c (copy_associated_info)
	(associate_info_references), tp/Texinfo/XS/main/tree.c
	(destroy_associated_info), tp/Texinfo/XS/main/tree_types.h
	(extra_type), tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line),
	tp/Texinfo/XS/parsetexi/menus.c
	(register_extra_menu_entry_information),
	tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace),
	tp/Texinfo/XS/structuring_transfo/structuring.c (new_node_menu_entry):
	have parse_node_manual in perl return an element as in C.  Update
	callers.  In C use a new extra type, extra_container, very similar to
	extra_contents, but passed to perl as an element with contents, in
	build_perl_container.

2023-11-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (command_tree, _convert_xref_commands)
	(_convert_menu_entry_type), tp/Texinfo/Convert/Info.pm (format_node),
	tp/Texinfo/Convert/LaTeX.pm (_convert),
	tp/Texinfo/Convert/Plaintext.pm (_convert): always use
	'manual_content' and 'node_content' in an element with them as sole
	contents.

	* tp/Texinfo/Convert/LaTeX.pm (_convert),
	tp/Texinfo/Convert/Plaintext.pm (process_footnotes, node_line)
	(image_formatted_text, format_image, _convert): avoid
	using contents separately from the element they are content of.

2023-11-23  Gavin Smith <gavinsmith0123@gmail.com>

	* info/window.c (window_make_modeline): Include any numbered
	version suffix in the displayed manual name, so
	automake-1.16.info.gz displays as (automake-1.16) not (automake-1).

2023-11-23  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/configure.ac (perl_conf_LDFLAGS) [MS-Windows]:
	Append extra flags to perl_conf_LDFLAGS after -no-undefined check,
	rather than setting a HOST_NEEDS_NO_UNDEFINED automake conditional.
	(lookup_perl_conf): No longer AC_SUBST perl config values as these
	values are no longer required in Makefile.am.

	* tp/Texinfo/XS/Makefile.am (PLATFORM_LDFLAGS): No longer set
	or refer to separately from perl_conf_LDFLAGS.

	Confining changes to the compilation flags to configure.ac
	potentially makes it easier to include these changes in configure
	checks if it is ever found to be necessary.

2023-11-22  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Element Direction Information Type),
	tp/Texinfo/Convert/HTML.pm (%valid_direction_return_type): do not
	accept tree nor tree_nonumber as from_element_direction types.

	* doc/texi2any_api.texi (Target Commands Links@comma{} Texts and
	Associated Commands), tp/Texinfo/Convert/HTML.pm (command_tree)
	(command_text): separate command_tree function, using code from
	command_text to get the tree or tree without number.  Update callers.

	* tp/Texinfo/Convert/HTML.pm (_file_header_information): do not use
	a command_string if the string is empty.

2023-11-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_html_perl_info.c,
	tp/Texinfo/XS/main/get_perl_info.c
	(html_get_button_specification_list),
	tp/maintain/regenerate_C_options_info.pl: move
	html_get_button_specification_list to get_html_perl_info.c, as it is
	needed by options_get_perl.c in libtexinfoxs.

2023-11-22  Gavin Smith <gavinsmith0123@gmail.com>

	* INSTALL: elaborate on PERL_EXT_* variables for building
	XS modules, why they are needed and how to override them when
	running make.

2023-11-22  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/Makefile.am,
	* tp/Texinfo/XS/configure.ac (PERL_INC, XSUBPPARGS): Define in
	configure.ac and propagate to Makefile.am, so it is more clear what
	"archlibexp" and "privlibexp" from the Perl conf are being used for.

2023-11-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_special_unit_type): rename
	element as output_unit.

	* tp/Texinfo/XS/convert/convert_html.c (enum
	count_elements_in_filename_type, count_elements_in_filename):
	implement count_elements_in_filename.

	* tp/Texinfo/Convert/HTML.pm (_XS_converter_initialize)
	(converter_initialize), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_converter_initialize_sv),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv): get special_unit_body formatting
	references from perl.

	* tp/Texinfo/XS/convert/convert_html.c
	(OUTPUT_UNIT_INTERNAL_CONVERSION, output_unit_conversion_external)
	(special_unit_body_formatting_external)
	(register_output_unit_conversion_function)
	(register_special_unit_body_formatting_function)
	(html_converter_initialize, convert_output_unit),
	tp/Texinfo/XS/main/converter_types.h (OUTPUT_UNIT_CONVERSION_FUNCTION)
	(SPECIAL_UNIT_BODY_FORMATTING, CONVERTER): add special unit
	body formatting function setup and the possibilty to convert output
	unit using a C function.  

	* tp/Texinfo/XS/convert/convert_html.c (convert_special_unit_type),
	tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_formatting_function_format_navigation_header)
	(call_special_unit_body_formatting),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_get_button_specification_list),
	tp/Texinfo/XS/main/converter_types.h (enum button_specification_type)
	(enum button_information_type, BUTTON_SPECIFICATION_INFO)
	(BUTTON_SPECIFICATION, BUTTON_SPECIFICATION_LIST),
	tp/Texinfo/XS/main/document_types.h,
	tp/maintain/regenerate_C_options_info.pl: add preliminary types for
	buttons specifications, declare struct OPTIONS in document_types.h and
	converter_types.h to avoid an interdependency between those files and
	included files and options_types.h. Get buttons specifications from
	perl. Add functions to call format_navigation_header and special unit
	body formatting from C.
	Incomplete implementation of convert_special_unit_type.

2023-11-22  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/setup_converters_code_tables.pl: set ENV{'TEXINFO_XS'} =
	'omit' to avoid depending on XS code being loaded.

2023-11-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(html_get_css_elements_classes): free selectors.

	* tp/Texinfo/XS/convert/convert_html.c (html_finalize_output_state),
	tp/Texinfo/XS/main/converter_types.h (CSS_LIST, CSS_SELECTOR_STYLE):
	free self->page_name_number, self->page_css and
	self->css_element_class_styles structures.  Free self->pending_closes
	stack.

2023-11-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (html_get_css_elements_classes)
	(_default_format_css_lines), doc/texi2any_api.texi (Customizing CSS):
	have html_get_css_elements_classes return a reference on an array, not
	an array.

	* tp/Texinfo/Convert/HTML.pm: rename $self->{'file_css'} as
	$self->{'page_css'}.

	* tp/Texinfo/Convert/HTML.pm (convert),
	tp/Texinfo/XS/convert/convert_html.c (html_convert_convert): set
	current_filename in _html_convert_convert.

	* tp/Texinfo/XS/main/get_perl_info.c (add_svav_to_string_list),
	tp/Texinfo/XS/main/get_perl_info.h (enum sv_string_type),
	tp/maintain/regenerate_C_options_info.pl: add the possibility to get
	utf-8 strings in add_svav_to_string_list, and use enum to specify the
	type of strings.  Update callers.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_title_titlepage),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_prepare_output_sv),
	tp/Texinfo/XS/convert/convert_html.c (html_converter_prepare_output),
	tp/Texinfo/XS/main/converter_types.h (CSS_SELECTOR_STYLE)
	(CSS_SELECTOR_STYLE_LIST, CONVERTER): add
	html_converter_prepare_output_sv and call it in
	html_prepare_title_titlepage to have XS code called just before the
	conversion.  html_converter_prepare_output_sv calls
	html_converter_prepare_output for code that do not need interaction
	with perl.  Use those functions to import css_element_class_styles
	information from perl.

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_formatting_state), tp/Texinfo/XS/convert/convert_html.c
	(html_convert_convert, convert_output_output_unit_internal)
	(html_prepare_title_titlepage, html_convert_output),
	tp/Texinfo/XS/main/converter_types.h (CURRENT_FILE_INFO, CONVERTER): 
	use CURRENT_FILE_INFO for current_file, adding the index in output
	files.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_attribute_class)
	(html_get_css_elements_classes), tp/Texinfo/XS/convert/convert_html.c
	(compare_page_name_number, find_page_name_number)
	(compare_selector_style, find_css_selector_style)
	(collect_css_element_class, compare_strings)
	(html_get_css_elements_classes, protect_class_name)
	(html_attribute_class, html_set_pages_files, setup_output_simple_page)
	(html_prepare_units_directions_files)
	(html_prepare_units_directions_files),
	tp/Texinfo/XS/main/converter_types.h (PAGE_NAME_NUMBER)
	(PAGE_NAME_NUMBER_LIST, CSS_LIST, PAGES_CSS_LIST, CONVERTER):
	implement collect_css_element_class, protect_class_name,
	html_get_css_elements_classes and html_attribute_class in C, and add
	XS interfaces for html_attribute_class and
	html_get_css_elements_classes.

2023-11-21  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/Makefile.am (libtexinfoxs_la_LDFLAGS):
	Refer to $(perl_conf_LDFLAGS) instead of $(PERL_CONF_ccdlflags)
	to make it easier to compare with XSLIBS_LDFLAGS.
	(AM_LDFLAGS): Remove references to this variable throughout,
	as it is not defined anywhere any more, and not a variable the
	user should be redefining from the command line.

2023-11-21  Gavin Smith <gavinsmith0123@gmail.com>

	XS build flags

	* tp/Texinfo/XS/Makefile.am (XSLIBS_LDFLAGS): Add a comment
	stating that -avoid-version and -module are recognised by libtool
	to make it clear where to look for documentation on these options.
	No functional changes intended.

2023-11-20  Patrice Dumas  <pertusus@free.fr>

	HTML css functions API change, split information and selector rules

	* doc/texi2any_api.texi (Simple Customization of CSS),
	tp/Texinfo/Convert/HTML.pm (css_add_info, css_set_selector_style)
	(css_get_info, css_selector_style), tp/init/sc_formatting_with_css.pm,
	tp/init/documentation_examples.pm: split css_set_selector_style out of
	css_add_info for setting of selector CSS style.  Split
	css_selector_style out of css_get_info to get selector CSS style.
	Also css_get_info returns the list of selectors, not a hash.  Update
	callers.

2023-11-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/build_html_perl_state.c (build_html_target)
	(build_html_element_targets, add_html_element_target)
	(pass_html_element_targets, build_html_special_targets): split
	build_html_element_targets in three functions to be able to build one
	html target, and add one.

	* tp/Texinfo/XS/convert/convert_html.c
	(convert_output_output_unit_internal): add a flag for
	file_changed_counter, to be sure that the state is rebuilt.

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_formatting_state), tp/Texinfo/XS/convert/convert_html.c
	(register_added_target, get_target, html_command_id),
	tp/Texinfo/XS/main/converter_types.h (HTML_ADDED_TARGET_LIST)
	(CONVERTER): add get_target and html_command_id and rebuild perl
	state with a new target.

2023-11-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XSLoader.pm (init): avoid undefined value in warning
	message.

	* tp/Texinfo/Convert/HTML.pm (register_opened_section_level)
	(close_registered_sections_level): change variable names.

	* tp/Texinfo/Convert/HTML.pm (close_registered_sections_level): return
	a reference on an array, not an array.  Update callers.

	* tp/Texinfo/Convert/HTML.pm (_initialize_output_state): initialize
	$self->{'pending_closes'} here.

	* tp/Texinfo/Convert/HTML.pm (%XS_conversion_overrides),
	tp/Texinfo/XS/convert/ConvertXS.xs
	(html_register_opened_section_level)
	(html_close_registered_sections_level),
	tp/Texinfo/XS/convert/convert_html.c
	(html_register_opened_section_level)
	(html_close_registered_sections_level, html_finalize_output_state),
	tp/Texinfo/XS/main/command_stack.c (clear_string_stack),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): add
	clear_string_stack.  Implement register_opened_section_level and
	close_registered_sections_level in C with an XS interface.

	* tp/Texinfo/XS/main/command_stack.c (push_string_stack_string)
	(top_string_stack): add const.

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_formatting_state): declare multiple_pass variables inside
	the block.

	* doc/texi2any_api.texi: updates.

2023-11-20  Gavin Smith <gavinsmith0123@gmail.com>

	XS build flags

	* tp/Texinfo/XS/configure.ac (perl_conf_CFLAGS, perl_conf_LDFLAGS):
	Set and output with AC_SUBST.  Append to CFLAGS and LDFLAGS for
	checks only.
	* tp/Texinfo/XS/Makefile.am: Reuse perl_conf_CFLAGS and
	perl_conf_LDFLAGS.  This makes it clearer that we are adding the
	same flags for building as for configure checks.

2023-11-19  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.supp: Add suppression specification for leaks and errors
	associated to setenv, getenv and translations showing up with t/19def.t.

2023-11-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_free_converter): rename
	html_destroy as html_free_converter.

	* tp/Texinfo/XS/convert/ConvertXS.xs (destroy),
	tp/Texinfo/XS/convert/converter.c (converter_list, new_converter)
	(retrieve_converter, unregister_converter_descriptor),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv): use a list of pointers to converters
	in converter_list.  Add new_converter to allocate a converter,
	replacing register_converter.  Add unregister_converter_descriptor
	that removes a converter from converter_list and frees it.

	* tp/Texinfo/XS/convert/converter.c (html_free_converter): free
	special_unit_info.  Free html_document_context.stack.

2023-11-19  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.supp: Add suppression specification for leaks associated
	to switch_to_global_locale and setenv showing up with t/19def.t
	all_commands_delimiters.

2023-11-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/get_perl_info.c (set_output_converter_sv):
	free converter->conf itself after freeing the options if it was set.

2023-11-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (command_conversion_external)
	(type_conversion_external, register_type_conversion_function)
	(register_command_conversion_function, html_converter_initialize)
	(html_destroy, html_convert_css_string, convert_to_html_internal),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): make
	type_conversion_function and command_conversion_function array
	of structures, not of pointers on structures.

2023-11-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/converter_types.h (TYPE_CONVERSION_FUNCTION)
	(COMMAND_CONVERSION_FUNCTION): declare struct CONVERTER; before
	defining TYPE_CONVERSION_FUNCTION and COMMAND_CONVERSION_FUNCTION,
	and define those structures before CONVERTER.  Solution from Gavin.

2023-11-19  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/texi2any.supp: Add variant suppression specification
	for setenv error.

2023-11-19  Patrice Dumas  <pertusus@free.fr>

	* INSTALL: document TEXINFO_XS_STRUCTURE and TEXINFO_XS_CONVERT use.

2023-11-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/ConvertXS.pm, tp/Texinfo/Convert/Converter.pm,
	tp/Texinfo/Convert/HTML.pm, tp/Texinfo/Convert/PlainTexinfo.pm,
	tp/Texinfo/Convert/Texinfo.pm, tp/Texinfo/Convert/Text.pm: load XS
	related to conversion only if structure is also done by XS.

2023-11-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm ($XS_parser, $XS_structuring, %XS_overrides)
	(%XS_structure_overrides, import): use hashes for XS overrides.  Do
	not load rebuild_document and rebuild_tree if XS is not used for
	structure.

2023-11-19  Patrice Dumas  <pertusus@free.fr>

	Explicit void for argument of C functions. Gavin report.

2023-11-18  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/main/tree_types.h: Correct file name in a
	comment.

2023-11-18  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (xspara__add_next): Check return value
	for u8_mbtouc as documented, by checking for 0xfffd (replacement
	character), instead of using the same as mbrtowc. 

2023-11-18  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/context_stack.c (pop_context):
	Define with (void) parameter list rather than ().

2023-11-18  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c: Remove include directives for several
	header files that we don't need any more due to using libunistring
	functions instead of locale-dependent libc functions.
	[_WIN32] (w32_setlocale, mbrlen, mbrtowc, iswspace, iswupper):
	Remove these now-unused implementations.

2023-11-18  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/texi2any.supp: Add suppression for memory leak with
	switch_to_global_locale.

2023-11-18  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/main/translations.c (translate_string):
	Remove commented-out code, the purpose of which is not evident.
	Remove FIXME comment as this should be working now we call
	switch_to_global_locale.

2023-11-18  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/main/translations.c (translate_string):
	Exdent preprocessor #ifndef directives.  Add a return statement
	to #ifndef block to avoid wrapping the rest of the function in
	the #else block.

2023-11-18  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/main/translations.c (translate_string):
	Remove commented-out Perl code and comments.  It's hard
	to read and does not match the current Perl code in
	Texinfo/Translations.pm.

2023-11-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(html_open_command_update_context, convert_to_html_internal)
	tp/Texinfo/XS/main/call_perl_function.c
	(call_latex_convert_to_latex_math): add
	call_latex_convert_to_latex_math to call
	Texinfo::Convert::LaTeX::convert_to_latex_math from XS, and use it in
	convert_to_html_internal.

	* tp/t/html_tests.t: do not skip mathjax tests with XS.

2023-11-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_open_command_update_context)
	(_convert_command_update_context, _open_type_update_context)
	(_convert_type_update_context, _convert),
	tp/Texinfo/XS/convert/convert_html.c
	(html_open_command_update_context)
	(html_convert_command_update_context, html_open_type_update_context)
	(html_convert_type_update_context, convert_to_html_internal): use
	functions for state update, and modify when updating takes place for
	types, before open and before the type element formatting.

	* tp/Texinfo/XS/convert/convert_html.c
	(special_characters_formatting): use numeric entities.

	* tp/Texinfo/XS/convert/convert_html.c (in_string): add.

	* tp/Texinfo/XS/convert/convert_html.c (convert_row_type)
	(types_internal_conversion_table): row type conversion in C.

2023-11-17  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/main/convert_utils.c
	(convert_to_utf8, convert_to_utf8_verbatiminclude):
	Rename function to avoid confusion with convert_to_utf8 in input.c.

2023-11-17  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/main/api_to_perl.c (croak_message):
	Add wrapper for Perl croak.  Useful for debugging.

2023-11-17  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/texi2any.supp: Use "..." in suppressions file to allow
	for varying numbers of times tdestroy_recurse appears in the stack
	trace.

2023-11-17  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/regenerate_C_options_info.pl: handle value set
	from perl being undef.

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv): remove unused variable.

2023-11-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/ConvertXS.pm: remove fallback module.

	* tp/Texinfo/XSLoader.pm (init): update fatal error message.

2023-11-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/element_types.awk,
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): output code defining
	TXI_TREE_TYPES_NUMBER to the number of tree element types.  Update
	codes that used the last type instead.

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/builtin_commands.c
	(TYPE_INDEX, type_name_index, compare_type_index_fn)
	(set_element_type_name_info, find_element_type),
	tp/Texinfo/XS/convert/ConvertXS.xs (init): prepare a list of element
	types names and type number in set_element_type_name_info and sort.
	Called from init in ConvertXS.xs.  Add find_element_type to find the
	type of a type name and use it in html_converter_initialize_sv.

2023-11-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/command_stack.c (top_integer_stack): use correct
	function name instead of top_integer_context.

	* tp/Texinfo/XS/main/get_perl_info.c (converter_initialize)
	(set_output_converter_sv): set conf already in converter_initialize.

	* tp/Texinfo/XS/main/unicode.h (OTXI_UNICODE_TEXT_CASES): always
	increase var after appending.  Use a constant "-".

	* tp/Texinfo/XS/convert/convert_html.c (special_characters_formatting)
	(in_non_breakable_space, in_space_protected)
	(OTXI_ISO_ENTITY_TEXT_CASES, OTXI_NO_ISO_ENTITY_TEXT_CASES)
	(OTXI_NO_BREAK_CASES, OTXI_SPACE_PROTECTION_CASES, OTXI_CONVERT_TEXT)
	(OTXI_ALL_CONVERT_TEXT, html_default_format_protect_text)
	(convert_text, html_converter_initialize)
	(types_internal_conversion_table), tp/Texinfo/XS/convert/converter.c
	(xml_format_text_with_numeric_entities),
	tp/Texinfo/XS/convert/converter.h (OTXI_NUMERIC_ENTITY_TEXT_CASES),
	tp/Texinfo/XS/main/converter_types.h (enum html_special_character)
	(STRING_WITH_LEN, CONVERTER): use macros to generate inline code for
	text conversion, remove protect_text_unicode_text,
	protect_text_use_iso_entities and protect_text_no_iso_entities.  Setup
	special characters and line_break_element.

2023-11-16  Patrice Dumas  <pertusus@free.fr>

	* tp/t/input_files/punctuation_small_case_accents_latin1.texi,
	tp/t/input_files/punctuation_small_case_accents_utf8.texi,
	tp/t/input_files/punctuation_small_case_accents_us_ascii.texi:
	add an encoded character in @sc.

2023-11-16  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/texi2any.supp: Add valgrind suppression file.  Add
	suppressions for setenv bug with perl 5.36 and earlier.

2023-11-16  Gavin Smith <gavinsmith0123@gmail.com>

	* contrib/nontests/latex2html.test: Remove.
	* contrib/nontests/bibtex.test, contrib/nontests/defs.in:
	Remove checks using hevea.
	* configure.ac: Delete commented-out AC_CHECK_PROGS line for hevea.
	* contrib/nontests/Makefile.am: Remove as file is unused.

2023-11-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_types_conversion, call_types_open, call_commands_conversion)
	(call_commands_open, call_output_units_conversion),
	tp/Texinfo/XS/convert/convert_html.c (TYPE_INTERNAL_CONVERSION)
	(convert_table_term_type, command_conversion_external)
	(command_open, type_conversion_external, type_open)
	(convert_to_html_internal, output_unit_conversion)
	(convert_output_unit, convert_convert_output_unit_internal):
	pass TEXT to gather conversion results instead of returning char *.
	Also more const for functions arguments.

	* tp/Texinfo/XS/convert/convert_html.c
	(convert_output_output_unit_internal): use text->end for res_len
	if possible.

2023-11-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_text, convert, output),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_conversion_units):
	cache OUTPUT_CHARACTERS and OUTPUT_ENCODING_NAME equal to utf8
	in self->use_unicode_text.

	* tp/Texinfo/Convert/HTML.pm (output): keep documentlanguage
	as in preamble until the beginning of conversion.

	* tp/Texinfo/XS/convert/convert_html.c (protect_text_unicode_text),
	tp/Texinfo/XS/main/unicode.h (OTXI_UNICODE_TEXT_CASES): add conversion
	of text to HTML with encoded characters.

2023-11-15  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (xspara_add_text, xspara__add_next):
	Cast char * to uint8_t * when calling u8_mbtouc to avoid a
	compiler warning.  This is valid as we know the strings we are
	getting from Perl are UTF-8 encoded.
	(xspara_add_text): Avoid a warning about a variable possibly
	being undefined.

2023-11-15  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Conversion in Preformatted Context),
	tp/Texinfo/Convert/HTML.pm (in_preformatted_context),
	tp/Texinfo/Convert/HTML.pm (inside_preformatted): rename
	in_preformatted as in_preformatted_context and
	_in_preformatted_in_menu as inside_preformatted.

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_formatting_state), tp/Texinfo/XS/convert/convert_html.c
	(html_new_document_context, convert_to_html_internal),
	tp/Texinfo/XS/main/build_perl_info.c (build_integer_stack),
	tp/Texinfo/XS/main/command_stack.c (push_integer_stack_integer)
	(pop_integer_stack, top_integer_context),
	tp/Texinfo/XS/main/converter_types.h (INTEGER_STACK, CONVERTER):
	replace the monospace stack by a generic integer stack with the same
	functionalities.  Remove enum monospace_context.

	* tp/Texinfo/Convert/HTML.pm (in_preformatted_context)
	(inside_preformatted, _new_document_context)
	(_reset_unset_no_arg_commands_formatting_context, _convert),
	tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_document_context, build_html_formatting_state),
	tp/Texinfo/XS/convert/convert_html.c (html_new_document_context)
	(html_pop_document_context)
	(reset_unset_no_arg_commands_formatting_context)
	(convert_to_html_internal), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER): add states for preformatted_context and
	inside_preformatted, set together with preformatted_classes and
	composition_context, in order to access faster to the context.

	* tp/Texinfo/XS/convert/convert_html.c (in_preformatted_context)
	(inside_preformatted): add.

2023-11-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (TYPE_INTERNAL_CONVERSION)
	(types_internal_conversion_table, convert_table_term_type)
	(html_converter_initialize), tp/Texinfo/XS/main/converter_types.h
	(enum formatting_reference_status): add
	types_internal_conversion_table where type conversion implemented in C
	is registered, use it to replace type_conversion function.
	Implement convert_table_term_type as a type conversion function.

	* tp/Texinfo/XS/convert/convert_html.c (in_code, in_math, in_raw)
	(in_upper_case, in_verbatim): add.

2023-11-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.h, tp/Texinfo/XS/main/converter_types.h
	(HTML_ARGUMENTS_FORMATTED_FORMAT_TYPE, HTML_ARGS_FORMATTED)
	(HTML_ARG_FORMATTED): move from utils.h to converter_types.h.

	* tp/Texinfo/XS/convert/convert_html.c (command_conversion_external)
	(type_conversion_external, register_type_conversion_function)
	(register_command_conversion_function, html_converter_initialize)
	(html_initialize_output_state, html_destroy, html_convert_css_string)
	(convert_to_html_internal), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER, TYPE_CONVERSION_FUNCTION, COMMAND_CONVERSION_FUNCTION):
	use directly function references to convert types and commands, in
	order to be able to replace functions calling perl by C functions.
	Rename type_conversion as type_conversion_external and
	command_conversion as command_conversion_external.

2023-11-15  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Simple Output Customization for Simple
	Commands with Braces): fix example.

	* tp/init/documentation_examples.pm: new example for uppercase.

	* tp/Makefile.tres, tp/t/init_files_tests.t (sc_formatting_with_css),
	tp/init/sc_formatting_with_css.pm: example of init file to format
	small caps with CSS.

2023-11-15  Patrice Dumas  <pertusus@free.fr>

	Customization of uppercasing commands

	* doc/texi2any_api.texi (Customization of Commands Converting to
	Uppercase), tp/Texinfo/Config.pm ($GNUT_upper_case_commands)
	(texinfo_register_upper_case_command)
	(GNUT_get_upper_case_commands_info, GNUT_reinitialize_init_files),
	tp/Texinfo/Convert/HTML.pm (%default_upper_case_commands)
	(converter_initialize, _convert), tp/Texinfo/XS/convert/convert_html.c
	(html_format_init, convert_to_html_internal),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER): add possibility of customizing commands converting their
	argument to uppercase letters.

2023-11-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.h (OTXI_PROTECT_XML_CASES),
	tp/Texinfo/XS/convert/converter.c
	(xml_format_text_with_numeric_entities, xml_protect_text):
	add code that can be inlined for the protection of XML special
	characters as OTXI_PROTECT_XML_CASES.  Use in converter.c and base
	code more on misc.c code with memcmp and case.

	* tp/Texinfo/XS/convert/convert_html.c
	(OTXI_PROTECT_XML_FORM_FEED_CASES, html_default_format_protect_text)
	(protect_text_use_iso_entities, protect_text_no_iso_entities):
	setup OTXI_PROTECT_XML_FORM_FEED_CASES to be inlined for the
	protection of XML special charcters and form feeds.  Implement
	protect_text_use_iso_entities and html_default_format_protect_text.

2023-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%XS_overrides, %XS_conversion_overrides)
	(import): use hashes for association of overriden sub with XS sub.

	* tp/Texinfo/Convert/HTML.pm (_XS_format_init, import),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_format_init),
	tp/Texinfo/XS/convert/convert_html.c (html_converter_initialize)
	(html_format_init): add html_format_init function to be called once to
	setup C data that does not need any information on customization
	with code from html_converter_initialize.  Setup XS interface.

	* tp/Texinfo/XS/convert/convert_html.c (convert_to_html_internal):
	use current_commands_conversion and not commands_conversion and
	current_types_conversion and not types_conversion.

	* tp/Texinfo/XS/convert/convert_html.c
	(html_default_format_protect_text)
	(default_css_string_format_protect_text): implement.

	* tp/Texinfo/XS/convert/converter.c
	(xml_format_text_with_numeric_entities, xml_protect_text): implement.

2023-11-14  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/command_data.txt
	(item_LINE, itemx, defblock, defline, deftypeline):
	Remove contain_basic_inline flag.  There is no reason an @anchor
	should not occur inside @item, inside @table, or the other
	commands, as no index entry is being created with the @anchor.

	Report from Ihor Radchenko <yantar92@posteo.net> for Org mode manual.

2023-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Translations.pm (import), tp/Texinfo/XS/Makefile.am,
	tp/Texinfo/XS/main/DocumentXS.xs (translations_configure),
	tp/Texinfo/XS/main/TranslationsXS.xs: rename configure as
	translations_configure and move to DocumentXS.xs.  Do not build
	TranslationsXS anymore.

2023-11-14  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm,
	Pod-Simple-Texinfo/pod2texi.pl: update for the move of functions to
	Texinfo::Document.

2023-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/DocumentXS.xs (rebuild_document, rebuild_tree)
	(remove_document_descriptor, remove_document, clear_document_errors)
	(set_document_options), tp/Makefile.am (dist_modules_DATA),
	tp/Texinfo/Document.pm (import, rebuild_document, rebuild_tree)
	(clear_document_errors), tp/Texinfo/XS/Makefile.am
	(DocumentXS_la_SOURCES): move rebuild_document, rebuild_tree,
	remove_document_descriptor, remove_document and clear_document_errors
	to a new XS associated to Texinfo::Document.

2023-11-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_destroy): output a debug
	message if the html converter is destroyed while there are error messages
	that have not been registered.

2023-11-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree.c (replace_element_in_list): add.

	* tp/Texinfo/XS/convert/convert_html.c (html_get_tree_root_element)
	(prepare_special_units, prepare_footnotes_targets)
	(html_prepare_output_units_global_targets),
	tp/Texinfo/XS/main/build_perl_info.c (build_global_info_tree_info)
	(build_global_commands), tp/Texinfo/XS/main/command_data.awk,
	tp/Texinfo/XS/main/utils.c (delete_global_info)
	(delete_global_commands, get_cmd_global_multi_command)
	(get_cmd_global_uniq_command, get_global_document_command),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command)
	(handle_block_command), tp/Texinfo/XS/parsetexi/parser.c
	(register_global_command, store_document),
	tp/Texinfo/XS/structuring_transfo/structuring.c (warn_non_empty_parts)
	(set_menus_node_directions),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(regenerate_master_menu): use ELEMENT_LIST as container of global multi
	commands, not ELEMENT.


2023-11-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/call_html_perl_function.c
	(call_file_id_setting_label_target_name)
	(call_file_id_setting_node_file_name)
	(call_file_id_setting_sectioning_command_target_name),
	tp/Texinfo/XS/convert/convert_html.c (find_element_target)
	(prepare_special_units, add_element_target_to_list)
	(add_element_target, add_special_target, normalized_label_id_file)
	(new_sectioning_command_target, set_root_commands_targets_node_files)
	(prepare_index_entries_targets, prepare_footnotes_targets)
	(html_set_pages_files, convert_tree_new_formatting_context)
	(html_convert_css_string, convert_to_html_internal)
	(convert_output_unit), tp/Texinfo/XS/convert/converter.c
	(normalized_sectioning_command_filename, node_information_filename)
	(comma_index_subentries_tree),
	tp/Texinfo/XS/convert/indices_in_conversion.c (index_content_element),
	tp/Texinfo/XS/main/converter_types.h (HTML_TARGET),
	tp/Texinfo/XS/main/node_name_normalization.c
	(convert_to_normalized_internal, convert_to_normalized)
	(convert_to_identifier, normalize_transliterate_texinfo)
	(normalize_transliterate_texinfo_contents), tp/Texinfo/XS/main/utils.h
	(HTML_ARG_FORMATTED): mark elements as const in HTML conversion and
	node_name_normalization.

2023-11-13  Gavin Smith <gavinsmith0123@gmail.com>

	Update required gnulib modules for XS

	* tp/Texinfo/XS:
	Run "gnulib-tool --add-import uchar".

2023-11-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (text_accents, text_heading)
	(convert_to_text_internal, convert_to_text): set element arguments and
	elemnts to const if they are not modified, to make sure that the
	Texinfo tree is not modified.

2023-11-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (ascii_accents_internal),
	tp/Texinfo/XS/main/convert_utils.c (find_innermost_accent_contents),
	tp/Texinfo/XS/main/convert_utils.h, tp/Texinfo/XS/main/unicode.c
	(format_eight_bit_accents_stack, encoded_accents)
	(format_unicode_accents_stack_internal), tp/Texinfo/XS/main/utils.c
	(push_stack_element, pop_stack_element, destroy_accent_stack),
	tp/Texinfo/XS/main/utils.h (ELEMENT_STACK, ACCENTS_STACK): move
	ACCENTS_STACK and destroy_accent_stack to main/utils.c.  Add a stack
	for elements, with elements unmodifed (const), in main/utils.c.  Use
	that stack for accent commands.

2023-11-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_texinfo.c
	(convert_contents_to_texinfo, check_node_same_texinfo_code)
	(root_heading_command_to_texinfo), tp/Texinfo/XS/main/debug.c
	(print_associate_info_debug, print_element_debug_details),
	tp/Texinfo/XS/main/tree.c (last_args_child): mark elements in argument
	and in code as const when they are not modified.

2023-11-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (brace_no_arg_command)
	(text_heading), tp/Texinfo/XS/main/convert_utils.c
	(element_associated_processing_encoding, add_heading_number)
	(find_innermost_accent_contents, convert_to_utf8)
	(encoded_input_file_name, expand_verbatiminclude)
	(definition_arguments_content, definition_category_tree),
	tp/Texinfo/XS/main/errors.c (message_list_line_error_internal)
	(message_list_command_error), tp/Texinfo/XS/main/tree.c
	(insert_list_slice_into_list, insert_slice_into_contents),
	tp/Texinfo/XS/main/utils.c (encode_with_iconv, decode_string)
	(encode_string, section_level): add const for source info and elements
	in argument for function that should not modify the argument they point
	to.  Not much successful in making sure that the Texinfo tree is not
	modified, though.

2023-11-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/build_html_perl_state.c,
	tp/Texinfo/XS/convert/call_html_perl_function.c,
	tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/main/builtin_commands.c (element_builtin_data_cmd),
	tp/Texinfo/XS/main/output_unit.c (output_unit_texi),
	tp/Texinfo/XS/main/converter_types.h (FILE_NAME_PATH_COUNTER)
	(SPECIAL_UNIT_DIRECTION, CONVERTER), tp/Texinfo/XS/main/tree_types.h
	(OUTPUT_UNIT), tp/Texinfo/XS/main/utils.h (FILE_SOURCE_INFO): set
	output units and elements to be const whenever relevant to make sure
	that the tree and the output units are not modified.

	* tp/Texinfo/XS/main/build_perl_info.c (store_additional_info): set
	input element as const.

2023-11-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/indices_in_conversion.c
	(index_content_element), tp/Texinfo/XS/main/builtin_commands.c
	(element_command_name, element_builtin_cmd),
	tp/Texinfo/XS/main/convert_to_texinfo.c (expand_cmd_args_to_texi)
	(convert_to_texinfo_internal, convert_to_texinfo)
	(link_element_to_texi, target_element_to_texi_label),
	tp/Texinfo/XS/main/debug.c (debug_element_command_name)
	(print_element_debug, debug_print_element), tp/Texinfo/XS/main/extra.c
	(lookup*), tp/Texinfo/XS/main/utils.c (get_label_element): add const
	to elements in input of soe functions, especially for conversion to
	Texinfo, to make sure that the tree is not modified by the conversion.

2023-11-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/node_name_normalization.c (normalize_top_name)
	(convert_to_identifier): never free input of normalize_top_name,
	result always need to be freed.

	* tp/Texinfo/XS/main/node_name_normalization.c (normalize_top_name)
	(unicode_to_protected, protect_unicode_char): set input text to be
	const.

2023-11-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/def.c (split_delimiters, split_def_args),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(protect_first_parenthesis, protect_text)
	(protect_hashchar_at_line_beginning_internal): call relocate source
	marks only if there are source marks.  Do not initialize variables
	that do not need to be.

2023-11-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (register_converter),
	tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/get_perl_info.c
	(converter_initialize), tp/Texinfo/XS/main/utils.c: use a local
	variable as initial converter before calling register_converter. Pass
	converter to converter_initialize. Remove new_converter function.

	* tp/Texinfo/XS/convert/converter.c (set_global_document_commands),
	tp/Texinfo/XS/main/utils.c (set_informative_command_value)
	(set_global_document_command): pass options and global commands to
	set_informative_command_value and set_global_document_command, not
	converters.

	* tp/Texinfo/XS/main/converter_types.h (TRANSLATED_SUI_ASSOCIATION),
	tp/Texinfo/XS/main/utils.c: move TRANSLATED_SUI_ASSOCIATION to
	converter_types.h.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_convert_output),
	tp/Texinfo/XS/main/build_perl_info.c (build_output_files_information):
	pass converter SV to build_output_files_information and pass directly
	OUTPUT_FILES_INFORMATION.

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES),
	tp/Texinfo/XS/main/converter_types.h,
	tp/Texinfo/XS/main/document_types.h (enum error_type, ERROR_MESSAGE)
	(ERROR_MESSAGE_LIST, GLOBAL_INFO, DOCUMENT, EXPANDED_FORMAT): move
	parsed document types to a new file, document_types.h. Update includes
	for all the files.

	* tp/Texinfo/XS/convert/convert_html.c
	(html_global_unit_direction_names, html_conversion_context_type_names)
	(html_formatting_reference_names, html_argument_formatting_type_names)
	(special_unit_info_type_names, translated_special_unit_info),
	tp/Texinfo/XS/main/utils.c: move code used in HTML conversion to
	convert_html.c.

2023-11-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (split_custom_heading_command_contents),
	tp/t/init/translation_in_parser_in_translation.pm,
	tp/Texinfo/XS/main/utils.c: do not use
	trim_spaces_comment_from_content in
	split_custom_heading_command_contents and
	translation_in_parser_in_translation.pm and remove
	trim_spaces_comment_from_content.

2023-11-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/floats.c (add_to_listoffloats_list)
	(float_list_to_listoffloats_list, destroy_listoffloats_list),
	tp/Texinfo/XS/main/tree_types.h (LISTOFFLOATS_TYPE),
	tp/Texinfo/XS/structuring_transfo/structuring.c (number_floats):
	use ELEMENT_LIST for float_list in listoffloats data, directly and not
	as a pointer.  Change add_to_listoffloats_list to return the
	listoffloats type if found, and create a new one otherwise.

2023-11-12  Patrice Dumas  <pertusus@free.fr>

	Separate types for list of floats and list of listoffloats

	* tp/Texinfo/XS/main/build_perl_info.c (build_document),
	tp/Texinfo/XS/main/converter_types.h (DOCUMENT),
	tp/Texinfo/XS/main/document.c
	(destroy_document_information_except_tree),
	tp/Texinfo/XS/main/floats.c (add_to_float_record_list)
	(add_to_listoffloats_list, find_float_type)
	(float_list_to_listoffloats_list, destroy_listoffloats_list),
	tp/Texinfo/XS/main/tree_types.h (LISTOFFLOATS_TYPE)
	(LISTOFFLOATS_TYPE_LIST, FLOAT_RECORD_LIST),
	tp/Texinfo/XS/parsetexi/parser.c (store_document),
	tp/Texinfo/XS/structuring_transfo/structuring.c (number_floats):
	add new types for listoffloats lists LISTOFFLOATS_TYPE_LIST instead of
	using the same as for floats lists. Rename a field of floats lists
	structure. Add add_to_listoffloats_list as a distinct function to add
	to LISTOFFLOATS_TYPE_LIST. Update DOCUMENT and functions to use the
	relevant types.

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block): no
	initialization of float_type, it is not used and is confusing.

2023-11-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.h (parser_float_list),
	tp/Texinfo/XS/parsetexi/parser.c (store_document),
	tp/Texinfo/XS/parsetexi/end_line.c (parser_float_list)
	(end_line_starting_block): rename global float_records as
	parser_float_list.

2023-11-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(prepare_index_entries_targets), tp/Texinfo/XS/convert/converter.c
	(comma_index_subentries_tree, free_comma_index_subentries_tree): have
	comma_index_subentries_tree return an ELEMENT_LIST.

	* tp/Texinfo/XS/main/output_unit.c (split_by_node): set pending_parts
	to be an ELEMENT_LIST.

	* tp/Texinfo/XS/parsetexi/parser.c (rearrange_tree_beginning): use an
	ELEMENT_LIST for first_types.

2023-11-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (text_accents),
	tp/Texinfo/XS/main/convert_utils.c (find_innermost_accent_contents)
	(destroy_accent_stack), tp/Texinfo/XS/main/convert_utils.h
	(ACCENTS_STACK): put the stack in ACCENTS_STACK directly, not as a
	pointer.

2023-11-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (ascii_accent)
	(ascii_accents_internal), tp/Texinfo/XS/main/unicode.c
	(unicode_accent, format_eight_bit_accents_stack)
	(format_unicode_accents_stack_internal, encoded_accents),
	tp/Texinfo/XS/main/utils.c (normalize_encoding_name): make some
	variables const to make sure that the accent formatting function do
	not modify their associated elements, texts or accent commands lists.

2023-11-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (ascii_accent)
	(ascii_accents_internal): call encoded_accents with ascii_accent as
	argument, not ascii_accents_internal.  Add an unused set_case argument
	to ascii_accent to have a prototype matching with the prototype used
	by encoded_accents.

	* tp/Texinfo/XS/main/convert_to_text.c (ascii_accents_internal),
	tp/Texinfo/XS/main/convert_utils.c (find_innermost_accent_contents)
	(destroy_accent_stack), tp/Texinfo/XS/main/convert_utils.h
	(ACCENTS_STACK), tp/Texinfo/XS/main/unicode.c
	(format_eight_bit_accents_stack, encoded_accents)
	(format_unicode_accents_stack_internal): use an ELEMENT_LIST for the
	ACCENTS_STACK stack.

2023-11-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (prepare_special_units)
	(set_root_commands_targets_node_files),
	tp/Texinfo/XS/main/build_perl_info.c (build_elements_list)
	(build_document), tp/Texinfo/XS/main/converter_types.h (DOCUMENT),
	tp/Texinfo/XS/main/document.c (register_document_nodes_list)
	(register_document_sections_list)
	(destroy_document_information_except_tree),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(sectioning_structure, nodes_tree),
	tp/Texinfo/XS/structuring_transfo/structuring.c (sectioning_structure)
	(nodes_tree, check_nodes_are_referenced, set_menus_node_directions)
	(complete_node_tree_with_menus): use ELEMENT_LIST for nodes_list and
	sections_list.

	* tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(fill_gaps_in_sectioning),
	tp/Texinfo/XS/structuring_transfo/structuring.c
	(get_node_node_childs_from_sectioning, new_complete_node_menu)
	(print_down_menus, new_master_menu),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(fill_gaps_in_sectioning, insert_nodes_for_sectioning_commands)
	(complete_node_menu, get_non_automatic_nodes_with_sections)
	(complete_tree_nodes_menus, complete_tree_nodes_missing_menu): use
	ELEMENT_LIST for fill_gaps_in_sectioning,
	get_node_node_childs_from_sectioning, print_down_menus and
	get_non_automatic_nodes_with_sections.

	* tp/Texinfo/XS/structuring_transfo/transformations.c
	(reassociate_to_node, insert_nodes_for_sectioning_commands): use
	ELEMENT_LIST for new_previous.

2023-11-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree.c (new_list, destroy_list),
	tp/Texinfo/XS/structuring_transfo/transformations.c (modify_tree)
	(protect_text, protect_hashchar_at_line_beginning_internal)
	(reference_to_arg_internal): add new_list and destroy_list, use those
	functions.

2023-11-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree.c (insert_list_slice_into_list)
	(insert_slice_into_contents, insert_list_slice_into_args)
	(insert_list_slice_into_contents): add insert_list_slice_into_list,
	use it in other functions, add insert_list_slice_into_args and
	insert_list_slice_into_contents.  Remove
	insert_contents_slice_into_args.

	* tp/Texinfo/XS/structuring_transfo/transformations.c (modify_tree)
	(reference_to_arg_internal, protect_text)
	(protect_hashchar_at_line_beginning_internal): change function called
	by modify_tree to return element lists instead of elements.  Update
	functions use as modify_tree argument.

2023-11-12  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (xspara_add_text):
	Keep running total of return values of uc_width and pass it to
	xspara_add__next.  Remove an apparently obsolete comment about
	the width of accent characters.
	(xspara__add_next): Take extra argument.  If non-negative, use for
	the column count of the word, rather than using uc_width. This way
	we avoid calling it twice for every character.

2023-11-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/get_perl_info.c
	(get_sv_index_entries_sorted_by_letter): use
	indices_info_index_by_name.  Use entry_idx_in_index for index in
	index_entries.

2023-11-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(convert_output_output_unit_internal): free path_encoding.

	* tp/Texinfo/XS/main/convert_utils.c: change in spacing.

2023-11-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (HTML_COMMAND_STRUCT)
	(register_format_context_command, convert_to_html_internal): set
	context command context string dynamically.

	* tp/Texinfo/XS/convert/converter.c (set_file_path): add more messages
	for file paths already set/reset, as in perl, and handle memory
	correctly in that case.

2023-11-12  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (xspara__add_next, xspara_add_next):
	Remove unnecessary casts to ucs4_t when calling uc_width.  Advice
	from Bruno.

2023-11-11  Gavin Smith <gavinsmith0123@gmail.com>

	Update required gnulib modules for XS

	* tp/Texinfo/XS:
	Run "gnulib-tool --remove-import wcwidth c32width c32isupper", and
	"gnulib-tool --import unictype/ctype-upper".

2023-11-11  Gavin Smith <gavinsmith0123@gmail.com>

	Revised locale-independent paragraph formatting.

	* tp/Texinfo/XS/xspara.c (PARAGRAPH) <last_letter>:
	Declare as char32_t instead of wchar_t.

	(xspara_add_text, xspara__add_next): Use gnulib/libunstring
	function u8_mbtouc instead of mbrtowc or btowc, uc_width instead
	of wcwidth, and uc_is_upper instead of iswupper.

	(xspara_init): Eliminate lengthy code attempting to switch to
	a locale with UTF-8 encoding.

	* tp/Texinfo/XS/Makefile.am (XSParagraph_la_LDFLAGS):
	Link with $(LTLIBC32CONV), set from gnulib.

	Patch originally applied 2023-11-09 and reverted 2023-11-10.
	Advice to use uc_width instead of c32width from Bruno Haible.
	c32width does not work for non-ASCII characters in the C locale.

2023-11-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_finalize_output_state),
	tp/Texinfo/XS/convert/converter.c (free_output_unit_files_file)
	(clear_output_unit_files, free_output_unit_files)
	(free_generic_converter): clear/free output_unit_files information.

2023-11-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_finalize_output_state),
	tp/Texinfo/XS/convert/converter.c (free_generic_converter),
	tp/Texinfo/XS/main/convert_utils.c (free_unclosed_files)
	(free_output_files_information, clear_output_files_information):
	clear/free output_files_information.

2023-11-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_destroy),
	tp/Texinfo/XS/convert/convert_html.c
	(reset_unset_no_arg_commands_formatting_context): free
	html_command_conversion strings and trees for no args commands, free
	no_arg_formatted_cmd, free translated_to_convert when replacing it in
	reset_unset_no_arg_commands_formatting_context.

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv): comment out allocating memory for
	style converting, as it is not used/tested/freed for now.

2023-11-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_units_directions_files),
	tp/Texinfo/XS/convert/convert_html.c (html_destroy_files_source_info):
	free files_source_info.

	* tp/Texinfo/XS/convert/convert_html.c (html_set_pages_files): free
	top_node_filename_str, filename and output_unit_file_name file names
	setting loop, and unit_file_name_paths.
	
	* tp/Texinfo/XS/convert/convert_html.c (html_translate_names):
	free/destroy text or tree before replacing.

	* tp/Texinfo/XS/convert/convert_html.c
	(convert_output_output_unit_internal): free encoded_out_filepath.

	* tp/Texinfo/XS/main/output_unit.c (units_directions): use an
	ELEMENT_LIST for up_list instead of an ELEMENT, and free.

	* tp/Texinfo/XS/main/translations.c (replace_convert_substrings): free
	convert_to_texinfo debug string.

2023-11-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/converter_types.h (HCC_CONTEXT_TYPES_LIST),
	tp/Texinfo/XS/main/utils.h: move definition of HCC_CONTEXT_TYPES_LIST
	to main/converter_types.h.

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_translated_names), tp/Texinfo/XS/convert/convert_html.c
	(reset_unset_no_arg_commands_formatting_context)
	(html_translate_names), tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER): change html_command_conversion in converter to be a two
	dimension array with known size.

2023-11-11  Gavin Smith <gavinsmith0123@gmail.com>

	Remove hevea support from texi2dvi

	* util/texi2dvi (run_hevea, run_tex4ht): Remove.
	(run_tex_suite): Call run_tex directly instead of run_core_conversion.
	(run_core_conversion): Remove.

	(top level): Remove options --info, --html, --text, --tex4ht.
	(out_lang_set, out_lang_ext, out_lang_tex):
	Do not recognize "html", "info" or "text".
	(usage): Update usage message.

	(latex2html): Remove variable.
	(index_file_p, make_tex_cmd, run_index, run_tex_suite):
	Do not check value of $latex2html.

	It did not work at all due to calls to make_tex_cmd in
	run_tex_suite (added 2019-04-08) and in make_openout_text, called
	via decide_aux_files_method (added 2015-09-02).  Even when I
	disabled those calls, there were other errors.	Since nobody
	has complained in 8 years, it is probably not important, and
	it complicates the script significantly anyway, integrated into
	many parts of the code for a very rare if non-existent use case.

2023-11-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (destroy),
	tp/Texinfo/Convert/Converter.pm (import, destroy),
	tp/Texinfo/Convert/Text.pm(import, destroy),
	tp/Texinfo/XS/convert/convert_html.c (html_destroy),
	tp/Texinfo/XS/convert/converter.c (free_generic_converter),
	tp/Texinfo/XS/main/convert_utils.c (destroy_translated_commands),
	tp/t/test_utils.pl (test), tp/texi2any.pl: add function, XS interface
	and C code to destroy a converter, to free its memory, called both in
	texi2any.pl and test_utils.pl.

2023-11-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_finalize_output_state),
	tp/Texinfo/XS/convert/convert_html.c (html_finalize_output_state)
	(html_check_transfer_state_finalization): add checks on final
	converter output state and on state used to sync perl converter state
	after the last sync of perl state.

2023-11-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_finalize_output_state),
	tp/Texinfo/XS/convert/indices_in_conversion.c (destroy_merged_indices)
	(destroy_indices_sorted_by_letter): free merged indices, indices
	sorted by letter and title_titlepage.

2023-11-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree_types.h (INDEX),
	tp/Texinfo/XS/main/converter_types.h (MERGED_INDEX)
	(LETTER_INDEX_ENTRIES, INDEX_SORTED_BY_LETTER): rename structure
	fields related to index numberof entries or space for entries and
	letter number.  Update code using those structures.

	* tp/Texinfo/XS/main/build_perl_info.c (build_single_index_data):
	rename i as index.

	* tp/Texinfo/XS/convert/convert_html.c: reindent.

2023-11-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs
	(get_index_entries_sorted_by_letter),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER),
	tp/Texinfo/XS/main/get_perl_info.c
	(get_sv_index_entries_sorted_by_letter): set index_entries_by_letter
	as a pointer on INDEX_SORTED_BY_LETTER, not a pointer on pointer.

	* tp/Texinfo/XS/main/get_perl_info.c
	(get_sv_index_entries_sorted_by_letter): add a zeroed entry to mark
	the end of the array. strdup letter string. Check that index entry
	index name is set in perl. When finding the index entry in C index
	data, verify that the index number from perl leads to an index
	consistent with index size. Debug message if the index entry is not
	found.

2023-11-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/indices_in_conversion.c (merge_indices): add a
	trailing zeroed merged index index entry.

2023-11-10  Gavin Smith <gavinsmith0123@gmail.com>

	* util/texi2dvi (move_to_dest): When --output is given, report
	that a file was moved successfully.  Error out if the file could
	not be moved.

	Jonathan Dushoff <dushoff@mcmaster.ca> reported that the output
	with the --output option was confusing, as TeX would not print
	the name of the final location.

2023-11-10  Gavin Smith <gavinsmith0123@gmail.com>

	* util/texi2dvi (move_to_dest): Rearrange code slightly
	for simplicity and change a variable name.  No functional
	changes intended.

2023-11-10  Gavin Smith <gavinsmith0123@gmail.com>

	* util/texi2dvi (move_to_dest): Only take a single argument,
	as it is only called with multiple arguments when outputing
	to Info with hevea, which is an extremely niche use case.  In
	fact, running with hevea (--html or --info on a LaTeX source)
	appears to be broken.  (Loop introduced on 2006-06-27.)
	(run_hevea): Put the loop here.  Code not tested.

2023-11-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (import, _XS_html_merge_index_entries)
	(_sort_index_entries), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_merge_index_entries), tp/Texinfo/XS/convert/convert_html.c
	(html_merge_index_entries): rename sort_index_entries as
	html_merge_index_entries, add an XS override and call it.

	* tp/Texinfo/XS/convert/convert_html.c (html_merge_index_entries),
	tp/Texinfo/XS/convert/indices_in_conversion.c (merge_indices),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): set index_entries as
	a pointer on MERGED_INDEX, not a pointer on pointer.

	* tp/Texinfo/XS/convert/indices_in_conversion.c (merge_indices):
	update and fix code, in particular to store index without another
	index merged in.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_conversion_units),
	tp/Texinfo/XS/convert/convert_html.c
	(set_root_commands_targets_node_files, html_set_pages_files)
	(convert_output_output_unit_internal),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER),
	tp/Texinfo/XS/main/get_perl_info.c (converter_initialize): put
	error_messages directly in converter, not as a pointer.

	* tp/Texinfo/XS/main/errors.c (wipe_error_messages)
	(wipe_error_message_list, clear_error_message_list),
	tp/Texinfo/XS/main/build_perl_info.c (pass_converter_errors): add
	clear_error_message_list that clears messages but does not deallocate
	the list memory.  Use clear_error_message_list instead of
	wipe_error_message_list to reuse memory in converter.

	* tp/Texinfo/XS/main/utils.c (new_expanded_formats): remove format
	argument. Update callers.

2023-11-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_set_pages_files): strdup
	on the special_unit_filename for associated output units.

	* tp/Texinfo/XS/convert/convert_html.c
	(special_unit_variety_direction_index, html_converter_initialize),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER):
	remove varieties_direction_index, do the index computation in
	special_unit_variety_direction_index.

	* tp/Texinfo/XS/convert/convert_html.c (reset_html_targets)
	(html_initialize_output_state, html_finalize_output_state): add
	reset_html_targets to free targets contents, called in
	html_finalize_output_state both for html_targets and
	html_special_targets.

	* tp/Texinfo/XS/convert/convert_html.c (html_finalize_output_state):
	clear seen_ids, free special_units_direction_name,
	output_unit_file_indices and special_unit_file_indices.

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_global_units_directions)
	(pass_html_global_units_directions),
	tp/Texinfo/XS/convert/convert_html.c
	(html_prepare_output_units_global_targets),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): change
	special_units_direction_name to be a list of SPECIAL_UNIT_DIRECTION,
	not a list of pointers.

	* tp/Texinfo/XS/main/get_perl_info.c (set_translated_commands),
	tp/Texinfo/XS/main/convert_utils.c (translated_command_tree),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): change
	translated_commands to be a list of TRANSLATED_COMMAND, not a list of
	pointers.

	* tp/Texinfo/XS/convert/convert_html.c (html_set_pages_files): no
	memset for special_unit_file_indices and output_unit_file_indices as
	they are filled anyway.

	* tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_translated_names): use enum and SUIT_type_none.

2023-11-10  Gavin Smith <gavinsmith0123@gmail.com>

	Revert change on 2023-11-09 "Locale-independent XS paragraph
	formatting".

	This gives inconsistent test results between XS and pure Perl.
	Reverting until this can be investigated.

2023-11-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(reset_translated_special_unit_info_tree)
	(html_finalize_output_state, html_translate_names): add function
	reset_translated_special_unit_info_tree based on code from
	html_translate_names and use it in html_finalize_output_state too.

	* tp/Texinfo/XS/main/converter_types.h (enum special_unit_info_type)
	(enum special_unit_info_tree), tp/Texinfo/XS/convert/convert_html.c
	(special_unit_info_tree, reset_translated_special_unit_info_tree),
	tp/Texinfo/XS/main/utils.c (translated_special_unit_info),
	tp/Texinfo/XS/main/utils.h (TRANSLATED_SUI_ASSOCIATION): add *_none
	set to -1 for special_unit_info_type and special_unit_info_tree.  Use
	enum as types more.

2023-11-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_conversion_units),
	(tp/Texinfo/XS/convert/build_html_perl_state.c
	(build_html_special_targets, pass_html_special_targets),
	tp/Texinfo/XS/convert/convert_html.c (add_element_target)
	(add_special_target, set_special_units_targets_files)
	(prepare_associated_special_units_targets, unique_target)
	(new_sectioning_command_target, prepare_index_entries_targets)
	(prepare_footnotes_targets, html_set_pages_files)
	(html_initialize_output_state, html_translate_names),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): put
	html_special_targets, html_targets and seen_ids directly in CONVERTER,
	not as pointers.

	* tp/Texinfo/XS/convert/convert_html.c (html_converter_initialize)
	(html_initialize_output_state): initialize converter
	global_units_directions in html_initialize_output_state.

2023-11-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/get_html_perl_info.c
	(html_converter_initialize_sv): use enum as type.

2023-11-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (add_element_target_to_list)
	(set_special_units_targets_files)
	(prepare_associated_special_units_targets)
	(new_sectioning_command_target, prepare_index_entries_targets)
	(prepare_footnotes_targets):
	strdup target in add_element_target_to_list.  Free strings used in
	input.

	* tp/Texinfo/XS/convert/convert_html.c (html_translate_names): change
	variable name, use enum when possible.

2023-11-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (copy_tree),
	tp/Texinfo/XS/main/manipulate_tree.c (copy_tree),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs (copy_tree):
	remove second argument of copy_tree.  Update callers.

	* tp/t/test_tree_copy.t: use copy_treeNonXS instead of skipping the
	test with a manual tree.

2023-11-09  Gavin Smith <gavinsmith0123@gmail.com>

	Locale-independent XS paragraph formatting

	* tp/Texinfo/XS/xspara.c (PARAGRAPH) <last_letter>:
	Declare as char32_t instead of wchar_t.

	(xspara_add_text, xspara__add_next): Use gnulib/libunstring
	function u8_mbtouc instead of mbrtowc or btowc, c32width instead
	of wcwidth, and c32isupper instead of iswupper.

	(xspara_init): Eliminate lengthy code attempting to switch to
	a locale with UTF-8 encoding.

	* tp/Texinfo/XS/Makefile.am (XSParagraph_la_LDFLAGS):
	Link with $(LTLIBC32CONV), set from gnulib.

2023-11-09  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS:
	Run "gnulib-tool --add-import c32isupper c32width unistr/u8-mbtouc".

2023-11-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs
	(get_index_entries_sorted_by_letter),
	tp/Texinfo/XS/main/get_perl_info.c
	(get_sv_index_entries_sorted_by_letter): use INDEX ** in argument of
	get_sv_index_entries_sorted_by_letter and return an
	INDEX_SORTED_BY_LETTER ** instead of modifying a converter.

2023-11-07  Patrice Dumas  <pertusus@free.fr>

	* tp/t/html_tests.t (mathjax_with_texinfo)
	(mathjax_with_texinfo_enable_encoding)
	(mathjax_with_texinfo_html_file): skip tests with conversion of
	Texinfo to LaTeX in HTML in math if using XS for conversion, as it is
	not implemented.

2023-11-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/get_perl_info.c: move
	copy_sv_options_for_convert_text to the end of the file.

2023-11-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (ConvertXS_la_SOURCES),
	tp/Texinfo/XS/convert/get_html_perl_info.c,
	tp/Texinfo/XS/main/get_perl_info.c: move HTML specific code out of
	main/get_perl_info.c to convert/get_html_perl_info.c.

2023-11-07  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/Makefile.am (lib_LTLIBRARIES, xs_LTLIBRARIES):
	Place libtexinfo.la and libtexinfoxs.la in xs_LTLIBRARIES instead.

2023-11-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (output): fix
	get_output_files_XS_unclosed_streams function name.

2023-11-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (ConvertXS_la_SOURCES),
	tp/Texinfo/XS/convert/call_html_perl_function.c,
	tp/Texinfo/XS/main/build_perl_info.c,
	tp/Texinfo/XS/main/call_perl_function.c,
	tp/Texinfo/XS/convert/build_html_perl_state.c: new files
	convert/call_html_perl_function.c and convert/build_html_perl_state.c
	with HTML specific content of call_perl_function.c and
	build_perl_info.c.

2023-11-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (import, _XS_get_unclosed_stream)
	(get_output_files_XS_unclosed_streams), tp/Texinfo/Convert/HTML.pm
	(output), tp/Texinfo/XS/convert/ConvertXS.xs (get_unclosed_stream),
	tp/Texinfo/XS/main/build_perl_info.c
	(build_output_files_unclosed_files): it is not possible to associate
	an unclosed stream to a SV from C.  However, as found out by Gavin, it
	is possible to pass a stream through the XS interface. Therefore, in
	build_output_files_unclosed_files, the unclosed file name is
	registered, associated to undef, and the stream can then be passed to
	perl through a call of the new XS interface
	Texinfo::Convert::ConvertXS::get_unclosed_stream. Add get_unclosed_stream
	to retrieve the file streams of all the unclosed file paths that came
	from XS and are not associated to a stream and associate them to the
	unclosed files in output_files_information.

2023-11-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c,
	tp/Texinfo/XS/main/build_perl_info.c: move code specific of HTML to
	the end of the files.

2023-11-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_sort_index_entries),
	tp/Texinfo/XS/main/get_perl_info.c
	(get_sv_index_entries_sorted_by_letter): pass directly indices sorted
	by letter hash to XS.  There is code to sort index names in XS, but it
	is commentted out as it is not clear that it is useful.

2023-11-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (import, _translate_names)
	(_prepare_conversion_units, _prepare_units_directions_files)
	(_prepare_title_titlepage, _html_convert_convert, convert)
	(_html_convert_output), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_conversion_units): override directly perl functions.
	Add _html_convert_convert based on convert code to override
	conversion.  Change html_prepare_conversion_units to match perl
	function call.

2023-11-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_conversion_units)
	(html_prepare_units_directions_files, html_translate_names)
	(html_prepare_output_units_global_targets): set warning strings.

	* tp/Texinfo/XS/main/build_perl_info.c (pass_output_unit_files):
	increase ref count of references stored in converter.

2023-11-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_units_directions_files)
	(output, _html_set_pages_files): return files_source_info as a
	reference on a hash instead of a hash.

	* tp/Texinfo/Convert/HTML.pm (_prepare_units_directions_files),
	tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_units_directions_files),
	tp/Texinfo/XS/main/build_perl_info.c
	(build_html_elements_in_file_count, pass_html_elements_in_file_count)
	(pass_output_unit_files): set elements_in_file_count, filenames,
	file_counters and out_filepaths on pperl converter from C/XS in
	_prepare_units_directions_files.

2023-11-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c
	(pass_html_global_units_directions): rename from
	set_html_global_units_directions.  Update callers.

	* tp/Texinfo/Convert/HTML.pm (_prepare_conversion_units),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_conversion_units),
	tp/Texinfo/XS/main/build_perl_info.c (build_html_element_targets)
	(pass_html_element_targets, build_html_special_targets)
	(build_html_special_targets, pass_html_special_targets)
	(build_html_seen_ids, pass_html_seen_ids): set targets,
	special_targets, seen_ids and document_units from C/XS in
	_prepare_conversion_units.

2023-11-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_units_directions_files)
	(convert), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_units_directions_files)
	(html_prepare_output_units_global_targets),
	tp/Texinfo/XS/main/build_perl_info.c
	(build_html_global_units_directions)
	(set_html_global_units_directions): add
	set_html_global_units_directions to set in XS
	"global_units_directions" in perl converter instead of returning to
	perl.

2023-11-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm, tp/Texinfo/Convert/HTML.pm:
	remove converter_options_for_output, use the converter directly in all
	calling functions.

2023-11-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_converter_initialize),
	tp/Texinfo/XS/main/get_perl_info.c (html_converter_initialize_sv):
	move code mapping variety names to index in global_units_directions
	to html_converter_initialize.

	* tp/Texinfo/XS/main/get_perl_info.c (html_converter_initialize_sv):
	convert style commands element to UTF-8.  Set converter HV only once.

2023-11-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_converter_initialize),
	tp/Texinfo/XS/main/get_perl_info.c (html_converter_initialize_sv):
	move allocation of space for translated tree types from
	html_converter_initialize_sv to html_converter_initialize.

	* tp/Texinfo/XS/main/converter_types.h (CONVERTER): put
	special_unit_varieties directly in the structure.  Update codes using
	the strucutre.

2023-11-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/get_perl_info.c (converter_initialize)
	(html_converter_initialize_sv): split generic converter initialization 
	out of html_converter_initialize_sv to converter_initialize.

2023-11-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm, tp/Texinfo/Convert/HTML.pm
	(converter_initialize): remove encode_converter_document from
	Texinfo::Convert::Converter and move corresponding code to the end of
	converter_initialize where XS converter is initialized.

	* tp/Texinfo/Convert/HTML.pm (converter_initialize),
	tp/Texinfo/XS/main/get_perl_info.c (html_converter_initialize_sv):
	pass directly the converter to html_converter_initialize_sv.

2023-11-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (encode_converter_document),
	tp/Texinfo/XS/main/get_perl_info.c (set_translated_commands)
	(html_converter_initialize_sv): encode strings in XS, not in perl.

2023-11-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/get_perl_info.c, tp/Texinfo/XS/main/utils.h:
	remove more code related to sorting in C based on sortable entries
	from perl, get_sv_sortable_entries, KEY_ALPHA, SORTABLE_ENTRY and
	INDEX_SORTABLE_ENTRIES.

2023-11-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_sort_index_entries),
	tp/Texinfo/XS/main/get_perl_info.c
	(get_sv_index_entries_sorted_by_letter): pass index entries by letter
	directly as a hash.

2023-11-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_sort_index_entries),
	tp/Texinfo/XS/main/get_perl_info.c
	(get_sv_index_entries_sorted_by_letter): encode strings in
	get_sv_index_entries_sorted_by_letter by using SvPVutf8 instead of
	doing it in perl.

2023-11-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (import, _sort_index_entries),
	tp/Texinfo/XS/convert/ConvertXS.xs
	(sort_sortable_index_entries_by_letter),
	tp/Texinfo/XS/convert/indices_in_conversion.c
	(sort_indices_by_letter): remove code related to sorting in C based on
	sortable entries from perl, as it is unfinished because it requires
	a collation function in C, and the passing of data from perl need to
	be redone, it would be better to restart from scratch.

2023-11-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (converter_options_for_output):
	rename encode_converter_for_output as converter_options_for_output.
	Update callers.

	* tp/Texinfo/Convert/HTML.pm (_prepare_conversion_units)
	(_prepare_units_directions_files, _prepare_title_titlepage)
	(_html_convert_output), tp/Texinfo/Convert/Text.pm
	(select_text_options), tp/Texinfo/Translations.pm (_XS_gdt),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_conversion_units)
	(html_prepare_units_directions_files)
	(html_prepare_title_titlepage, html_convert_output),
	tp/Texinfo/XS/main/TranslationsXS.xs (gettree),
	tp/Texinfo/XS/main/get_perl_info.c (copy_sv_options_for_convert_text):
	do not convert strings to UTF-8 in perl but in XS.  Rename
	encode_text_options as select_text_options in Texinfo::Convert::Text.

	* tp/Texinfo/Translations.pm (import),
	tp/Texinfo/XS/main/TranslationsXS.xs (gdt): remove _XS_gettree, have a
	direct override of gdt (in comments, as it does not work).  In XS,
	rename gettree as gdt and adapt call to match gdt call in perl.

2023-11-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm, tp/Texinfo/Config.pm
	(register_XS_document_main_configuration),
	tp/Texinfo/Convert/Converter.pm (encode_converter_document),
	tp/Texinfo/Convert/HTML.pm (_translate_names),
	tp/Texinfo/Convert/Text.pm (encode_text_options),
	tp/maintain/regenerate_C_options_info.pl: encode customization options
	strings in C and not in perl.  The corresponding code is generated by
	regenerate_C_options_info.pl, using SvPVbyte for byte strings and
	SvPVutf8 to get UT-8 encoded strings for character strings.

	* tp/Texinfo/XS/main/TranslationsXS.xs (gettree): more compact code.

2023-11-05  Gavin Smith <gavinsmith0123@gmail.com>

	* contrib/tex3patch: Remove.  The message in texinfo.tex that
	recommended this script was removed on 2003-07-27.  It was
	said to work around a bug in "Unix TeX 3.0".  It currently
	has no effect when running on texinfo.tex.

2023-11-05  Patrice Dumas  <pertusus@free.fr>

	* NEWS: mention that PACKAGE* customization variables became
	PACKAGE*_OPTION.  Mentioned by Arsen.

2023-11-05  Gavin Smith <gavinsmith0123@gmail.com>

	* contrib/texifont: Remove subdirectory.  It has been untouched
	for over 10 years and has no prospect of further development.

2023-11-05  Gavin Smith <gavinsmith0123@gmail.com>

	Revert documentlanguage fix

	* tp/Texinfo/ParserNonXS.pm (_parse_def),
	* tp/Texinfo/XS/parsetexi/def.c (parse_def): Do not set type
	untranslated if @documentlanguage is not set at the time of parsing.
	* tp/t/languages.t (no_documentlanguage_before_copying): Skip test.

	This reverses change on 2023-11-01.  Although it is correct,
	it slows the program down a lot when a lot of @def* are used
	and there is no @documentlanguage.

	This gets back to the execution times from texi2any 7.1 (with XS
	enabled only).

2023-11-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm, tp/ext/highlight_syntax.pm,
	tp/init/documentation_examples.pm, tp/init/html32.pm,
	tp/t/init/ignore_and_comments_output.init,
	tp/t/init/mini_ker_t2h.init, tp/t/init/t2h_singular.init: handle undef
	contents for all commands and types conversion functions (and undef
	args).

2023-11-05  Patrice Dumas  <pertusus@free.fr>

	Change customization of translations to target only translated string

	* tp/Texinfo/Translations.pm (translate_string): rename _gdt as
	translate_string.  Update callers.

	* doc/texi2any_api.texi (Translated Strings Customization)
	(Translation Contexts), tp/Texinfo/Convert/HTML.pm (translate_string),
	(%default_formatting_references), tp/Texinfo/Translations.pm (gdt)
	(gdt_string), tp/Texinfo/XS/convert/convert_html.c
	(html_translate_string, html_gdt, html_gdt_tree, html_pgdt_tree)
	(special_unit_info_tree, html_translate_names)
	(convert_to_html_internal), tp/Texinfo/XS/main/call_perl_function.c
	(call_formatting_function_format_translate_message),
	tp/Texinfo/XS/main/get_perl_info.c, tp/init/documentation_examples.pm,
	tp/t/init/special_element_customization.pm,
	tp/t/init/translated_strings_customization.pm,
	tp/t/init/translation_in_parser_in_translation.pm: remove the
	possibility to customize the output of gdt or gdt_string, instead
	replace translate_string by the format_translate_message formatting
	function output. format_translate_message replaces
	format_translate_message_tree and format_translate_message_string.

2023-11-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm, tp/Texinfo/Convert/HTML.pm,
	tp/Texinfo/Convert/PlainTexinfo.pm, tp/Texinfo/Convert/Text.pm,
	tp/Texinfo/Structuring.pm, tp/Texinfo/Transformations.pm: always use
	main XS file first, and add use Texinfo::XSLoader if used in the
	module.

	* tp/Texinfo/Convert/ConvertXS.pm: only load if TEXINFO_XS_CONVERT is
	set. From Gavin.

	* tp/Texinfo/StructTransf.pm: only load if TEXINFO_XS_PARSER is not
	unset and TEXINFO_XS_STRUCTURE is not set to 0. From Gavin.

	* tp/Texinfo/Common.pm ($XS_structuring, import),
	tp/Texinfo/Structuring.pm ($XS_structuring, import),
	tp/Texinfo/Transformations.pm ($XS_structuring, import): load modules
	only if TEXINFO_XS_PARSER is not unset and TEXINFO_XS_STRUCTURE is not
	set to 0. From Gavin.

	* tp/t/test_utils.pl ($XS_structuring, test), tp/texi2any.pl: set
	no_build argument to parse_texi_* and consider that error messages are
	done in XS if TEXINFO_XS_PARSER is not unset and TEXINFO_XS_STRUCTURE
	is not set to 0. Based on Gavin idea.

	* tp/Texinfo/Convert/Text.pm ($XS_convert, _convert_tree_with_XS)
	(convert_to_text, output): call perl code preparing for XS call and
	calling XS functions only if TEXINFO_XS_CONVERT is set.

2023-11-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c, tp/Texinfo/XS/main/converter_types.h:
	remove HTML_CSS_FORMATTING_REFERENCES_LIST.

	* tp/Texinfo/Convert/HTML.pm (command_text): handle 'cmdname' not set
	to set context string by using the type.

	* tp/Texinfo/Convert/HTML.pm (_convert, _convert_style_command)
	(_convert_w_command, _convert_email_command)
	(_convert_explained_command, _convert_uref_command)
	(_convert_image_command, _convert_math_command)
	(_convert_indicateurl_command, _convert_titlefont_command)
	(_convert_U_command), tp/init/html32.pm,
	tp/init/documentation_examples.pm: if there are no arguments for a
	command, pass undef as args.  Update converting functions to account
	for that change.

	* tp/Texinfo/Convert/Text.pm (encode_text_options),
	tp/Texinfo/XS/main/get_perl_info.c (get_expanded_formats): pass
	expanded_formats as a hash, never as an array.

	* tp/Texinfo/Convert/HTML.pm (_convert_before_item_type): handle undef
	$contents.

	* tp/Texinfo/Convert/HTML.pm (_new_document_context)
	(_reset_unset_no_arg_commands_formatting_context),
	tp/Texinfo/XS/convert/convert_html.c (html_new_document_context)
	(reset_unset_no_arg_commands_formatting_context): change in contexts
	names.

	* tp/Texinfo/Convert/HTML.pm (convert): set 'current_filename' earlier
	such that it is available in perl codes called by XS.

	* tp/Texinfo/Convert/HTML.pm (import, converter_initialize, convert)
	(_finalize_output_state, output), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_initialize_output_state, html_finalize_output_state)
	(html_new_document_context, html_pop_document_context),
	tp/Texinfo/XS/convert/convert_html.c (html_new_document_context)
	(html_pop_document_context, html_converter_initialize)
	(html_finalize_output_state), tp/Texinfo/XS/main/build_perl_info.c
	(build_html_formatting_state), tp/Texinfo/XS/main/command_stack.c
	(html_top_document_context, html_top_formatting_context): add XS
	overrides for _new_document_context.  push the first document context
	in _initialize_output_state, not in converter_initialize, add an
	argument for _initialize_output_state for the context name.  Add
	_finalize_output_state to be called at the end of output, and add an
	XS override to pop the last document context.  Add
	document_contexts_to_pop and document_context_change states to change
	only the document contexts that need to be when passing to perl.
	rename top_document_context as html_top_document_context and 
	top_html_formatting_context as html_top_formatting_context.

	* tp/Texinfo/XS/convert/convert_html.c (html_gdt_string, html_gdt_tree)
	(html_pgdt_tree): prepend html_ to the function names.

	* tp/Texinfo/XS/convert/convert_html.c (html_gdt_string)
	tp/Texinfo/XS/main/build_perl_info.c (build_replaced_substrings),
	tp/Texinfo/XS/main/call_perl_function.c
	(call_formatting_function_format_translate_message_string): add
	strings customization support.

	* tp/Texinfo/XS/main/translations.c (translate_string): free langs
	pointers.

	* tp/Texinfo/XS/main/translations.c: use const for messages, contexts
	and language aruments.

	* tp/Texinfo/Convert/Converter.pm (%common_converters_defaults),
	tp/t/accents.t (test_enable_encoding): add document_descriptor as
	an option in Texinfo::Convert::Converter to retrieve a document even
	if only the descriptor is known, for instance if only the tree is
	available.  Setup state and an XS converter by passing
	tree_document_descriptor as document_descriptor in option in
	accents.t, and by calling _initialize_output_state.

	* tp/Texinfo/Convert/HTML.pm (register_file_information)
	(get_file_information, _initialize_output_state): rename
	files_information state as html_files_information.

2023-11-04  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Structuring.pm (import),
	* tp/Texinfo/Transformations.pm (import):
	List overrided perl subroutines in a hash for more concise code.

2023-11-04  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Common.pm (import): List overrided perl subroutines
	in a hash for more concise code.

2023-11-04  Gavin Smith <gavinsmith0123@gmail.com>

	* info/scan.c (write_tag_contents): Check if added text is of
	zero length in order to avoid subsequently calling memcpy with
	a null source argument.  Report with -fsanitize=undefined on amd64
	from Sam James <sam@gentoo.org>.

2023-11-03  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/Makefile.am: Make files depend on
	maintain/regenerate_C_options_info.pl if built by that script.


2023-11-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (build_html_formatting_state):
	current_filename is found by get_info, therefore in converter_info
	there is a reference on the value in the converter hash.  The
	associated SV should not be replaced such that its reference stays the
	same.  Therefore for current_filename use sv_setpv to modify the
	value but not the SV to pass to perl.

2023-11-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (command_special_unit_variety)
	(prepare_special_units): rename command_special_unit_variety from
	contents_command_special_unit_variety and add footnotes.

	* tp/Texinfo/XS/convert/convert_html.c (special_unit_info_tree)
	(special_unit_info, prepare_special_units): use find_string.

	* tp/Texinfo/XS/convert/convert_html.c (html_converter_initialize),
	tp/Texinfo/XS/main/converter_types.h (COMMAND_ID_INDEX, CONVERTER):
	add command_special_variety_name_index to converter that associate
	command names with indices in special_unit_varieties and the
	HF_special_variety flag for those commands.

	* tp/Texinfo/XS/convert/convert_html.c (html_get_tree_root_element):
	if find_container is set, return the output unit associated to
	commands that are associated with an output unit.

2023-11-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c, tp/Texinfo/XS/main/errors.c:
	add "%s" format for fprintf instead of using a string as format.
	Report from Gavin.

2023-11-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (converter_initialize),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_converter_initialize_sv),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER),
	tp/Texinfo/XS/main/get_perl_info.c
	(register_formatting_reference_default)
	(register_formatting_reference_with_default)
	(html_converter_initialize_sv): pass css strings commands and types
	conversion to C. To setup css strings formatting references, copy the
	formatting references and replace with specific css functions
	references. Do that for formatting functions, commands and types
	conversion.

	* tp/Texinfo/XS/convert/convert_html.c (command_conversion)
	(type_conversion, html_initialize_output_state),
	tp/Texinfo/XS/main/call_perl_function.c (call_types_conversion)
	(call_commands_conversion), tp/Texinfo/XS/main/converter_types.h
	(CONVERTER): add current_formatting_references,
	current_commands_conversion and current_types_conversion in converter
	to be able to change formatting functions references lists as a whole.

	* tp/Texinfo/XS/convert/convert_html.c (html_convert_css_string)
	(reset_unset_no_arg_commands_formatting_context),
	tp/Texinfo/XS/main/build_perl_info.c (build_html_translated_names):
	implement css string conversion and pass translated css strings no arg
	commands back to perl.

2023-11-02  Gavin Smith <gavinsmith0123@gmail.com>

	* configure.ac, js/info.js, util/texi2dvi, util/texi2pdf:
	Bump version to 7.1dev.

2023-11-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/get_perl_info.c (add_svav_to_string_list): use a
	SV * in argument, not a SV **.  Update callers.

	* tp/Texinfo/XS/main/get_perl_info.c (get_sv_options),
	tp/maintain/regenerate_C_options_info.pl: generate automatically
	get_sv_option to get one option value from perl and set the C option.
	Put get_sv_options in get_perl_info.c, that calls get_sv_option for
	each option set in perl.

	* tp/Texinfo/Convert/Converter.pm (import, _XS_set_conf, set_conf)
	(force_conf), tp/Texinfo/XS/convert/ConvertXS.xs (set_conf),
	tp/Texinfo/XS/main/get_perl_info.c (set_conf): XS interface to set
	customization options in C converter options.

	* tp/Texinfo/Convert/HTML.pm (_translate_names): always use XS
	if with XS.

	* tp/Texinfo/XS/convert/convert_html.c
	(reset_unset_no_arg_commands_formatting_context),
	tp/Texinfo/Convert/HTML.pm
	(_reset_unset_no_arg_commands_formatting_context): add context name in
	explanations of conversion.

2023-11-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(convert_output_output_unit_internal): do not output the NUL in
	fwrite.

	* tp/Texinfo/XS/convert/convert_html.c (convert_to_html_internal):
	set HMSF_preformatted_classes after closing a style type.

	* tp/Texinfo/XS/convert/convert_html.c
	(convert_output_output_unit_internal): pass output_unit_filename to
	format_end_file and format_begin_file instead of full paths.

	* tp/Texinfo/XS/convert/convert_html.c (html_converter_initialize):
	do not register pre class for non preformatted commands with small
	variants.

	* tp/Texinfo/XS/main/utils.c (SMALL_BLOCK_COMMANDS_LIST): fix typo in
	name.

2023-11-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_set_pages_files)
	(html_converter_initialize): initialize file_changed_counter in
	html_set_pages_files as it requires knowing the number of output
	files.

	* tp/Texinfo/XS/convert/convert_html.c
	(convert_output_output_unit_internal): handle the case of no
	conversion to output encoding setup.

	* tp/Texinfo/XS/main/build_perl_info.c (init): initialize "utf-8"
	&output_conversions to be sure that it is set before other
	conversions.

	* tp/Texinfo/XS/main/utils.c (get_encoding_conversion): use strcasecmp
	to compare encoding names in a case-insensitive way.

2023-11-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_convert_output): correct
	fclose error status reading.

	* tp/Texinfo/XS/main/translations.c (replace_substrings): allocate
	output strings in all the cases.

	* tp/Texinfo/XS/main/errors.c (message_list_document_error_internal):
	show immediately error messages if DEBUG is set.

2023-11-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_html_convert_output),
	tp/Texinfo/XS/convert/convert_html.c (html_convert_output): only
	consider two cases for filenames, no filenames if output_file is the
	empty string '', filenames otherwise.

	* tp/Texinfo/Convert/HTML.pm (_html_convert_output, import)
	(_XS_html_prepare_title_titlepage, _prepare_title_titlepage, convert),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_title_titlepage),
	tp/Texinfo/XS/convert/convert_html.c (html_prepare_title_titlepage)
	(html_convert_output): separate setting titlepage from main
	conversion, removing code from html_convert_output to put it in
	*_prepare_title_titlepage, replacing html_convert_init and
	_XS_html_convert_init for convert.

	* tp/Texinfo/XS/main/call_perl_function.c
	(call_formatting_function_format_title_titlepage): call
	build_html_formatting_state if needed.

2023-11-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/languages.t
	(no_documentlanguage_before_copying): test without @documentlanguage
	before @copying but a @documentlanguage before @insertcopying.  From
	Gavin.

2023-11-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_def),
	tp/Texinfo/XS/parsetexi/def.c (parse_def): set type untranslated and
	associate translation context even if @documentlanguage is not set at
	the time of parsing.  @documentlanguage may indeed be set when
	converting.  Report from Gavin.

2023-11-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_html_convert_output): if a special
	element body is empty, do not return immediately but check if there is
	already a body registered with the file, as in that case, the body
	would need to be output.

	* tp/Texinfo/Common.pm (output_files_open_out): warn if an unclosed
	file has already been registered.

	* tp/Texinfo/XS/main/utils.c (add_include_directory): simplify, set
	string argument const.

	* tp/Texinfo/Convert/HTML.pm (_html_convert_output),
	tp/Texinfo/XS/convert/convert_html.c (html_convert_output): rename $footer
	as $file_end and $header as $file_beginning.

	* tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_units_directions_files),
	tp/Texinfo/XS/convert/convert_html.c
	(html_prepare_units_directions_files),
	tp/Texinfo/XS/convert/converter.c (initialize_output_units_files),
	tp/Texinfo/XS/convert/convert_html.c (html_set_pages_files),
	tp/Texinfo/XS/convert/converter.c (find_output_unit_file)
	(add_output_units_file, set_output_unit_file)
	(register_normalize_case_filename, set_file_path),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): put
	output_unit_files directly in CONVERTER. Start indices of found files
	in output_unit_files list at 0. have set_output_unit_file and
	functions called by set_output_unit_file return indices in
	output_unit_files list. Setup converter output_unit_file_indices and
	special_unit_file_indices with each output unit output_unit_files file
	index.

	* tp/Texinfo/XS/convert/convert_html.c (unique_target),
	tp/Texinfo/XS/main/utils.c (find_string): add
	find_string function.

	* tp/Texinfo/XS/main/build_perl_info.c (newSVpv_byte): add
	newSVpv_byte.

	* tp/Texinfo/Convert/HTML.pm (_html_convert_output),
	tp/Texinfo/XS/convert/convert_html.c
	(convert_output_output_unit_internal, html_convert_output),
	tp/Texinfo/XS/main/build_perl_info.c (build_html_formatting_state),
	tp/Texinfo/XS/main/convert_utils.c (encoded_output_file_name),
	(register_unclosed_file, output_files_open_out)
	(output_files_register_closed), tp/Texinfo/XS/main/converter_types.h
	(ARRAY_INDEX_LIST, FILE_NAME_PATH_COUNTER, FILE_STREAM)
	(FILE_STREAM_LIST, OUTPUT_FILES_INFORMATION):
	finish C html_convert_output output implementation. Pass file counters
	back to perl. Add Texinfo::Common output_files_information API to C to
	open and register files.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_convert_output),
	tp/Texinfo/XS/convert/convert_html.c (html_converter_initialize),
	tp/Texinfo/XS/main/build_perl_info.c
	(build_output_files_unclosed_files, build_output_files_opened_files)
	(build_output_files_information): build perl converter
	output_files_information.

	* tp/texi2any.pl (%main_unclosed_files): rename %unclosed_files as
	%main_unclosed_files.

2023-10-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/call_perl_function.h (FILE_NAME_PATH)
	(TARGET_CONTENTS_FILENAME): move to call_perl_function.h.

	Update includes in many files.

2023-10-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm ($XS_convert): add a variable, set to 1
	if $ENV{TEXINFO_XS_CONVERT} is 1 to run perl codes calling XS codes
	only if set.

	* tp/Texinfo/Convert/HTML.pm (import, _XS_html_convert_output)
	(_html_convert_output), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_convert_output), tp/Texinfo/XS/convert/convert_html.c
	(html_convert_output, convert_convert_output_unit_internal)
	(convert_output_output_unit_internal),
	tp/Texinfo/XS/main/call_perl_function.c
	(call_formatting_function_format_footnotes_segment)
	(call_formatting_function_format_end_file)
	(call_formatting_function_format_begin_file): add a separate function,
	_html_convert_output, for the main conversion code.  A return of undef
	from that function means failure now, and not no text to output. Setup
	an XS interface to replace this code, with html_convert_output.
	Partial implementation in C code.

2023-10-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (output): rename $output for the no page
	case to $text_output.  Move _do_js_files call out of the conversion
	code, to prepare for XS override.

2023-10-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_do_js_files, output): move code related
	to js files, both for INFO_JS_DIR and for js license file also for
	mathjax to the _do_js_files function.  Call _do_js_files also if there
	is no output file, but only if TEST is not set, a combination which is
	very unlikely.
	
	* tp/Texinfo/Convert/HTML.pm (output), tp/t/test_utils.pl: update
	comments, in particular in output on unreachable code, as code that is
	unreachable corresponds to the case output_file ne '' and no pages.

	* tp/Makefile.tres, tp/t/html_tests.t (info_js_dir_html)
	(info_js_dir_html_text, mathjax_with_texinfo_html_file)
	(info_js_dir_html_file): more tests to test INFO_JS_DIR and check when
	associated files are created.

	* Changelog: remove some spaces.

2023-10-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (output): move js files copying code out
	of output units formatting loop.

	* tp/Texinfo/Convert/Converter.pm (output)
	(determine_files_and_directory), tp/Texinfo/Convert/HTML.pm (output):
	make sure that $destination_directory is defined.

	* tp/Texinfo/Convert/HTML.pm (_do_jslicenses_file, output): handle the
	case of empty directory string, avoid calling File::Spec->catdir in
	that case.

	* tp/Texinfo/Convert/HTML.pm (output): update code used in case there
	are no pages, even though the situation cannot arise. Also add
	comments.

	* tp/Texinfo/Convert/HTML.pm (output): simplify units conversion code
	in output().

2023-10-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_convert_tree): rename
	convert_tree as html_convert_tree.

	* tp/Texinfo/Convert/HTML.pm (_XS_html_convert_tree),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_convert_tree):
	immplementation of html_convert_tree XS interface, not used as
	convert_tree is not called on trees registered in XS.

2023-10-30  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl: do not rebuild the perl document/tree before calling
	convert_to_texinfo for MACRO_EXPAND if TEXINFO_XS_CONVERT is set.

2023-10-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_conversion_units, convert)
	(output): set contents and shortcontents early in convert and
	output, where other configurations options are set, and not in
	_prepare_conversion_units.

	* tp/Texinfo/XS/convert/convert_html.c (html_convert_convert): convert
	special units instead of output units twice...

	* tp/Texinfo/XS/main/build_perl_info.c (build_html_document_context):
	add missing call of build_html_document_context_ctx.

	* tp/Texinfo/XS/main/convert_to_texinfo.c
	(root_heading_command_to_texinfo): initialize tree, fix nesting of
	if, free text representation of command.

	* tp/Texinfo/Convert/Texinfo.pm (root_heading_command_to_texinfo):
	reorganize code, no functional change.

	* tp/Texinfo/Convert/HTML.pm (convert_output_unit),
	tp/Texinfo/XS/convert/convert_html.c (convert_output_unit): better debug
	for output units conversion.

	* tp/Texinfo/XS/convert/convert_html.c (prepare_footnotes_targets):
	free footnote texinfo content in debug message.

	* tp/Texinfo/XS/convert/convert_html.c (html_translate_names):
	add encoding_name in debug message.

2023-10-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.h (TRANSLATED_SUI_ASSOCIATION),
	tp/Texinfo/XS/convert/convert_html.c: move TRANSLATED_SUI_ASSOCIATION
	from convert_html.c to utils.h.

	* tp/Texinfo/XS/main/utils.c (special_unit_info_type_names)
	(translated_special_unit_info), tp/Texinfo/XS/main/get_perl_info.c: move
	special_unit_info_type_names and translated_special_unit_info from
	get_perl_info.c to utils.c.

	* tp/Texinfo/XS/convert/convert_html.c (html_pop_document_context):
	free preformatted_classes.

	* tp/Texinfo/XS/convert/convert_html.c (html_converter_initialize),
	tp/Texinfo/XS/main/get_perl_info.c (html_converter_initialize_sv):
	call html_converter_initialize at the end of
	html_converter_initialize_sv and move code initializing
	global_units_directions to html_converter_initialize.

	* tp/Texinfo/XS/convert/convert_html.c
	(reset_unset_no_arg_commands_formatting_context): free and strdup
	no_arg_command_context->text).  Correctly set self->modified_state
	with flags.

	* tp/Texinfo/XS/main/converter_types.h (CONVERTER): have
	no_arg_formatted_cmd directly in converter, not a pointer to it.
	Update code referring to no_arg_formatted_cmd.

	* tp/Texinfo/XS/convert/convert_html.c (html_converter_initialize)
	(html_translate_names), tp/Texinfo/XS/main/build_perl_info.c
	(build_html_translated_names, build_html_formatting_state),
	tp/Texinfo/XS/main/converter_types.h (CONVERTER): in
	html_translate_names, collect information on commands that will need
	to be reset or that are translated to pass to perl, and mark that
	formatting state translations have to be set for perl. Reset perl
	converter data and pass translated data in
	build_html_translated_names.

	* tp/Texinfo/XS/convert/convert_html.c (convert_to_html_internal):
	call destroy_args_formatted to free args_formatted.

2023-10-29  Gavin Smith <gavinsmith0123@gmail.com>

	* po_document/no.po, po_document/nb.po:
	Rename to nb.po and remove "No translation available!" translations.
	Report from Karl Ove Hufthammer.

2023-10-29  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/info-stnd.texi (Custom Key Bindings): Also document
	XDG_CONFIG_DIRS and correct name of other env variable.

2023-10-29  Gavin Smith <gavinsmith0123@gmail.com>

	* info/infomap.c (locate_init_file): Check through
	XDG_CONFIG_DIRS as a last resort, using /etc/xdg as a default
	value.
	(fetch_user_maps): Accommodate null return value from
	locate_init_file.

2023-10-29  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/info-stnd.texi (Custom Key Bindings): Describe looking
	under XDG_CONFIG_HOME first for infokey file.
	* doc/info-stnd.texi: Refer to infokey rather than .infokey
	throughout.
	* NEWS: mention change

2023-10-29  Gavin Smith <gavinsmith0123@gmail.com>

	XDG directory for infokey

	* info/infomap.c (locate_init_file): New function, split
	from fetch_user_maps.  Check for init file under $XDG_CONFIG_HOME
	or .config before checking for $HOME/.infokey.
	(fetch_user_maps): Call locate_init_file.
	* info/infomap.h, info/infomap.c (INFOKEY_FILE): Move to infomap.c
	and define without leading period.
	* info/infomap.c (DOT_INFOKEY_FILE): Provide definition with
	leading period.

2023-10-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES),
	tp/Texinfo/XS/main/converter_types.h: move definitions of types
	related to document and converter to a separate file,
	converter_types.h, to avoid issues with include order.

	* tp/Texinfo/XS/main/command_stack.c (top_html_formatting_context)
	(top_document_context), tp/Texinfo/XS/convert/convert_html.c: move
	top_html_formatting_context and top_document_context out of
	convert_html.c to tp/Texinfo/XS/main/command_stack.c.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_translate_names)
	(html_convert_convert), tp/Texinfo/XS/convert/convert_html.c
	(html_new_document_context, html_pop_document_context)
	(convert_tree_new_formatting_context, convert_to_html_internal)
	(convert_output_unit), tp/Texinfo/XS/main/build_perl_info.c
	(build_html_formatting_context_ctx, build_html_formatting_context)
	(build_html_document_context, build_html_formatting_context_stack)
	(build_html_composition_context_stack)
	(build_html_preformatted_classes_stack, build_html_monospace_stack)
	(build_html_block_commands_stack, build_html_document_context_ctx)
	(build_html_formatting_state), tp/Texinfo/XS/main/call_perl_function.c
	(call_types_conversion, call_types_open, call_commands_conversion)
	(call_commands_open): use modified_state to hold information on the
	state that needs to be reset before calling perl code, using flags
	with name HMSF_*. Add the flags variable as argument of
	build_html_formatting_state. Add functions for more fine grained
	rebuilt of formatting state.

2023-10-29  Patrice Dumas  <pertusus@free.fr>

	Regular tree structure for @value with flag not found

	* tp/Texinfo/ParserNonXS.pm (_new_value_element),
	tp/Texinfo/Convert/HTML.pm (_convert), tp/Texinfo/Convert/Texinfo.pm
	(_expand_cmd_args_to_texi), tp/Texinfo/Translations.pm
	(_substitute_element_array), tp/Texinfo/XS/main/convert_to_texinfo.c
	(expand_cmd_args_to_texi), tp/Texinfo/XS/main/translations.c
	(substitute_element_array), tp/Texinfo/XS/parsetexi/parser.c
	(new_value_element): use brace_command_arg to hold the flag text in
	the first contents for @value and @txiinternalvalue.

2023-10-29  Patrice Dumas  <pertusus@free.fr>

	No export of perl tree at parsing time with XS

	* tp/Texinfo/Common.pm (informative_command_value)
	(get_global_document_command, set_global_document_command),
	tp/Texinfo/XS/main/utils.c (informative_command_value)
	(set_global_document_command, get_global_document_command):
	make informative_command_value public.  Split retrieval of global
	element out of set_global_document_command to a new
	get_global_document_command function that is called by
	set_global_document_command.

	* tp/Texinfo/Common.pm (relate_index_entries_to_table_items_in_tree),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(relate_index_entries_to_table_items_in_tree): use document as
	argument of relate_index_entries_to_table_items_in_tree.  Update
	callers.

	* tp/Texinfo/ParserNonXS.pm (get_parser_info),
	tp/Texinfo/XS/main/build_perl_info.c (build_global_info): add
	novalidate and documentlanguage information in global info,
	duplicating information from global commands, in order not to depend
	on global commands being present for structuring and transformations.

	* tp/Texinfo/XS/main/build_perl_info.c (build_global_info)
	(build_global_info_tree_info, get_document, build_document),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (_get_parser_info)
	(parse_texi_file, parse_texi_piece, parse_texi_text, parse_texi_line),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (get_document),
	tp/t/test_utils.pl (test), tp/texi2any.pl: add $no_build argument to
	XS parse perl functions. If set, the document is returned by
	get_document and contains only minimal information built from XS that
	is needed before rebuild_document call.  For that,
	build_global_info_tree_info is split out of build_global_info as it
	needs a built tree.  In texi2any.pl and test_utils.pl set the
	$no_build argument to $with_XS, such as not to built a tree if XS is
	used.

2023-10-29  Patrice Dumas  <pertusus@free.fr>

	* po/POTFILES.in: add tp/Texinfo/XS/structuring_transfo/structuring.c,
	tp/Texinfo/XS/structuring_transfo/transformations.c and
	tp/Texinfo/XS/main/convert_utils.c.

	update po files.

2023-10-29  Patrice Dumas  <pertusus@free.fr>

	* doc/tp_api/Makefile.am (texi2any_internals_dependencies): replace
	TranslationsNonXS.pm by Translations.pm.

2023-10-29  Patrice Dumas  <pertusus@free.fr>

	update po files

2023-10-29  Patrice Dumas  <pertusus@free.fr>

	* po_document/POTFILES.in: replace tp/Texinfo/TranslationsNonXS.pm by
	tp/Texinfo/Translations.pm.

2023-10-29  Patrice Dumas  <pertusus@free.fr>

	Use specific functions overrides for Translations, not full module

	* tp/Texinfo/TranslationsXS.pm, tp/Makefile.am (dist_modules_DATA),
	tp/Texinfo/Translations.pm, tp/Texinfo/XS/Makefile.am (xs_LTLIBRARIES,
	TranslationsXS*), tp/Texinfo/XS/main/TranslationsXS.xs: rename
	Translations.xs as TranslationsXS.xs and use the
	Texinfo::TranslationsXS namesapce in the XS file.  rename
	Texinfo/Translations.pm as Texinfo/TranslationsXS.pm and update,
	rename as Texinfo/TranslationsNonXS.pm as Texinfo/Translations.pm and
	add content of Texinfo/XS/main/TranslationsXS.pm, with some code
	update.  Remove Texinfo/XS/main/TranslationsXS.pm.

2023-10-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (store_source_mark_list),
	tp/Texinfo/XS/main/tree_types.h (SM_TYPES_LIST),
	tp/Texinfo/XS/parsetexi/source_marks.c (register_source_mark)
	(source_marks_reset_counters): remove SM_type_none from SM_TYPES_LIST
	and use SM_TYPES_LIST more to avoid repetitive code.

2023-10-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): use
	lookup_info instead of lookup_extra_string, as the information needed
	is in info and not extra and there is no corresponding function.
	Revert the recent change.

2023-10-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c: inline and remove
	element_type_name function.  Inline in callers.

2023-10-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (plain_texinfo_convert_tree)
	(text_convert_tree): use newSVpv_utf8.

	* tp/Texinfo/XS/main/builtin_commands.c (element_builtin_cmd): return
	0 if the e->cmd value is outside of the the command id tables
	boundaries.

	* tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): use
	lookup_extra_string.

	* tp/Texinfo/XS/convert/converter.c,
	tp/Texinfo/XS/convert/indices_in_conversion.c,
	tp/Texinfo/XS/main/build_perl_info.c,
	tp/Texinfo/XS/main/command_stack.c, tp/Texinfo/XS/parsetexi/api.c,
	tp/Texinfo/XS/parsetexi/parser.c: update comments.

	* tp/Texinfo/XS/parsetexi/parser.c: reindent.

2023-10-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/api_to_perl.c (call_switch_to_global_locale)
	(call_sync_locale): call switch_to_global_locale and sync_locale only
	for the perl versions that have them.  From Gavin.

2023-10-28  Gavin Smith <gavinsmith0123@gmail.com>

	* po_document/no.us-ascii.po, po_document/no.po:
	Rename and state the encoding to be UTF-8.  This avoids the
	creation of an extra no.us-ascii directory on users' systems to
	hold the translation, with it being unlikely that packages other
	than Texinfo are providing a translation for no.us-ascii.

	Suggestion from Rafel Fontanelle <rafaelff@gnome.org>.

2023-10-28  Gavin Smith <gavinsmith0123@gmail.com>

	Remove us-ascii translations

	* po_document/ca.us-ascii.po, po_document/de.us-ascii.po,
	po_document/pt.us-ascii.po, po_document/pt_BR.us-ascii.po:
	Remove these unmaintained translations files.  Variants exist
	without the .us-ascii suffix, maintained via the Translation Project.
	* NEWS: mention

	Report from Rafel Fontanelle <rafaelff@gnome.org>.

2023-10-28  Gavin Smith <gavinsmith0123@gmail.com>

	Remove out-of-place translation file

	* po_document/pl.iso-8859-2.po: Remove.
	* tp/t/input_files/pl_translated_inserted_strings_8bit.texi,
	* tp/t/formats_encodings.t (8bit_document_translations): Remove.

	This reverts the addition of this file and test on 2023-08-06.  This
	translation file did not belong under po_document as it was not
	provided by upstream translators, and would take extra work to keep
	the translation up-to-date. It would also be installed
	unnecessarily on users' systems (report from Rafael Fontenelle).
	It was only added for the sake of the test.

2023-10-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm, tp/Texinfo/Convert/DocBook.pm,
	tp/Texinfo/Convert/HTML.pm, tp/Texinfo/Convert/LaTeX.pm,
	tp/Texinfo/Convert/Plaintext.pm, tp/Texinfo/Convert/TexinfoMarkup.pm,
	tp/Texinfo/Convert/Text.pm, tp/Texinfo/Convert/TextContent.pm,
	tp/t/test_utils.pl: rename expanded_formats_hash as expanded_formats.

	* tp/Texinfo/XS/main/utils.h (EXPANDED_FORMAT): set typedef for struct
	expanded_format.  Update all code using this type.

	* tp/Texinfo/Convert/Converter.pm (encode_converter_document),
	tp/Texinfo/XS/main/get_perl_info.c (get_expanded_formats)
	(copy_sv_options_for_convert_text, html_converter_initialize_sv):
	pass expanded_formats to converter.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_translate_names)
	(html_convert_convert): if self->modified_state, rebuild formatting
	state after calling the C function.

	* tp/Texinfo/XS/convert/convert_html.c (COMMAND_ID_ARGS_SPECIFICATION)
	(COMMAND_ARGS_SPECIFICATION, html_converter_initialize)
	(convert_to_html_internal): use systematically unsigned long for flags
	and correctly multiply by the size when copying.

	* tp/Texinfo/XS/main/convert_to_text.c
	(TEXT_INDICATOR_CONVERTER_OPTIONS, copy_options_for_convert_text),
	tp/Texinfo/XS/main/convert_to_text.h (TEXT_OPTIONS),
	tp/Texinfo/XS/main/get_perl_info.c (copy_sv_options_for_convert_text):
	add copy_options_for_convert_text to be called from converters.
	Upper-case TEXT_OPTIONS fields common with OPTIONS.

	* tp/Texinfo/XS/convert/convert_html.c (convert_to_html_internal):
	set convert_to_text formatted args.

	* tp/Texinfo/XS/convert/convert_html.c (convert_to_html_internal):
	free command_type.text.

2023-10-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (html_converter_initialize):
	fix setting HF_composition_context for HTML_align_cmd.

	* tp/Texinfo/XS/main/build_perl_info.c (build_html_document_context):
	fix name of monospace context key in perl.

	* tp/Texinfo/Convert/HTML.pm (_convert): minor change for
	monospacestring argument formatting to be more consistent with other
	codes and with XS code.

2023-10-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (convert_to_html_internal),
	tp/Texinfo/XS/main/element_types.txt (text): add a virtual element
	type for all the elements holding text, and use it for the selection
	of the conversion function, similar to perl code.

	* doc/texi2any_api.texi (Tree Element Conversion Functions): explain
	the a text type is used to select formatting function for tree
	elements with text.

2023-10-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfoxs_la_SOURCES),
	(main/api_to_perl.c, main/api_to_perl.h)
	(tp/Texinfo/XS/main/build_perl_info.c): rename main/tree_perl_api.h as
	main/api_to_perl.h and move corresponding code from
	main/build_perl_info.c to main/api_to_perl.c, newly created.

	* main/api_to_perl.c (call_sync_locale, call_switch_to_global_locale)
	tp/Texinfo/XS/main/translations.c (translate_string),
	tp/tests/many_input_files/different_languages_gen_master_menu.sh
	(LC_ALL), tp/tests/run_parser_all.sh b/tp/tests/run_parser_all.sh
	(LC_ALL): call switch_to_global_locale and sync_locale to fix C locale
	not being translated, it is required in XS code that calls setlocale.
	Analysis and solution from Gavin.

2023-10-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfoxs_la_SOURCES),
	tp/Texinfo/XS/main/call_perl_function.h: add call_perl_function.h file
	for a more common code, also given that these functions should
	probably only called from the HTML converter.

2023-10-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_def_line_type): fix call of
	Texinfo::Convert::Text::convert_to_text (in a code that is never run
	in normal circumstances).

	* tp/Texinfo/Convert/HTML.pm (converter_initialize): set non expanded
	raw format commands to undef in 'commands_conversion' rather than not
	setting the key in the hash, as the meaning is different, it means
	ignoring the command, not that the command is not formatted.  For the
	XS code it makes a difference.

	* tp/Texinfo/Convert/HTML.pm (_translate_names, output): do not run
	both perl and XS code as it will mess up the converter state.  Do not
	call the XS code for now in output.

	* tp/Texinfo/Convert/HTML.pm (_convert): unset
	$self->{'current_root_command'} also when the command is not
	converted.

	* tp/Texinfo/Convert/Converter.pm (encode_converter_document)
	tp/Texinfo/Convert/HTML.pm (converter_initialize),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_converter_initialize_sv),
	tp/Texinfo/XS/main/get_perl_info.c (html_converter_initialize_sv),
	tp/Texinfo/XS/main/utils.h (CONVERTER): pass output_units_conversion
	to XS.

	* tp/Texinfo/Convert/Text.pm (convert_to_text): confess if $options is
	not a ref.

	* tp/Texinfo/XS/main/utils.h (HTML_ARG_FORMATTED)
	(HTML_ARGS_FORMATTED, enum argument_formatting_type)
	(HTML_ARGUMENTS_FORMATTED_FORMAT_TYPE):
	rename from ARG_FORMATTED and ARGS_FORMATTED, move from
	tp/Texinfo/XS/convert/convert_html.c and add
	HTML_ARGUMENTS_FORMATTED_FORMAT_TYPE.

	* tp/Texinfo/XS/convert/convert_html.c (command_conversion)
	(command_open, convert_tree, convert_tree_new_formatting_context)
	(reset_unset_no_arg_commands_formatting_context)
	(destroy_args_formatted, convert_to_html_internal)
	(output_unit_conversion, convert_output_unit),
	tp/Texinfo/XS/main/build_perl_info.c (build_html_formatting_state)
	(build_html_command_formatted_args),
	tp/Texinfo/XS/main/call_perl_function.c (call_commands_conversion)
	(call_commands_open, call_output_units_conversion)
	(call_types_conversion, call_types_open), tp/Texinfo/XS/main/utils.h
	(CONVERTER), tp/Texinfo/XS/main/utils.c
	(html_argument_formatting_type_names): call output units conversion,
	command opening and conversion.  Progress in completeness of
	conversion.  Add self->modified_state to mark that the formatting
	state has to be rebuilt and self->tree_to_build if a tree need to be
	built as perl, in general when it comes from a translated string.
	Pass formatted_args to perl, pass multiple_pass formatting state.

2023-10-27  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/main/build_perl_info.c (build_perl_array):
	Use "%s" for printing a string with fprintf.

2023-10-27  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Text.pm (convert_to_text): Change cluck
	to confess so we do not carry on in the test suite if there is
	a problem.

2023-10-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES),
	tp/Texinfo/XS/main/command_stack.c (COMMAND_STACK)
	(reset_command_stack, push_command, pop_command, top_command)
	(enum command_type_variety, enum monospace_context, COMMAND_OR_TYPE)
	(COMMAND_OR_TYPE_STACK, push_command_or_type, pop_command_or_type)
	(top_command_or_type, STRING_STACK, push_string_stack_string)
	(pop_string_stack, top_string_stack, MONOSPACE_CONTEXT_STACK)
	(push_monospace, push_style_no_code, pop_monospace_context)
	(top_monospace_context), parsetexi/context_stack.c: move code related
	to command stack out of to main/command_stack.c and add code there
	related to other stacks.

	* tp/Texinfo/Convert/Converter.pm (encode_converter_document),
	tp/Texinfo/XS/main/get_perl_info.c (html_converter_initialize_sv):
	pass code_types and pre_class_types to XS.

	* tp/Texinfo/XS/convert/convert_html.c (HTML_COMMAND_STRUCT)
	(additional_format_context_cmd, HTML_align_cmd, html_commands_data)
	(register_format_context_command, register_pre_class_command)
	(html_converter_initialize), tp/Texinfo/XS/main/utils.c
	(small_block_associated_command), tp/Texinfo/XS/main/utils.h
	(SMALL_BLOC_COMMANDS_LIST): setup informations on commands, flags,
	preformatted class and format context strings.

	* tp/Texinfo/XS/convert/convert_html.c (type_conversion, type_open),
	tp/Texinfo/XS/main/call_perl_function.c (call_types_conversion)
	(call_types_open): call of perl conversion type and open type
	functions.

	* tp/Texinfo/XS/convert/convert_html.c (push_html_formatting_context)
	(top_html_formatting_context, pop_html_formatting_context)
	(html_new_document_context, html_pop_document_context)
	(top_document_context), tp/Texinfo/XS/main/utils.h
	(HTML_FORMATTING_CONTEXT, HTML_FORMATTING_CONTEXT_STACK)
	(HTML_DOCUMENT_CONTEXT, HTML_DOCUMENT_CONTEXT_STACK): functions to
	manipulate document context and formatting context.

	* tp/Texinfo/XS/convert/convert_html.c (convert_to_html_internal),
	tp/Texinfo/XS/main/build_perl_info.c (build_html_formatting_context)
	(build_html_document_context, build_html_formatting_state),
	tp/Texinfo/XS/main/call_perl_function.c (call_types_conversion),
	tp/Texinfo/XS/main/element_types.txt, tp/Texinfo/XS/main/utils.h
	(CONVERTER): add setting of document and formatting context, call
	types formatting functions, more types of args formatted.  Set
	modified_state if the state has been changed and needs to be
	reexported before calling a perl function.  Pass document and
	formatting context to perl before calling perl functions.

2023-10-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (import): load conversion overrides only
	if TEXINFO_XS_CONVERT is set.

	* tp/Texinfo/Convert/HTML.pm (convert): return result with XS such
	that there is no double conversion.

2023-10-25  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_tree_copy.t: skip copy_tree call if with XS as there is no
	XS converter available and it triggers a debug message. Report from
	Gavin.

2023-10-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/translations.c: add missing includes.

2023-10-25  Gavin Smith <gavinsmith0123@gmail.com>

	Use enum symbols for end-of-sentence status

	* tp/Texinfo/Convert/ParagraphNonXS.pm (remove_end_sentence)
	(add_text): Use Perl constants for the various possible values
	of $paragraph->{'end_sentence'}, rather than integer literals.
	* tp/Texinfo/XS/xspara.c (enum eos_status): New.
	(xspara_remove_end_sentence, xspara_add_text, PARAGRAPH):
	Use throughout.

2023-10-25  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (xspara__add_next) [debugging output]:
	Only print the word argument up until its length, as it is not
	null-terminated any more.
	(xspara_add_text): TODO comment removed.

2023-10-25  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (xspara_add_text): Process multiple
	space characters together, in order to more closely match the
	execution order of the Perl code.
	(xspara__print_escaped_spaces): Take length argument.
	(debug): Declare as static.

2023-10-25  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/t/02coverage.t (commands_in_math): Remove trailing space on
	a line as this is not the purpose of this test.

2023-10-25  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/ParagraphNonXS.pm (add_text),
	* tp/Texinfo/XS/xspara.c (xspara_add_text):
	Unconditionally use a single space character to separate words in
	the output when not at the end of a sentence, rather than using
	the whitespace character from the input.

2023-10-25  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Conventions)
	<whitespace>: Reword slightly.
	<@ignore'd section on form feeds>: Do not say that FF are kept
	between paragraphs in Info output, as this does not currently
	appear to be the case.
	<@ignore'd section on Emacs>: Delete altogether.

2023-10-25  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/main/errors.c (message_list_line_error_internal):
	Use "%s" to print a string with fprintf in case the string contains
	conversion specifications.

2023-10-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Config.pm (register_XS_document_main_configuration):
	rename Texinfo::Config set_document_main_configuration as
	register_XS_document_main_configuration. Update callers.

	* tp/Texinfo/Common.pm (import, set_document_options),
	tp/Texinfo/Config.pm (register_XS_document_main_configuration),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(set_document_options): return immediately in
	register_XS_document_main_configuration if there is no document
	descriptor, warn in XS if document is not found.  Move perl code done
	in Texinfo::Common in set_document_options to
	register_XS_document_main_configuration.  Override directly
	set_document_options in Texinfo::Common.

	* tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs: minonr
	change in syntax.

2023-10-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (import, copy_treeNonXS, copy_contentsNonXS),
	tp/Texinfo/Structuring.pm (import),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs (copy_tree),
	tp/t/test_tree_copy.t: remove copy_tree from Structuring.pm.  Override
	copy_tree in Common.pm.  Let XS copy_tree build the tree and return the
	perl tree.  Add NonXS variants for copy_tree and copy_contents for
	situations where the XS tree cannot be found or where we want to
	modify perl trees only.  Update callers of copy_tree and
	copy_contents, using the NonXS or the overriden function.

	* tp/t/automatic_nodes.t, tp/t/test_fill_gaps_in_sectioning.t: fix
	skip call.

2023-10-25  Patrice Dumas  <pertusus@free.fr>

	* util/texi-elements-by-size: pass a document in argument of
	sort_element_counts.

2023-10-25  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm (_protect_*)
	(_reference_to_text_in_texi, _normalize_texinfo_name, _prepare_anchor),
	Pod-Simple-Texinfo/pod2texi.pl (_parsed_manual_tree)
	(_fix_texinfo_tree): call Texinfo::Structuring::rebuild_document or
	Texinfo::Structuring::rebuild_tree to rebuild the tree if modified in
	XS.

2023-10-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (sectioning_structure),
	tp/Texinfo/Transformations.pm (protect_hashchar_at_line_beginning):
	put tree first in arguments.  Update callers and XS.

	* tp/t/test_tree_copy.t: call rebuild_tree.

2023-10-24  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): call rebuild_output_units unconditionally
	if $test_split or $split_pages is set.  Add a comment explaining why
	the current code works, because there is no XS override and
	rebuild_output_units returns its output, and that if an XS override is
	set up there should be overrides for all the functions.

2023-10-24  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (convert_to_html): use only strings for SPLIT.

	* tp/Texinfo/Structuring.pm (split_pages): remove normalization of
	$split argument.

2023-10-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (import, split_by_node, split_by_section),
	tp/Texinfo/Convert/HTML.pm (_prepare_conversion_units)
	(_prepare_units_directions_files): remove overriding of split_by_node
	and split_by_section, as it is not needed in HTML. It is still in
	structuring_transfo/StructuringTransfo.xs and could be overriden again
	if there is an actual case in which overriding the functions is
	interesting.

2023-10-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (import, split_pages): remove overriding
	of split_pages, as it is not needed in HTML.  It is still in
	structuring_transfo/StructuringTransfo.xs and could be easily
	overriden again if there is an actual case in which overriding the
	function is interesting.

	* tp/Texinfo/Common.pm, tp/Texinfo/Structuring.pm,
	tp/Texinfo/Transformations.pm: remove now unused $XS_only.

2023-10-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/labels.c (internal_xref_list)
	(remember_internal_xref, reset_internal_xrefs, forget_internal_xrefs):
	use an ELEMENT_LIST for internal_xref_list.

	* tp/Texinfo/Transformations.pm (regenerate_master_menu),
	tp/Texinfo/Common.pm (replace_element_in_contents),
	tp/Texinfo/XS/main/tree.ctp/Texinfo/XS/main/tree.c
	(remove_element_from_list, replace_element_in_contents),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(regenerate_master_menu): when removing an existing @detailmenu,
	remove it also from the global commands information and remove the
	associated menu entry nodes from internal references, add the new
	master menu to global commands information.

	* tp/Texinfo/Common.pm (import)
	(relate_index_entries_to_table_items_in_tree)
	(move_index_entries_after_items_in_tree, protect_colon_in_tree)
	(protect_comma_in_tree, protect_node_after_label_in_tree),
	tp/Texinfo/Structuring.pm (import, associate_internal_references)
	(sectioning_structure, nodes_tree, set_menus_node_directions)
	(complete_node_tree_with_menus, check_nodes_are_referenced)
	(number_floats), tp/Texinfo/Transformations.pm (import)
	(fill_gaps_in_sectioning, reference_to_arg_in_tree)
	(complete_tree_nodes_menus, complete_tree_nodes_missing_menu)
	(regenerate_master_menu, insert_nodes_for_sectioning_commands)
	(protect_hashchar_at_line_beginning)
	(protect_first_parenthesis_in_targets),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs,
	tp/t/test_utils.pl, tp/texi2any.pl: override
	directly the perl functions with XS, remove associated _XS_*
	functions. Update conditions of XS use to correspond to the cases of
	functions overriding.

	* tp/Texinfo/Structuring.pm (import, rebuild_tree),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(rebuild_tree): add to be able to rebuild a tree after modification by
	XS code.

	* tp/t/automatic_nodes.t, : skip tests that test perl but not XS
	when XS is used.

	* tp/t/automatic_menus.t, tp/t/automatic_nodes.t,
	tp/t/do_master_menu.t, tp/t/index_before_item.t,
	tp/t/protect_character_in_texinfo.t, tp/t/reference_to_text_in_tree.t,
	tp/t/test_fill_gaps_in_sectioning.t, tp/t/test_protect_contents.t,
	tp/t/test_protect_hashchar_at_line_beginning.t: rebuild tree or
	document to pass tests when there is a parsing and
	transformations/structuring in XS, but perl is used for conversion of
	the tree back to texinfo code.

2023-10-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/builtin_commands.c (element_builtin_cmd)
	(element_builtin_data_cmd): do not replace CM_item by CM_item_LINE if
	in a table term in element_builtin_cmd, do it in the new function
	element_builtin_data_cmd.  Update callers.

	* tp/Texinfo/Convert/HTML.pm (import),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_converter_initialize_sv),
	tp/Texinfo/XS/main/get_perl_info.c (html_converter_initialize_sv),
	tp/Texinfo/XS/convert/convert_html.c (html_converter_initialize):
	rename html_converter_initialize as html_converter_initialize_sv.
	Add html_converter_initialize for converter initialization that can be
	done in C only.

	* tp/Texinfo/XS/convert/convert_html.c (enum argument_formatting_type)
	(ARG_FORMATTED, ARGS_FORMATTED, MAX_COMMAND_ARGS_NR)
	(COMMAND_ID_ARGS_SPECIFICATION, COMMAND_ID_ARGS_SPECIFICATION)
	(default_commands_args, COMMAND_ARGS_SPECIFICATION)
	(command_args_flags, html_converter_initialize)
	(convert_to_html_internal): add a structure for default_commands_args,
	using flags to determine how the different arguments should be
	formatted.  Copy to an array of commands_id, command_args_flags in
	html_converter_initialize.  Use the structure in
	convert_to_html_internal for preliminary code that fills the
	ARGS_FORMATTED structure.

	* tp/Texinfo/Convert/HTML.pm (import, _XS_html_convert_convert)
	(convert), tp/Texinfo/XS/convert/ConvertXS.xs (html_convert_convert),
	tp/Texinfo/XS/convert/convert_html.c (convert_output_unit)
	(convert_convert_output_unit_internal, html_convert_convert): add
	preliminary XS interface for conversion in convert().

	* tp/Texinfo/Convert/HTML.pm (convert_output_unit): rename $element as
	$output_unit.

	* tp/Texinfo/XS/convert/convert_html.c (convert_to_html_internal):
	diverse fixes and improvements.

2023-10-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert): make code clearer and more
	efficient, avoid modifying @args_specification, rename $i as
	$content_idx.

	* tp/Texinfo/XS/main/builtin_commands.c (element_command_name)
	(element_builtin_cmd), tp/Texinfo/XS/main/command_data.awk: add
	to generated command_ids.h a define for BUILTIN_CMD_NUMBER, that
	replaces the builtin_cmd_number variable.

	* tp/Texinfo/XS/main/utils.c (item_line_parent),
	tp/Texinfo/XS/parsetexi/multitable.c: move item_line_parent from
	parsetexi/multitable.c to main/utils.c.

	* tp/Texinfo/Convert/Converter.pm (encode_converter_document),
	tp/Texinfo/Convert/HTML.pm (converter_initialize),
	tp/Texinfo/XS/main/get_perl_info.c
	(register_formatting_reference_with_default)
	(html_converter_initialize), tp/Texinfo/XS/main/utils.h (enum
	formatting_reference_status, FORMATTING_REFERENCE, CONVERTER):
	pass commands_open, commands_conversion, types_open and
	types_conversion to converter.  Add a status for FORMATTING_REFERENCE
	to simplify the use of FORMATTING_REFERENCE.

	* tp/Texinfo/XS/convert/convert_html.c (convert_to_html_internal):
	preliminary implementation.

2023-10-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (output): set BODYTEXT early where
	the other configuration variables are set.

	* tp/Texinfo/XS/main/build_perl_info.c (newSVpv_utf8),
	tp/Texinfo/XS/main/call_perl_function.c
	(call_nodenamenormalization_unicode_to_transliterate): make
	newSVpv_utf8 a global function and use it in
	call_nodenamenormalization_unicode_to_transliterate.

	* tp/Texinfo/Convert/Converter.pm (encode_converter_document),
	tp/Texinfo/Convert/HTML.pm (converter_initialize),
	tp/Texinfo/XS/main/get_perl_info.c (html_converter_initialize),
	tp/Texinfo/XS/main/utils.c (html_formatting_reference_names)
	(html_css_string_formatting_reference_names),
	tp/Texinfo/XS/main/utils.h (HTML_FORMATTING_REFERENCES_LIST)
	(FORMATTING_REFERENCE, CONVERTER):
	pass formatting_function and default formatting references to
	converter initialization.

	* tp/Texinfo/Convert/HTML.pm (convert): setup simpletitle_tree
	and call _reset_info to be able to really format the title.

	* tp/Texinfo/Convert/HTML.pm (import, _XS_html_convert_init)
	(convert), tp/Texinfo/XS/convert/ConvertXS.xs (html_convert_init),
	tp/Texinfo/XS/convert/convert_html.c (html_convert_init),
	tp/Texinfo/XS/main/call_perl_function.c
	(call_formatting_function_format_title_titlepage):
	implement convert() init phase in C with an XS interface.  Consist in
	in setting the title_titlepage, by calling the corresponding perl
	formatting reference.

	* tp/t/converters_tests.t (commands_in_settitle_with_title),
	tp/Makefile.tres: test a title in convert.

2023-10-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (import)
	(_XS_prepare_output_units_global_targets)
	(_prepare_output_units_global_targets, convert),
	tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_output_units_global_targets): rename
	prepare_output_units_global_targets as
	html_prepare_output_units_global_targets. Add an XS interface for
	html_prepare_output_units_global_targets for convert() in perl.

	* tp/Texinfo/Convert/HTML.pm (import, _XS_translate_names)
	(_translate_names, convert), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_translate_names), tp/Texinfo/XS/convert/convert_html.c
	(html_translate_names), tp/Texinfo/XS/convert/convert_html.c
	(html_prepare_conversion_units_targets): rename translate_names as
	html_translate_names, add a specific XS interface and remove from
	html_prepare_conversion_units_targets.

	* tp/Texinfo/Convert/HTML.pm (_sort_index_entries): reindent, comment
	out unused code.

2023-10-22  Patrice Dumas  <pertusus@free.fr>

	* info/Makefile.am: add AUTOMAKE_OPTIONS no-dist-built-sources to
	attempt to have funs.h not distributed even if in BUILT_SOURCES.
	Does not seem to work?

2023-10-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (dist_modules_DATA, modules_DATA)
	(Texinfo/Commands.pm, Texinfo/Options.pm)
	(DISTCLEANFILES, MAINTAINERCLEANFILES), tp/Texinfo/XS/Makefile.am
	(../Commands.pm, ../Options.pm): build Options.pm and Commands.pm
	systematically in srcdir, as they are prerequisites for files in
	scrdir in tp/Texinfo/XS for maintain/setup_converters_code_tables.pl.
	For the same reason, distribute Commands.pm and Options.pm and put
	them in MAINTAINERCLEANFILES, not DISTCLEANFILES.

	* tp/Texinfo/XS/Makefile.am (cmd_normalization.c): add other files
	built with the rule as targets.

	* tp/Texinfo/XS/Makefile.am: remove $srcdir from prerequisites, they
	should be found on VPATH.

2023-10-22  Patrice Dumas  <pertusus@free.fr>

	* man/Makefile.am (generated_mans, MAINTAINERCLEANFILES): distinguish
	generated man pages in generated_mans variable and
	MAINTAINERCLEANFILES, manually written man pages should not be
	cleaned.

2023-10-22  Patrice Dumas  <pertusus@free.fr>

	update po files

2023-10-22  Patrice Dumas  <pertusus@free.fr>

	* po_document/POTFILES.in: replace tp/Texinfo/Translations.pm by
	tp/Texinfo/TranslationsNonXS.pm.

2023-10-22  Patrice Dumas  <pertusus@free.fr>

	Move DebugTree.pm to the main Texinfo modules directory

	* tp/Texinfo/DebugTree.pm, tp/texi2any.pl (%formats_table),
	tp/Makefile.am b/tp/Makefile.am (dist_modules_DATA): move
	DebugTexinfo/DebugTree.pm to Texinfo/.

2023-10-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres: update.

2023-10-22  Patrice Dumas  <pertusus@free.fr>

	* tp/DebugTexinfo/DebugTree.pm (_print_tree): remove self argument,
	unused.

2023-10-22  Patrice Dumas  <pertusus@free.fr>

	* tp/DebugTexinfo/DebugTree.pm (output): never generate output units,
	only deal with the tree.
	Reindent.

2023-10-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Text.pm (convert_to_text): define $options if
	they do not already exist.

2023-10-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_misc_line)
	(_parse_line_command_args), tp/Texinfo/XS/parsetexi/end_line.c
	(parse_line_command_args, end_line_misc_line): remove
	{'extra'}->{'missing_argument'} from tree.

2023-10-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (output), tp/Texinfo/Convert/LaTeX.pm
	(_prepare_conversion, _convert), tp/Texinfo/Convert/Plaintext.pm
	(_convert): check existence of contents instead of relying on
	{'extra'}->{'missing_argument'}.

	* tp/Texinfo/Convert/LaTeX.pm (_associate_other_nodes_to_sections,
	_convert), tp/Texinfo/Convert/Plaintext.pm (_convert): avoid erroneous
	autovivification.

2023-10-22  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Command Tree Element Conversion Functions),
	tp/Texinfo/Convert/HTML.pm (_convert, _convert_email_command)
	(_convert_explained_command, _convert_uref_command)
	(_convert_image_command, _convert_titlefont_command)
	(_convert_sp_command, _convert_center_command),
	tp/init/documentation_examples.pm, tp/init/html32.pm,
	tp/t/init/translate_txiinternalvalue_macro.init: if an argument is
	empty, set @$args for this argument to be undef instead of ignoring
	completly the command for commands with
	{'extra'}->{'missing_argument'}.  Modify formatting functions for that
	change, but also to avoid modifying input @$args.

	* tp/Texinfo/Convert/HTML.pm (command_text, output): check existence
	of contents instead of relying on {'extra'}->{'missing_argument'}.
	Use directly element as tree.

2023-10-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_units_directions_files):
	encode to UTF-8 all the input strings, they are all character strings.

	* tp/Texinfo/XS/main/build_perl_info.c (build_html_files_source_info)
	(build_html_elements_in_file_count, build_filenames)
	(build_file_counters, build_out_filepaths): set all the output strings
	as character strings, as is the case for all the strings in the HTML
	converter.

	* tp/Texinfo/XS/convert/convert_html.c (prepare_special_units):
	define variable before, minor change.

2023-10-21  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/ParagraphNonXS.pm (add_next, add_text):
	Remove handling of backspace control characters from add_next,
	doing it in add_text instead (as is done in the corresponding
	XS code).

2023-10-21  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Customizing Output File Names),
	tp/Texinfo/Convert/HTML.pm (_get_top_unit, unit_is_top_output_unit)
	(_prepare_output_units_global_targets),
	tp/Texinfo/XS/convert/convert_html.c (get_top_unit)
	(prepare_output_units_global_targets): add get_top_unit, based on
	_prepare_output_units_global_targets code, to find the top unit, with
	output_units set as an optional argument, such that if not set, the
	first output unit is not considered as a top output unit.  Use
	_get_top_unit in unit_is_top_output_unit, without output_units
	argument.

	* tp/t/init/misc_file_collision.init: add variables to distinguish
	input and output, no functional change.

2023-10-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c,
	tp/Texinfo/XS/convert/convert_html.c: fix integer conf use, taking
	into account that -1 means undefined.

2023-10-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (find_output_unit_file)
	(add_output_units_file, register_normalize_case_filename),
	tp/Texinfo/XS/main/utils.h (FILE_NAME_PATH_COUNTER): add
	normalized_filename field in FILE_NAME_PATH_COUNTER to distinguish
	case independent file name and case dependent file name with
	CASE_INSENSITIVE_FILENAMES.

	* tp/Texinfo/Convert/HTML.pm (_prepare_units_directions_files),
	tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_units_directions_files),
	tp/Texinfo/XS/main/build_perl_info. (build_filenames):
	pass filenames state too from XS to perl.

2023-10-21  Patrice Dumas  <pertusus@free.fr>

	* tp/t/html_tests.t (sectioning_check_menu_structure): rename
	sectioning_frames as sectioning_check_menu_structure.

2023-10-21  Patrice Dumas  <pertusus@free.fr>

	Remove HTML frames output, FRAMES and FRAMESET_DOCTYPE customization options

	* NEWS, doc/texinfo.texi (HTML Customization Variables)
	(@command{texi2html}), tp/Texinfo/Convert/HTML.pm (%defaults),
	(_prepare_units_directions_files, output),
	tp/Texinfo/options_data.txt, tp/init/html32.pm, tp/t/html_tests.t
	(sectioning_frames): remove FRAMES and FRAMESET_DOCTYPE customization
	options, and frames output related code, mainly
	_prepare_frames_filenames and _default_format_frame_files.

2023-10-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.h (FILE_SOURCE_INFO,
	FILE_SOURCE_INFO_LIST), tp/Texinfo/XS/convert/convert_html.h: move to
	utils.h from convert_html.h.

	* tp/Texinfo/Convert/HTML.pm (_prepare_units_directions_files),
	tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_units_directions_files),
	tp/Texinfo/XS/convert/convert_html.c
	(prepare_output_units_global_targets),
	tp/Texinfo/XS/main/build_perl_info.c (output_unit_to_perl_hash)
	(fill_output_units, build_output_units_list)
	(rebuild_output_units_list, build_html_files_source_info)
	(build_html_global_units_directions, build_file_counters)
	(build_out_filepaths, build_html_elements_in_file_count),
	tp/Texinfo/XS/main/utils.c (html_global_unit_direction_names),
	tp/Texinfo/XS/main/utils.h (HTML_GLOBAL_DIRECTIONS_LIST)
	(SPECIAL_UNIT_DIRECTION, CONVERTER): rebuild output units lists and
	get HTML perl converter state information from
	_XS_prepare_units_directions_files/html_prepare_units_directions_files
	for global_units_directions, file_counters, elements_in_file_count and
	out_filepaths.  Set self->special_units_direction_name to pass special
	units directions more easily from XS.

2023-10-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_special_units_directions):
	return if $special_units is not defined.

	* tp/Texinfo/Structuring.pm (units_file_directions): remove unused
	variable and set my in the right block.

	* tp/Texinfo/XS/main/tree_types.h (RUD_FILE_DIRECTIONS_TYPES)
	(enum relative_unit_direction_type): rename enum
	relative_unit_direction as enum relative_unit_direction_type.
	Add RUD_FILE_DIRECTIONS_TYPES to complete
	relative_unit_direction_type.

	* tp/Texinfo/XS/main/output_unit.c (relative_unit_direction_name)
	(print_output_unit_directions): setup direction names and use them in
	print_output_unit_directions.

	* tp/Texinfo/XS/convert/convert_html.c
	(prepare_special_units_directions)
	(html_prepare_units_directions_files),
	tp/Texinfo/XS/main/output_unit.c (units_file_directions),
	tp/Texinfo/XS/main/utils.h (FILE_NAME_PATH_COUNTER): finish
	implementation of html_prepare_units_directions_files, with
	prepare_special_units_directions, units_file_directions and
	setting of elements_in_file_count.

2023-10-21  Gavin Smith <gavinsmith0123@gmail.com>

	Handle blocks of word characters in XS paragraph formatter

	* tp/Texinfo/XS/xspara.c (xspara__add_next): Allow for 'word'
	argument not to be null-terminated.
	(xspara__add_text): Call xspara__add_next with block of word
	characters, rather than one at a time.  This has a minor performance
	benefit and matches the Perl code better.

2023-10-21  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/ParagraphNonXS.pm (add_next, add_text):
	Add FIXME comment saying to make the code more like the XS code
	in handling of \x08 control characters.

2023-10-21  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert): Move a block
	of code to make it clearer that the result of _protect_sentence_ends
	is only passed to add_text, not add_next.

2023-10-21  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (xspara__add_next): Eliminate code
	handling control character markers to allow an end of sentence.
	It only handled markers at the end of the string, not throughout,
	and also necessitated modifying the string.  These markers are
	added in Plaintext.pm by _protect_sentence_ends and the result
	should only be passed to add_text (which handles them), not
	to add_next.

2023-10-21  Patrice Dumas  <pertusus@free.fr>

	in tp/Texinfo/XS gnulib-tool --add-import unicase/u8-tolower

2023-10-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/output_unit.c (units_directions): verify that
	directions lists exit before using them.  Initialize section_childs.

2023-10-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (output_unit_texi)
	(print_output_unit_directions), tp/Texinfo/XS/main/output_unit.c
	(output_unit_texi, print_output_unit_directions): rename
	print_element_directions as print_output_unit_directions and
	unit_or_external_element_texi as output_unit_texi. Update callers.

	* tp/Texinfo/Convert/HTML.pm (from_element_direction),
	tp/Texinfo/Convert/Plaintext.pm (count_context_bug_message)
	(convert_output_unit), tp/Texinfo/Structuring.pm (output_unit_texi)
	(print_output_unit_directions), tp/Texinfo/XS/main/output_unit.c
	(output_unit_texi, print_output_unit_directions): rename variables
	names with element in their name replacing element by output_unit or
	unit when they correspond to output units.

2023-10-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_html_set_pages_files): put
	%filenames_paths with %files_source_info as 'file_info_path'.
	Change order of code and conditions for a more logical code
	and to avoid creating unused hashes, more like C code.

2023-10-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(reset_unset_no_arg_commands_formatting_context): free reset
	translated_converted and strdup set string.

	* tp/Texinfo/XS/convert/convert_html.c (prepare_special_units):
	free contents contents_option_ref in every cases.

	* tp/Texinfo/XS/structuring_transfo/structuring.c
	(sectioning_structure): free appendix_nr.

2023-10-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree.c (spare_element, reset_obstacks)
	(new_element, destroy_element): comment out code related to
	spare_element.  Instead simply free the destroyed element.
	Avoiding memory leak with spare_element requires calling
	reset_obstacks, which adds some complexity.

2023-10-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(prepare_index_entries_targets): destroy normalize_index_element
	element.

	* tp/Texinfo/XS/convert/converter.c (set_global_document_commands),
	tp/Texinfo/XS/main/utils.c (set_informative_command_value): strdup
	char * values set in option_ref.  Also in set_informative_command_value
	free before resetting.

2023-10-20  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (xspara_add_text):
	Keep track of both the type of current (block of) characters to
	proess and the type of the next (block of) characters.
	Still only operate on one character at a time for now.

2023-10-20  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (xspara_add_text): Rearrange code
	getting the type of character and how it should be processed.
	This is to prepare for handling blocks of characters at once,
	more like the structure of the corresponding Perl code.

2023-10-20  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/main/call_perl_function.c
	(call_file_id_setting_special_unit_target_file_name)
	(call_file_id_setting_label_target_name)
	(call_file_id_setting_node_file_name)
	(call_file_id_setting_sectioning_command_target_name)
	(call_file_id_setting_unit_file_name):
	Change G_LIST to G_ARRAY to build on older Perls.

2023-10-20  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (xspara_add_text) <delete END_SENTENCE>:
	Do not set state.last_letter, as it also set by xspara__add_next
	which was just called and it is confusing to have it set in two
	places; and the corresponding code in
	Texinfo::Convert::ParagraphNonXS::add_text doesn't set
	$paragraph->{'last_letter'}.

2023-10-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(reset_unset_no_arg_commands_formatting_context): free
	no_arg_command_context->text before resetting.

	* tp/Texinfo/XS/convert/convert_html.c (translate_names)
	(prepare_index_entries_targets): free lists and normalized_index.

	* tp/Texinfo/XS/convert/converter.c (set_global_document_commands):
	free option_ref char before resetting.

2023-10-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (Texinfo/Commands.pm, Texinfo/Options.pm),
	tp/Texinfo/XS/Makefile.am (Texinfo/Commands.pm, Texinfo/Options.pm),
	tp/maintain/regenerate_commands_perl_info.pl,
	tp/maintain/regenerate_perl_options_info.pl: duplicate rules
	generating Texinfo/Commands.pm and Texinfo/Options.pm to
	tp/Texinfo/XS/Makefile.am as these modules are needed by
	setup_converters_code_tables.pl.  Pass generated file name as argument
	to regenerate_commands_perl_info.pl and
	regenerate_perl_options_info.pl.

2023-10-19  Patrice Dumas  <pertusus@free.fr>

	* doc/refcard/Makefile.am (txirefcard-a4.pdf): use txirefcard-a4 and
	not txirefcard for all the commands call for parallel make.

2023-10-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.h,
	tp/Texinfo/XS/convert/indices_in_conversion.h,
	tp/Texinfo/XS/main/utils.h (html_conversion_context_type_names)
	(KEY_ALPHA, SORTABLE_ENTRY, INDEX_SORTABLE_ENTRIES):  move definitions
	to utils.h.

	* tp/Texinfo/XS/convert/ConvertXS.xs,
	tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/main/get_perl_info.c,
	tp/Texinfo/XS/main/get_perl_info.h,
	tp/Texinfo/XS/main/tree_perl_api.h: fix headers inclusion.

	* tp/Texinfo/XS/Makefile.am (Translations_la_CPPFLAGS)
	(StructuringTransfo_la_CPPFLAGS, ConvertXS_la_CPPFLAGS): remove
	useless -I options.

2023-10-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (units_directions): remove redundant
	condition.

	* tp/Texinfo/XS/main/manipulate_tree.c
	(normalized_menu_entry_internal_node)
	(normalized_entry_associated_internal_node, first_menu_node),
	tp/Texinfo/XS/structuring_transfo/structuring.c: move code from
	structuring.c to manipulate_tree.cmanipulate_tree.c.

	* tp/Texinfo/XS/main/output_unit.c (output_unit_node)
	(label_target_unit_element, print_element_directions)
	(node_unit_directions, section_unit_directions, units_directions):
	finish implementation of units_directions.

2023-10-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_conversion_units): if XS is
	used, return the XS code result, to have data usable for next XS
	code.

	* tp/Texinfo/XS/convert/convert_html.c
	(prepare_index_entries_targets), tp/Texinfo/XS/convert/converter.c
	(normalized_sectioning_command_filename, node_information_filename),
	tp/Texinfo/XS/main/call_perl_function.c
	(call_nodenamenormalization_unicode_to_transliterate),
	tp/Texinfo/XS/main/node_name_normalization.c
	(unicode_to_transliterate, normalize_transliterate_texinfo)
	(normalize_transliterate_texinfo_contents): add
	call_nodenamenormalization_unicode_to_transliterate to call
	Texinfo::Convert::NodeNameNormalization::_unicode_to_transliterate to
	do the transliteration in a reproductible way.  Add an argument to
	unicode_to_transliterate to specify that the perl external
	transliteration is wanted.  Set this argument if TEST is set.

	* tp/Texinfo/XS/main/build_perl_info.c (build_html_element_targets):
	use newSVpv_utf8 for all the strings.

2023-10-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Unicode.pm (%transliterate_map): adjust, using
	some transliteration from iconv, and also some from unidecode, in
	particular when iconv and unidecode give the same output.

2023-10-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm, tp/Texinfo/Convert/DocBook.pm,
	tp/Texinfo/Convert/HTML.pm (output), tp/Texinfo/Convert/IXINSXML.pm,
	tp/Texinfo/Convert/TexinfoSXML.pm, tp/Texinfo/Convert/TexinfoXML.pm,
	tp/t/languages.t: always use a string for SPLIT customization
	variable, so replace 0 by ''.

	* tp/Texinfo/Structuring.pm (import, clear_document_errors),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(clear_document_errors), tp/t/test_utils.pl (test), tp/texi2any.pl:
	add an XS interface to clear_document_errors in Texinfo/Structuring.pm
	and use it in test_utils.pl and texi2any.pl after passing document
	errors.

	* tp/Texinfo/Convert/HTML.pm (_new_sectioning_command_target): use
	sectioning command normalized_name as base for contents targets, not
	sectioning command target.

	* tp/Texinfo/Convert/HTML.pm (_prepare_conversion_units),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_conversion_units),
	build_html_element_targets(build_html_element_targets)
	(build_html_special_targets, build_html_seen_ids)
	(pass_converter_errors): build perl converter state information from XS
	corresponding to _prepare_conversion_units, 'targets', 'special_targets',
	'seen_ids' and pass errors.

	* tp/Texinfo/Convert/HTML.pm (convert)
	(_prepare_associated_special_units_targets, _register_special_unit),
	tp/Texinfo/XS/convert/convert_html.c (register_special_unit)
	(prepare_output_units_global_targets, prepare_units_directions_files):
	set special units directions in
	_prepare_associated_special_units_targets instead of
	_register_special_unit.

	* tp/Texinfo/Convert/HTML.pm
	(_prepare_associated_special_units_targets),
	tp/Texinfo/XS/convert/convert_html.c
	(prepare_associated_special_units_targets): handle better undefined
	target.

	* tp/Texinfo/Convert/HTML.pm (_prepare_index_entries_targets),
	tp/Texinfo/XS/convert/convert_html.c (prepare_index_entries_targets):
	do not use trim_spaces_comment_from_content as it is useless.

	* tp/Texinfo/XS/convert/convert_html.c (prepare_footnotes_targets):
	fix footnotes targets numbering.

	* tp/Texinfo/Convert/HTML.pm (_initialize_output_state)
	(_prepare_footnotes_targets): initialize 'pending_footnotes' in
	_initialize_output_state, not in _prepare_footnotes_targets.

	* tp/Texinfo/XS/convert/convert_html.c (prepare_special_units):
	separate about and footnotes elements if there are more than one
	output units.

	* tp/Texinfo/XS/convert/convert_html.c (prepare_special_units): use
	strings from self->special_unit_varieties in special_output_unit.

	* tp/Texinfo/XS/convert/convert_html.c (normalized_label_id_file)
	(set_root_commands_targets_node_files),
	tp/Texinfo/XS/main/call_perl_function.c
	(call_file_id_setting_label_target_name)
	(call_file_id_setting_node_file_name): distinguish undefined return
	after calling file_id_setting functions or without calling the
	functions.

	* tp/Texinfo/XS/convert/convert_html.c
	(set_root_commands_targets_node_files): fix node filename extension.

	* tp/Texinfo/XS/convert/convert_html.c (contents_elements_options):
	add summarycontents.

	* tp/Texinfo/XS/main/command_data.awk: add summarycontents in
	global_multi_commands.

	* tp/Texinfo/XS/convert/convert_html.c (compare_index_name)
	(prepare_index_entries_targets): sort indices names before setting
	targets to obtain the same output as in perl.

	* tp/Texinfo/XS/convert/convert_html.c (add_to_unit_file_name_paths)
	(html_set_pages_files): fix unit_file_name_paths to be a list of
	pointers.

	* tp/Texinfo/XS/main/build_perl_info.c (convert_error),
	tp/Texinfo/XS/main/errors.c (reallocate_error_messages)
	(message_list_document_error_internal)
	(message_list_document_error_internal)
	(message_list_document_error_internal), tp/Texinfo/XS/main/utils.h
	(enum error_type): initialize error_message.  Add
	specific enum error_type for document_error and document_warning.

	* tp/Texinfo/XS/main/node_name_normalization.c
	(convert_to_normalized_internal): ignore seealso.

	* tp/Texinfo/XS/main/node_name_normalization.c
	(unicode_to_transliterate): transliterate to obtain ascii.

	* tp/Texinfo/XS/main/build_perl_info.c (output_unit_to_perl_hash):
	setup directions.  Add associated_unit to special_unit_element.  Add
	associated_document_unit.

	* tp/Texinfo/Convert/HTML.pm (import)
	(_XS_prepare_units_directions_files, _prepare_units_directions_files),
	tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_units_directions_files),
	tp/Texinfo/XS/convert/convert_html.c (prepare_units_directions_files),
	tp/Texinfo/XS/main/output_unit.c (units_directions),
	tp/Texinfo/XS/main/tree_types.h (RUD_DIRECTIONS_TYPES_LIST)
	(enum relative_unit_direction, OUTPUT_UNIT):
	preliminary incomplete implementation of
	_prepare_units_directions_files XS interface, begin an implementation
	of units_directions.

	* tp/Texinfo/XS/main/utils.h (enum global_unit_direction): rename
	enum units_directions as enum global_unit_direction.

2023-10-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_conversion_units)
	(_prepare_units_directions_files, convert),
	tp/Texinfo/XS/convert/convert_html.c (html_prepare_conversion_units)
	(prepare_units_directions_files): do not call
	_prepare_output_units_global_targets in _prepare_conversion_units,
	call it in _prepare_units_directions_files or directly in convert.

	* tp/Texinfo/Convert/HTML.pm (_prepare_conversion_units, convert)
	(output): call _translate_names out of _prepare_conversion_units,
	directly in convert or output.

2023-10-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_html_set_pages_files)
	(_prepare_conversion_units, _prepare_units_directions_files)
	(_prepare_associated_special_units_targets, convert):
	separate setting associated_special_units targets, put in
	_prepare_associated_special_units_targets and called in
	_prepare_conversion_units, from setting associated_special_units
	files, with code put directly at the end of _html_set_pages_files.

	* tp/Texinfo/XS/convert/convert_html.c
	(prepare_associated_special_units_targets, html_set_pages_files),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_conversion_units)
	(prepare_units_directions_files): implement
	prepare_associated_special_units_targets and code in
	html_set_pages_files that sets associated_special_units files.

2023-10-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/api.c (reset_parser_except_conf):
	remove dTHX call as this file does not include perl headers.

2023-10-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (top_node_filename): rewrite code
	for simpler code, no functional change.

	* tp/Texinfo/Convert/HTML.pm (_html_set_pages_files): avoid using
	hashes if not needed.  Move code associating special elements that
	have no page with the main page in the main special elements loop.

	* tp/Texinfo/Convert/HTML.pm (_prepare_units_directions_files): group
	code setting file names and directions in
	_prepare_units_directions_files new function for future easier
	overriding by XS code.

	* tp/Texinfo/Convert/HTML.pm (_prepare_units_directions_files)
	(output): put unit_command as file_info_element for special output
	unit, not output unit.

	* tp/Texinfo/XS/main/output_unit.c (add_to_output_unit_list),
	tp/Texinfo/XS/main/tree_types.h (OUTPUT_UNIT): add index to
	output_unit structure.

	* tp/Texinfo/XS/convert/convert_html.c (set_file_source_info)
	(add_to_files_source_info, find_file_source_info)
	(add_to_unit_file_name_paths, html_set_pages_files)
	(prepare_units_directions_files), tp/Texinfo/XS/convert/convert_html.h
	(FILE_SOURCE_INFO, FILE_SOURCE_INFO_LIST),
	tp/Texinfo/XS/convert/converter.c (top_node_filename)
	(initialize_output_units_files, add_output_units_file)
	(register_normalize_case_filename, set_output_unit_file)
	(set_file_path), tp/Texinfo/XS/main/call_perl_function.c
	(call_file_id_setting_unit_file_name), tp/Texinfo/XS/main/utils.h
	(FILE_NAME_PATH, FILE_NAME_PATH_COUNTER, FILE_NAME_PATH_COUNTER_LIST)
	(CONVERTER): implement html_set_pages_files.

	* tp/Makefile.tres, tp/t/html_tests.t
	(top_file_name_and_node_name_collision): new test.

2023-10-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(reset_unset_no_arg_commands_formatting_context)
	(complete_no_arg_commands_formatting, translate_names):
	complete translate_names by adding complete_no_arg_commands_formatting
	and reset_unset_no_arg_commands_formatting_context.
	reset_unset_no_arg_commands_formatting_context is incomplete as
	conversion is sill not implemented.

2023-10-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/translations.c (gdt_string): pass string first.

	* tp/Texinfo/Convert/Converter.pm (encode_converter_document),
	tp/Texinfo/XS/convert/convert_html.c (translate_names),
	tp/Texinfo/XS/main/convert_utils.c (translated_command_tree),
	tp/Texinfo/XS/main/get_perl_info.c (compare_ints)
	(set_translated_commands, html_converter_initialize),
	tp/Texinfo/XS/main/utils.h (HCC_CONTEXT_TYPES_LIST, CONVERTER)
	(HTML_COMMAND_CONVERSION, COMMAND_ID_LIST, TRANSLATED_COMMAND):
	pass style_commands_formatting, translated_commands and
	no_arg_commands_formatting to XS.
	Handle partly no_arg_formatted in translate_names.

2023-10-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_initialize_output_state):
	warn, and do not proceed if converter is not found.

	* tp/Texinfo/XS/main/builtin_commands.c (builtin_cmd_number)
	(element_command_name): add builtin_cmd_number, the number of builtin
	commands as an extern.

	* tp/Texinfo/Convert/HTML.pm
	(_reset_unset_no_arg_commands_formatting_context): reindent.

2023-10-15  Patrice Dumas  <pertusus@free.fr>

	Indent struct and enum more consistently

2023-10-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (@all_style_commands): add
	%quoted_style_commands commands.

2023-10-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (html_convert_css_string_for_list_mark)
	(_translate_names, _convert_no_arg_command, converter_initialize)
	(_css_string_convert_no_arg_command)
	(_reset_unset_no_arg_commands_formatting_context): exchange command
	and context level in no_arg_commands_formatting.

	* tp/Texinfo/Convert/HTML.pm (%style_commands_element)
	(%style_commands_formatting, _convert_style_command)
	(converter_initialize): exchange command and context level in
	style_commands_formatting.  Remove context from
	%style_commands_element.

	* tp/Texinfo/Convert/HTML.pm (_convert_style_command): remove
	commented out code that is not in line with the API.  Rewrite the
	function for clearer code.

2023-10-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (TRANSLATED_SUI_ASSOCIATION)
	(translated_special_unit_info, special_unit_info_tree)
	tp/Texinfo/XS/main/get_perl_info.c (special_unit_info_type_names)
	(html_converter_initialize, html_converter_initialize),
	tp/Texinfo/XS/main/translations.c (pgdt_tree),
	tp/Texinfo/XS/main/utils.h (CONVERTER, SUI_TYPES_LIST)
	(enum special_unit_info_tree): distinguish data structures for
	special_unit_info_tree, add translated_special_unit_info to match
	the tree special unit info with string special unit info and prepare a
	specific function special_unit_info_tree to get the translated tree.

	* tp/Texinfo/XS/convert/convert_html.c (translate_names)
	(find_element_target, html_prepare_conversion_units_targets),
	tp/Texinfo/XS/main/utils.h (TDS_TRANSLATED_TYPES_LIST)
	(TDS_NON_TRANSLATED_TYPES_LIST, enum direction_string, HTML_TARGET)
	(CONVERTER):
	partial implementation of translate_names.

2023-10-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_footnotes_targets): rename
	_prepare_footnotes as _prepare_footnotes_targets.

	* tp/Texinfo/XS/convert/convert_html.c (html_initialize_output_state)
	(add_element_target_to_list, add_special_target)
	(prepare_footnotes_targets), tp/Texinfo/XS/main/utils.h (enum
	special_target_type, CONVERTER): implement prepare_footnotes_targets
	and special_targets.

2023-10-14  Patrice Dumas  <pertusus@free.fr>

	in tp/Texinfo/XS gnulib-tool --add-import uniconv/u32-strconv-from-enc unistr/u32-next uninorm/nfkd unictype/category-Mn

2023-10-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/errors.c, tp/Texinfo/XS/main/utils.c (xasprintf):
	move xasprintf to utils.c.

	* tp/Texinfo/Convert/HTML.pm (_prepare_index_entries_targets)
	(_prepare_conversion_units, _sort_index_entries, convert, output),
	tp/Texinfo/XS/convert/convert_html.c (sort_index_entries)
	(prepare_index_entries_targets): split _prepare_index_entries in two,
	with _sort_index_entries for the sorting that is now done before
	_prepare_conversion_units, and _prepare_index_entries_targets for the
	targets, which is done in _prepare_conversion_units.  This allows to
	have sorting done independently to allow to pass sorted or sortable
	indices informations to C more independently.

	* tp/Texinfo/Convert/HTML.pm (_sort_key, _sort_index_entries)
	(_collator_sort_key, setup_sortable_index_entries): preset an
	indicator to determine if the string is alphanumeric or not in
	$sortable_entry 'keys'.  Replace _sort_string by _sort_key and
	add _collator_sort_key to sort taking into account this information on
	keys being alphanumeric or not.

	* tp/Texinfo/Convert/HTML.pm (setup_sortable_index_entries): add
	a $silent argument, to avoid error messages if called twice.

	* tp/Texinfo/Convert/HTML.pm (import)
	(_XS_get_index_entries_sorted_by_letter, _sort_index_entries),
	tp/Texinfo/XS/convert/ConvertXS.xs
	(get_index_entries_sorted_by_letter),
	tp/Texinfo/XS/main/get_perl_info.c
	(get_sv_index_entries_sorted_by_letter), tp/Texinfo/XS/main/utils.h
	(MERGED_INDEX, LETTER_INDEX_ENTRIES, INDEX_SORTED_BY_LETTER)
	(CONVERTER): get already sorted index entries from perl to C.

	* tp/Texinfo/Convert/HTML.pm (import)
	(_XS_sort_sortable_index_entries_by_letter, _sort_index_entries),
	tp/Texinfo/XS/Makefile.am (ConvertXS_la_CPPFLAGS)
	(ConvertXS_la_LDFLAGS), tp/Texinfo/XS/convert/ConvertXS.xs
	(sort_sortable_index_entries_by_letter),
	tp/Texinfo/XS/convert/indices_in_conversion.c
	(sort_indices_by_letter),
	tp/Texinfo/XS/convert/indices_in_conversion.h (KEY_ALPHA)
	(SORTABLE_ENTRY, INDEX_SORTABLE_ENTRIES, LETTER_SORTABLE_ENTRIES,
	(LETTER_SORTABLE_ENTRIES_LIST), tp/Texinfo/XS/main/get_perl_info.c
	(get_sv_sortable_entries), tp/Texinfo/XS/main/unicode.c
	(normalize_NFKD): unfinished implementation in C of
	sorting based on setup_sortable_index_entries.  It is unfinished
	because it requires some sorting of letters in C, which is not ready.

2023-10-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (sort_indices_by_letter)
	(sort_indices_by_index, setup_sortable_index_entries): separate
	sort_indices in two, sort_indices_by_letter and sort_indices_by_index
	and add setup_sortable_index_entries for the common part that setup
	sortable index entries.  Update callers.

2023-10-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (prepare_index_entries),
	tp/Texinfo/XS/convert/converter.c (comma_index_subentries_tree)
	(free_comma_index_subentries_tree),
	tp/Texinfo/XS/convert/indices_in_conversion.c (index_content_element),
	tp/Texinfo/XS/main/utils.c (trim_spaces_comment_from_content):
	implement setting target for index entries.

2023-10-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (trim_spaces_comment_from_content): modify
	implementation to take as argument an element and return an element
	or undef, and do not modify the input.  Add comments explaining why
	this function currently does nothing.  Update callers.

	* tp/Texinfo/Common.pm (split_custom_heading_command_contents): use an
	element in input and output and avoid modifying arrays.  Update
	callers.

	* tp/Makefile.tres, tp/t/latex_tests.t (custom_headings_and_comments),
	tp/t/09indices.t (subentries_and_comments): add tests with comments in
	situations where trim_spaces_comment_from_content is called.

2023-10-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (normalized_to_id),
	tp/Texinfo/XS/main/utils.c (isascii_digit): add prefix
	only if starting with digit.

	* tp/Texinfo/XS/main/errors.c (message_list_document_error_internal):
	initialize error_line.

	* tp/Texinfo/XS/main/call_perl_function.c: add missing PUTBACK.

	* tp/Texinfo/XS/main/call_perl_function.c
	(call_file_id_setting_node_file_name): allow undef returned
	node_filename.

	* tp/Texinfo/XS/main/get_perl_info.c (html_converter_initialize):
	handle undef special_unit_info value.

	* tp/Texinfo/XS/main/utils.c (ultimate_index): move to main/utils.c.

	* tp/Texinfo/XS/Makefile.am (ConvertXS_la_SOURCES),
	convert/indices_in_conversion.c (merge_indices),
	tp/Texinfo/XS/convert/convert_html.c (prepare_index_entries)
	(html_prepare_conversion_units_targets): preliminary implementation of
	prepare_index_entries, with merge_indices done.

2023-10-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.h (enum error_type): use more specific
	enum names by prepending MSG_.  Update users.

2023-10-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_set_root_commands_targets_node_files):
	remove unused $output_units argument.  Remove unused $no_unidecode.
	Put $extension in if.

	* tp/Texinfo/XS/main/errors.c (reallocate_error_messages)
	(message_list_line_error_internal)
	(message_list_document_error_internal, message_list_document_error)
	(message_list_document_warn), tp/Texinfo/XS/main/get_perl_info.c
	(html_converter_initialize): add message_list_document_warn and
	message_list_document_error and add error messages in converter.

	* tp/Texinfo/XS/main/convert_utils.c, tp/Texinfo/XS/main/utils.c
	(output_conversions, input_conversions, decode_string, encode_string):
	move output_conversions, input_conversions, decode_string, encode_string
	to utils.c.

	* tp/Texinfo/XS/parsetexi/input.c (parser_input_conversions): rename
	input_conversions as parser_input_conversions.

	* tp/Texinfo/XS/convert/convert_html.c (normalized_to_id)
	(normalized_label_id_file, unique_target)
	(new_sectioning_command_target, set_root_commands_targets_node_files)
	(html_prepare_conversion_units_targets),
	tp/Texinfo/XS/convert/converter.c (id_to_filename)
	(normalized_sectioning_command_filename, node_information_filename),
	tp/Texinfo/XS/main/call_perl_function.c
	(call_file_id_setting_label_target_name)
	(call_file_id_setting_node_file_name)
	(call_file_id_setting_sectioning_command_target_name),
	tp/Texinfo/XS/main/node_name_normalization.c
	(unicode_to_transliterate, normalize_transliterate_texinfo)
	(normalize_transliterate_texinfo_contents): implement
	set_root_commands_targets_node_files.

2023-10-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_get_target)
	(_new_sectioning_command_target): reorganize code, remove return of
	_new_sectioning_command_target, no functional change.

2023-10-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (import, _XS_initialize_output_state)
	(_initialize_output_state), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_initialize_output_state), tp/Texinfo/XS/convert/convert_html.c
	(html_initialize_output_state): add output state initialization for
	html conversion code in C.

	* tp/Texinfo/XS/convert/convert_html.c (prepare_special_units): call
	all new_output_units_descriptor before calling retrieve_output_units
	to be sure that all realloc calls have been done and that the address
	of special units list won't change afterwards.  Call strdup for
	special_unit_variety and destroy do_special.

	* tp/Texinfo/XS/convert/converter.c (set_global_document_commands):
	free option_ref.

	* tp/Texinfo/XS/main/get_perl_info.c (set_output_converter_sv): rename
	get_output_converter_sv as set_output_converter_sv.  Free
	converter->init_conf if needed.

	* tp/Texinfo/XS/main/build_perl_info.c (output_unit_to_perl_hash):
	setup special_unit_element perl element.

	* tp/Texinfo/XS/main/get_perl_info.c (html_converter_initialize),
	tp/Texinfo/XS/main/utils.h (CONVERTER):
	after calling register_converter, retrieve the registered converter.
	Add a reference to perl converter in CONVERTER.

	* tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_conversion_units),
	tp/Texinfo/XS/Makefile.am (libtexinfoxs_la_SOURCES),
	tp/Texinfo/XS/convert/convert_html.c (add_element_target)
	(set_special_units_targets_files), tp/Texinfo/XS/main/utils.h
	(HTML_TARGET, HTML_TARGET_LIST, TARGET_FILENAME, CONVERTER),
	tp/Texinfo/XS/main/call_perl_function.c
	(call_file_id_setting_special_unit_target_file_name): split
	html_prepare_conversion_units in two, adding
	html_prepare_conversion_units_targets, such that perl output unit
	structures are set before possible call to perl customization function
	in set_special_units_targets_files in
	html_prepare_conversion_units_targets.  Finish implementation of
	set_special_units_targets_files, by adding
	call_file_id_setting_special_unit_target_file_name to call perl
	customization function.

2023-10-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c
	(set_special_units_targets_files): begin implementation of
	set_special_units_targets_files.

2023-10-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/convert_html.c (SPECIAL_UNIT_ORDER)
	(compare_special_units, prepare_special_units): prepare separate
	special units.

2023-10-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (encode_converter_document),
	tp/Texinfo/XS/main/get_perl_info.c (special_unit_info_type_names)
	(html_converter_initialize), tp/Texinfo/XS/main/utils.h
	(SUI_TYPES_LIST, VARIETY_DIRECTION_INDEX, CONVERTER): pass special
	units informations to XS, both textual information and also setup a
	mapping between special unit variety name and index in
	global_units_directions.

	* tp/Texinfo/XS/convert/convert_html.c (special_unit_info)
	(special_unit_variety_direction_index, register_special_unit): use
	special units information to setup global_units_directions when
	registering a special unit.

	* tp/Texinfo/XS/convert/convert_html.c (prepare_special_units):
	fix getting top, as it is a uniq command.

	* tp/Texinfo/XS/parsetexi/source_marks.c (source_marks_names):
	simplify.

2023-10-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_heading_command): do automatic
	node menu only if there is a node.

	* tp/Texinfo/Convert/HTML.pm (_contents_inline_element)
	(_set_special_units_targets_files)
	(_prepare_associated_special_units_targets): handle better special
	output unit target set to undefined in user init file.

2023-10-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (encode_converter_document)
	(encode_converter_for_output): rearrange code, no functional change.

2023-10-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (encode_converter_document)
	(encode_converter_for_output), tp/Texinfo/Convert/HTML.pm (import)
	(_XS_converter_initialize, converter_initialize)
	(_prepare_conversion_units), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_converter_initialize, html_prepare_conversion_units),
	tp/Texinfo/XS/convert/converter.c (converter_list, retrieve_converter)
	(register_converter), tp/Texinfo/XS/main/get_perl_info.c
	(html_converter_initialize, get_sv_converter)
	(get_output_converter_sv): distinguish converter initialization, with
	encode_converter_document, _XS_converter_initialize and
	html_converter_initialize.  In this step, register a converter with
	register_converter and set "converter_descriptor" in perl structure in
	html_converter_initialize.  In a second step, retrieve converter, add
	more information before starting the output.  In this step, use
	encode_converter_for_output called in _prepare_conversion_units,
	get_sv_converter, and get_output_converter_sv to retrieve and update
	the converter.  Remove get_converter_sv.

	* tp/Texinfo/XS/convert/convert_html.c
	(prepare_output_units_global_targets), tp/Texinfo/XS/main/utils.h
	(enum units_directions, CONVERTER), tp/Texinfo/XS/main/get_perl_info.c
	(html_converter_initialize): use global_units_directions
	in converter, initialize in html_converter_initialize and do not set a
	fixed number of directions.

	* tp/Texinfo/XS/main/utils.h (command_location_names)
	(enum command_location): rename commands_location as command_location.
	Update users.

	* tp/Texinfo/XS/convert/convert_html.c (CMD_VARIETY)
	(contents_command_special_unit_variety, register_special_unit)
	(prepare_special_units, contents_elements_options)
	(conf_for_special_units, html_prepare_conversion_units),
	tp/Texinfo/XS/convert/convert_html.h (enum special_unit_info_type),
	tp/Texinfo/XS/main/tree_types.h (OUTPUT_UNIT):
	continue implementation of html_prepare_conversion_units, with setting
	up contents associated output units.

2023-10-08  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Elements and Links for Directions),
	tp/Texinfo/Convert/HTML.pm (global_direction_unit), tp/init/chm.pm:
	rename global_direction as global_direction_unit and also use
	global_direction_unit for sepcial output units.  Remove
	special_direction_unit.  Use only 'global_units_directions' as
	associated state.  Update callers.

	* tp/Texinfo/Convert/Converter.pm (encode_converter_document): rename
	encode_converter as encode_converter_document.  Update caller.

	* tp/Texinfo/Convert/HTML.pm (_prepare_special_units_directions):
	rename _special_units_directions as _prepare_special_units_directions.

2023-10-07  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Special Units Information Customization),
	tp/Texinfo/Convert/HTML.pm (get_special_unit_info_varieties)
	(special_unit_info): use a different function to get the list of
	varieties, called get_special_unit_info_varieties, instead of
	special_unit_info.  Update callers.

2023-10-07  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/regenerate_C_options_info.pl: simplify and fix generated
	get_command_option code.

2023-10-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (get_cmd_global_command): rename
	get_global_command as get_cmd_global_command.

	* tp/Texinfo/XS/main/utils.c (set_global_document_command): check that
	unique command is set before calling set_informative_command_value.

2023-10-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/converter.c (set_global_document_commands):
	use const qualifier for location and cmd_list arguments.

2023-10-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_special_units): do not set
	do_special_associated, directly add to associated_special_units.

2023-10-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (set_global_document_commands):
	make $selected_commands a mandatory argument.

	* tp/Texinfo/Convert/Converter.pm (encode_converter),
	tp/Texinfo/XS/Makefile.am (ConvertXS_la_SOURCES),
	tp/Texinfo/XS/convert/ConvertXS.xs (html_prepare_conversion_units),
	tp/Texinfo/XS/convert/convert_html.c,
	tp/Texinfo/XS/main/get_perl_info.c (get_converter_sv),
	tp/Texinfo/XS/main/utils.c (commands_location_names)
	(get_global_command, informative_command_value)
	(set_informative_command_value, in_preamble, new_converter)
	(set_global_document_command), tp/Texinfo/XS/main/utils.h
	(enum global_option_command_type, COMMAND_OPTION_DEFAULT)
	(COMMAND_OPTION_REF, COMMAND_OPTION_VALUE, enum commands_location)
	(CONVERTER, enum global_directions),
	tp/maintain/regenerate_C_options_info.pl,
	tp/Texinfo/XS/convert/converter.c (new_option_value, command_init)
	(set_global_document_commands):
	make converter related code generic and move to main/utils.c.  Pass
	converter_init_conf/output_init_conf from perl.  Generate
	get_command_option code and command_option_default_table table.
	Implement set_global_document_commands.

2023-10-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_conversion_units)
	(output, convert): call _prepare_index_entries and _prepare_footnotes
	in _prepare_conversion_units.

	* tp/Texinfo/Convert/HTML.pm
	(_prepare_associated_special_units_targets): make sure that target is
	unique.

	* tp/Texinfo/Convert/HTML.pm (_prepare_output_units_global_targets):
	finish by finding Index direction.

	* tp/Texinfo/Structuring.pm (split_by_node, split_by_section)
	(split_pages): add no_XS argument to be able to signal that the
	function is called in the XS code as part of another code.

	* tp/Texinfo/XS/main/output_unit.c (new_output_unit)
	(add_to_output_unit_list, split_by_node, split_by_section, unsplit)
	(LEVEL_SPLIT_STRING, split_pages): move to output_unit.c out of
	structuring.c.

	* tp/Texinfo/XS/main/output_unit.c (unit_or_external_element_texi):
	add.

	* tp/Texinfo/Convert/Converter.pm (converter, encode_converter),
	tp/Texinfo/Convert/HTML.pm (import, _XS_prepare_conversion_units)
	(_prepare_conversion_units, output), tp/Texinfo/XS/Makefile.am
	(ConvertXS_la_SOURCES, *_CPPFLAGS), tp/Texinfo/XS/convert/ConvertXS.xs
	(html_prepare_conversion_units), tp/Texinfo/XS/convert/convert_html.c
	(new_html_converter, ROOT_AND_UNIT, html_get_tree_root_element),
	(prepare_output_units_global_targets, html_prepare_conversion_units),
	tp/Texinfo/XS/convert/convert_html.h (HTML_CONVERTER),
	tp/Texinfo/XS/main/element_types.txt,
	tp/Texinfo/XS/main/get_perl_info.c (get_html_converter_sv):
	preliminary implementation of _prepare_conversion_units in C, and XS
	interface.  add -I$(srcdir)/convert to more CPPFLAGS, as
	HTML_CONVERTER definition is used in get_perl_info.h.

	* tp/Texinfo/Convert/HTML.pm (_html_get_tree_root_element): rename
	$root_element variable as $output_unit).

2023-10-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (output): use directly tree element
	instead of recreating an element from contents when the argument
	element is suitable as tree, for fulltitle and simpletitle.

2023-10-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (build_document): remove
	no_clean_perl_refs argument.  Update callers.
	Remove clean_texinfo_tree, clean_additional_info,
	clean_source_mark_list that are not used anymore.

	* tp/t/test_utils.pl (test), tp/texi2any.pl: always rebuild document
	at the end of the structuring/transformations phase as we want to have
	a perl tree consistent with the C tree and with the hv references in C
	tree.

2023-10-05  Patrice Dumas  <pertusus@free.fr>

	The C tree which refers to hv owns a reference to the perl element

	* tp/Texinfo/XS/Makefile.am (libtexinfoxs_la_SOURCES),
	tp/Texinfo/XS/main/build_perl_info.c (unregister_perl_tree_element)
	(element_to_perl_hash), tp/Texinfo/XS/main/tree.c (destroy_element):
	do not transfer the hv ref to the perl av considering that the
	element->hv still own a reference. Add unregister_perl_tree_element,
	called in destroy_element to release the reference.

	* tp/Texinfo/XS/main/build_perl_info.c (store_additional_info)
	(store_source_mark_list, element_to_perl_hash, build_document): do not
	clear the elements hv.  The tree can now be rebuilt more than once.
	Clear the hv at the beginning of element_to_perl_hash if the hv
	already exists.  Remove error messages associated to already existing
	hv, as now this can happen when the tree is rebuilt more than once.

	* tp/Texinfo/XS/main/build_perl_info.c (build_output_units_list): do
	not transfer the hv ref to the perl av considering that
	output_unit->hv still own a reference.


2023-10-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (output), tp/Texinfo/Structuring.pm
	(split_pages): never do XS only for split_pages, and do not rebuild
	output_units from XS in HTML, it is too early for that.

2023-10-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_conversion_units)
	(_prepare_special_units, _set_special_units_targets_files)
	(_special_units_directions, output): separate code
	setting targets and files for special units to
	_set_special_units_targets_files, and setting directions to
	_special_units_directions.

2023-10-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_html_set_pages_files): move code
	associating special units without filename to main page to
	_html_set_pages_files.

	* tp/Texinfo/Convert/HTML.pm (output): move _prepare_frames_filenames
	call out of _prepare_conversion_units to output, as it should only be
	relevant if there are output files.

2023-10-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_conversion_units)
	(_register_special_unit, _prepare_special_units)
	(_prepare_associated_special_units_targets, convert, output): separate
	the code setting up a special output unit and the associated virtual
	element, and register the direction to _register_special_unit.  Handle
	special element associated to a document output units, in practice
	contents and shortcontents when not in a separate element in
	_prepare_special_units, returning a new array with such special output
	units.  At that point associate to the document unit.  Call
	_prepare_associated_special_units_targets later on (where
	_prepare_contents_elements was called) to finish setting up the
	targets.  Remove _prepare_contents_elements.

2023-10-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_contents_elements): do not set
	filename directly, it should be set by the associated output unit. Set
	the output unit filename.

	* tp/t/html_tests.t (test_separated_contents_shortcontents),
	tp/Makefile.tres: add test with shortcontents and contents not located
	in the same file to check that links to contents are correct.

2023-10-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_special_units): rename
	$element as $special_unit.  Set tree_unit_directions while creating
	the special units, not after.

2023-10-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_set_root_commands_targets_node_files):
	use $self->{'sections_list'} to determine sections, not output units.

	* tp/Texinfo/Convert/HTML.pm (_prepare_special_units): move code
	around to separate phases better.

2023-10-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm: minor code/comments cleanups.  Reset
	$self->{'document_units'} after rebuild_output_units call.

2023-10-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_conversion_units)
	(_prepare_special_units): remove unused $destination_directory
	argument.

	* tp/Texinfo/Convert/HTML.pm (_prepare_conversion_units)
	(_prepare_frames_filenames, _prepare_special_units): move setup
	of special units directions to _prepare_special_units.  Move setup of
	frames filenames out of _prepare_special_units to
	_prepare_frames_filenames, and call _prepare_frames_filenames in
	_prepare_conversion_units.  Simplify _prepare_frames_filenames code
	removing the possibility to customize file names directly.

	* tp/Texinfo/Convert/HTML.pm (_prepare_contents_elements): get
	$output_units as argument and use it instead of
	$self->{'document_units'}.

2023-10-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (import, _XS_split_pages, split_pages),
	tp/Texinfo/XS/main/get_perl_info.c (get_sv_output_units),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs (split_pages),
	tp/Texinfo/XS/structuring_transfo/structuring.c (output_unit_section)
	(LEVEL_SPLIT_STRING, split_level_table, split_pages): implement
	split_page and XS interface.

	* tp/DebugTexinfo/DebugTree.pm (output),
	tp/Texinfo/Convert/Converter.pm (output), tp/Texinfo/Convert/HTML.pm
	(output), tp/Texinfo/Structuring.pm (import, rebuild_output_units),
	tp/Texinfo/XS/main/get_perl_info.c (get_sv_output_units_descriptor),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(rebuild_output_units), tp/t/test_utils.pl (test): add
	rebuild_output_units to get back output_units list from C to perl.
	Call it after calls to split_pages.

	* tp/DebugTexinfo/DebugTree.pm (output): rename $elements as
	$output_units.

2023-10-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (split_by_section): reorganize code to
	avoid redundancy.

	* tp/Texinfo/Structuring.pm (import, _XS_split_by_section)
	(split_by_section),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(split_by_section), tp/Texinfo/XS/structuring_transfo/structuring.c
	(split_by_section): implement split_by_section in C and XS interface.

2023-10-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES),
	tp/Texinfo/XS/main/build_perl_info.c (build_output_units_list),
	tp/Texinfo/XS/main/output_unit.c (retrieve_output_units)
	(new_output_units_descriptor),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(split_by_node), tp/Texinfo/XS/structuring_transfo/structuring.c
	(split_by_node), tp/t/test_utils.pl: in split_by_node register
	output_units list to a global list of output units setup in the new
	main/output_unit.c file.  Return a descriptor corresponding to the
	index in the list.
	In build_output_units_list, use a descriptor as argument and pass the
	descriptor to perl in the first output_units output unit.

2023-10-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (unsplit), tp/t/test_utils.pl: move
	unsplit to tp/Texinfo/Structuring.pm.

	* tp/Texinfo/Structuring.pm (import, _XS_unsplit, unsplit),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs (unsplit),
	tp/Texinfo/XS/structuring_transfo/structuring.c (unsplit): C
	implementation and XS interface for unsplit.

2023-10-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree.c (add_to_element_list): add a function
	that can be directly called on an ELEMENT_LISTE, for output units
	contents_list.  Use in similar existing functions.

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (_get_parser_info): rename
	get_parser_info as _get_parser_info.

	* tp/Texinfo/Structuring.pm (rebuild_document),
	tp/Texinfo/XS/main/build_perl_info.c (build_document),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (_get_parser_info),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (build_document),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(rebuild_document), tp/t/test_utils.pl (test), tp/texi2any.pl: add
	no_clean_perl_refs argument to build_document to keep the hv pointers
	to perl tree elements.  Set it when document are rebuild after the
	structuring and transformations.

	* tp/Texinfo/Structuring.pm (import, _XS_split_by_node)
	(split_by_node), tp/Texinfo/XS/main/build_perl_info.c
	(output_unit_to_perl_hash, build_output_units_list),
	tp/Texinfo/XS/main/tree_types.h (enum output_unit_type, OUTPUT_UNIT)
	(OUTPUT_UNIT_LIST), tp/Texinfo/XS/main/utils.c
	(output_unit_type_names),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(split_by_node), tp/Texinfo/XS/structuring_transfo/structuring.c
	(new_output_unit, add_to_output_unit_list, split_by_node): implement
	split_by_node in C and the XS interface.

2023-10-01  Patrice Dumas  <pertusus@free.fr>

	* Texinfo/Structuring.pm: move code around to have output units
	related code after external references, number floats and menus code.

2023-09-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (build_single_index_data),
	tp/Texinfo/XS/main/tree_types.h (INDEX_ENTRY),
	tp/Texinfo/XS/parsetexi/indices.c (enter_index_entry)
	(complete_indices): rename the command INDEX_ENTRY struct field to
	entry_element to be more in line with perl code data.

2023-09-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (unit_or_external_element_texi): simplify
	by using directly the external node element content.  Other
	simplifications and changes.

	Minor other changes.

2023-09-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (_label_target_unit_element): use directly
	the node argument tree element as unit_command for the
	external_node_unit output unit target.

2023-09-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (_label_target_unit_element): do not set
	external node associated_unit, it is not useful and it is better if
	there are associated_unit only for elements at the root level.

2023-09-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (debug_print_output_unit),
	tp/Texinfo/Convert/HTML.pm (from_element_direction),
	tp/Texinfo/Structuring.pm (_label_target_unit_element)
	(unit_or_external_element_texi): setup an output unit in
	_label_target_unit_element associated to an external node for
	consistency with the other directions.

2023-09-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_printindex_command)
	(_html_set_pages_files, _default_format_begin_file)
	(output_internal_links): inline and remove unit_element_command.

2023-09-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (command_root_element_command)
	(command_contents_href, command_text, from_element_direction)
	(_translate_names, _contents_inline_element)
	(_convert_special_unit_type, _html_get_tree_root_element)
	(_html_set_pages_files, _prepare_special_units)
	(_prepare_contents_elements): associate a "virtual" out of tree
	element with type special_unit_element to special output units, in
	order to use an element as 'targets' hash keys to more consistent with
	other output units.

2023-09-27  Patrice Dumas  <pertusus@free.fr>

	* Texinfo/Common.pm (debug_print_output_unit): new function used for
	debugging.

2023-09-26  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi, tp/Texinfo/Convert/HTML.pm,
	tp/t/init/only_toc_out.init,
	tp/t/init/special_element_customization.pm: replace special_element by
	special_unit everywhere.

2023-09-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (debug_print_element): remove extra
	special_element_type, it has disappeared since long.

2023-09-26  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi, tp/Texinfo/Config.pm,
	tp/Texinfo/Convert/HTML.pm, tp/t/init/t2h_singular.init: replace
	special_element_body by special_unit_body.

2023-09-26  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi, tp/Texinfo/Config.pm,
	tp/Texinfo/Convert/HTML.pm,
	tp/t/init/redirection_file_collision_with_special.init,
	tp/t/init/special_element_customization.pm: replace
	special_element_info by special_unit_info and
	special_direction_element by special_direction_unit.

2023-09-26  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi, tp/Texinfo/Config.pm,
	tp/Texinfo/Convert/HTML.pm, tp/t/init/only_toc_out.init:
	rename special_elements_directions as special_units_directions and
	special_element_variety as special_unit_variety, and rename some
	Special Element to Special Unit in documentation.

2023-09-26  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Texinfo Tree Elements in User Defined
	Functions), tp/Texinfo/Convert/HTML.pm (command_text)
	(from_element_direction, _convert_special_unit_type)
	(_default_format_element_footer, _html_get_tree_root_element)
	(_prepare_special_elements, _prepare_contents_elements, output),
	tp/ext/epub3.pm: rename unit_type special_element as special_unit,
	rename _convert_special_element_type as _convert_special_unit_type.

2023-09-26  Patrice Dumas  <pertusus@free.fr>

	* tp/init/book.pm (book_format_navigation_header): rename contents key
	of output units as unit_contents.

2023-09-26  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Output Units in User Defined Functions): add
	unit_contents.

2023-09-26  Patrice Dumas  <pertusus@free.fr>

	Rename contents key of output units as unit_contents

	* tp/Texinfo/Convert/Converter.pm (convert_output_unit)
	(_set_output_units_files), tp/Texinfo/Convert/HTML.pm
	(_default_format_element_header)
	(_set_root_commands_targets_node_files)
	(_html_set_pages_files, convert_output_unit),
	tp/Texinfo/Convert/Plaintext.pm (convert_output_unit),
	tp/Texinfo/Structuring.pm (split_by_node, split_by_section),
	tp/t/test_utils.pl (@contents_keys): rename contents key of output
	units as unit_contents.

2023-09-26  Patrice Dumas  <pertusus@free.fr>

	Rename type key of output units as unit_type

	* doc/texi2any_api.texi (Output Units in User Defined Functions),
	tp/Texinfo/Convert/HTML.pm (command_text, from_element_direction)
	(_default_format_element_footer, _html_get_tree_root_element)
	(_prepare_special_elements, _prepare_contents_elements)
	(convert_output_unit, output), tp/Texinfo/Structuring.pm
	(split_by_node, split_by_section, units_directions)
	(unit_or_external_element_texi): rename output unit type key as
	unit_type.

2023-09-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (unit_element_command)
	(_default_format_begin_file): have unit_element_command only return
	tree elements. Get the special element to be used in file title in
	_default_format_begin_file.

	* tp/Texinfo/Convert/HTML.pm: remove obsolete/debug code.

2023-09-26  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi
	(Texinfo Tree Elements in User Defined Functions)
	(Output Units in User Defined Functions)
	(Output Units Conversion Functions), tp/Texinfo/Config.pm
	($GNUT_output_units_conversion)
	(texinfo_register_output_unit_formatting)
	(GNUT_get_output_units_conversion), tp/Texinfo/Convert/HTML.pm
	(default_output_unit_conversion, output_unit_conversion)
	(converter_initialize, convert, convert_output_unit, output),
	tp/ext/epub3.pm, tp/t/init/mini_ker_t2h.init: separate conversion
	function for output units, convert_output_unit, and separate
	customization functions, registered with
	texinfo_register_output_unit_formatting.
	Separate documentation of Output Units in User Defined Functions and
	Texinfo Tree Elements in User Defined Functions.

2023-09-26  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl: fix SORT_ELEMENT_COUNT closing file error message.

2023-09-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (sort_element_counts),
	tp/texi2any.pl: pass a document in argument of sort_element_counts.

2023-09-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (_get_root_element): fix code
	by using associated_unit.

2023-09-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm: remove _convert_document_units,
	convert_document_sections and convert_document_nodes.

	* tp/Texinfo/Convert/Plaintext.pm (_initialize_converter_state)
	(convert_output_unit): rename _convert_root_element as
	convert_output_unit.  Add _initialize_converter_state based on
	convert_tree code.

	* tp/Texinfo/Convert/Converter.pm (output, convert_output_unit),
	tp/Texinfo/Convert/Info.pm (output), tp/Texinfo/Convert/Plaintext.pm
	(convert_tree): call convert_output_unit instead of convert_tree on
	output units.

	* tp/Texinfo/Convert/Converter.pm (_count_converted_text): function
	based on sort_element_counts code.

	* tp/Texinfo/Convert/Converter.pm (sort_element_counts): use different
	code for output units and tree. Call convert_output_unit instead of
	convert_tree on output units.

	* tp/Texinfo/Convert/IXIN.pm (_get_element): update and simplify.

	* tp/Texinfo/Convert/IXIN.pm (output_ixin): change variable names to
	use output units related names. Call convert_output_unit instead of
	convert_tree on output units.

2023-09-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_html_get_tree_root_element): simplify
	by returning directly $current->{'associated_unit'} instead of
	recursing into it, and by removing impossible cases.

2023-09-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am: minor changes. Add comments and minor
	changes in code to make the organization of the file clearer.

2023-09-24  Patrice Dumas  <pertusus@free.fr>

	Separate *_CPPFLAGS and *_CFLAGS

	* tp/Texinfo/XS/Makefile.am (XSLIBS_CPPFLAGS, XSLIBS_CFLAGS)
	(*_la_CFLAGS, *_la_CPPFLAGS): separate XSLIBS_CPPFLAGS, with -I and -D
	from XSLIBS_CFLAGS.  Do the same for *_la_CFLAGS and *_la_CPPFLAGS to
	add XSLIBS_CFLAGS to *_la_CFLAGS and leave XSLIBS_CPPFLAGS in
	*_la_CPPFLAGS.
	More consistent order of *_la_* variables.

2023-09-24  Patrice Dumas  <pertusus@free.fr>

	Use consistent flags in XS/configure.ac and XS/Makefile.am

	* tp/Texinfo/XS/configure.ac (CFLAGS, LDFLAGS): move
	$PERL_CONF_cccdlflags to CFLAGS as it should belong here.
	Add $PERL_CONF_optimize to CFLAGS as it is there in Makefile.am.

	* tp/Texinfo/XS/Makefile.am (XSLIBS_CFLAGS): add PERL_CONF_cccdlflags
	as it is in configure.ac and it seems like the way to go to use the
	same compile flags as used to compile perl module, even when it is
	redundant with libtool flags.

2023-09-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/api.c, tp/Texinfo/XS/parsetexi/parser.c
	(store_document): move store_document to parser.c.

2023-09-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (maintenance_files): add
	maintain/setup_accent_tables.pl.

	* tp/Texinfo/XS/Makefile.am (EXTRA_DIST): add
	main/accent_tables_8bit_codepoints.c.  Fix StructuringTransfo.xs path
	name.

	* tp/Texinfo/XS/Makefile.am, tp/maintain/setup_accent_tables.pl
	(BEGIN), tp/maintain/setup_converters_code_tables.pl (BEGIN): pass
	srcdir.  Do not use Texinfo::ModulePath, as it may not be created when
	tp/Texinfo/XS is processed, as tp is processed after tp/Texinfo/XS/,
	and we only need to find pure perl modules.

2023-09-24  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/Makefile.am (pod2texi),
	Pod-Simple-Texinfo/pod2texi.pl (BEGIN): modify BEGIN block of
	pod2texi.pl to use similar code than texi2any.pl to find perl modules
	with Texinfo::ModulePath.

2023-09-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (associate_internal_references): change
	order of arguments, put document first.

2023-09-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/structuring.c
	(sectioning_structure): use enumerate_item_representation for appendix
	number.

2023-09-23  Patrice Dumas  <pertusus@free.fr>

	* b/tp/Texinfo/Transformations.pm
	(_protect_hashchar_at_line_beginning),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(protect_hashchar_at_line_beginning_internal): relocate source marks.

	* tp/Texinfo/XS/structuring_transfo/transformations.c
	(protect_first_parenthesis, protect_text): minor changes in code.

2023-09-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files),
	tp/t/input_files/cpp_directives_line_value_macro.texi,
	tp/Makefile.tres, tp/t/60macro.t (cpp_directives_line_value_macro),
	tp/t/transformations.t
	(protect_hashchar_at_line_beginning_source_mark): add a file with
	macro expansions and value expansion in line directives.  Use it as a
	regular test file and for the test of
	protect_hashchar_at_line_beginning transformation together with source
	marks.

2023-09-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/structuring.c (new_master_menu):
	destroy master_menu_title temporary container.  Destroy master_menu if
	empty.

	* tp/Texinfo/XS/structuring_transfo/transformations.c
	(protect_first_parenthesis): free source_mark_list.list after all the
	source marks have been relocated.

	* tp/Texinfo/XS/structuring_transfo/transformations.c
	(regenerate_master_menu): return if there is no need for a master
	menu.

	* tp/Makefile.tres, tp/t/transformations.t
	(regenerate_master_menu_no_need_for_master_menu): test for a case of
	master menu not needed, with only chapter-level with
	TREE_TRANSFORMATIONS regenerate_master_menu.

2023-09-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c
	(destroy_document_information_except_tree), tp/Texinfo/XS/main/utils.c
	(wipe_index_names), tp/Texinfo/XS/parsetexi/api.c
	(reset_parser_except_conf): add wipe_index_names based on
	destroy_document_information_except_tree code.  Call in
	destroy_document_information_except_tree and in
	reset_parser_except_conf.  Also call forget_indices in
	reset_parser_except_conf.

2023-09-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/translations.c (gdt_tree): free small_strings and
	small_strings->list.

2023-09-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (protect_first_parenthesis),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(protect_first_parenthesis): fix location of removal and insertion
	when not the first element.

2023-09-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (protect_first_parenthesis),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(protect_first_parenthesis): relocate source marks.

	* tp/Makefile.tres, tp/t/transformations.t
	(protect_first_parenthesis_after_parenthesis_source_mark): new test
	with protect_first_parenthesis and source marks to be relocated
	before and after parenthesis.

2023-09-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (protect_first_parenthesis),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(protect_first_parenthesis): allow an empty text string before
	protected parenthesis, for instance for source mark.

	* tp/Makefile.tres, tp/t/transformations.t
	(protect_first_parenthesis_source_mark): test of
	protect_first_parenthesis with source marks.

2023-09-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/def.c (split_def_args),
	tp/Texinfo/XS/parsetexi/parser.c (isolate_last_space_internal): set
	text of element source mark is relocated to before relocating the
	source mark as now the information of whether the element has text is
	used in relocate_source_marks.

2023-09-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm ($XS_only), tp/Texinfo/Structuring.pm
	($XS_only), tp/Texinfo/Transformations.pm ($XS_only): set $XS_only
	if both TEXINFO_XS is set to require and TEXINFO_XS_CONVERT is set.

2023-09-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (relocate_source_marks, _protect_text),
	tp/Texinfo/XS/main/manipulate_tree.c (relocate_source_marks),
	tp/Texinfo/XS/structuring_transfo/transformations.c (protect_text):
	handle the case of a source mark relocated after an @-command
	replacing a character, as done in protect_text for comma.

	* tp/Makefile.tres, tp/t/transformations.t
	(protect_comma_source_mark): new test to test protect_comma with
	source marks.

2023-09-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree.c (insert_contents_slice_into_args): remove
	insert_slice_into_args and add insert_contents_slice_into_args that
	takes a contents slice and put to args.

	* tp/Texinfo/XS/structuring_transfo/transformations.c (modify_tree):
	even when the args are replaced, use the contents of the temporary
	container element returned by (*operation), using
	insert_contents_slice_into_args.

	* tp/Texinfo/Common.pm (_protect_text),
	tp/Texinfo/XS/structuring_transfo/transformations.c (protect_text): do
	not protect text in rawline_arg.

	* tp/Makefile.tres, tp/t/transformations.t
	(protect_node_after_label_source_mark_in_protected): test source marks
	in protected characters.

2023-09-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (_protect_text), tp/Texinfo/XS/Makefile.am
	(StructuringTransfo_la_LIBADD, StructuringTransfo_la_LDFLAGS)
	(StructuringTransfo_la_CPPFLAGS),
	tp/Texinfo/XS/structuring_transfo/transformations.c (protect_text):
	relocate source marks in protect_text.

	* tp/t/transformations.t (protect_colon_source_mark): add more text to
	avoid confusing source mark count.

2023-09-20  Patrice Dumas  <pertusus@free.fr>

	Update gnulib to be on par with master branch (minor change)

	* tp/Texinfo/XS: Run "gnulib-tool --add-import".

2023-09-20  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (%tested_transformations, test): add the
	possibility to test for transformations that are not 'valid' tree
	transformations: protect_comma, protect_colon,
	protect_node_after_label, protect_first_parenthesis and
	protect_hashchar_at_line_beginning.

	* tp/Makefile.tres, tp/t/transformations.t
	(protect_colon_source_mark): test protect_colon with source marks.

2023-09-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (indices_info_index_by_name),
	tp/Texinfo/XS/parsetexi/indices.c (add_index, init_index_commands),
	tp/Texinfo/XS/structuring_transfo/transformations.c,
	tp/Texinfo/XS/parsetexi/end_line.c (parse_line_command_args): move
	indices_info_index_by_name to main/utils.c and use it in
	parsetexi/indices.c and parsetexi/end_line.c.  Remove now unused
	index_by_name from parsetexi/indices.c.

2023-09-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/55conditionals.t (if_not_closed): new test.

2023-09-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block):
	use parser_format_expanded_p.

2023-09-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/indices.c, tp/Texinfo/XS/main/utils.c
	(wipe_index): move wipe_index to main/utils.c.

	* tp/Texinfo/XS/parsetexi/indices.c: remove wipe_indices.

	Add or remove #include <stddef.h>.

2023-09-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES),
	tp/Texinfo/XS/main/utils.c, tp/Texinfo/XS/main/floats.c
	(add_to_float_record_list, find_float_type)
	(float_list_to_listoffloats_list, destroy_listoffloats_list)
	(parse_float_type), tp/Texinfo/XS/parsetexi/api.c (store_document),
	tp/Texinfo/XS/parsetexi/end_line.c (float_records): move floats
	related function to a new main/floats.c file.  Use a FLOAT_RECORD_LIST
	as global float_records structure.

2023-09-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/structuring.c: remove now unneeded
	#include "labels.h".

2023-09-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/manipulate_tree.c (add_source_mark)
	(remove_from_source_mark_list, relocate_source_marks)
	(parse_node_manual), tp/Texinfo/XS/parsetexi/labels.c,
	tp/Texinfo/XS/parsetexi/source_marks.c: move parse_node_manual to
	manipulate_tree.c and add_source_mark, remove_from_source_mark_list
	and relocate_source_marks that are needed by parse_node_manual and
	could also be needed for other tree manipulation functions in the
	future.

2023-09-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES),
	tp/Texinfo/XS/main/utils.c, tp/Texinfo/XS/main/manipulate_tree.c
	(increase_ref_counter, copy_associated_info, copy_tree_internal)
	(get_copy_ref, associate_info_references, copy_extra_info, copy_tree)
	(copy_contents): new file manipulate_tree.c.  Move tree copy related
	code to manipulate_tree.c.

2023-09-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (encode_with_iconv): pass source_info
	from arguments.  Update callers.

2023-09-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c (unregister_tree),
	tp/Texinfo/XS/main/document.h (TREE_AND_STRINGS): return tree
	and small strings in the TREE_AND_STRINGS new structure.

	* tp/Texinfo/XS/main/utils.c (merge_strings): add.

	* tp/Texinfo/XS/main/translations.c (replace_convert_substrings, gdt)
	(gdt_tree), tp/Texinfo/XS/parsetexi/indices.c (complete_indices),
	tp/Texinfo/XS/structuring_transfo/structuring.c (new_master_menu),
	tp/Texinfo/XS/main/convert_utils.c (definition_category_tree),
	tp/Texinfo/XS/main/Translations.xs (gettree): have
	replace_convert_substrings and gdt return a document_descriptor.  Add
	the gdt_tree function that takes an optional document in argument to
	merge the small strings to, and returns a tree after calling
	unregister_tree.  Set the string argument to be the first argument of
	gdt and gdt_tree.  Update callers to call gdt_tree instead of gdt or
	adapt to change in gdt.

2023-09-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.xs: remove wipe_errors from the
	XS interface.

2023-09-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/api.c (reset_parser_except_conf): do not
	call functions that destroy/reset structures associated to a document
	with store_document that have already been reset in the store_document
	call.  Remove reset_floats.

	* tp/Texinfo/XS/parsetexi/parser.c (check_line_directive): remove
	unused variable.

2023-09-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (check_line_directive): do not
	save the line directive parsed filename string, as the encoded file
	name, which is the one that is used in source_info, is saved in
	save_line_directive.

2023-09-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_handle_comma): set raw in elided type
	parent.

	* tp/Texinfo/ParserNonXS.pm (_gather_previous_item): reparent elements
	removed from before_item.

2023-09-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_close_brace_command): delete
	remaining_args.

	* tp/t/test_utils.pl (%avoided_keys_tree): do not ignore
	remaining_args.

2023-09-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/TranslationsNonXS.pm (complete_indices),
	tp/Texinfo/XS/parsetexi/indices.c (complete_indices): set
	index_entry_normalized contents parent.  Remove FIXME as it has become
	incorrect and it is normal for out of tree elements not to have
	parents.

	* tp/Texinfo/TranslationsNonXS.pm: remove _non_bracketed_contents.

2023-09-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/TranslationsNonXS.pm (_substitute_element_array): use a
	for loop on indices in array, as in the XS code.

	* tp/Texinfo/TranslationsNonXS.pm: changes in spacing.

2023-09-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/builtin_commands.c (element_builtin_cmd): change
	FIXME in message to BUG and rephrase.

2023-09-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs: remove text_convert.

2023-09-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_utils.c (expand_verbatiminclude): free
	file path.

2023-09-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (text_convert_tree): destroy
	text_options in case of unexpected document not found error.

	* tp/Texinfo/XS/main/convert_to_text.c (destroy_text_options): free
	include_directories, call free_options to free inside of converter
	options.

	* tp/Texinfo/XS/main/utils.c (clear_strings_list): rename
	clear_include_directories as clear_strings_list.  Update callers.

2023-09-18  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/regenerate_C_options_info.pl, tp/Texinfo/XS/main/utils.c
	(free_strings_list, destroy_strings_list), tp/Texinfo/XS/Makefile.am
	(EXTRA_DIST, BUILT_SOURCES), tp/Texinfo/XS/main/document.c
	(destroy_document_information_except_tree): generate free_options
	functions code to free options structure.  Rename to
	options_init_free.c the file where this automatically generated code
	is put.  Rename free_strings_list as destroy_strings_list and set
	free_strings_list to free the content of the string list, but not the
	structure itself.  Use free_options in
	destroy_document_information_except_tree, and also destroy the
	nodes_list and sections_list elements.

2023-09-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Config.pm (set_document_main_configuration): call
	set_document_options only once.

2023-09-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/PlainTexinfo.pm (import, _convert_tree_with_XS)
	(convert_tree, convert), tp/Texinfo/Convert/Texinfo.pm
	(_convert_tree_with_XS, convert_to_texinfo),
	tp/Texinfo/XS/convert/ConvertXS.xs (plain_texinfo_convert_tree):
	remove plain_texinfo_convert, always get the tree before calling XS
	code.  Simplify plain_texinfo_convert_tree call by removing the
	unused first argument.

2023-09-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (EXTRA_DIST, BUILT_SOURCES),
	tp/Texinfo/XS/main/command_data.awk,
	tp/Texinfo/XS/main/build_perl_info.c (build_global_commands),
	tp/Texinfo/XS/main/utils.c (delete_global_commands),
	tp/Texinfo/XS/main/utils.h (GLOBAL_COMMANDS),
	tp/Texinfo/XS/parsetexi/api.c (store_document),
	tp/Texinfo/XS/parsetexi/parser.c (register_global_command): generate
	automatically with command_data.awk the struct GLOBAL_COMMANDS header
	file and list of macro calls for global multiple and global unique
	commands.

2023-09-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (build_global_commands),
	tp/Texinfo/XS/parsetexi/api.c (store_document): use GLOBAL_UNIQUE_CASE
	and GLOBAL_CASE macro names to be consistent with other parts of the
	code.

	* tp/Texinfo/XS/main/utils.c (delete_global_commands): handle
	footnotes like floats.

2023-09-17  Patrice Dumas  <pertusus@free.fr>

	Separate structure for global commands from global info

	* tp/Texinfo/XS/main/build_perl_info.c (build_global_commands)
	(build_document), tp/Texinfo/XS/main/Translations.xs (gettree),
	tp/Texinfo/XS/main/document.c (register_document)
	(destroy_document_information_except_tree), tp/Texinfo/XS/main/utils.c
	(delete_global_info, delete_global_commands),
	tp/Texinfo/XS/main/utils.h (GLOBAL_INFO, GLOBAL_COMMANDS),
	tp/Texinfo/XS/parsetexi/api.c (store_document),
	tp/Texinfo/XS/parsetexi/parser.c (global_commands)
	(register_global_command, wipe_parser_global_info)
	(rearrange_tree_beginning),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs (copy_tree),
	tp/Texinfo/XS/structuring_transfo/structuring.c (warn_non_empty_parts)
	(set_menus_node_directions): add a separate structure, GLOBAL_COMMANDS
	for global commands, removing them from GLOBAL_INFO.  Rename
	build_global_info2 as build_global_commands.

2023-09-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/command_data.txt: consider everyheading, everyfooting, and
	similar even* odd* commands to be global_unique and not global.

2023-09-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm (remove_document),
	tp/Texinfo/XS/main/document.c (remove_document_descriptor),
	tp/t/test_utils.pl (test): rename main/document.c remove_document as
	remove_document_descriptor.  Update callers.  Have both
	remove_document_descriptor and remove_document in the XS interface.
	Override and use remove_document in perl code.

	* tp/texi2any.pl: call remove_document at the end of an input file
	processing.

	* tp/Texinfo/XS/parsetexi/Parsetexi.xs: remove interface for
	remove_document/remove_document_descriptor.

2023-09-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm (import, document_descriptor)
	(remove_document),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(remove_document), tp/t/test_utils.pl (test): add remove_document XS
	in Texinfo::Document, using StructuringTransfo.xs.  Call it in
	test_utils.pl after each test.

	* tp/Texinfo/Convert/PlainTexinfo.pm (convert): use
	document_descriptor().

2023-09-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/api.c (store_document): add missing
	microtype COPY_GLOBAL_ARRAY.

2023-09-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/get_perl_info.c
	(copy_sv_options_for_convert_text): remove unused variable.

2023-09-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser): set debug to 0
	if $conf->{'DEBUG'} is 0.

2023-09-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/macro.c (new_macro): free macrobody when
	reusing the same slot.

	* tp/Texinfo/XS/parsetexi/macro.c (handle_macro): stll free expanded
	text when the string is empty.

2023-09-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal):
	always destroy parsed_def.

	* tp/Texinfo/XS/main/unicode.c (encoded_accents)
	(unicode_point_decoded_in_encoding): free normalized_encoding.

	* tp/Texinfo/XS/parsetexi/macro.c (expand_linemacro_arguments): free
	command name when it is a comment.

	* tp/Texinfo/XS/parsetexi/macro.c (handle_macro): check that string is
	not empty before removing end of line.

	* tp/Texinfo/XS/structuring_transfo/structuring.c (print_down_menus):
	destroy node_title_copy.

	* tp/Texinfo/XS/structuring_transfo/transformations.c
	(relate_index_entries_to_table_items_in): free idx_info.

	* tp/Texinfo/XS/structuring_transfo/transformations.c (new_node):
	destroy appended text element.

	* tp/Texinfo/XS/structuring_transfo/transformations.c
	(reference_to_arg_internal): when destroying the removed reference
	command argument element, do not set the list to 0 as it means that
	the list will not be free'd.

	* tp/Texinfo/XS/structuring_transfo/transformations.c
	(complete_node_menu): destroy node_childs and pending in every
	relevant cases.

2023-09-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (rearrange_tree_beginning): destroy
	before_setfilename if empty and not used.

	* tp/Texinfo/XS/structuring_transfo/structuring.c (number_floats):
	remove duplicate add_extra_string_dup.

2023-09-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (text_heading): simplify code,
	free heading_with_number in case of empty heading.

	* tp/Texinfo/XS/main/convert_to_text.c (ascii_accent): remove unused
	variable.

2023-09-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/labels.c
	(check_register_target_element_label): free label_texi from error
	message.

	* tp/Texinfo/XS/structuring_transfo/structuring.c (check_menu_entry)
	(check_nodes_are_referenced, complete_node_tree_with_menus, nodes_tree)
	(associate_internal_references): free texinfo code strings used in
	error messages.

2023-09-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (ascii_accent): do not make the
	TEXT static, its .text needs to be free'd.

	* tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal):
	remove double definition of variable cased.

	* tp/Texinfo/XS/main/convert_utils.c (expand_verbatiminclude): free
	file_name_encoding.

	* tp/Texinfo/XS/structuring_transfo/structuring.c
	(check_nodes_are_referenced, new_complete_node_menu): destroy node_childs.

	* tp/Texinfo/XS/structuring_transfo/structuring.c
	(check_nodes_are_referenced): free referenced_identifiers.

2023-09-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal):
	also destroy children of parsed_definition_category, which should not
	be elsewhere in the tree, as tree elements were copied.

	* tp/Texinfo/Convert/Utils.pm (definition_category_tree): set parents
	of elements that are not already in the tree.

	* tp/Texinfo/XS/main/convert_utils.c (definition_category_tree):
	use add_to_element_contents instead of add_to_contents_as_array to
	have parents set.

2023-09-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (plain_texinfo_convert)
	(plain_texinfo_convert_tree, text_convert, text_convert_tree): free
	plain_texinfo_convert and text_convert results.

2023-09-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/translations.c (replace_convert_substrings): free
	texinfo_line.

2023-09-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/structuring.c
	(sectioning_structure): create section_directions element only if
	it is needed.

2023-09-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_texinfo.c (expand_cmd_args_to_texi):
	set cmd as element_builtin_cmd to handle user-defined element cmd.

2023-09-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (text_heading)
	(convert_to_text_internal), tp/Texinfo/XS/main/convert_utils.c
	(add_heading_number): add options arguments.  No actual implementation
	of using thet options, as there is no way to test yet.

2023-09-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Text.pm (_convert): use consistently
	$options->{'converter'} both for
	Texinfo::Convert::Utils::expand_verbatiminclude error registration and
	customization information.

	* tp/Texinfo/Convert/Utils.pm (encoded_input_file_name): if
	DOC_ENCODING_FOR_INPUT_FILE_NAME customization is not defined,
	consider that it is true.

	* tp/tests/encoded/Makefile.am (EXTRA_DIST),
	tp/tests/encoded/verbatiminclude_names_latin1.texi,
	tp/tests/encoded/list-of-tests (verbatiminclude_names_latin1_html)
	(verbatiminclude_names_latin1_html_explicit_encoding)
	(verbatiminclude_names_latin1_rawtext)
	(verbatiminclude_names_latin1_explicit_encoding_rawtext): add tests
	on how verbatiminclude file name encoding is resolved in raw text in
	HTML and in raw text converter and how customization options are used.

	* tp/Texinfo/XS/main/convert_utils.c (encoded_input_file_name): add
	OPTIONS and GLOBAL_INFO arguments and use them to determine encoding.

	* tp/Texinfo/XS/main/convert_utils.c (expand_verbatiminclude): add
	an explicit ERROR_MESSAGE_LIST argument, conditionalize error output
	to that argument and use message_list_command_error functions.  Use
	normal OPTIONS as argument.  Add GLOBAL_INFO argument to pass to
	encoded_input_file_name.

	* tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal):
	pass OPTIONS and global information to expand_verbatiminclude.

2023-09-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Text.pm (encode_text_options),
	tp/Texinfo/XS/main/convert_to_text.c (destroy_text_options),
	tp/Texinfo/XS/main/get_perl_info.c (copy_sv_options_for_convert_text):
	separate other converter configuration given as option->{'converter'}
	and Text converter options put in an OPTION structure.

2023-09-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (text_convert_tree): use a
	different prototype to match with perl overriden function.

2023-09-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Text.pm (_convert_tree_with_XS, convert_to_text)
	(output), tp/Texinfo/XS/convert/ConvertXS.xs (text_convert_tree): call
	_convert_tree_with_XS with perl text options as an additional argument
	in case XS is not used for the call to _convert.

	* tp/Texinfo/Convert/Text.pm (converter): do not bless the converter
	twice.

2023-09-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (text_convert)
	(text_convert_tree): rename converter as text_options_in and options
	as text_options.

2023-09-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/get_perl_info.c (add_svav_to_string_list): fix
	strings_nr, av_top_index gives the last index, not number of elements.

	* tp/Texinfo/Common.pm (encode_options): add function based on
	set_document_options.  Filter in valid_customization_options.

	* tp/Texinfo/Convert/Text.pm (@text_indicator_converter_options)
	(copy_options_for_convert_text, encode_text_options, convert_to_text)
	(output): encode options.  Pass separately converter options and
	specific text options to XS.  Pass expanded_formats_hash as
	expanded_formats array.

	* tp/Texinfo/XS/main/convert_to_text.c (destroy_text_options)
	tp/Texinfo/XS/main/convert_to_text.h (TEXT_OPTIONS),
	tp/Texinfo/XS/main/get_perl_info.c (copy_sv_options_for_convert_text):
	add converter_options.

	* tp/Texinfo/XS/convert/convert_text.c (text_convert),
	tp/Texinfo/XS/main/convert_to_text.h (TEXT_OPTIONS): add
	document_descriptor option.

	* tp/Texinfo/XS/main/convert_to_text.c (destroy_text_options),
	rename destroy_options as destroy_text_options.  Update callers.

	* tp/Texinfo/XS/convert/convert_text.c (text_convert),
	tp/Texinfo/XS/main/convert_to_text.c (destroy_text_options)
	(text_accents, text_heading, convert_to_text_internal)
	(convert_to_text), tp/Texinfo/XS/main/get_perl_info.c
	(copy_sv_options_for_convert_text): rename TEXT_OPTIONS options as
	text_options.

2023-09-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/indices.c (complete_indices): do not reuse
	document pointer after a call to gdt, the documents list may  have
	been realloc'ated and the document pointer can be invalid.

	* tp/Texinfo/XS/structuring_transfo/structuring.c
	(sectioning_structure, warn_non_empty_parts, check_menu_entry)
	(check_nodes_are_referenced, set_menus_node_directions)
	(complete_node_tree_with_menus, nodes_tree)
	(associate_internal_references): get document structure member
	pointers early in functions.

	* tp/Texinfo/XS/main/Translations.xs (gettree): use
	get_sv_tree_document.

	* tp/Texinfo/XS/main/targets.c (add_element_to_identifiers_target):
	minor change.

	* tp/Texinfo/XS/main/targets.c (register_label_element): pass
	document_descriptor, which is less likely to change than the element
	pointer that can change if the elements list is realloc'ated.

	* tp/Texinfo/XS/main/translations.c (switch_messages_locale): free and
	strdup working_locale string to (hopefully) avoid memory issues.

2023-09-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/*/*.*: rename global_info.global_input_encoding_name
	as global_info.input_encoding_name for consistency with other
	variables and with perl code.

2023-09-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/Translations.xs (gettree),
	tp/Texinfo/XS/main/TranslationsXS.pm (gdt),
	tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal),
	tp/Texinfo/XS/main/convert_utils.c (definition_category_tree),
	tp/Texinfo/XS/main/translations.c (translate_string, gdt, gdt_string),
	tp/Texinfo/XS/parsetexi/indices.c (complete_indices),
	tp/Texinfo/XS/structuring_transfo/structuring.c (new_master_menu),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(regenerate_master_menu): use OPTIONS in gdt to obtain the
	documentlanguage.  Pass document options down to gdt.

2023-09-13  Patrice Dumas  <pertusus@free.fr>

	* tests/many_input_files/different_languages_gen_master_menu.sh
	(LC_ALL): set LC_ALL=en_US.utf-8 to have gettext do something.

2023-09-13  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl: move document rebuilding and error registering to
	before handle_errors call.

2023-09-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (protect_comma_in_tree, protect_colon_in_tree)
	(protect_node_after_label_in_tree): return the perl tree when there
	is no document descriptor, even if $XS_only is set.

	* tp/Texinfo/Transformations.pm (_new_node): remove a node_tree
	tree_document_descriptor if there is one, as the result will not be
	correct if perl tree may not be updated.

2023-09-13  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_protect_hashchar_at_line_beginning.t: call
	Texinfo::Structuring::rebuild_document and add errors when needed.

2023-09-13  Patrice Dumas  <pertusus@free.fr>

	* tp/t/automatic_nodes.t, tp/t/do_master_menu.t: call
	Texinfo::Structuring::rebuild_document when needed.

2023-09-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (protect_comma_in_tree, protect_colon_in_tree)
	(protect_node_after_label_in_tree): return tree if from XS.

2023-09-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/transformations.c
	(reassociate_to_node): fix lookup_extra_integer status check for
	previous node.  Fix finding the menu in previous node.  Destroy menus
	and delete extra keys if there are not menus anymore.

2023-09-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_macro_command_line): chomp
	argument used in error message.

2023-09-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/structuring.c
	(set_menus_node_directions, complete_node_tree_with_menus, nodes_tree)
	(associate_internal_references): use options set in document.

	* tp/Makefile.tres, tp/t/30sectioning.t (equivalent_nodes_novalidate)
	(unknown_node_direction_novalidate, unknown_node_in_menu_novalidate):
	test all the possible cases with novalidate effect.

2023-09-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm ($XS_only, _XS_*): have all the _XS_*
	functions return 1 (except for _XS_copy_tree) to convey that XS code
	was not used.  In perl functions, return after calling the _XS_*
	functions if their return value is not set, when there is no XS, and if
	the $XS_only variable is 1.

	* tp/Texinfo/Common.pm ($XS_only), tp/Texinfo/Structuring.pm
	($XS_only), tp/Texinfo/Transformations.pm ($XS_only),
	tp/t/test_utils.pl (test), tp/texi2any.pl: set $XS_only to 1 if
	environment variable $TEXINFO_XS is require.  Call
	add_formatted_message on XS rebuilt document error if
	$TEXINFO_XS is require.

2023-09-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/options_data.txt: remove duplicates, fix
	SORT_ELEMENT_COUNT type.

	* tp/Makefile.am, maintain/regenerate_perl_options_info.pl,
	maintain/regenerate_C_options_info.pl, tp/Texinfo/XS/Makefile.am:
	split the C part of maintain/regenerate_options_info.pl out and put in
	maintain/regenerate_C_options_info.pl, the perl part is now
	maintain/regenerate_perl_options_info.pl.

	* maintain/regenerate_C_options_info.pl, tp/Texinfo/XS/Makefile.am,
	tp/Texinfo/XS/main/get_perl_info.c: generate code to get perl options
	hash and copy to C.

	* tp/Texinfo/Common.pm (import, %non_decoded_customization_variables)
	(_XS_set_document_options, set_document_options),
	tp/Texinfo/Config.pm (set_document_main_configuration),
	tp/Texinfo/XS/main/document.c (register_document_options),
	tp/Texinfo/XS/main/get_perl_info.c (add_svav_to_string_list,
	copy_sv_options) (copy_sv_options_for_convert_text),
	tp/Texinfo/XS/main/utils.c (new_options, add_include_directory,
	add_string), tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(set_document_options), tp/t/test_utils.pl (test), tp/texi2any.pl:
	move %non_decoded_customization_variables to Texinfo::Common. Add XS
	override to encode MainConfig options values and pass options to store
	in document, add add_svav_to_string_list based on
	copy_sv_options_for_convert_text to get more generically STRING_LIST
	from perl.

	* tp/Texinfo/Convert/Converter.pm (%common_converters_defaults),
	tp/Texinfo/Convert/HTML.pm (_default_format_program_string)
	(convert_tree), tp/Texinfo/Convert/Info.pm (_info_header),
	tp/Texinfo/options_data.txt, tp/t/init/t2h_singular.init,
	tp/texi2any.pl ($main_program_set_options, %test_conf): rename
	PACKAGE* to PACKAGE*_OPTION to avoid clashing with macros with the
	same name defined in config.h.

	* tp/maintain/regenerate_commands_perl_info.pl: use explicitly
	<STDIN>.

2023-09-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm, tp/Makefile.am (modules_DATA)
	(maintenance_files, EXTRA_DIST, DISTCLEANFILES),
	tp/Texinfo/options_data.txt, tp/maintain/regenerate_options_info.pl,
	tp/Texinfo/Convert/Converter.pm, tp/Texinfo/Convert/IXIN.pm,
	tp/t/test_utils.pl, tp/texi2any.pl, util/txicustomvars: generate
	options hashes (except for those related to parsers) automatically
	from options_data.txt instead of having hashes in Common.pm.  Also
	generate a C structure.

2023-09-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (%converter_customization_options)
	(%converter_other_options): put @variable_string_settables in
	%converter_customization_options and @variable_other_settables in
	%converter_other_options.

2023-09-12  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/run_parser_all.sh (LC_ALL): use en_US.utf-8 to avoid the
	possibility of ISO-8859-1 being detected as encoding.

2023-09-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (%common_parser_options, %parser_options)
	(%multiple_at_command_options, %unique_at_command_options)
	(%converter_cmdline_options, %program_cmdline_options)
	(%converter_customization_options, %other_options)
	(%array_cmdline_options): shorten names and always use _options
	postfix.  Update users.

2023-09-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/builtin_commands.c (element_builtin_cmd): return
	0 in the end to avoid compiler warning even though it should never
	happen.

2023-09-12  Patrice Dumas  <pertusus@free.fr>

	* po/Makevars (XGETTEXT_OPTIONS): add missing end of line protection.

2023-09-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm ($XS_only, _XS_*),
	tp/Texinfo/Transformations.pm ($XS_only, _XS_*): have all the _XS_*
	functions return 1 (except for _XS_copy_tree) to convey that XS code
	was not used.  In perl functions, return after calling the _XS_*
	functions if their return value is not set, when there is no XS, and if
	the $XS_only variable is 1.  With that system, it is easy to switch
	from running perl code only without XS to always running perl code.

	* tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(fill_gaps_in_sectioning): do not return anything.

2023-09-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Report.pm (add_formatted_message),
	tp/Texinfo/XS/main/build_perl_info.c (build_source_info_hash)
	(convert_error), tp/Texinfo/XS/parsetexi/Parsetexi.pm
	(get_parser_info): store the source_info information directly in
	convert_error returned hash, pass the hv to build_source_info_hash.
	Add error_line to convert_error returned hash. Add
	add_formatted_message in Texinfo::Report to add an already setup error
	message structure.  Use it in get_parser_info and remove _get_errors.

2023-09-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/text.c (text_printf): set format to be
	const.

	* tp/Texinfo/XS/main/errors.c (message_list_line_error_internal)
	tp/Texinfo/XS/main/utils.h (ERROR_MESSAGE): add error_line to
	ERROR_MESSAGE. Set the error_line using pgettext as is done in perl.
	Remove debug_error_warning_message and prepare_error_line_message.

	* po/Makevars (XGETTEXT_OPTIONS): add message_list_command_error,
	message_list_command_warn and pgettext.

2023-09-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Report.pm (line_warn, line_error, document_warn)
	(document_error): remove chomping, messages should not have end of
	lines.

2023-09-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (new_complete_menu_master_menu): rearrange
	condition, avoid the possibility of comparison with undefined.

2023-09-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/errors.c (message_list_command_warn): add.

	* tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(associate_internal_references, protect_hashchar_at_line_beginning),
	tp/Texinfo/XS/structuring_transfo/structuring.c (check_menu_entry)
	(set_menus_node_directions, associate_internal_references),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(protect_hashchar_at_line_beginning_internal)
	(protect_hashchar_at_line_beginning): pass document as argument.

	* tp/Texinfo/XS/structuring_transfo/structuring.c
	(sectioning_structure, check_menu_entry, set_menus_node_directions)
	(nodes_tree, associate_internal_references),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(protect_hashchar_at_line_beginning_internal):
	use message_list_command_warn instead of command_warn.

2023-09-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/errors.c (error_messages_list)
	(message_list_line_error_internal, line_error_internal, wipe_errors)
	(wipe_error_message_list, forget_errors, message_list_command_error),
	tp/Texinfo/XS/main/translations.c (replace_convert_substrings),
	tp/Texinfo/XS/parsetexi/api.c (store_document),
	tp/Texinfo/XS/main/document.c: use an ERROR_MESSAGE_LIST structure for
	the parser errors instead of error_list, error_number and error_space.
	Add message_list_line_error_internal that takes an ERROR_MESSAGE_LIST
	as argument with the same code as line_error_internal.  Move
	wipe_error_message_list from document.c to errors.c. Make wipe_errors
	and line_error_internal wrappers around wipe_error_message_list and
	message_list_line_error_internal.  Add message_list_command_error to
	be used in structuring and converters.

	* tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(sectioning_structure),
	tp/Texinfo/XS/structuring_transfo/structuring.c
	(sectioning_structure): pass document instead of tree to
	sectioning_structure.

2023-09-10  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl: comment out tree rebuilding after document
	structuring, as it would require passing customization for master menu
	regeneration.

2023-09-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(rebuild_document), tp/t/test_utils.pl (test): copy input document
	info keys values not already in new document info.  This is in order
	to have info keys values set in perl copied over to the rebuilt
	document.

	* tp/texi2any.pl: rebuild tree after document structuring.  other
	minor changes.

2023-09-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c (wipe_error_message_list)
	(destroy_document_information_except_tree, clear_document_errors),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs,
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (get_parser_info): clear document
	errors in XS after they have been registered in perl.

2023-09-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_utils.c (expand_verbatiminclude): add raw
	text to verbatiminclude.

	* tp/Texinfo/XS/main/convert_utils.c (expand_verbatiminclude),
	tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal): pass
	text options to expand_verbatiminclude.  This is temporary as
	expand_verbatiminclude should be usable by any converter and thus
	should take in argument generic converter customization information.

	* tp/Texinfo/Convert/Text.pm (output): call XS function for tree
	conversion.

2023-09-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%available_converter_info)
	(_convert_heading_command): update for changes introduced by rebase on
	master.

2023-09-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Text.pm (converter): remove code setting output
	encoding redundant with Texinfo::Common::set_output_encodings call.

	* tp/Texinfo/Convert/Text.pm (output): add a possible way to call XS
	converter incomments.  To pass the tests, would need to pass include
	directories to expand_verbatiminclude.

2023-09-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (converter),
	tp/Texinfo/Convert/Text.pm (converter): set the class argument to be
	mandatory and only handle the case of class and optionally
	configuration hash to be in arguments.

	* tp/texi2any.pltp/texi2any.pl: minor code simplifications.

2023-09-07  Patrice Dumas  <pertusus@free.fr>

	* tp/t/input_files/in_menu_only_special_spaces_node.texi,
	tp/t/input_files/only_special_spaces_node.texi: remove testing of
	U+2028 and U+2029 LINE SEPARATOR and PARAGRAPH SEPARATOR characters,
	as the perl and XS code give different width.  Those character should
	be handled explicitly in formatting, before that it is not an issue t
	o have different behaviours.

2023-09-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (text_accents): handle Null
	encoding.

	* tp/Texinfo/XS/main/get_perl_info.c
	(copy_sv_options_for_convert_text): pass sort_string.

2023-09-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (new_text_options)
	(text_accents): strdup and free options->encoding.

	* tp/Texinfo/XS/main/get_perl_info.c
	(copy_sv_options_for_convert_text): pass enabled_encoding.

	* tp/Texinfo/XS/main/unicode.c (unicode_brace_no_arg_command):
	fix the order of unicode_point_decoded_in_encoding arguments.

2023-09-05  Patrice Dumas  <pertusus@free.fr>

	* tp/t/accents.t (test_enable_encoding): use encoded_accents instead
	of internal functions in the tests.

2023-09-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Utils.pm (find_innermost_accent_contents):
	return tree element containing the innermost accent @-command contents
	instead of the contents.  Update callers.

2023-09-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (to_upper_or_lower_multibyte),
	tp/Texinfo/XS/main/convert_to_text.c: use u8_strlen (u8_text) + 1
	to include the NULL character in u8_toupper and u8_tolower
	input strings.  From Bruno Haible.

2023-09-05  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Customizing External Node Output Names),
	tp/Texinfo/Convert/HTML.pm (_external_node_href): pass elements for
	external_target_split_name and external_target_non_split_name.

2023-09-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (node_information_filename)
	(_set_output_units_files), tp/Texinfo/Convert/HTML.pm (command_href)
	(from_element_direction, _convert_xref_commands)
	(_convert_menu_entry_type, _normalized_label_id_file)
	(_set_root_commands_targets_node_files, _external_node_href): setup
	and pass elements for external nodes.

2023-09-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/TranslationsNonXS.pm (replace_convert_substrings):
	decrease DEBUG level by one for the gdt parser to avoid having
	parser and converter debug together for a level of 1.

2023-09-04  Patrice Dumas  <pertusus@free.fr>

	* tp/t/40moresectioning.t (@test_out_files): set full_document.
	Minor change in comments.

2023-09-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (count_multibyte)
	(to_upper_or_lower_multibyte, width_multibyte): change resultbuf
	variable name to u8_text.
	Minor changes in comments.

2023-09-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (rebuild_document),
	tp/Texinfo/XS/main/build_perl_info.c (build_document),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (get_parser_info),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (build_document),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(rebuild_document): pass no_store as an optionnal possibly undef
	argument to the XS functions build_document and rebuild_document and
	handle it there instead of handling it in Parsetexi.pm
	get_parser_info.

2023-09-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (get_parser_info)
	(parse_texi_file, parse_texi_piece, parse_texi_text, parse_texi_line):
	turn the unused store argument into a no_store argument.  With
	no_store set in get_parser_info, XS tree and document information is
	removed as well as tree_document_descriptor and document_descriptor
	keys.

	* tp/Texinfo/TranslationsNonXS.pm (replace_convert_substrings):
	call parse_texi_line with the no_store XS data argument set, such that
	those trees cannot be retrieved by the XS converters.

	* tp/Texinfo/XS/convert/ConvertXS.xs (plain_texinfo_convert)
	(plain_texinfo_convert_tree, text_convert, text_convert_tree),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs (copy_tree):
	return undef and not a reference on undef.  Also modify copy_tree code
	in comments.

	* tp/Texinfo/Convert/Text.pm (convert_to_text): add debugging
	information for undefined XS Text, when XS Text is expected.

	* tp/Texinfo/XS/main/document.c (retrieve_document): do not retrieve a
	document with a tree unset.

2023-09-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal):
	pass empty string to text_heading.

2023-09-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal):
	do not add an end of line for empty @top.

2023-09-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal):
	fir email, url/uref and float arguments formatting.

2023-09-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (text_heading): fix condition
	on lookup_extra_integer section_level status.

2023-09-03  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/setup_converters_code_tables.pl (%commands_map): add \\.
	protect normalize_node_nobrace_symbol_text output too.

2023-09-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_utils.c (definition_arguments_content):
	only gather contents if there are def_line contents.

	* tp/Texinfo/XS/main/convert_utils.c (definition_category_tree):
	initialize result, return explicitly 0 when there are no contents
	or no class and no category.

	* tp/Texinfo/XS/main/convert_utils.c (definition_category_tree):
	fix deftypemethod command name in string.

2023-09-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal):
	add an end of line at the end of menu_entry instead of removing.

	* tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal):
	call brace_no_arg_command.

	* tp/Texinfo/XS/main/convert_to_text.c (brace_no_arg_command): check
	return value of unicode_brace_no_arg_command, initialize result, do
	not use to_upper_or_lower_multibyte.

2023-09-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/builtin_commands.c (element_builtin_cmd): map
	item to item_LINE if in table_term.

2023-09-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (text_heading): add heading
	number.

2023-09-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c
	(destroy_document_information_except_tree), tp/Texinfo/XS/main/utils.c
	(free_strings_list): move free_small_document_strings to main/utils.c
	and rename as free_strings_list.

	* tp/Texinfo/XS/main/convert_to_text.c (new_text_options): initialize
	options->include_directories.

	* tp/Texinfo/XS/convert/ConvertXS.xs (text_convert)
	(text_convert_tree), tp/Texinfo/XS/convert/convert_text.c
	(text_convert), tp/Texinfo/XS/main/get_perl_info.c
	(copy_sv_options_for_convert_text): pass options from perl to convert_to_text.

2023-09-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (ascii_accents_internal),
	tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal):
	do not call to_upper_or_lower_multibyte, there is an issue with memory
	management.

	* tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal):
	handle better some cases of missing arguments or invalid arguments.

2023-09-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/builtin_commands.c (element_builtin_cmd),
	tp/Texinfo/command_data.txt, tp/Texinfo/XS/main/builtin_commands.h:
	add element_builtin_cmd to map user-defined element commands to
	internal commands for class of user-defined commands,
	definfoenclose_command for @definfoenclose defined commands,
	and index_entry_command for @*index commands.  The internal
	commands flags are the right ones.

	* tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal):
	use element_builtin_cmd to have a command id in the range of the
	arrays of builtin_command_data and other similar arrays.
	Check of unset text.

	* tp/Texinfo/XS/parsetexi/input.c (parser_locate_include_file):
	return result.

2023-09-01  Patrice Dumas  <pertusus@free.fr>

	in tp/Texinfo/XS gnulib-tool --add-import uniwidth/u8-strwidth.

2023-09-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal):
	separate TEXT for block commands lines.  Initialize in_code and
	in_raw.  Other misc fixes.

	* tp/Texinfo/XS/main/convert_utils.c (definition_category_tree):
	initialize arg_category and arg_class.  Fix extra key, is def_role not
	role.  Copy arg_category before returning it.  Add element texts to
	output.

	* tp/Texinfo/XS/main/utils.c (locate_include_file): handle missing
	include directories.

2023-09-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (ConvertXS_la_LIBADD): add
	libtexinfoxs.la.

	* tp/Texinfo/Convert/Text.pm (import, _convert_tree_with_XS)
	(convert_to_text): interface to XS.

2023-09-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal),
	tp/Texinfo/XS/main/convert_utils.c (definition_arguments_content)
	(destroy_parsed_def, definition_category_tree),
	tp/Texinfo/XS/main/convert_utils.h (PARSED_DEF):
	finish implementation of conversion to text.  Implement
	definition_arguments_content and definition_category_tree.

	* tp/Texinfo/XS/convert/ConvertXS.xs (plain_texinfo_convert)
	(plain_texinfo_convert_tree): use get_perl_info.h functions.

	* tp/Texinfo/XS/convert/convert_plain_texinfo.c,
	tp/Texinfo/XS/convert/convert_plain_texinfo.h
	tp/Texinfo/XS/convert/ConvertXS.xs: rename plain_texinfo.h as
	convert_plain_texinfo.h to avoid clash in .h files names.

	* tp/Texinfo/XS/Makefile.am (ConvertXS_la_SOURCES),
	tp/Texinfo/XS/convert/ConvertXS.xs (text_convert_tree, text_convert):
	add XS interface for conversion to text as in Convert/Text.pm.

2023-08-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal),
	tp/Texinfo/XS/main/utils.c (decompose_integer)
	(enumerate_item_representation): implement enumerate item leading text
	output.

2023-08-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_utils.c (expand_verbatiminclude): fix
	returned value, and stop if file couldn't be opened.

2023-08-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Text.pm (%ignored_format_raw_commands): specific
	category for raw output formatting block commands.

	* tp/Texinfo/Convert/Text.pm (convert_tree, convert, _convert): always
	set options in functions calling _convert.

	* tp/Texinfo/Convert/Utils.pm (%month_name),
	tp/Texinfo/Convert/Text.pm (_convert): rename Texinfo::Convert::Utils
	%MONTH_NAMES as %month_name.

	* tp/Texinfo/Convert/Utils.pm (expand_verbatiminclude): do not set
	useless 'text_arg' extra of generated verbatim tree element.

	* tp/Texinfo/XS/main/tree_types.h (STRING_LIST),
	tp/Texinfo/XS/main/document.h: rename SMALL_STRINGS_LIST as
	STRING_LIST and move to main/tree_types.h.

	* tp/Texinfo/XS/main/utils.c (get_encoding_conversion)
	(reset_encoding_list, text_buffer_iconv, encode_with_iconv),
	tp/Texinfo/XS/main/utils.h (ENCODING_CONVERSION)
	(ENCODING_CONVERSION_LIST), tp/Texinfo/XS/parsetexi/api.c
	(reset_parser_except_conf), tp/Texinfo/XS/parsetexi/input.c
	(input_conversions, set_input_encoding, parser_reset_encoding_list):
	move code related to setting up conversions from set_input_encoding in
	parsetexi/input.c to main/utils.c, move reset_encoding_list,
	text_buffer_iconv and encode_with_iconv.  Use an
	ENCODING_CONVERSION_LIST structure to hold the list, space and number
	passed in argument to the functions.  Add parser_reset_encoding_list
	that calls the corresponding function with the parser
	ENCODING_CONVERSION_LIST.

	* tp/Texinfo/XS/main/utils.c (add_include_directory)
	(clear_include_directories, locate_include_file),
	tp/Texinfo/XS/parsetexi/api.c (reset_parser, parse_file),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line),
	tp/Texinfo/XS/parsetexi/input.c (parser_include_dirs_list)
	(parser_add_include_directory, parser_clear_include_directories)
	(parser_locate_include_file): move include directoories related
	functions from parsetexi/input.c to main/utils.c.  Add a STRING_LIST
	structure as arguments to those functions, and add parser specific
	corresponding functions, parser_add_include_directory,
	parser_clear_include_directories and parser_locate_include_file that
	call the functions with the parser directories list as argument.

	* tp/Texinfo/XS/main/convert_utils.c (convert_utils_month_name)
	(element_associated_processing_encoding, decode_string, encode_string)
	(convert_to_utf8, encoded_input_file_name, expand_verbatiminclude):
	implement expand_verbatiminclude, element_associated_processing_encoding
	and encoded_input_file_name.  For that also add decode_string,
	encode_string and convert_to_utf8 that allows to encode/decode from/to
	UTF-8, similarly to Encode::decode and Encode::encode. convert_to_utf8
	is a static version here, as it clashes with the version in
	parsetexi/input.c.

	* tp/Texinfo/XS/main/convert_to_text.c (convert_to_text_internal)
	(convert_to_text): implementation of arguments conversion for most
	commands.

2023-08-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_texinfo.c: remove the unused function
	node_extra_to_texi, link_element_to_texi is the functionnaly
	equivalent function adapted to the new calling and with the same name
	as in perl code.

2023-08-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (_XS_number_floats): fix function name.

2023-08-29  Patrice Dumas  <pertusus@free.fr>

	in tp/Texinfo/XS gnulib-tool --add-import uniwidth/u8-width

2023-08-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_text.c (underline_symbol)
	(text_heading), tp/Texinfo/XS/main/convert_utils.c
	(add_heading_number), tp/Texinfo/XS/main/utils.c (width_multibyte):
	implement add_heading_number and text_heading.

2023-08-29  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/setup_converters_code_tables.pl,
	tp/Texinfo/XS/main/unicode.h (COMMAND_UNICODE): add Texinfo::Unicode
	%unicode_character_brace_no_arg_commands, %unicode_map and
	%extra_unicode_map to a generated table in cmd_unicode.c named
	unicode_character_brace_no_arg_commands.

	* tp/Texinfo/XS/main/convert_to_text.c (brace_no_arg_command),
	tp/Texinfo/XS/main/unicode.c (unicode_point_decoded_in_encoding)
	(unicode_brace_no_arg_command): implement brace command formatting in
	text. Not tested.

2023-08-29  Patrice Dumas  <pertusus@free.fr>

	Implementation of accents on conversion to text (untested)

	* tp/Texinfo/XS/main/utils.c (count_multibyte): rename
	count_convert_u8 as count_multibyte.  Update callers.

	* tp/Texinfo/XS/main/utils.c (to_upper_or_lower_multibyte): add.

	* tp/Texinfo/Convert/Unicode.pm (%unicode_to_eight_bit),
	tp/Texinfo/XS/Makefile.am, tp/Texinfo/XS/main/unicode.c,
	tp/maintain/setup_accent_tables.pl: make %unicode_to_eight_bit our and
	generate a corresponding C structure with setup_accent_tables.pl in
	a file included in unicode.c.

	* tp/Texinfo/XS/main/node_name_normalization.c (protect_unicode_char):
	handle 0xFFFF with 4 characters hex string protected characters.

	* tp/Texinfo/XS/main/convert_to_text.c (ascii_accents_internal),
	tp/Texinfo/XS/main/unicode.c (format_eight_bit_accents_stack)
	(format_unicode_accents_stack_internal): use
	to_upper_or_lower_multibyte to uppercase or lowercase in
	ascii_accents_internal, format_eight_bit_accents_stack and
	format_unicode_accents_stack_internal.

	* tp/Texinfo/XS/main/unicode.c (compare_strings)
	(format_eight_bit_accents_stack)
	(format_unicode_accents_stack_internal), tp/Texinfo/XS/main/unicode.h
	(ENCODING_CODEPOINTS), tp/Texinfo/XS/main/convert_to_text.c
	(text_accents): implement format_eight_bit_accents_stack and
	finish implementation of other functions to have a complete
	implementation of text_accents.

2023-08-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/labels.c, tp/Texinfo/XS/parsetexi/labels.h,
	tp/Texinfo/XS/parsetexi/parser.h (labels_list, identifiers_target)
	(labels_number): declare extern labels.c data in parser.h and not in
	labels.h to avoid exposing parser global data to code including
	labels.h.

	* tp/Texinfo/XS/parsetexi/labels.c: declare labels_space static.

2023-08-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (count_convert_u8),
	tp/Texinfo/XS/parsetexi/parser.c: move count_convert_u8 from parser.c
	to utils.c.  Update users.

2023-08-28  Patrice Dumas  <pertusus@free.fr>

	in tp/Texinfo/XS gnulib-tool --add-import unicase/u8-toupper

2023-08-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (nodes_tree): do not produce a different
	tree with novalidate.

2023-08-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (build_single_index_data):
	store entry_associated_element.

	* tp/Texinfo/XS/structuring_transfo/transformations.c
	(relate_index_entries_to_table_items_in): @table @item command in tree
	is CM_item and not CM_item_LINE.

2023-08-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree_types.h (enum directions),
	tp/Texinfo/XS/main/utils.c (direction_names, direction_texts): follow
	the nodes directions order.

2023-08-28  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): use newly obtained $identifier_target for
	Texinfo::Structuring::units_directions.

2023-08-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/structuring.c
	(sectioning_structure): fix incrementation of section number.
	Handle appendix number better.

2023-08-28  Patrice Dumas  <pertusus@free.fr>

	* tp/t/18itemize.t (enumerate_more_letters): test representation
	above zz.

2023-08-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (number_floats),
	tp/Texinfo/XS/structuring_transfo/structuring.c (number_floats):
	simpler implementation tracking only the number of float in last
	chapter.

2023-08-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (move_index_entries_after_items): remove
	contents if empty.

2023-08-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/structuring.c
	(sectioning_structure): missed code for section numbers.

2023-08-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (number_floats): quote float index to
	force a representation as string in perl.

2023-08-28  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): if $ENV{TEXINFO_XS_CONVERT} is set,
	rebuild the tree based on the state of the XS tree after structuring.

2023-08-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/build_perl_info.c (build_document),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (get_parser_info): set
	tree_document_descriptor and document_descriptor in XS code.

2023-08-27  Patrice Dumas  <pertusus@free.fr>

	* tp/t/converters_tests.t: set full_document for html file tests too.

2023-08-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (converter): rename parser_info key
	as document_info.  Update users.

	* tp/Texinfo/Common.pm, tp/t/test_sort.t, tp/texi2any.pl: rename
	$parser_information variable as $document_information.

2023-08-27  Patrice Dumas  <pertusus@free.fr>

	* tp/t/20preformatted.t, tp/t/30sectioning.t (@test_out_files),
	tp/t/html_tests.t (mathjax_with_texinfo_enable_encoding, @test_cases)
	(@test_cases_text), tp/t/info_tests.t (@file_tests),
	tp/t/init_files_tests.t (@test_cases): do not set a file name if a
	piece of Texinfo is tested, set full_document if a file name is
	specified.

	* tp/t/test_utils.pl (test): warn if parse_texi_piece is used with
	a file name specified.

2023-08-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/structuring.c
	(set_menus_node_directions): set directions from first menu.

2023-08-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/structuring.c (nodes_tree):
	fix prev of first Top node child.

2023-08-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (sectioning_structure): quote section
	number such that perl always considers it a string.

	* tp/Texinfo/XS/main/build_perl_info.c (build_elements_contents_list)
	(build_document): setup nodes_list and sections_list.

	* tp/Texinfo/XS/main/build_perl_info.c (build_global_info),
	tp/Texinfo/XS/main/utils.c (delete_global_info),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (parse_texi_file),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs, tp/Texinfo/XS/parsetexi/api.c
	(parse_file): pass input_file_name and input_directory to XS through
	parse_file to store as global_info.

	* tp/Texinfo/XS/structuring_transfo/structuring.c
	(sectioning_structure): initialize command_unnumbered to 0.  Fix
	command numbers code.

	* tp/Texinfo/XS/structuring_transfo/structuring.c (number_floats):
	add float number to extra.

2023-08-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (sectioning_structure),
	tp/Texinfo/XS/structuring_transfo/structuring.c
	(sectioning_structure): do not set sectioning root as any sectioning
	element up.

	* tp/Texinfo/XS/structuring_transfo/structuring.c (nodes_tree):
	add to the node list without resetting the parent.

	* tp/Texinfo/XS/main/build_perl_info.c (build_perl_directions)
	(store_additional_info): add support of extra_direction.

	* tp/Texinfo/XS/main/build_perl_info.c (clean_texinfo_tree)
	(clean_additional_info, clean_source_mark_list, build_document):
	add functions to remove hv in elements such that a new tree can be
	rebuilt.  Call it right after exporting the tree to perl in
	build_document.

	* tp/Texinfo/Structuring.pm (import, rebuild_document),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(rebuild_document):

2023-08-27  Patrice Dumas  <pertusus@free.fr>

	* tp/t/automatic_menus.t (test), tp/t/test_tree_copy.t: remove return
	of Texinfo::Structuring::sectioning_structure, it is not useful and is
	better not used.

2023-08-27  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test), tp/texi2any.pl: do not use nodes
	lists or sections lists gathered when determining the structure, but
	from the document when the lists is needed.  Do not depend on
	nodes lists or sections lists gathered when determining the structure
	to decide whixh function to call.

2023-08-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (%common_converters_defaults)
	(converter), tp/Texinfo/Convert/*.pm, tp/ext/*.pm, tp/init/*.pm,
	tp/t/test_utils.pl (test), tp/texi2any.pl: remove 'structuring',
	use sections_list in document.

2023-08-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (get_parser_info),
	tp/Texinfo/XS/main/build_perl_info.c (build_document): have
	build_document return a blessed Texinfo::Document object.

2023-08-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c (register_document)
	(destroy_document_information_except_tree), tp/Texinfo/XS/main/utils.c
	(add_to_float_record_list, find_float_type)
	(float_list_to_listoffloats_list, destroy_listoffloats_list),
	tp/Texinfo/Document.pm (register, floats_information),
	tp/Texinfo/XS/main/build_perl_info.c (build_float_types_list)
	(build_document), tp/Texinfo/XS/parsetexi/Parsetexi.pm
	(get_parser_info): add conversion of floats list to a listoffloats
	list using the same float records structure differently, done right
	away in document, to have a structure similar to the floats structure
	in perl document, with types and list of floats by types.
	Rename Texinfo::Document and parser XS floats structure key as
	listoffloats_list and rename build_float_list as
	build_float_types_list in build_perl_info.c.

	* tp/Texinfo/Structuring.pm (import, XS_number_floats, number_floats),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(number_floats), tp/Texinfo/XS/structuring_transfo/structuring.c
	(number_floats): implement number_floats in XS.

2023-08-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/targets.c (set_labels_identifiers_target): remove
	check of index on redundant entries being past the end of the list,
	as it may happen legitimately if there are many redundant entries not
	exactly at the end.

	* tp/Texinfo/Structuring.pm,
	tp/Texinfo/XS/structuring_transfo/structuring.c: move functions to
	earlier in file to be before their use.

	* tp/Texinfo/Structuring.pm (check_nodes_are_referenced): minor
	modifications, use more intermediary variables, set variables earlier
	if used in diverse conditions.

	* tp/Texinfo/Structuring.pm (import, _XS_check_nodes_are_referenced)
	(check_nodes_are_referenced),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(check_nodes_are_referenced),
	tp/Texinfo/XS/structuring_transfo/structuring.c
	(register_referenced_node, compare_strings)
	(check_nodes_are_referenced): implement check_nodes_are_referenced in
	XS.

2023-08-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (@node_directions_names): rename
	@node_directions as @node_directions_names.

	* tp/Texinfo/Structuring.pm (_first_menu_node): use
	_normalized_entry_associated_internal_node in _first_menu_node.
	Move code around.

	* tp/Texinfo/Structuring.pm (complete_node_tree_with_menus): update
	code to use more intermediary variables, rearrange conditions, set
	variables earlier if used in diverse conditions.

	* tp/Texinfo/XS/structuring_transfo/structuring.c
	(set_menus_node_directions): do nothing if there are no menu. Complete
	missing code.

	* tp/Texinfo/XS/structuring_transfo/structuring.c: move code around.

	* tp/Texinfo/Structuring.pm (import, complete_node_tree_with_menus)
	(_XS_complete_node_tree_with_menus),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(complete_node_tree_with_menus),
	tp/Texinfo/XS/structuring_transfo/structuring.c (first_menu_node)
	(complete_node_tree_with_menus): implement
	complete_node_tree_with_menus in XS (without the use of configuration
	variables).

2023-08-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): avoid unwanted
	autovivification.

2023-08-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/extra.c (lookup_extra_string),
	tp/Texinfo/XS/structuring_transfo/structuring.c: add lookup extra
	function tailored for strings.

	* tp/Texinfo/Structuring.pm (set_menus_node_directions): change
	variable names, correct code for detailmenu.

	* tp/Texinfo/Structuring.pm (import, _XS_set_menus_node_directions)
	(set_menus_node_directions),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(set_menus_node_directions),
	tp/Texinfo/XS/structuring_transfo/structuring.c (check_menu_entry)
	(set_menus_node_directions): implement set_menus_node_directions XS.

2023-08-25  Patrice Dumas  <pertusus@free.fr>

	New transformation to protect first parenthesis in tree label elements

	* tp/Texinfo/Transformations.pm (import)
	(_protect_first_parenthesis_in_targets)
	(_XS_protect_first_parenthesis_in_targets)
	(protect_first_parenthesis_in_targets),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(protect_first_parenthesis_in_targets),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(protect_first_parenthesis_in_targets_internal)
	(protect_first_parenthesis_in_targets)
	Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm
	(_normalize_texinfo_name): new transformation,
	protect_first_parenthesis_in_targets, based on
	protect_first_parenthesis, that protect the first parenthesis in all
	the target element labels.  Use it in
	Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm.

	* tp/t/test_protect_contents.t: base test on
	protect_first_parenthesis_in_targets.

	* tp/Texinfo/Common.pm (get_label_element): handle an input element
	without command name.

2023-08-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (digit_chars, parse_line_directive),
	tp/Texinfo/XS/parsetexi/parser.c (check_line_directive): put the
	parsing of a line directive out of parser.c check_line_directive
	to utils.c parse_line_directive.

	* tp/Texinfo/Transformations.pm (import)
	(_XS_protect_hashchar_at_line_beginning)
	(protect_hashchar_at_line_beginning),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(protect_hashchar_at_line_beginning),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(protect_hashchar_at_line_beginning_internal)
	(protect_hashchar_at_line_beginning): implement
	protect_hashchar_at_line_beginning in XS.

2023-08-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm: use Texinfo::Convert::Texinfo
	instead of requiring.

	* tp/t/test_utils.pl (test), tp/texi2any.pl: call import method
	of modules if they aree require'd and not use'd.

2023-08-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (check_nodes_are_referenced)
	(set_menus_node_directions, complete_node_tree_with_menus)
	(number_floats), tp/t/test_utils.pl (test), tp/texi2any.pl: use a
	document in argument instead of data available in document.

	* tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(fill_gaps_in_sectioning): do not return a perl structure, it does not
	match with the perl tree.

	* tp/Texinfo/Structuring.pm, tp/Texinfo/Transformations.pm: move XS
	overriden functions around.

2023-08-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm (register_document_nodes_list)
	(register_document_sections_list, nodes_list, sections_list),
	tp/Texinfo/XS/main/document.c (register_document_nodes_list)
	(register_document_sections_list),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(sectioning_structure, nodes_tree), tp/t/test_utils.pl (test),
	tp/texi2any.pl: add functions to register nodes lists and sections
	lists in a document and use them.

2023-08-25  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): use nodes_list for nodes tests results
	instead of top node.

2023-08-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (set_menus_node_directions): remove code
	related to simple menus which support have been removed.

2023-08-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(nodes_tree), tp/Texinfo/XS/structuring_transfo/structuring.c
	(nodes_tree): remove top_node out argument.

2023-08-25  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test), tp/texi2any.pl b/tp/texi2any.pl,
	tp/Texinfo/Convert/Info.pm (output): determine top node with
	identifiers_target instead of {'structuring'}->{'top_node'}
	in Info.pm.  Remove now unused {'structuring'}->{'top_node'}.

	* tp/Texinfo/Structuring.pm (check_nodes_are_referenced)
	(complete_node_tree_with_menus, nodes_tree), tp/t/test_utils.pl
	(test), tp/texi2any.pl: do not have nodes_tree return the 'top_node'.
	Codes needing a top node are better off deciding what a top node means
	in their context.  Remove unused top_node argument of
	complete_node_tree_with_menus.  Set top_node explicitly in
	test_utils.pl and check_nodes_are_referenced.

2023-08-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (import, _XS_protect_colon_in_tree)
	(protect_colon_in_tree, _XS_protect_comma_in_tree)
	(protect_comma_in_tree, _XS_protect_node_after_label_in_tree)
	(protect_node_after_label_in_tree),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(protect_colon_in_tree, protect_comma_in_tree)
	(protect_node_after_label_in_tree): XS overrides for
	protect_colon_in_tree, protect_comma_in_tree and
	protect_node_after_label_in_tree.

2023-08-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (nodes_tree): use a document in input.
	Update callers.

	* tp/Texinfo/Structuring.pm (nodes_tree): directions to external
	manuals point to the node arguments elements directly.

	* tp/Texinfo/XS/main/utils.c (direction_names, direction_texts)
	(directions_length): setup extern structures related to directions in
	utils.c.

	* tp/Texinfo/Structuring.pm (import, _XS_nodes_tree, nodes_tree),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs (nodes_tree),
	tp/Texinfo/XS/structuring_transfo/structuring.c
	(section_direction_associated_node, nodes_tree): implement nodes_tree
	in XS.

2023-08-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (protect_first_parenthesis): take an element in
	argument and modify it directly. Simplify the code. Update callers.

	* tp/Texinfo/Transformations.pm (_new_node): reorganize code.

	* tp/Texinfo/Transformations.pm (_reassociate_to_node): remove useless
	condition.

	* tp/Texinfo/Transformations.pm
	(insert_nodes_for_sectioning_commands): use copy_contents instead of
	copy_tree.

	* tp/Texinfo/Transformations.pm (import)
	(insert_nodes_for_sectioning_commands)
	(_XS_insert_nodes_for_sectioning_commands),
	tp/Texinfo/XS/main/convert_to_texinfo.c
	(root_heading_command_to_texinfo), tp/Texinfo/XS/main/targets.c
	(destroy_label_list, sort_labels_identifiers_target)
	(register_label_in_list, add_element_to_identifiers_target)
	(existing_label_error, register_label_element),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(insert_nodes_for_sectioning_commands),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(protect_first_parenthesis, new_node, reassociate_to_node)
	(insert_nodes_for_sectioning_commands, protect_comma)
	(protect_comma_in_tree, protect_node_after_label)
	(protect_node_after_label_in_tree): implement
	insert_nodes_for_sectioning_commands in XS, and protect_comma_in_tree,
	protect_node_after_label_in_tree, protect_first_parenthesis, new_node,
	register_label_element.

2023-08-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c (register_document): put document
	descriptor in the document structure for use in error messages in
	downstream code.

	* tp/Texinfo/XS/Makefile.am (libtexinfoxs_la_SOURCES),
	main/get_perl_info.c (get_document_or_warn, get_sv_tree_document)
	(get_sv_document_document),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs: add
	functions to get document from tree or doocument for use in XS code.

	* tp/t/automatic_nodes.t: remove unneeded code, update.

2023-08-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Transformations.pm (regenerate_master_menu): use a
	document as input.  Update callers.

	* tp/Texinfo/Structuring.pm
	(_normalized_entry_associated_internal_node): $identifier_target
	argument is not optional, and return only the node.  Update callers.

	* tp/Texinfo/Transformations.pm (regenerate_master_menu),
	tp/Texinfo/Structuring.pm (new_master_menu, _print_down_menus): pass
	$use_sections down to new_complete_node_menu.

	* tp/Texinfo/Structuring.pm (_print_down_menus): reorganize code.

	* tp/Texinfo/Structuring.pm (regenerate_master_menu): reorganize code.

	* tp/Texinfo/Transformations.pm (import, regenerate_master_menu)
	(_XS_regenerate_master_menu),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(regenerate_master_menu),
	tp/Texinfo/XS/structuring_transfo/structuring.c
	(normalized_entry_associated_internal_node, print_down_menus)
	(new_master_menu), tp/Texinfo/XS/structuring_transfo/transformations.c
	(regenerate_master_menu): implement regenerate_master_menu in XS.

	* tp/t/do_master_menu.t: remove unused trees setting.

	* tp/t/10menu.t (empty_leading_menu_comment), tp/Makefile.tres: new test.

2023-08-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Transformations.pm (import)
	(complete_tree_nodes_missing_menu)
	(_XS_complete_tree_nodes_missing_menu),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(complete_tree_nodes_missing_menu),
	tp/Texinfo/XS/structuring_transfo/structuring.c
	(new_complete_node_menu),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(complete_tree_nodes_missing_menu): implement
	complete_tree_nodes_missing_menu in XS.

2023-08-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (copy_contents), tp/Texinfo/Structuring.pm
	(new_node_menu_entry, _print_down_menus), tp/Texinfo/XS/main/utils.c
	(copy_contents): pass element as first copy_contents argument and
	return an element. Add a type as second argument. Add C version.

	* tp/Texinfo/Structuring.pm (new_block_command)
	(new_complete_node_menu, new_master_menu),
	tp/Texinfo/Transformations.pm (complete_node_menu): pass
	new_block_command an element with contents and parent already set and
	use that element as the block command element.  Remove the parent
	argument.

	* tp/Texinfo/Structuring.pm (normalized_menu_entry_internal_node):
	new function taken from _normalized_entry_associated_internal_node
	that determine the normalized menu_entry node for internal nodes.

	* tp/Texinfo/Transformations.pm (complete_node_menu): use
	normalized_menu_entry_internal_node instead of
	_normalized_entry_associated_internal_node.

	* tp/Texinfo/Transformations.pm (import, complete_tree_nodes_menus)
	(_XS_complete_tree_nodes_menus), tp/Texinfo/XS/Makefile.am
	(StructuringTransfo_la_CPPFLAGS),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(complete_tree_nodes_menus),
	tp/Texinfo/XS/structuring_transfo/structuring.c (new_block_command)
	(normalized_menu_entry_internal_node)
	(get_node_node_childs_from_sectioning, new_node_menu_entry),
	tp/Texinfo/XS/structuring_transfo/transformations.c
	(prepend_new_menu_in_node_section, struct EXISTING_ENTRY)
	(complete_node_menu, get_non_automatic_nodes_with_sections)
	(complete_tree_nodes_menus, new_asis_command_with_text, protect_text)
	(protect_colon, protect_colon_in_tree: implement complete_tree_nodes_menus
	in XS and protect_colon_in_tree in C.

	* tp/Texinfo/Structuring.pm (_register_menu_node_targets): use
	_normalized_entry_associated_internal_node.

	* tp/Texinfo/Structuring.pm (get_node_node_childs_from_sectioning):
	rearrange code.

	* tp/texi2any.pl: get float information only where needed.

2023-08-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (warn_non_empty_parts): take a document in
	argument instead of global_commands information.  Update callers.

	* tp/Texinfo/Structuring.pm (import, warn_non_empty_parts)
	(_XS_warn_non_empty_parts),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(warn_non_empty_parts),
	tp/Texinfo/XS/structuring_transfo/structuring.c
	(warn_non_empty_parts): implement warn_non_empty_parts in XS.

2023-08-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/builtin_commands.h (command_other_flags):
	rename builtin_command_other_flags as command_other_flags as there is
	no ambiguity.  Update callers.

	* tp/Texinfo/XS/main/utils.c (is_content_empty),
	tp/Texinfo/XS/structuring_transfo/transformations.c: move from
	transformations.c to utils.c.

2023-08-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (%appendix_commands)
	(%unnumbered_commands), tp/Texinfo/XS/main/builtin_commands.h,
	tp/Texinfo/XS/main/command_data.awk, tp/Texinfo/command_data.txt: add
	appendix and unnumbered flags to commands data.

	* tp/Texinfo/Structuring.pm (sectioning_structure): use only $level in
	code determining the section number, and set the extra section_level
	afterwards.  Rearrange code.

	* tp/Texinfo/XS/main/extra.c (lookup_extra_integer): new function to
	ease getting an integer from extra information.

	* tp/Texinfo/XS/main/utils.c (section_level),
	tp/Texinfo/XS/structuring_transfo/transformations.c: move from
	transformations.c.  Return a negative value if the command is not
	supposed to be associated to a level.

	* tp/Texinfo/XS/main/extra.c (add_extra_directions)
	(lookup_extra_directions), tp/Texinfo/XS/main/tree.c
	(destroy_associated_info, element_set_empty_contents),
	tp/Texinfo/XS/main/tree_types.h (enum extra_type, enum directions),
	tp/Texinfo/XS/main/utils.c (copy_associated_info)
	(associate_info_references): add extra_directions extra type, similar
	to extra_contents, but accepting null elements in contents and always
	initialized with 3 elements.

	* tp/Texinfo/Structuring.pm (import, sectioning_structure)
	(_XS_sectioning_structure),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(sectioning_structure),
	tp/Texinfo/XS/structuring_transfo/structuring.c
	(sectioning_structure): implement sectioning_structure in XS.

2023-08-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (sectioning_structure): do not return
	the section root, return undef if there are no sections.  If needed,
	the section root may be found as upper section tree element
	or with {'sections_list'}->[0]->{'extra'}->{'sectioning_root'}.
	Do not store 'sectioning_root' in 'structuring'.  Update codes
	that used {'structuring'}->{'sectioning_root'}.

2023-08-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (sectioning_structure): put sectioning
	root directly in the extra key of the first section to have it in the
	regular tree as extra out of tree element.

2023-08-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (%extra_directions, _copy_tree)
	(_copy_extra_info): handle *_directions extra keys that do not contain
	directly a reference to tree elements, but contain next, prev and up
	keys which values are references to tree elements.

	* tp/t/test_tree_copy.t: test copy with sectioning structure set.

2023-08-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am: indent all the lines of a rule with tabs.

2023-08-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (sectioning_structure): reset $level
	after modifying the section level for a more readable code.
	Initialize extra section_directions once at the beginning.

	* tp/Makefile.tres, tp/t/30sectioning.t (part_section_part): new test.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML (_convert_unit_type), tp/ext/epub3.pm
	(epub_convert_unit_type): rename _convert_tree_unit_type as
	_convert_unit_type and epub_convert_tree_unit_type as
	epub_convert_unit_type.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML (_prepare_conversion_units): rename
	_prepare_conversion_tree_units as _prepare_conversion_units.
	Rename 'tree_units' as 'document_units'.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML: rename current_root_element as
	current_output_unit.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML (unit_element_command): rename
	tree_unit_element_command as unit_element_command.  Change variables
	names.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML: rename tree_unit_file_name as
	unit_file_name.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi: refer more to output units.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (units_directions)
	(units_file_directions): rename elements_directions as
	units_directions and elements_file_directions as
	units_file_directions.  Update callers.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (_output_unit_section)
	(_output_unit_node): rename _tree_unit_section as _output_unit_section
	and _tree_unit_node as _output_unit_node.  Rename some variables.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (set_output_unit_file)
	(_set_output_units_files, initialize_output_units_files)
	(_convert_document_units): rename set_tree_unit_file as
	set_output_unit_file, rename _set_tree_units_files as
	_set_output_units_files, rename initialize_tree_units_files as
	initialize_output_units_files.  Update callers.  Rename
	_convert_document_tree_units as _convert_document_units.

	* tp/Texinfo/Convert/HTML.pm (global_direction): rename
	global_direction_element as global_direction.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (unit_or_external_element_texi):
	rename root_or_external_element_cmd_texi as
	unit_or_external_element_texi.  Update callers.

	* tp/Texinfo/Convert/Converter.pm, tp/Texinfo/Convert/Plaintext.pm,
	tp/Texinfo/Structuring.pm: rename $tree_unit and similar variable as
	$output_unit.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (unit_is_top_output_unit): rename
	element_is_tree_unit_top as unit_is_top_output_unit.  Update callers.

	* tp/Texinfo/Convert/HTML.pm ($self->{'global_target_directions'}):
	rename global_target_elements_directions as global_target_directions.

	* tp/Texinfo/Convert/HTML.pm, tp/init/book.pm: rename $tree_unit as
	$output_unit and similar variable names renaming all over.

	* doc/texi2any_api.texi: rename all over element units, elements
	output element units, tree units as output units when relevant.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl ($nr_comparisons, test): enable comparison of
	floats results.

	* p/Texinfo/Convert/Converter.pm (float_type_number)
	(float_name_caption), tp/Texinfo/Convert/Plaintext.pm (_convert),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/Structuring.pm (number_floats), tp/t/test_utils.pl: put
	float_number in extra instead of structure.  No more structure key.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (split_pages),
	tp/Texinfo/Convert/Converter.pm (_set_tree_units_files),
	tp/Texinfo/Convert/HTML.pm (_html_set_pages_files): put
	'first_in_page' directly in tree unit.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm: update POD.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_special_elements): fix
	frames special elements hashes.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (_register_menu_node_targets)
	(check_nodes_are_referenced, set_menus_node_directions)
	(complete_node_tree_with_menus): determine if a node is in a menu
	dynamically instead of with {'structure'}->{'menu_up_hash'}.
	Remove {'structure'}->{'menu_up_hash'}.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): setup menu results based on the nodes
	list, like the generated result is now.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (_first_menu_node)
	(set_menus_node_directions, complete_node_tree_with_menus)
	(elements_directions), tp/texi2any.pl, tp/t/test_utils.pl: determine
	menu_child dynamically with _first_menu_node instead of adding the
	information to the tree.  For that, pass $identifier_target to
	complete_node_tree_with_menus.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (set_menus_node_directions): set
	menu_child only for the first menu when there are multiple menus.

	* tp/Texinfo/Structuring.pm (complete_node_tree_with_menus): use
	a variable to hold $node->{'structure'}->{'menu_child'} once for all.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm, tp/Texinfo/Convert/HTML.pm,
	tp/t/test_utils.pl: move associated_unit from structure directly in
	the element.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm, tp/Texinfo/Convert/*.pm,
	tp/t/test_utils.pl: replace node directions {'structure'}->{'node_*'}
	by {'extra'}->{'node_directions'}->{'*'}.  Fix some unexpected
	autovivification.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm, tp/t/test_utils.pl: replace menu
	directions {'structure'}->{'menu_*'} by
	{'extra'}->{'menu_directions'}->{'*'}.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm, tp/Texinfo/Convert/*.pm,
	tp/t/test_utils.pl: Replace {'structure'}->{'section_*'} by
	{'extra'}->{'section_directions'}->{*} and {'structure'}->{'toplevel_*'}
	by {'extra'}->{'toplevel_directions'}->{*}.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm, tp/Texinfo/Convert/*.pm, tp/ext/epub3.pm,
	tp/init/book.pm, tp/init/chm.pm: put section_level, section_number
	and section_childs in extra instead of structure.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm, tp/Texinfo/Convert/HTML.pm,
	tp/t/init/only_toc_out.init: move tree unit directions out of
	structure directly in tree_unit.  Move 'special_element_variety'
	out of extra directly in tree_unit.

2023-08-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm, tp/Texinfo/Convert/*.pm, tp/ext/epub3.pm,
	tp/init/book.pm, tp/init/chm.pm, tp/t/init/t2h_singular.init,
	tp/t/test_utils.pl: move 'unit_filename' out of structure directly in
	tree_unit.  Move 'unit_command' out of extra directly in tree_unit.
	Replace {'structure'}->{'unit_next'} by {'tree_unit_directions'}->{'next'}
	and {'structure'}->{'unit_prev'} by
	{'tree_unit_directions'}->{'prev'}.

2023-08-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/extra.c (lookup_extra_contents),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command)
	(handle_block_command): add lookup_extra_contents with create argument
	to create the extra contents container if there is none.  Use for
	menus and authors.

2023-08-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/*/*.c: rename KEY_PAIR variables k to more descriptive
	names.  Replace some calls to lookup_extra by calls to
	lookup_extra_element.

	* tp/Texinfo/XS/main/convert_to_texinfo.c (expand_cmd_args_to_texi):
	use local KEY_PAIR for verb delimiter.

	* tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command):
	call fatal if subentry parent has no level set.

2023-08-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_enter_menu_entry_node)
	(_handle_other_command, _handle_line_command, _handle_block_command)
	(_handle_open_brace, _handle_close_brace): copy more source_info
	to have the same tree as the XS parser, even for invalid constructs
	such aas 2 commands on the same line.

	* tp/Texinfo/ParserNonXS.pm (_end_line_starting_block): do not reset
	source_info for float.

2023-08-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (relate_index_entries_to_table_items_in_tree)
	(_XS_relate_index_entries_to_table_items_in_tree),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(relate_index_entries_to_table_items_in_tree): do not pass
	indices_information to the XS
	relate_index_entries_to_table_items_in_tree.

	* tp/Texinfo/XS/main/utils.c (new_expanded_formats): return the
	formats.

	* tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs,
	tp/Texinfo/XS/main/translations.c, tp/Texinfo/XS/parsetexi/end_line.c:
	remove or comment out unused variables.

2023-08-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (section_level), tp/Texinfo/ParserNonXS.pm
	(%parser_state_initialization, _handle_line_command),
	tp/Texinfo/Transformations.pm (_correct_level),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command,
	tp/Texinfo/XS/structuring_transfo/transformations.c (section_level)
	(correct_level): rename extra key sections_level as level_modifier and
	sections_level parser state as sections_level_modifier.

	* tp/Texinfo/XS/structuring_transfo/transformations.c (section_level)
	(correct_level): do not check that key value is 0 before checking the
	integer value.

	* tp/Texinfo/XS/structuring_transfo/transformations.c (modify_tree):
	make clearer that the operation on tree should take care of destroying
	removed element.

2023-08-19  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/pod2texi.pl (_parsed_manual_tree): update
	Texinfo::Structuring::associate_internal_references call.

2023-08-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (associate_internal_references): use a
	document as argument.  Update callers.

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES),
	tp/Texinfo/XS/main/targets.c (compare_labels,
	set_labels_identifiers_target), tp/Texinfo/XS/main/document.c: add
	main/targets.c and move set_labels_identifiers_target to that file.

	* tp/Texinfo/XS/main/node_name_normalization.c
	(convert_to_normalized_internal), tp/Texinfo/XS/main/utils.c
	(collapse_spaces): move code from main/node_name_normalization.c
	to main/utils.c and make it a function, collapse_spaces.

	* tp/Texinfo/Structuring.pm (import, associate_internal_references)
	(_XS_associate_internal_references), tp/Texinfo/XS/Makefile.am
	(StructuringTransfo_la_SOURCES),
	tp/Texinfo/XS/structuring_transfo/structuring.c
	(associate_internal_references),
	tp/Texinfo/XS/main/convert_to_texinfo.c (link_element_to_texi)
	(target_element_to_texi_label, check_node_same_texinfo_code),
	tp/Texinfo/XS/main/node_name_normalization.c
	(convert_contents_to_identifier),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs
	(associate_internal_references), tp/Texinfo/XS/main/targets.c
	(compare_targets, find_identifier_target): implement
	associate_internal_references in XS code.

	* tp/Texinfo/Convert/Texinfo.pm (check_node_same_texinfo_code),
	tp/Texinfo/Structuring.pm: add use re => '/a'.  Move
	check_node_same_texinfo_code to tp/Texinfo/Convert/Texinfo.pm for the
	use re => '/a'.

	* tp/Texinfo/Convert/Texinfo.pm (check_node_same_texinfo_code): use
	directly an {'extra'}->{'node_content'} as argument.  Update callers.

	* tp/Texinfo/XS/convert/ConvertXS.xs (plain_texinfo_convert)
	(plain_texinfo_convert_tree): use SV in argument, not HV.

2023-08-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/StructTransf.pm (BEGIN), tp/Texinfo/XS/Makefile.am
	(StructuringTransfo_la_SOURCES),
	tp/Texinfo/XS/structuring_transfo/StructuringTransfo.xs: rename
	StructTransf.xs as StructuringTransfo.xs (but keep the perl package
	defined in StructuringTransfo.xs name as StructTransf).  Move
	StructuringTransfo.xs and transformations.c from main to
	structuring_transfo directory.

2023-08-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (modify_tree),
	tp/Texinfo/XS/main/transformations.c (modify_tree): keep track of
	location in args or contents array instead of inserting from the end.
	Fix C code.

	* tp/Texinfo/Transformations.pm (_reference_to_arg): reset parent
	of contents kept from the reference argument.

	* tp/Texinfo/XS/main/transformations.c (reference_to_arg_internal):
	add a container, put the new element in it, copy contents only and fix
	parents.

2023-08-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (modify_tree),
	tp/Texinfo/XS/main/transformations.c (modify_tree): recurse
	into the original element only if not replaced.

2023-08-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Transformations.pm (_protect_hashchar_at_line_beginning)
	(protect_hashchar_at_line_beginning): simpler implementation.
	Only consider element with text like a cpp line, find index in
	parent contents and modify tree if first or preceded by a new line in
	text.  Inline _is_cpp_line.

	* tp/t/test_protect_hashchar_at_line_beginning.t ('after block end')
	('on quotation line'): new tests.

2023-08-16  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): remove call of duplicate_tree_element_keys
	and remove duplicate_tree_element_keys and _duplicate_element_keys
	as they are not useful since quite a long time, as the perl parser
	duplicates all the source_info.

	* tp/t/test_utils.pl: remove unused duplicate_key_array.

2023-08-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (modify_tree, _protect_text)
	(_move_index_entries_after_items)
	(_relate_index_entries_to_table_items), tp/Texinfo/Transformations.pm
	(_reference_to_arg, _reassociate_to_node)
	(_protect_hashchar_at_line_beginning), tp/t/test_utils.pl
	(_duplicate_element_keys): the function called by modify
	tree should now return a reference on an array holding the contents to
	be inserted, or undef, if the tree does not need to be modified.

	* tp/Texinfo/XS/main/transformations.c (is_content_empty): implement
	is_content_empty.

	* tp/Texinfo/XS/main/tree.c (remove_from_args): add.

	* tp/Texinfo/Transformations.pm (_XS_reference_to_arg_in_tree)
	(reference_to_arg_in_tree), tp/Texinfo/XS/main/StructTransf.xs
	(reference_to_arg_in_tree), tp/Texinfo/XS/main/transformations.c
	(reference_to_arg_internal, reference_to_arg_in_tree): implementation
	of reference_to_arg_in_tree in XS.

	* tp/Texinfo/Transformations.pm (_reference_to_arg): change name of
	$content variable to $arg.

2023-08-16  Patrice Dumas  <pertusus@free.fr>

	* tp/t/reference_to_text_in_tree.t (run_test): call convert_to_texinfo
	on the main tree, such that it will work with XS code registering
	in the main tree.

2023-08-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm, tp/Texinfo/XS/main/builtin_commands.h,
	tp/Texinfo/XS/main/command_data.awk, tp/Texinfo/command_data.txt: add
	non_formatted_brace to other flags.  Update callers.

2023-08-16  Patrice Dumas  <pertusus@free.fr>

	Add an other flags field in COMMAND

	* tp/Texinfo/XS/main/builtin_commands.h (COMMAND)
	(builtin_command_other_flags), tp/Texinfo/XS/main/command_data.awk:
	with command data used outside of parser, it is relevant to have all
	the flags available.  The flags not already there, called other flags,
	are put in another unsigned long in the COMMAND structure.

2023-08-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Transformations.pm (_reference_to_arg): use
	Texinfo::Common::is_content_empty to determine if content is empty.

	* tp/t/reference_to_text_in_tree.t (end of line, comment, empty asis):
	new test.

2023-08-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Text.pm (_ascii_accents): accept more than
	one character.

	* tp/Texinfo/ParserNonXS.pm (_text_contents_to_plain_text),
	tp/Texinfo/XS/parsetexi/parser.c (text_contents_to_plain_text): rename
	convert_to_text as text_contents_to_plain_text.  Update callers.

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES),
	tp/Texinfo/XS/main/convert_utils.c (find_innermost_accent_contents)
	(destroy_accent_stack), tp/Texinfo/XS/main/convert_utils.h
	(ACCENTS_STACK): implement find_innermost_accent_contents from
	Texinfo::Convert::Utils.

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES),
	tp/Texinfo/XS/main/convert_to_text.c (ascii_accent)
	(ascii_accents_internal, new_text_options, destroy_options)
	(text_accents): preliminary implementation of Texinfo::Convert::Text.

	* tp/Texinfo/XS/main/unicode.c (format_unicode_accents_stack_internal)
	(encoded_accents): unfinished implementations.

	* tp/Texinfo/XS/main/utils.c (isascii_alpha),
	tp/Texinfo/XS/parsetexi/end_line.c: move isascii_alpha to utils.c.

	* tp/Texinfo/XS/main/utils.c (expanded_formats)
	(clear_expanded_formats, add_expanded_format, new_expanded_formats)
	(format_expanded_p), tp/Texinfo/XS/parsetexi/handle_commands.c
	(parser_expanded_formats, clear_parser_expanded_formats)
	(add_parser_expanded_format, parser_format_expanded_p):
	move expanded formats related functions from handle_commands.c to
	utils.c and add a list as argument.  Add warppers to use in parser
	only in handle_commands.c.  Update callers.

	* tp/Texinfo/XS/main/utils.c (normalize_encoding_name),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line):
	add normalize_encoding_name to utils.c using code from end_line.c.

2023-08-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Transformations.pm (_reference_to_arg): replace
	link too.

	* tp/Texinfo/XS/Makefile.am (EXTRA_DIST, BUILT_SOURCES),
	tp/Texinfo/XS/main/node_name_normalization.c,
	tp/Texinfo/XS/main/transformations.c, tp/Texinfo/XS/main/unicode.c,
	tp/maintain/setup_converters_code_tables.pl: generate commands
	tables for C for sort_brace_no_arg_commands, nobrace_symbol_text and
	text_brace_no_arg_commands. Normalize names of command tables files.

	* tp/Texinfo/Convert/Text.pm (%sort_brace_no_arg_commands): make it
	our to be used in C table generation.

	* tp/Texinfo/XS/main/transformations.c (reference_to_arg_internal):
	unfinished implementation.

2023-08-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (move_index_entries_after_items): no next
	if empty, to correctly set previous.

	* tp/Texinfo/Common.pm (import)
	(move_index_entries_after_items_in_tree)
	(_XS_move_index_entries_after_items_in_tree),
	tp/Texinfo/XS/main/StructTransf.xs
	(move_index_entries_after_items_in_tree),
	tp/Texinfo/XS/main/transformations.c (move_index_entries_after_items)
	(move_index_entries_after_items_internal)
	(move_index_entries_after_items_in_tree): implement
	move_index_entries_after_items in XS.  Call it in addition to the
	perl function.

2023-08-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/transformations.c
	(relate_index_entries_to_table_items_in_tree): do not return the tree.

2023-08-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (move_index_entries_after_items),
	tp/t/index_before_item.t (run_test): do not return the tree
	from move_index_entries_after_items.

2023-08-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (move_index_entries_after_items):
	simplify code and avoid using an intermediary array.

2023-08-15  Patrice Dumas  <pertusus@free.fr>

	Remove SIMPLE_MENU customization option and tree transformation

	* NEWS, doc/texinfo.texi (HTML Customization Variables)
	(Other Customization Variables), tp/Makefile.tres,
	tp/Texinfo/Common.pm (@variable_string_settables)
	(%valid_tree_transformations), tp/Texinfo/Convert/HTML.pm
	(_in_preformatted_in_menu, _convert_menu_command)
	(_convert_menu_entry_type), tp/t/html_tests.t (menu, menu_in_example),
	tp/t/test_utils.pl (test), tp/texi2any.pl: remove SIMPLE_MENU
	customization option and simple_menu tree transformation and
	specific formatting in HTML.  It is not a good idea to have possibly
	different tree to represent a menu, and it is a burden to maintain.
	The transformations code in perl remain.

2023-08-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (Parsetexi_la_LDFLAGS)
	(Translations_la_LDFLAGS, StructTransf_la_LDFLAGS)
	(ConvertXS_la_LDFLAGS): remove linking flags for libraries not
	directly linked against.

2023-08-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (GNULIB_CPPFLAGS): rename AM_GNULIB as
	GNULIB_CPPFLAGS.

2023-08-15  Patrice Dumas  <pertusus@free.fr>

	* man/Makefile.am (pod2texi.1): use -r and sed to remove perl,
	Pod::Man and Pod::Simple versions, to avoid conflicts in version
	control system.

2023-08-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block):
	uncomment variable declaration (rebased from master with impacts
	earlier).

2023-08-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (get_parser_info): always
	register the document descriptor in perl document and tree.

	* tp/Texinfo/Common.pm (_relate_index_entries_to_table_items_in):
	remove the need for an intermediary array.

	* tp/Texinfo/XS/main/tree.c (insert_slice_into_args): add, for
	modify_tree in XS.

	* tp/Texinfo/Common.pm (import)
	(relate_index_entries_to_table_items_in_tree)
	(_XS_relate_index_entries_to_table_items_in_tree),
	tp/Texinfo/XS/main/StructTransf.xs
	(relate_index_entries_to_table_items_in_tree),
	tp/Texinfo/XS/main/transformations.c (indices_info_index_by_name)
	(lookup_index_entry, modify_tree)
	(relate_index_entries_to_table_items_in)
	(relate_index_entries_to_table_items_internal)
	(relate_index_entries_to_table_items_in_tree),
	tp/Texinfo/XS/main/tree_types.h (INDEX_ENTRY_AND_INDEX, INDEX_ENTRY):
	implement relate_index_entries_to_table_items_in_tree in XS.

	* tp/Texinfo/Structuring.pm (copy_tree, _XS_copy_tree),
	tp/Texinfo/XS/main/StructTransf.xs (copy_tree): call both the
	perl code and the XS code to have a copy for both contexts.
	Add the document descriptor information to the perl tree.

	* tp/Texinfo/Transformations.pm (fill_gaps_in_sectioning)
	(_XS_fill_gaps_in_sectioning): call both the perl code and the XS code
	to modify both trees.

	* tp/Texinfo/XS/parsetexi/indices.c: remove unused INDEX_ENTRY_REF
	structure.

2023-08-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am,
	tp/maintain/setup_converters_code_tables.pl: setup
	tp/Texinfo/XS/main/structuring_tables.c with
	Texinfo::Common::command_structuring_level and
	Texinfo::Common::level_to_structuring_command.

	* tp/Texinfo/Transformations.pm (import), tp/Texinfo/XS/Makefile.am
	(StructTransf_la_*), tp/Makefile.am (dist_modules_DATA),
	tp/t/test_fill_gaps_in_sectioning.t, Texinfo/XS/main/transformations.c
	(section_level, correct_level) (fill_gaps_in_sectioning),
	Texinfo/StructTransf.pm: add a new XS code, StructTransf.xs for
	Structuring and Transformations.  Add
	tp/Texinfo/XS/main/transformations.c for transformations and implement
	fill_gaps_in_sectioning, overriding fill_gaps_in_sectioning in
	tp/Texinfo/Transformations.pm with XS function.

	* tp/Texinfo/Structuring.pm (import),
	tp/Texinfo/XS/convert/ConvertXS.xs,: use Texinfo::StructTransf for
	copy_tree.

	* tp/Texinfo/XS/main/builtin_commands.h: add builtin_command_flags and
	builtin_command_name defines.

2023-08-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/translations.c: conditionalize includes and code
	on ENABLE_NLS.

2023-08-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (AM_GNULIB, AM_CPPFLAGS, *_la_CPPFLAGS)
	(libtexinfoxs_la_LIBADD, Parsetexi_la_LIBADD, Translations_la_LIBADD):
	separate gnulib flags from the remaining of AM_CPPFLAGS.  Do not use
	gnulib flags and do not link against gnulib if gnulib is not directly
	used, for most of the XS codes.

2023-08-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Transformations.pm
	(insert_nodes_for_sectioning_commands), Pod-Simple-Texinfo/pod2texi.pl
	(_parsed_manual_tree), tp/t/automatic_nodes.t, tp/t/test_utils.pl
	(test), tp/texi2any.pl: change tree in-place in
	insert_nodes_for_sectioning_commands and do not return a tree.  Update
	callers.

	* tp/Texinfo/Transformations.pm (complete_node_menu),
	tp/t/automatic_menus.t (menu not closed): do not remove and readd end.
	Add test of missing end menu.

2023-08-14  Patrice Dumas  <pertusus@free.fr>

	* doc/tp_api/Makefile.am (texi2any_internals_dependencies): use
	TranslationsNonXS.pm instead of Translations.pm.

2023-08-14  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/pod2texi.pl: always set manual name, using
	base name of file if title is not found.  Base the output file name
	on the manual name if there is no title.

	* Pod-Simple-Texinfo/pod2texi.pl: use stricter utf-8 in binmode
	encoding layer.

2023-08-14  Patrice Dumas  <pertusus@free.fr>

	Add a shared library for Perl XS common code among XS codes

	* tp/Texinfo/XS/Makefile.am (libtexinfoxs_la_SOURCES): add shared
	library using perl includes and link flags for codes common to diverse
	XS codes, containing only build_perl_info.c.  Move build_perl_info.c
	from parsetexi directory to main directory.

2023-08-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/build_perl_info.c: include libintl.h only
	if ENABLE_NLS.

	* tp/Texinfo/XS/parsetexi/build_perl_info.h: do not include errors.h.

2023-08-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/errors.c, tp/Texinfo/XS/main/text.c (xvasprintf):
	move xvasprintf to text.c.  Update callers.

	* tp/Texinfo/XS/main/errors.c, tp/Texinfo/XS/main/utils.c (bug, fatal)
	(ERROR_MESSAGE): move bug, fatal and ERROR_MESSAGE types to utils.c.
	Update callers.

2023-08-14  Patrice Dumas  <pertusus@free.fr>

	Update includes and move LOCALEDIR define

	* tp/Texinfo/XS/main/debug.c, tp/Texinfo/XS/main/extra.c,
	tp/Texinfo/XS/parsetexi/counter.c, tp/Texinfo/XS/parsetexi/indices.c,
	tp/Texinfo/XS/parsetexi/labels.c, tp/Texinfo/XS/parsetexi/source_marks.c:
	include stdlib.h for malloc/realloc.

	* tp/Texinfo/XS/main/document.h, tp/Texinfo/XS/main/errors.h,
	tp/Texinfo/XS/main/text.h, tp/Texinfo/XS/main/translations.h,
	tp/Texinfo/XS/main/tree_types.h,
	tp/Texinfo/XS/parsetexi/build_perl_info.h,
	p/Texinfo/XS/parsetexi/context_stack.h,
	tp/Texinfo/XS/parsetexi/input.h, tp/Texinfo/XS/parsetexi/labels.h,
	tp/Texinfo/XS/parsetexi/parser.h,
	tp/Texinfo/XS/parsetexi/source_marks.h:
	include stddef.h for size_t.

	* tp/Texinfo/XS/parsetexi/api.h,
	tp/Texinfo/XS/parsetexi/build_perl_info.c: move LOCALEDIR define to
	build_perl_info.c, where it is used.

2023-08-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (ultimate_index), tp/Texinfo/ParserNonXS.pm
	(%parser_state_initialization, _parse_texi, _parse_line_command_args),
	tp/Texinfo/Structuring.pm (merge_indices),
	tp/maintain/regenerate_commands_perl_info.pl,
	tp/Texinfo/XS/main/tree_types.h (INDEX),
	tp/Texinfo/XS/parsetexi/build_perl_info.c (build_single_index_data)
	(build_index_data), tp/Texinfo/XS/parsetexi/indices.c
	(resolve_indices_merged_in), tp/Texinfo/XS/parsetexi/parser.c
	(parse_texi): update merged_in index information at the end of
	parse_texi to take into account indices merged after the first
	index merge.
	Remove 'contained_indices' index information key, use ultimate_index
	in perl code instead, to determine dynamically index merged in.
	Use code similar to the XS parser in Perl parser.
	Have build_single_index_data return the hv instead of putting it in
	the tree.  Remove the hv and contained_hv fields of INDEX since they
	are now unused.

	* tp/Texinfo/XS/parsetexi/end_line.c (parse_line_command_args): change
	variable names to match Perl parser variable names.  Use
	ultimate_index.

2023-08-14  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/run_parser_all.sh: set LC_ALL=en_US to have translations of
	messages in document with XS code working.  Should be temporary.

2023-08-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Translations.pm (configure): rename init as configure to
	avoid clashing with the XSLoader init function name.

	* tp/Texinfo/TranslationsNonXS.pm (import, configure, _configure_XS),
	tp/Makefile.am (dist_modules_DATA), p/Texinfo/Translations.pm,
	tp/Texinfo/XS/main/Translations.xs (configure_XS), tp/Texinfo/XS/Makefile.am
	(xs_LTLIBRARIES, Translations_la_SOURCES),
	tp/Texinfo/XS/main/translations.c (configure): rename
	Texinfo/Translations.pm as Texinfo/TranslationsNonXS.pm.  Prepare XS
	code for Translations in tp/Texinfo/XS/main/Translations.xs.  Setup
	Texinfo/Translations.pm to load the main/Translations.xs XS code, but
	load the Texinfo/TranslationsNonXS.pm module as accompanying perl
	modules, since the specific XS module does not work.  In
	Texinfo/TranslationsNonXS.pm call _configure_XS and override with the
	configure_XS function from XS code, which calls configure in
	tp/Texinfo/XS/main/translations.c in order to setup the locales
	directory in the XS code too.

	* tp/Texinfo/XS/main/translations.c (switch_messages_locale): set line
	to null before each call of getline.

	* tp/Texinfo/XS/main/translations.c (switch_messages_locale)
	(translate_string): try to set the LANG encironment variable too in
	addition to switching locale to have LANGUAGE taken into account.
	This does not work to have LANGUAGES taken into account if locale is
	C.

	* tp/Texinfo/XS/main/translations.c (replace_convert_substrings):
	access replaced_substrings only if not NULL.

	* tp/Texinfo/XS/main/Translations.xs (gettree),
	Texinfo/XS/main/TranslationsXS.pm (gdt): setup code to replace gdt in
	XS.  The code is correct, but the approach is flawed, as there won't
	be any substitution if the trees in replaced substrings are not
	registered in C data, as is the case in general.
	This issue is the reason why in tp/Texinfo/Translations.pm the NonXS
	module is loaded.

2023-08-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Translations.pm (init), tp/t/test_utils.pl,
	tp/texi2any.pl: add an init method in tp/Texinfo/Translations.pm
	to pass the locales directory, which simply calls bindtextdomain.

2023-08-13  Patrice Dumas  <pertusus@free.fr>

	* tp/init/book.pm (book_convert_heading_command): sync with
	tp/Texinfo/Convert/HTML.pm.

2023-08-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/translations.c (replace_convert_substrings):
	fix debug message.

2023-08-13  Patrice Dumas  <pertusus@free.fr>

	Isolate better the C parser api in api.h

	* tp/Texinfo/XS/parsetexi/Parsetexi.xs: remove wipe_values,
	reset_context_stack and init_index_commands.

	* tp/Texinfo/XS/main/translations.c (replace_convert_substrings),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs, tp/Texinfo/XS/parsetexi/api.c
	(parser_set_debug, parser_set_documentlanguage_override)
	(parser_set_DOC_ENCODING_FOR_INPUT_FILE_NAME)
	(parser_set_input_file_name_encoding, parser_set_locale_encoding)
	(parser_store_value, parser_add_include_directory)
	(parser_clear_expanded_formats, parser_add_expanded_format)
	(parser_set_accept_internalvalue): rename conf_* functions in api
	not using CONF to parser_* functions.  Add parser_* function in api
	to wrap functions in specific files such that all the code that can
	call the C parser externally is in api.h or conf.h.

	* tp/Texinfo/XS/parsetexi/conf.c (reset_conf),
	tp/Texinfo/XS/parsetexi/conf.h (CONF): remove
	doc_encoding_for_input_file_name as it is not set through conf.

	* tp/Texinfo/XS/parsetexi/Parsetexi.xs (init): buildir is passed, not
	srcdir.

	* tp/Texinfo/XS/main/debug.c (set_debug_output): add set_debug_output
	such that debugging can be set through a function.

	* tp/Texinfo/XS/parsetexi/api.c (reset_parser)
	(parser_set_DOC_ENCODING_FOR_INPUT_FILE_NAME),
	tp/Texinfo/XS/parsetexi/input.c
	(set_doc_encoding_for_input_file_name): use a function,
	set_doc_encoding_for_input_file_name, to set
	doc_encoding_for_input_file_name.  Make
	doc_encoding_for_input_file_name, input_file_name_encoding and
	locale_encoding static variables.

2023-08-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/build_perl_info.c: remove unused variable.

2023-08-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Translations.pm (complete_indices),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (get_parser_info),
	tp/Texinfo/XS/parsetexi/indices.c (complete_indices): copy elements
	used from the tree.
	Use XS complete_indices in the XS parser.

	* tp/t/README: minor fix and change in language.

2023-08-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (copy_tree_internal): call
	increase_ref_counter on current element, not on new.

2023-08-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/debug.c (print_associate_info_debug)
	(print_element_debug_details): add printing detailed debug information
	on extra and info.

	* tp/Texinfo/Common.pm (debug_print_element_details): add info, change
	to be more like XS code.

2023-08-12  Patrice Dumas  <pertusus@free.fr>

	in tp/Texinfo/XS gnulib-tool --add-import unistr/u8-strlen

2023-08-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/builtin_commands.c,
	tp/Texinfo/XS/parsetexi/commands.c, tp/Texinfo/XS/parsetexi/parser.c:
	remove unused variables.

	* tp/Texinfo/XS/main/node_name_normalization.c
	(convert_to_normalized_internal): remore redundant parenthesis,
	replace by a grouping.

	* tp/Texinfo/XS/main/translations.c (replace_convert_substrings):
	use %zu for size_t in fprintf format.

	* tp/Texinfo/XS/main/unicode.c (normalize_NFC): use u8_strlen instead
	of strlen to match the type.

2023-08-12  Patrice Dumas  <pertusus@free.fr>

	XS interface for copy_tree in tests

	* tp/Texinfo/Structuring.pm (import, copy_tree, _copy_tree_with_XS)
	tp/Texinfo/XS/convert/ConvertXS.xs (copy_tree), tp/t/test_tree_copy.t:
	add interface for XS copy_tree in Texinfo::Structuring.  Used in tests
	only for now, as it works only on full trees.

2023-08-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (increase_ref_counter)
	(copy_associated_info, get_copy_ref, associate_info_references):
	fix precedence, remove unused variables, do not mix declarations
	and code.

2023-08-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/extra.c (lookup_associated_info_by_index)
	(lookup_extra_by_index): add functions that looks directly at
	an index and compare the key strings at this index only.  Not
	to be used in general, but when speed is important and extra
	keys addition is controlled.

	* tp/Texinfo/XS/main/utils.c (copy_tree_internal)
	(increase_ref_counter, copy_associated_info, get_copy_ref)
	(copy_extra_info, associate_info_references, copy_tree),
	tp/Texinfo/Common.pm (_get_copy_ref): implement copy_tree in
	XS.  Not tested for now.

2023-08-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (_copy_tree, _get_ref, _copy_extra_info):
	redo the implementation of tree copy without a hash associating
	element and copy, to be easier to implement in XS.  Put the copy
	with the initial element, add a counter to count refs seen after
	an element has been copied and go through the tree in the same order
	again in _copy_extra_info to get the missing references and remove the
	information about copy/counter.

	* tp/t/test_tree_copy.t: add a test with a manual tree with a
	reference to the beginning of the tree from within an extra tree.

2023-08-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (_copy_extra_info):
	remove code for impossible situations.  Inline
	_substitute_references_in_array.

2023-08-11  Patrice Dumas  <pertusus@free.fr>

	in tp/Texinfo/XS gnulib-tool --add-import setenv unsetenv

2023-08-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES),
	tp/Texinfo/XS/main/builtin_commands.c (element_command_name),
	tp/Texinfo/XS/main/builtin_commands.h,
	tp/Texinfo/XS/main/convert_to_texinfo.c (expand_cmd_args_to_texi),
	tp/Texinfo/XS/main/debug.c (debug_element_command_name)
	(print_element_debug), tp/Texinfo/XS/main/document.c
	(set_labels_identifiers_target),
	tp/Texinfo/XS/parsetexi/build_perl_info.c (element_to_perl_hash),
	tp/Texinfo/XS/parsetexi/*.c, tp/Texinfo/XS/parsetexi/commands.c
	(user_defined_command_data), tp/Texinfo/XS/parsetexi/commands.h,
	tp/Texinfo/XS/parsetexi/debug_parser.c (debug_parser_command_name)
	(print_element_debug_parser, debug_parser_print_element): add
	element_command_name to determine an element command name to be used
	outside of the parser instead of command_name, as the user-defined
	commands information is not present in that case and the info
	command_name information should be used.  Use that function in
	print_element_debug, debug_print_element and element_to_perl_hash.
	Add specific parser print_element_debug_parser and
	debug_parser_print_element functions corresponding to
	print_element_debug and debug_print_element, but that use command_name
	to determine the command name.  Use those functions in parser code.
	Move code using user-defined commands information out of
	main/builtin_commands.* to parsetexi/commands.*.

	* tp/Texinfo/ParserNonXS.pm (_handle_brace_command),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_brace_command): add
	command_name info to definfoenclose user-defined commands.

	* tp/Texinfo/Convert/Texinfo.pm (_expand_cmd_args_to_texi): check if
	command is defined, not if non 0.

2023-08-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_texinfo.c (expand_cmd_args_to_texi):
	use "command_name" info for index_entry_command types to get the
	command name, as command_name(cmd) cannot be used as the index
	commands are user-defined commands dynamically added in the parser.

2023-08-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c (register_document)
	(destroy_document_information_except_tree),
	tp/Texinfo/XS/main/errors.c (forget_errors),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (get_parser_info, _get_errors),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs, tp/Texinfo/XS/parsetexi/api.c
	(store_document), tp/Texinfo/XS/parsetexi/build_perl_info.c
	(convert_error, get_errors, build_document): store error_list in
	document.  Give the list and number of errors as arguments to
	get_errors.  Do not expose get_errors to perl, it is called in
	build_document instead.
	Give directly a message in argument of convert_error.

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (get_parser_info),
	tp/Texinfo/XS/parsetexi/indices.c (complete_indices): do not
	add the def_index_element and def_index_ref_element in
	complete_indices in XS, as the tree cannot be built with elements
	appearing twice.  Call Texinfo::Translations::complete_indices in
	Parsetexi.pm again until a copy of the elements is stored in the XS
	tree.

2023-08-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c (register_document)
	(free_small_document_strings)
	(remove_document), tp/Texinfo/XS/main/document.h (SMALL_STRINGS_LIST),
	tp/Texinfo/XS/parsetexi/api.c (store_document),
	tp/Texinfo/XS/parsetexi/input.c (forget_small_strings):
	add small strings to stored information.

	* tp/Texinfo/XS/parsetexi/api.c (store_document),
	tp/Texinfo/XS/parsetexi/indices.c (forget_indices),
	tp/Texinfo/XS/parsetexi/labels.c (forget_labels)
	(forget_internal_xrefs): use forget_* for function names that clear
	information on a list in the parser without freeing the memory.

2023-08-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/translations.c (switch_messages_locale): check
	that the locale returned by setlocale is not C nor POSIX before
	setting the working locale to that locale.

	* tp/Texinfo/XS/main/translations.c (translate_string): use
	setenv/unsetenv instead of putenv as putenv interface is difficult to
	use.

	* tp/Texinfo/XS/parsetexi/indices.c (complete_indices): finish the
	implementation.

	* tp/Texinfo/Translations.pm (complete_indices): rearrange code to be
	more similar with XS code.

2023-08-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/convert/ConvertXS.xs (plain_texinfo_convert_tree): XS
	function finding the document based on a tree and converting to
	Texinfo.  Use SV * for converters to allow for undef converter.

	* tp/Texinfo/Convert/PlainTexinfo.pm (import)
	(_convert_document_with_XS, _convert_tree_with_XS, convert)
	(convert_tree): rename _convert_with_XS as _convert_document_with_XS.
	Add _convert_tree_with_XS, overriden with XS function and use it for
	convert_tree.

	* tp/Texinfo/Convert/Texinfo.pm (import, convert_to_texinfo)
	(_convert_to_texinfo, _convert_tree_with_XS): in convert_to_texinfo
	call _convert_tree_with_XS if there is an XS tree associated to the
	perl tree.  Override _convert_tree_with_XS with ConvertXS
	plain_texinfo_convert_tree.  Add _convert_to_texinfo to do the actual
	conversion in case it is done in pure Perl.

	* tp/Texinfo/XS/convert/plain_texinfo.c: remove Perl headers includes.

2023-08-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/PlainTexinfo.pm (convert_tree, convert)
	(_convert_with_XS): call directly
	Texinfo::Convert::Texinfo::convert_to_texinfo.  Remove _convert.

2023-08-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (get_parser_info),
	tp/t/test_utils.pl (new_test): use the key 'tree_document_descriptor'
	to register the document descriptor associated to a tree instead of
	'document_descriptor'.

2023-08-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_misc_line),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line): add info
	command_name to be able to retrieve easily the command name in the
	XS codes.

2023-08-10  Patrice Dumas  <pertusus@free.fr>

	* tp/t/init/translation_in_parser_in_translation.pm: use more specific
	name for function to avoid clash with other init files.

2023-08-10  Patrice Dumas  <pertusus@free.fr>

	Remove simple_parser

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm, tp/Texinfo/ParserNonXS.pm
	(parser), tp/Texinfo/Translations.pm (replace_convert_substrings):
	remove simple_parser, information leaks among simple parsers, with
	customizable translation strings, any Texinfo command could end up
	processed by a simple parser and leak.

2023-08-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (get_conf, parser),
	tp/Texinfo/ParserNonXS.pm (%parser_state_initialization)
	(_setup_conf, get_conf): restrict variables found by get_conf, and set
	the values to the parser initialization values only.  What is found in
	the document has no effect.

	* tp/Texinfo/ParserNonXS.pm (simple_parser): more initializations.

2023-08-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_misc_line),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line),
	tp/Texinfo/Convert/DocBook.pm (_convert),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): set
	index_entry_command for empty index entry commands.

2023-08-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/09indices.t (empty_added_index_entry):
	add test for defined index empty entry.

2023-08-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree.c (reset_obstacks, alloc_element)
	(destroy_element): do not use obstacks, as it requires any code adding
	element to be able to access the struct obstack and it is not simple
	to make it happen outside of the parser (after a call to
	store_document).

2023-08-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/convert_to_texinfo.c
	(convert_to_texinfo_internal): only add add space or brace after
	command if not done in expand_cmd_args_to_texi.

	* tp/Texinfo/XS/main/convert_to_texinfo.c (convert_to_texinfo):
	initialize with an empty string to always return a string even for a
	document without content.

2023-08-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/PlainTexinfo.pm (_convert_with_XS): remove
	output() as the XS converrter is not ready yet.

2023-08-10  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl: use Texinfo::Convert::PlainTexinfo consistently
	to output file and compare.

2023-08-10  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): update for the change in
	fill_gaps_in_sectioning return.

2023-08-09  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_fill_gaps_in_sectioning.t: use parse_texi_text, to
	be sure that a tree is stored with the XS parser.

2023-08-09  Patrice Dumas  <pertusus@free.fr>

	* t/test_fill_gaps_in_sectioning.t: also use the test_correction
	function to test Texinfo::Transformations::_correct_level.

2023-08-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Transformations.pm (_correct_level): build a better
	tree, with spaces in commands argument.

	* t/test_fill_gaps_in_sectioning.t: update and test better
	correctness.

2023-08-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Transformations.pm (_correct_level): correct the
	command names, modify in-place.

	* tp/Texinfo/Transformations.pm (fill_gaps_in_sectioning): modify
	in-place the contents.  Go through the contents only once, without
	using another list.

2023-08-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files),
	t/init/translation_in_parser_in_translation.pm, tp/Makefile.tres,
	tp/t/init_files_tests.t (translation_in_parser_in_translation): add
	a test of translation in parser of def object type index entry,
	when already in a translation (of the Next button).

	* tp/Texinfo/Translations.pm: minor changes (variable name, commented
	out debug).

2023-08-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c
	(destroy_document_information_except_tree, remove_document)
	(unregister_tree): add unregister_tree to get the tree, destroy
	everything else and remove it from the registered documents.  This
	should be used when the tree becomes part of another tree.

	* tp/Texinfo/XS/main/errors.c (prepare_error_line_message): setup
	an error line message in the same way as the 'error_line' key in
	perl error structure.

	* tp/Texinfo/XS/main/translations.c (substitute)
	(substitute_element_array, replace_convert_substrings): finish
	implementation of gdt/replace_convert_substrings, with parser call and
	substitution of tree elements.

	* tp/Texinfo/Translations.pm (_substitute_element_array): keep the
	txiinternalvalue not found (which should never happen).

2023-08-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/indices.c (complete_indices),
	tp/Texinfo/XS/parsetexi/parser.c (parse_texi): call complete_indices
	with a document_descriptor argument.

2023-08-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/tree.c (insert_into_element_list)
	(remove_from_element_list): add generic functions for element lists
	that can be used on args and on contents.  Not currently used.

2023-08-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Report.pm (line_error): add a translation when a macro
	is involved.

2023-08-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser),
	tp/Texinfo/XS/parsetexi/parser.c (set_accept_internalvalue): give a
	value in input to set_accept_internalvalue.

	* tp/Texinfo/XS/parsetexi/input.c (convert_to_utf8): in a comment,
	give more reasons to use UTF-8.

2023-08-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Translations.pm (_substitute_element_array): use only
	tree elements for substring substitutions.  Update gdt callers
	and doc/texi2any_api.texi.

	* tp/Texinfo/Convert/Utils.pm (definition_arguments_content): return
	arguments as an element.  Update callers.

2023-08-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Translations.pm (replace_convert_substrings): remove
	the possibility to retrieve information from parser, it never
	worked for the XS parser and if information is used, it should
	come from customization_information through get_conf().

	* tp/Texinfo/ParserNonXS.pm (%parser_state_initialization)
	(%parser_state_configuration): move clickstyle and kbdinputstyle
	to %parser_state_initialization.

2023-08-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/utils.c (delete_global_info),
	tp/Texinfo/XS/parsetexi/parser.c (wipe_parser_global_info):
	rename wipe_global_info as wipe_parser_global_info.  Split
	code that free GLOBAL_INFO structure out of wipe_parser_global_info to
	utils.c, renaming it delete_global_info, and call delete_global_info
	in wipe_parser_global_info.

	* tp/Texinfo/XS/main/document.c (remove_document),
	tp/Texinfo/XS/parsetexi/indices.c (wipe_index): free all the
	document structures, using delete_global_info for GLOBAL_INFO.

	* tp/Texinfo/XS/parsetexi/Parsetexi.xs: expose remove_document.

	* tp/Texinfo/XS/parsetexi/api.c (store_document): properly copy
	multiple global commands and dircategory_direntry.

2023-08-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (get_parser_info)
	(parse_texi_text, parse_texi_line, parse_texi_file, parse_texi_piece),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs, tp/Texinfo/XS/parsetexi/api.c
	(reset_parser_except_conf, parse_file, parse_text, parse_string)
	(parse_piece, store_document), tp/Texinfo/XS/parsetexi/parser.c
	(parse_texi_document, parse_texi): do not expose store_document
	to perl code, always call it in parse_texi. Add root argument to
	store_document, remove the Root global variable (which was now
	always 0 oustide of parse_texi). Pass document_descriptor from
	parse_file, parse_text, parse_string, parse_piece,
	parse_texi_document, parse_texi. For parse_file, an error is now 0,
	was 1 previously, now 1 is a document_descriptor. Pass
	document_descriptor to get_parser_info in Parsetexi.pm.

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (_get_errors): remove unused
	$self argument.

	* tp/Texinfo/XS/parsetexi/build_perl_info.c: cleanup includes.

2023-08-08  Patrice Dumas  <pertusus@free.fr>

	Setup parsed document information in XS

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (get_parser_info),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs,
	tp/Texinfo/XS/parsetexi/build_perl_info.c (build_texinfo_tree)
	(build_target_elements_list, build_identifiers_target)
	(build_internal_xref_list, build_float_list, build_index_data)
	(build_global_info, build_global_info2, build_document):
	do not expose to perl code and add arguments for build_texinfo_tree,
	build_target_elements_list, build_identifiers_target,
	build_internal_xref_list, build_float_list, build_index_data and
	build_global_info* instead of using global variables. Add
	build_document that calls those functions on a stored document to build
	a perl document hash, like the one obtained from Texinfo::Document.
	Always store the document in get_parser_info Parsetexi.pm, and get a
	document directly from XS, using build_document.

	* p/Texinfo/XS/parsetexi/labels.c (unallocate_labels): do not free
	labels_list, it should be stored in document.

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (get_parser_info)
	(parse_texi_file): set document info, and not parser info, which is
	not used anymore.

	* tp/t/test_utils.pl (test): set document info, and not parser info,
	which is not used anymore.

2023-08-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/build_perl_info.c (build_global_info),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line),
	tp/Texinfo/XS/parsetexi/input.c (set_input_encoding)
	(encode_file_name), tp/Texinfo/XS/parsetexi/parser.c
	(wipe_global_info), tp/Texinfo/XS/parsetexi/separator.c
	(handle_close_brace): put global_input_encoding_name in global_info.

2023-08-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (rearrange_tree_beginning): rename self as
	document.

	* tp/Texinfo/Structuring.pm (new_master_menu, _print_down_menus)
	(_normalized_entry_associated_internal_node): rename labels as
	identifier_target.

	* tp/Texinfo/Transformations.pm (regenerate_master_menu): rename self
	as customization_information and labels as identifier_target.

2023-08-08  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/pod2texi.pl (_parsed_manual_tree)
	(_fix_texinfo_tree, _fix_texinfo_manual, _do_top_node_menu): pass
	document and not tree.  Use information from document.

2023-08-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm, tp/Texinfo/XS/parsetexi/Parsetexi.pm,
	tp/t/automatic_menus.t, tp/t/automatic_nodes.t, tp/t/do_master_menu.t,
	tp/t/test_sort.t: remove indices_information, floats_information,
	internal_references_information, global_commands_information,
	global_information and labels_information from parsers, this
	information should come from documents.

	* tp/Texinfo/ParserNonXS.pm (_parse_texi), tp/Texinfo/Translations.pm
	(complete_indices), tp/Texinfo/XS/parsetexi/Parsetexi.pm
	(get_parser_info): pass directly index_names as
	Texinfo::Translations::complete_indices argument.

	* tp/Texinfo/Translations.pm (replace_convert_substrings): do not
	try to get a parser from a document, as there is none associated.

	* tp/Texinfo/Structuring.pm (new_master_menu),
	tp/Texinfo/Translations.pm (_gdt, gdt, gdt_string, replace_substrings)
	(replace_convert_substrings, pgdt, complete_indices): rename self as
	customization_information.

2023-08-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (converter),
	tp/Texinfo/Convert/Text.pm (converter), tp/Texinfo/Translations.pm
	(replace_convert_substrings), tp/t/test_utils.pl (convert_to_*)
	(test), tp/texi2any.pl, util/texi-elements-by-size: rename the parser
	key in converter options as document.

	* tp/t/test_utils.pl (test): use main_configuration for the
	Texinfo::Structuring::elements_directions call.

	* tp/Texinfo/Convert/Text.pm (converter): do not take
	EXPANDED_FORMATS from parser/document.

2023-08-07  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm
	(_normalize_texinfo_name): update for parse_texi_piece that
	returns a document, not a tree.

2023-08-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (parse_texi_piece),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (parse_texi_piece): return a
	document, not a tree.  Update callers.

	* tp/t/test_utils.pl (test), tp/texi2any.pl: take information on
	document from $document, not from parser.

	* tp/Texinfo/Document.pm (register): fix key name.

	* tp/t/test_utils.pl: change in spacing.

2023-08-07  Patrice Dumas  <pertusus@free.fr>

	Partial XS implementation of Texinfo::Translations

	*  tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES),
	tp/Texinfo/XS/main/utils.c (isascii_lower, isascii_upper)
	(read_flag_name), tp/Texinfo/XS/parsetexi/indices.c
	(complete_indices), tp/Texinfo/XS/parsetexi/parser.c (parse_texi),
	(tp/Texinfo/XS/main/translations.c (switch_messages_locale)
	(translate_string, replace_substrings, replace_convert_substrings)
	(gdt, gdt_string, new_named_string_element_list)
	(reallocate_named_string_element_list)
	(add_string_to_named_string_element_list)
	(add_element_to_named_string_element_list)
	(destroy_named_string_element_list), tp/Texinfo/XS/main/translations.h
	(NAMED_STRING_ELEMENT_LIST):
	add isascii_lower and isascii_upper.  Move read_flag_name to utils.c.
	Add complete_indices partial implementation.  Add main/translations.c
	where most of the remaining of Texinfo::Translations is partially
	implemented, in particular gdt.

2023-08-07  Patrice Dumas  <pertusus@free.fr>

	Separate functions for translations returned as strings or Texinfo trees

	* doc/texi2any_api.texi (Translations Output and Customization)
	(Internationalization of Strings Function)
	(Translated Strings Customization, Translation Contexts),
	doc/texinfo.texi (Internationalization of Document Strings),
	tp/Texinfo/Convert/HTML.pm (gdt, gdt_string),
	tp/Texinfo/Translations.pm (_gdt, gdt, gdt_string, pgdt)
	(replace_convert_substrings, replace_substrings),
	tp/init/documentation_examples.pm,
	tp/t/init/special_element_customization.pm,
	tp/t/init/translated_strings_customization.pm: add gdt_string
	to return translated substituted strings, that goes along with
	replace_substrings.  gdt is only used to return trees now.  Update
	HTML functions customization.  Update callers.

	* po_document/Makevars (XGETTEXT_OPTIONS): add gdt_string.

	* tp/Texinfo/Translations.pm (_gdt): comment out $perl_encoding and
	$DEFAULT_PERL_ENCODING, they are not used anymore.

2023-08-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (nodes_tree): avoid warning about top_node
	not being defined.

2023-08-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES)
	(Parsetexi_la_SOURCES): put the parser code in the libtexinfo library,
	such that it can be linked against from other XS codes.  Use the same
	library than for the XS parser and converters common code as it seems
	simpler and more efficient (Gavin).

2023-08-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (Parsetexi_la_SOURCES),
	tp/Texinfo/XS/parsetexi/build_perl_info.c,
	tp/Texinfo/XS/parsetexi/build_perl_info.h,
	tp/Texinfo/XS/parsetexi/api.c, tp/Texinfo/XS/parsetexi/api.h:
	split out of api.c the api related to perl and put it in
	build_perl_info.c.  What remains in api.c can be moved to a
	separate library to be linked against by XS code.

2023-08-06  Patrice Dumas  <pertusus@free.fr>

	* po/POTFILES.in: update.

2023-08-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Translations.pm (gdt): test that encodings are defined,
	not non null.

2023-08-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Config.pm (get_conf): make sure that undef is returned if
	the variable was not found in case of standalone.

2023-08-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Utils.pm (find_innermost_accent_contents):
	return in the expected format even if there was a bug.

	* tp/Texinfo/Convert/Converter.pm (output): explicit return undef at
	the end.

2023-08-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (_command_init): explicitly
	return undef, otherwise the return value is not well defined.

	* tp/Texinfo/Translations.pm (_substitute_element_array): when
	replacing a substring by an array, put it as contents in a
	typeless container element.

2023-08-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/main/document.c (register_document),
	tp/Texinfo/XS/main/tree_types.h (FLOAT_RECORD, FLOAT_RECORD_LIST),
	tp/Texinfo/XS/main/utils.h (GLOBAL_INFO),
	tp/Texinfo/XS/parsetexi/parser.h,
	tp/Texinfo/XS/parsetexi/api.c (store_document),
	tp/Texinfo/XS/parsetexi/labels.c (unallocate_internal_xrefs):
	store floats, internal_references, identifiers_target and global_info
	in document.  Move GLOBAL_INFO declaration to main/utils.h
	and FLOAT_RECORD to main/tree_types.h.

	* tp/Texinfo/XS/parsetexi/api.c (reset_parser_except_conf),
	tp/Texinfo/XS/parsetexi/labels.c (wipe_identifiers_target): add
	wipe_identifiers_target and call it in reset_parser_except_conf.

2023-08-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (parse_texi_piece, parse_texi_line)
	(parse_texi_text, parse_texi_file, _parse_texi_document, _parse_texi):
	setup a document in _parse_texi such as to use the same code in all
	the parse_texi_* functions.

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (get_parser_info)
	(parse_texi_file, parse_texi_text, parse_texi_line, parse_texi_piece):
	get the tree and setup the document in get_parser_info.  New argument
	for get_parser_info, store, if true the C parsed tree is kept.  Use
	get_parser_info in all the parse_texi_* codes for simpler and more
	similar codes.

2023-08-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (get_parser_info)
	(_set_errors_node_lists_labels_indices, _get_errors, parse_texi_file)
	(parse_texi_line): do not call _set_errors_node_lists_labels_indices
	in parse_texi_line, only _get_errors.  Inline
	_set_errors_node_lists_labels_indices in get_parser_info.  Cosmetic
	changes to the code to be more consistent.

2023-08-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (_find_menus_of_node)
	(_associate_node_menus), tp/Texinfo/XS/parsetexi/handle_commands.c
	(handle_block_command): associate menus to nodes in the XS parser
	instead of as postprocessing in perl.  Remove _find_menus_of_node
	and _associate_node_menus in Parsetexi.pm.

2023-08-05  Patrice Dumas  <pertusus@free.fr>

	Renaming of labels as identifier_target for code coming from master

	* tp/Texinfo/Convert/Plaintext.pm (_convert), tp/t/do_master_menu.t:
	rename labels as identifier_target.

	Note that the renaming had already been done on 2023-08-03, but on
	a branch.  Rebased code with use of the old names from the master
	branch did not show up as conflict, although this code is
	incompatible.  Therefore, this fix would have been needed since
	this commit:

	2023-08-03  Patrice Dumas  <pertusus@free.fr>

		Rename labels as identifier_target and targets/targets_list as labels_list

2023-08-05  Patrice Dumas  <pertusus@free.fr>

	Determine elements used as targets in C

	* tp/Texinfo/XS/main/document.c (register_document, compare_labels)
	(set_labels_identifiers_target), tp/Texinfo/XS/main/utils.c
	(get_label_element), tp/Texinfo/XS/parsetexi/Parsetexi.pm
	(_set_errors_node_lists_labels_indices), tp/Texinfo/XS/parsetexi/api.c
	(store_document, build_identifiers_target),
	tp/Texinfo/XS/main/tree_types.h (LABEL, LABEL_LIST),
	tp/Texinfo/XS/parsetexi/labels.c (identifiers_target, register_label)
	(unallocate_labels, check_register_target_element_label),
	tp/Texinfo/XS/parsetexi/parser.c (parse_texi): add identifier and
	index in document in labels list, register labels list in document.
	Implement set_labels_identifiers_target to sort the labels list
	and remove the redundant or empty labels.  Call
	set_labels_identifiers_target in parse_texi, setting the global
	variable identifiers_target.  Use identifiers_target to setup the
	identifiers_target hash in perl with build_identifiers_target.

	* tp/Texinfo/XS/parsetexi/api.c, tp/Texinfo/XS/parsetexi/labels.c:
	rename target_elements_list as labels_list.

	* tp/Texinfo/Document.pm (_existing_label_error)
	(_add_element_to_identifiers_target, register_label_element): use
	identifiers order to have the same error messages order as in XS
	parser.

	* tp/Texinfo/XS/main/errors.c (line_error_internal, line_error_ext),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (_get_errors),
	tp/Texinfo/XS/parsetexi/api.c (convert_error): add a continuation
	argument for line_error_internal and line_error_ext.  Update callers,
	setting to 0 for other functions than line_error_ext.

2023-08-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES): add main/utils.c.

	* tp/Texinfo/XS/main/utils.c: include ctype.h.

2023-08-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/commands.c,
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block),
	tp/Texinfo/XS/parsetexi/multitable.c (item_line_parent),
	tp/Texinfo/XS/parsetexi/parser.c (parent_of_command_as_argument):
	remove item_line_command, inline it in former callers.

	* tp/Texinfo/XS/parsetexi/*.c: explicit include of commands.h when
	close_preformatted_command is used.

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block): rename
	cmd as as_argument_cmd in code block.

2023-08-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (SUBDIRS): revert previous change by removing again .
	from the front, such that compilation in the XS directory proceeds
	before checking in the current directory.

2023-08-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_def),
	tp/Texinfo/XS/parsetexi/def.c (parse_def): remove obsolete code
	corresponding to former design of linemacro args expansion.

2023-08-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/*.c: add explicit includes.

2023-08-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES)
	(Parsetexi_la_SOURCES): move node_name_normalization and
	unicode to main.

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES),
	tp/Texinfo/XS/main/utils.c (whitespace_chars, isascii_alnum),
	tp/Texinfo/XS/parsetexi/parser.c: move whitespace_chars and
	isascii_alnum to main, to a new file, utils.c, for code that does not
	fit anywhere else.

	* tp/Texinfo/XS/main/node_name_normalization.c
	(convert_to_normalized_internal): use builtin_command_data directly.

2023-08-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (SUBDIRS): process . first, to be sure that
	Texinfo/ModulePath.pm is created before going into Texinfo/XS.

	* tp/Texinfo/XS/Makefile.am (libtexinfo_la_SOURCES)
	(Parsetexi_la_SOURCES): put files used in libtexinfo in main from
	parsetexi and generate files in main too.  Add debug.c, error.c,
	extra.c, text.c to libtexinfo.  Move commands.c back to parsetexi.

	* tp/Texinfo/XS/main/builtin_commands.c (lookup_builtin_command)
	(compare_command_fn), tp/Texinfo/XS/parsetexi/commands.c
	(lookup_command): split the code related to builtin commands out of
	commands.c to builtin_commands.c.  Keep some information related to
	user defined commands when needed for macros, for instance
	command_name in builtin_commands.h.

	* tp/Texinfo/XS/main/extra.h: split extra.h out of parser.h.

	* tp/Texinfo/XS/Makefile.am (XSParagraph_la_SOURCES, xspara_text.c)
	(xspara_text.h): rename text.c used in xspara.c as xspara_text.c,
	similar for text.h, to avoid clash with the files in main/.

	* tp/Texinfo/XS/main/convert_to_texinfo.c (expand_cmd_args_to_texi):
	search directly in builtin_command_data.

	* tp/Texinfo/XS/main/errors.c (current_source_info),
	tp/Texinfo/XS/parsetexi/input.c: move current_source_info to errors.c.

2023-08-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (XSLIBS_CFLAGS, XSLIBS_LDFLAGS): rename
	xs_CFLAGS as XSLIBS_CFLAGS and xs_LDFLAGS as XSLIBS_LDFLAGS to avoid
	an interpretation in which there would be eomthing special about those
	variables in automake because they have the same prefix as the
	xs_LTLIBRARIES.  From Gavin.
	Add FIXMEs based on Gavin feedback.

2023-08-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (xs_CFLAGS, xs_LDFLAGS): split a regular
	library, libtexinfo out of Parsetexi for the code common with
	ConvertXS.  Add and use specific flags for XS objects.

2023-08-04  Patrice Dumas  <pertusus@free.fr>

	* p/Texinfo/XS/parsetexi/command_data.awk: add an include for
	command.h in command_data.c.

2023-08-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parse_texi_file)
	(parse_texi_piece, parse_texi_text, parse_texi_line),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (store_document),
	tp/Texinfo/XS/parsetexi/api.c (reset_parser_except_conf, parse_file)
	(parse_text, store_document): add function store_document to store the
	document and get the document_descriptor, called optionally for
	parse_texi_piece and parse_texi_line.  Add the document_descriptor to
	the tree too.

	* tp/Texinfo/XS/parsetexi/api.c (store_document),
	tp/Texinfo/XS/parsetexi/document.c (register_document),
	tp/Texinfo/XS/parsetexi/indices.c (reset_indices):
	Store the index_names table in the document.  Add reset_indices to
	reset the indices without unallocating them.

	* tp/Texinfo/Convert/PlainTexinfo.pm (output, _convert_with_XS),
	tp/Texinfo/XS/convert/ConvertXS.xs (plain_texinfo_convert),
	tp/Texinfo/XS/convert/plain_texinfo.c (plain_texinfo_convert):
	simple implementation of output in XS, which outputs a string
	on stderr.

2023-08-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (set_menus_node_directions, nodes_tree)
	(associate_internal_references): remove unused parser_information
	arguments.  Update callers.

2023-08-03  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/pod2texi.pl (_parsed_manual_tree),
	tp/Texinfo/Transformations.pm (insert_nodes_for_sectioning_commands),
	tp/t/automatic_nodes.t, tp/t/test_utils.pl (test), tp/texi2any.pl:
	add registrar and customization_information arguments for
	insert_nodes_for_sectioning_commands.  This is in line with _new_name
	arguments.  This is not very useful, right now, though, as we know
	that there cannot be any error reported, since the node names are
	adapted such as not to clash with existing label targets.

2023-08-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/NodeNameNormalization.pm, tp/Texinfo/Document.pm
	(_add_element_to_identifiers_target, set_labels_identifiers_target)
	(register_label_element), tp/Texinfo/ParserNonXS.pm (_parse_texi),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm
	(_set_errors_node_lists_labels_indices): move set_nodes_list_labels
	code from NodeNameNormalization to Texinfo::Document, renaming as
	set_labels_identifiers_target.  Split
	_add_element_to_identifiers_target out of the function and use it in
	register_label_element too.

	* tp/Texinfo/Transformations.pm (_new_node),
	Pod-Simple-Texinfo/pod2texi.pl (_parsed_manual_tree): pass registrar
	and customization_information arguments to register_label_element.

2023-08-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm (register_label_element): rename add_node as
	register_label_element. Update callers.

2023-08-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Document.pm (labels_information),
	tp/Texinfo/ParserNonXS.pm (labels_information),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (labels_information): do not
	return the labels_list.  Update callers.

	* tp/Texinfo/Common.pm (register_label), tp/Texinfo/ParserNonXS.pm
	(_check_register_target_element_label): remove
	Texinfo::Common::register_label.

	* Pod-Simple-Texinfo/pod2texi.pl (_parsed_manual_tree)
	(_do_top_node_menu): update use of labels_information and use
	Texinfo::Document::add_node.

2023-08-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (nodes_tree), tp/texi2any.pl,
	tp/t/test_utils.pl (test): use tree in input of nodes_tree and return
	the list of nodes.

	* tp/Texinfo/Convert/NodeNameNormalization.pm (set_nodes_list_labels),
	tp/Texinfo/Document.pm (register, labels_information),
	tp/Texinfo/ParserNonXS.pm (labels_information),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (labels_information): do not set
	'nodes_list'.  Do not return nodes_list.  Update callers.

2023-08-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/NodeNameNormalization.pm (set_nodes_list_labels),
	tp/Texinfo/Structuring.pm (check_nodes_are_referenced)
	(complete_node_tree_with_menus, nodes_tree): put all the nodes in
	nodes list, not only the one that can be used as targets.

2023-08-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Transformations.pm (_new_node)
	(insert_nodes_for_sectioning_commands),
	tp/Texinfo/Document.pm (add_node), Pod-Simple-Texinfo/pod2texi.pl
	(_parsed_manual_tree), tp/t/automatic_nodes.t (test_new_node),
	tp/t/test_utils.pl (test), tp/texi2any.pl: apply Texinfo::Transformations
	insert_nodes_for_sectioning_commands on a Texinfo::Document.  Add
	add_node in Texinfo::Document to add a node as a target for
	references.

2023-08-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (parse_texi_text, parse_texi_file),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (parse_texi_file)
	(parse_texi_text): fix call of Texinfo::Document::register.

2023-08-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/NodeNameNormalization.pm (set_nodes_list_labels):
	rename %labels as %identifier_target.

2023-08-03  Patrice Dumas  <pertusus@free.fr>

	Rename 'nodes' in labels information key as 'nodes_list'

2023-08-03  Patrice Dumas  <pertusus@free.fr>

	Rename labels as identifier_target and targets/targets_list as labels_list

2023-08-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/NodeNameNormalization.pm (set_nodes_list_labels),
	tp/Texinfo/ParserNonXS.pm (_end_line_misc_line)
	(_check_register_target_element_label),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line),
	tp/Texinfo/XS/parsetexi/labels.c
	(check_register_target_element_label): warn for empty nodes in the
	parsers and normalize target elements in the parsers, instead of in
	set_nodes_list_labels.

	* tp/Texinfo/XS/parsetexi/node_name_normalization.c
	(convert_to_normalized_internal): fix ref* conversion, fix
	check of empty ref argument.
	(protect_unicode_char): avoid spurious error with empty next.
	(unicode_to_protected): initialize to an empty line.

	* tp/Texinfo/XS/parsetexi/unicode.c (unicode_accent): allocate dotless
	accents strings such that they can be freed later.

	* tp/Texinfo/Convert/NodeNameNormalization.pm
	(_end_line_starting_block): really call
	_check_register_target_element_label for float.

2023-08-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_output_anchor, _convert): add a
	function to output anchor XML elements.

	* tp/Texinfo/Convert/DocBook.pm (_output_anchor),
	tp/Texinfo/Convert/NodeNameNormalization.pm (set_nodes_list_labels),
	tp/Texinfo/Convert/Plaintext.pm (process_footnotes),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/Structuring.pm (new_node_menu_entry),
	tp/Texinfo/Transformations.pm (_new_node)
	(insert_nodes_for_sectioning_commands), tp/t/test_utils.pl (new_test):
	always set 'normalized' for elements that can be targets of cross
	references.  Set is_target if they can actually be targets.

2023-08-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/NodeNameNormalization.pm (convert_to_identifier):
	rename normalize_node as convert_to_identifier.  Update callers.

	* tp/Texinfo/XS/parsetexi/node_name_normalization.c
	(protect_unicode_char, unicode_to_protected, normalize_top_name)
	(convert_to_identifier): implement convert_to_identifier and
	associated functions from Texinfo::Convert::NodeNameNormalization.

	* tp/Texinfo/Convert/NodeNameNormalization.pm (set_nodes_list_labels),
	tp/Texinfo/ParserNonXS.pm (_end_line_misc_line),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line): call
	convert_to_identifier on node direction directly in parsers, not in
	set_nodes_list_labels.

	* tp/Texinfo/XS/parsetexi/node_name_normalization.c
	(convert_to_normalized_internal): return directly when converting an
	ignored element.

2023-08-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/NodeNameNormalization.pm (set_float_types),
	tp/Texinfo/ParserNonXS.pm (_enter_index_entry, _end_line_misc_line)
	(_end_line_starting_block, _parse_texi): set float list from
	perl parser.  Remove set_float_types function.

2023-08-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/unicode.c (unicode_accent): fix a one off
	NUL byte location.

	* tp/Makefile.tres, tp/t/27float.t (float_type_with_tieaccent):
	new test with tieaccent if float type, with diverse type of letters or
	digits in tieaccent.

2023-08-01  Patrice Dumas  <pertusus@free.fr>

	in tp/Texinfo/XS gnulib-tool --add-import unistr/u8-next

2023-08-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/27float.t (multiple_spaces_in_float_type):
	add test of float type with multiple consecutive spaces.

2023-08-01  Patrice Dumas  <pertusus@free.fr>

	Set floats list from XS parser, fix related bugs

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm
	(_set_errors_node_lists_labels_indices, get_parser_info),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block): do not
	call NodeNameNormalization::set_float_types, instead call
	build_float_list.  Uncomment the code in end_line_starting_block
	that calls parse_float_type and append to the floats list.  Uncomment
	the call of parse_float_type for listoffloats in end_line_misc_line.

	* tp/Texinfo/XS/parsetexi/api.c (build_float_list): use newSVpv_utf8
	on float type and use hv_fetch_ent to fetch the hash value to handle
	UTF-8 encoded key.

	* tp/Texinfo/XS/parsetexi/node_name_normalization.c
	(convert_to_normalized): return an empty string instead of 0 to avoid
	an undef value.

	* tp/Texinfo/XS/parsetexi/unicode.c (normalize_NFC): add +1 to the
	length in u8_normalize input to have the NUL byte considered.

	* tp/maintain/setup_converters_code_tables.pl: output UTF-8 encoded
	diacritic.

2023-08-01  Patrice Dumas  <pertusus@free.fr>

	in tp/Texinfo/XS gnulib-tool --add-import uninorm/nfc

	* tp/Texinfo/XS/Makefile.am (Parsetexi_la_LDFLAGS): add
	$(LTLIBUNISTRING).

2023-08-01  Patrice Dumas  <pertusus@free.fr>

	in tp/Texinfo/XS gnulib-tool --add-import unistr/u8-uctomb unictype/category-L unictype/category-test uniconv/u8-strconv-to-enc

2023-08-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/text.c (text_append, text_append_n): set
	input to be const.

	* tp/Texinfo/Convert/NodeNameNormalization.pm (_convert): treat link
	like inforef.

	* tp/Texinfo/XS/parsetexi/node_name_normalization.c
	(convert_to_normalized_internal), tp/Texinfo/XS/parsetexi/unicode.c
	(unicode_accent): finish implementation of convert_to_normalized
	and unicode_accent.

2023-08-01  Patrice Dumas  <pertusus@free.fr>

	Preliminary incomplete implementation of NodeNameNormalization in XS

	* tp/Makefile.am (maintenance_files),
	tp/maintain/setup_converters_code_tables.pl,
	tp/Texinfo/XS/Makefile.am: setup C tables based on perl hashes, for
	tables used in Unicode.pm and NodeNameNormalization.pm.

	* tp/Texinfo/Convert/Unicode.pm (unicode_accent): use
	%unicode_diacritics to determine if within an accent command, to
	get tieaccent and avoid needing unicode_accented_letters in XS.

	* tp/Texinfo/XS/Makefile.am, tp/Texinfo/XS/parsetexi/unicode.c
	(normalize_NFC, unicode_accent),
	tp/Texinfo/XS/parsetexi/node_name_normalization.c
	(convert_to_normalized_internal, convert_to_normalized): partial
	implementations in XS of Texinfo::Convert::Unicode and
	Texinfo::Convert::NodeNameNormalization.

	* tp/Texinfo/XS/parsetexi/parser.c (count_convert_u8): set input to
	be const.

2023-08-01  Patrice Dumas  <pertusus@free.fr>

	Run 'gnulib-tool --add-import uninorm/u8-normalize' under tp/Texinfo/XS.

	* tp/Texinfo/XS/parsetexi/labels.c,
	tp/Texinfo/XS/parsetexi/source_marks.c: include config.h first.

2023-07-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (Parsetexi_la_SOURCES),
	tp/Texinfo/XS/parsetexi/convert_to_texinfo.c,
	tp/Texinfo/XS/parsetexi/parser.c (convert_to_text),
	tp/Texinfo/XS/parsetexi/*.c: move convert_to_text to parser.c as it is
	only used for parsing.  Rename convert.c as convert_to_texinfo.c.

2023-07-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parse_texi_file)
	(parse_texi_text), tp/Texinfo/XS/parsetexi/command_data.awk,
	tp/Texinfo/XS/parsetexi/element_types.txt,
	tp/Texinfo/XS/parsetexi/parser.c (rearrange_tree_beginning)
	(parse_texi_document): translate to C rearrange_tree_beginning to
	rearrange the beginning of the tree in parse_texi_document rather than
	in Parsetexi.pm.  Set preamble command flag, add preamble_before_content
	element type.

	* tp/Texinfo/Common.pm (_add_preamble_before_content): do not create
	empty contents.

2023-07-30  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): setup a minimal parsed document with
	the tree only when the parsing was done by parse_texi_piece.

2023-07-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/PlainTexinfo.pm (import, _convert_with_XS):
	do not simply override convert, we must check at runtime that the
	document tree was stored by the XS parser.  Therefore override
	_convert_with_XS, which is used if document_descriptor is set for the
	document.

	* tp/Texinfo/XS/convert/ConvertXS.xs: fix MODULE and PACKAGE names.
	cosmetic changes to code.

	* tp/Texinfo/XS/parsetexi/document.c (retrieve_document): rename
	get_document as retrieve_document.

	* tp/t/test_utils.pl (test): use Texinfo::Convert::PlainTexinfo
	converter instead of Texinfo::Convert::Texinfo::convert_to_texinfo
	to test the XS converter.

2023-07-30  Patrice Dumas  <pertusus@free.fr>

	* tp/DebugTexinfo/DebugTree.pm, tp/Texinfo/Convert/Converter.pm,
	tp/Texinfo/Convert/DocBook.pm, tp/Texinfo/Convert/HTML.pm,
	tp/Texinfo/Convert/IXINSXML.pm, tp/Texinfo/Convert/Info.pm,
	tp/Texinfo/Convert/LaTeX.pm, tp/Texinfo/Convert/PlainTexinfo.pm,
	tp/Texinfo/Convert/Plaintext.pm, tp/Texinfo/Convert/TexinfoMarkup.pm,
	tp/Texinfo/Convert/Text.pm, tp/Texinfo/Convert/TextContent.pm,
	tp/t/test_utils.pl (convert_to_*, test), tp/texi2any.pl:
	pass a parsed Texinfo document to output() and convert() not directly
	a tree.

2023-07-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parse_texi_file)
	(parse_texi_text), tp/Texinfo/XS/parsetexi/api.c
	(reset_parser_except_conf, parse_file, parse_text),
	tp/Texinfo/XS/parsetexi/document.c (register_document)
	(remove_document): add register_document in document.c to register the
	document tree.  Register the tree with parse_file and parse_text
	and pass the document descriptor through an extra key.

2023-07-30  Patrice Dumas  <pertusus@free.fr>

	Add Texinfo::Document to represent a parsed Texinfo manual

	* tp/Texinfo/Document.pm, tp/Texinfo/ParserNonXS.pm (parse_texi_text)
	(parse_texi_file), tp/Texinfo/XS/parsetexi/Parsetexi.pm
	(parse_texi_file, parse_texi_text), tp/t/automatic_menus.t (test),
	tp/t/automatic_nodes.t, tp/t/test_sort.t, tp/t/test_tree_copy.t,
	tp/t/test_utils.pl (test), tp/texi2any.pl, util/texi-elements-by-size,
	Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm (_protect_hashchar)
	(_reference_to_text_in_texi), Pod-Simple-Texinfo/pod2texi.pl
	(_parsed_manual_tree), tp/Makefile.am: add the Texinfo::Document
	module to represent a parsed Texinfo manual.  Have parse_texi_text and
	parse_texi_file return a Texinfo::Document reference.

2023-07-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/ConvertXS.pm, tp/Texinfo/Convert/PlainTexinfo.pm
	(import): fix name of Texinfo::Convert::ConvertXS package.

2023-07-30  Patrice Dumas  <pertusus@free.fr>

	Basic XS converters support

	* Texinfo/Convert/ConvertXS.pm, Texinfo/XS/convert/ConvertXS.xs,
	tp/Texinfo/XS/Makefile.am (xs_LTLIBRARIES, ConvertXS_la*):
	basic support for XS converters.

	* tp/Texinfo/XS/parsetexi/api.c, tp/Texinfo/XS/Makefile.am
	(Parsetexi_la_SOURCES), Texinfo/XS/parsetexi/document.c,
	Texinfo/XS/parsetexi/document.h: prepare interface for documents
	in XS.  Incomplete and does nothing for now, only definitions
	needed to compile.

	* tp/Texinfo/Convert/PlainTexinfo.pm (import),
	Texinfo/XS/convert/ConvertXS.xs (plain_texinfo_convert),
	Texinfo/XS/convert/plain_texinfo.c (plain_texinfo_convert):
	preliminary interface for XS version of
	Texinfo::Conver::PlainTexinfo::convert.

2023-07-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/convert.c, tp/Texinfo/XS/parsetexi/parser.c:
	more directly included files which symbols are used.

2023-10-20  Gavin Smith <gavinsmith0123@gmail.com>

	No -I flags for bundled libraries

	* tp/tests/many_input_files/different_encodings.sh,
	* tp/tests/many_input_files/different_languages_gen_master_menu.sh,
	* tp/tests/many_input_files/input_dir_non_ascii.sh,
	* tp/tests/many_input_files/output_dir_file_non_ascii.sh,
	* tp/tests/many_input_files/output_dir_non_ascii.sh,
	* tp/tests/many_input_files/tex_l2h.sh,
	* tp/tests/many_input_files/tex_l2h_output_dir_non_ascii.sh:
	Remove several -I arguments for Perl to get library dependencies
	of texi2any.  It is unnecessary as texi2any adds the directories
	for these libraries itself using Texinfo::ModulePath.  It leads
	to a much longer command line, which makes these tests harder
	to understand.	It is also fragile in case the dependencies of
	the program change.

2023-10-20  Patrice Dumas <pertusus@free.fr>

	* doc/refcard/Makefile.am (txirefcard.pdf, txirefcard-a4.pdf):
	use $(srcdir) to find input tex file for out of source build.

2023-10-19  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/Makefile.am (pod2texi.texi): Remove several -I arguments
	for Perl to get library dependencies of pod2texi/texi2any.
	pod2texi adds the directories for these libraries itself.  It's
	awkward and fragile to supply these arguments whenever pod2texi
	is called, in case the dependencies of the program change.

2023-10-19  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.tex: Disable "@set indexescapeisbackslash" so that
	index files will use @ as the escape character rather than \.
	* NEWS, TODO: update.

2023-10-19  Gavin Smith <gavinsmith0123@gmail.com>

	* AUTHORS: add credits for js/*

2023-10-19  Gavin Smith <gavinsmith0123@gmail.com>

	* AUTHORS: trim texi2html and C makeinfo entries, as these are
	no longer part of the package.  Also remove credits for "images"
	directory as it is unclear which directory this refers to.

2023-10-19  Gavin Smith <gavinsmith0123@gmail.com>

	* autogen.sh: Edit comments to make clearer what files are being
	generated.

2023-10-19  Gavin Smith <gavinsmith0123@gmail.com>

	* po/check-linguas.pl: New script to check that the LINGUAS file
	matches the *.po files present in a directory.
	* po/Rules-checks, po_document/Rules-checks: Add a "check-linguas"
	target to run this script.
	* README-hacking: mention this as an automatic check.

2023-10-19  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Other Customization Variables)
	(EPUB Output File and Directory, EPUB HTML):
	Change EPUB to EPUB@. at ends of sentences.

2023-10-19  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: Remove superseded note.

2023-10-19  Gavin Smith <gavinsmith0123@gmail.com>

	* po/Makevars.template, po_document/Makevars.template: Remove.

2023-10-19  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/refcard/Makefile, doc/refcard/Makefile.am:
	Change file to Makefile.am.  This means we can put the information
	about what files to distribute in this file, rather than in
	doc/Makefile.am.
	* doc/Makefile.am: Update.

2023-10-19  Gavin Smith <gavinsmith0123@gmail.com>

	* info/info.c (get_initial_file),
	* info/infodoc.c (info_get_info_help_node),
	Use strcasecmp instead of strcmp in previous change.  This
	could better support case-insensitive file systems.  From Eli.

2023-10-19  Gavin Smith <gavinsmith0123@gmail.com>

	* info/info.c (get_initial_file),
	* info/infodoc.c (info_get_info_help_node),
	* info/nodes.c (info_get_node_with_defaults):
	Use strcmp or strcasecmp instead of mbscasecmp in several
	cases where we do not care about case-insensitive matching with
	non-ASCII characters.

2023-10-19  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/maintain/change_perl_modules_version.sh:
	Also update *.pm.in in order to updae Texinfo/ModulePath.pm.in,
	which was stuck at "6.3dev".  Remove commented-out sed version.
	Add usage message in case not invoked properly.

2023-10-19  Gavin Smith <gavinsmith0123@gmail.com>

	* configure.ac: Remove comment saying on whose recommendation
	we use "parallel-tests" (added 2012-11-10).  This is not useful
	for knowing why we use it.

2023-10-18  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/refcard/txirefcard.tex: Remove extra copyright year as it
	was still at 2019.

2023-10-18  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/Makefile.am (wwwdoc-install): Remove automatic "ls -ltu"
	call, which wasn't helpful.

2023-10-18  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: minor updates

2023-10-18  Gavin Smith <gavinsmith0123@gmail.com>

	Texinfo 7.1

	* configure.ac, NEWS: update

2023-10-18  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo-tex-test.texi (Line macros): Avoid checking
	example with leading space on a line after an "@" continuation
	character, as TeX's treatment of leading space on a line differs
	from that of texi2any.

2023-10-18  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Inserting Quotation Marks): Place @code around
	cindex entries for ` and `` to avoid them being changed to ' and ''
	in the Info index.

2023-10-17  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: reorder instructions slightly

2023-10-17  Gavin Smith <gavinsmith0123@gmail.com>

	* po_document/adjust-translations.pl: new script.
	* po_document: Run the script to adjust *.po files.
	* README-hacking: update to mention this script.

2023-10-16  Patrice Dumas <pertusus@free.fr>

	Update tex-html test results in tp/tests

2023-10-15  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/tests/coverage_macro.texi: Insert further blank lines in
	blocks of glyph commands.

2023-10-15  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: update

2023-10-15  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/api.c (reset_parser): Update comment
	re using malloc/free.

2023-10-15  Eli Zaretskii <eliz@gnu.org>

	* tp/Texinfo/XS/parsetexi/api.c (reset_parser),
	* tp/Texinfo/XS/xspara.c
	(xspara__add_pending_word, xspara_end, xspara__add_next):
	Add dTHX to allow compilation on MinGW.

	[Note from Gavin: this may be needed because these functions
	call fprintf.]

2023-10-14  Gavin Smith <gavinsmith0123@gmail.com>

	pretest 7.0.94


2023-10-14  Patrice Dumas <pertusus@free.fr>

	Update tex-html test results in tp/tests

2023-10-13  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/tests/coverage_macro.texi: Insert blank lines in blocks
	of glyph commands in attempt at avoiding divergent test results
	on MinGW, due to varying wcwidth values.  Report from Eli.

2023-10-12  Patrice Dumas <pertusus@free.fr>

	Update test results in tp/tests

2023-10-12  Patrice Dumas <pertusus@free.fr>

	update po files

2023-10-12  Patrice Dumas <pertusus@free.fr>

	Use translation context for definition aliases in converters

	* tp/Texinfo/Convert/HTML.pm (_convert), tp/Texinfo/Convert/LaTeX.pm
	(_convert), tp/Texinfo/Convert/Plaintext.pm (_convert),
	tp/Texinfo/Convert/Text.pm (_convert): use untranslated extra
	translation context if set.  Report and analysis by Gavin.

2023-10-12  Patrice Dumas <pertusus@free.fr>

	Add definition aliases translation context in the tree if needed

	* tp/Texinfo/Common.pm (pgdt_context, %def_map),
	tp/Texinfo/ParserNonXS.pm (_parse_def), tp/Texinfo/XS/parsetexi/def.c
	(DEF_ALIAS, def_aliases, parse_def): add pgdt_context to mark strings,
	which returns the context too.  Use the context in _parse_def to
	add it to the tree for untranslated type.  Similarly in def_aliases in
	def.c add a translation context if needed and add it to the tree in
	parse_def.  Report and analysis by Gavin.

	* po_document/Makevars (XGETTEXT_OPTIONS): add pgdt_context.

2023-10-12  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/maintain/regenerate_docstr.sh: Correct path to Makefile.am.

2023-10-12  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/tests/coverage_macro.texi: Insert blank lines in block
	of accent commands to avoid divergent test results on MinGW,
	due to varying wcwidth values.  Report from Eli.

2023-10-08  Eli Zaretskii <eliz@gnu.org>

	* install-info/install-info.c (readfile):
	Correct check for whether a compression program is being used
	in order to correctly close a file.

2023-10-08  Eli Zaretskii <eliz@gnu.org>

	* install-info/install-info.c (open_possibly_compressed_file):
	Close stdin file description in main process after calling popen
	on compression program.  This allows the file to be removed or
	renamed on Windows.

2023-10-08  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/input.c (next_text):
	Use positive value for getline argument.  From Eli.

2023-10-08  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/input.c (next_text):
	Initialise argument to getline to 0, as per documentation.
	Attempt to fix crash under MinGW, reported by Eli.

2023-10-07  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (xspara__print_escaped_spaces):
	Avoid unnecessary use of malloc/free.  malloc/free would
	require use of dTHX on MS-Windows.  Report from Eli Zaretskii.

2023-09-30  Gavin Smith <gavinsmith0123@gmail.com>

	pretest 7.0.93

2023-09-30  Gavin Smith <gavinsmith0123@gmail.com>

	* po_document/fix-translations.sh: Remove file.

2023-09-27  Gavin Smith <gavinsmith0123@gmail.com>

	Allow translation of @emph{See}

	* tp/Texinfo/Convert/HTML.pm (_convert_printindex_command):
	Change "@emph{See}" in translated string to "@emph{See@:}" in
	translated string.  This avoids a msgfmt error
        "a format specification for argument 'See' doesn't exist in 'msgstr'"
	due to {See} being seen as a placeholder for a string (with
	perl-brace-format).  Adding the non-alphabetic characters "@:"
	inside the braces stops this.  Report from Petr Pisar for Czech
	translation.

2023-09-21  Patrice Dumas <pertusus@free.fr>

	* tp/Texinfo/XS/configure.ac: do not reset CPPFLAGS to
	user-provided PERL_EXT_CFLAGS, as CPPFLAGS is modified by
	gnulib macros (specifically libunistring).  Report from Bruno Haible.

2023-09-21  Patrice Dumas <pertusus@free.fr>

	* configure.ac: require Unicode::Normalize.  Report from Bruno on
	CentOS Stream 9 where this module may not be installed.

2023-09-20  Gavin Smith <gavinsmith0123@gmail.com>

	Update gnulib

	* (top-level): Run "gnulib-tool --add-import"
	* tp/Texinfo/XS: Run "gnulib-tool --add-import".

	A gnulib update needed at top level to fix compilation on
	AIX 7.3.1.  Report from Bruno Haible.

2023-09-19  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo-tex-test.texi (TOC display): Add new example of
	section name with @/ in it, from Karl Berry.  Before the last change, 
	this led to an overfull hbox.

2023-09-19  Gavin Smith <gavinsmith0123@gmail.com>

	Simplify toc/index entry formatting

	* doc/texinfo.tex (\entry): Eliminate code allowing stretching
	into the margins, as it complicates the code and was questionable
	whether this was a good idea in the first place.  Do not hardcode
	70:30 ratio for splitting text across multiple lines.

2023-09-17  Patrice Dumas <pertusus@free.fr>

	* tp/tests/many_input_files/different_encodings.sh: skip test if
	$PERL_UNICODE_COLLATE_OK is no, as this test requires compatible
	unicode collation.  Report from Gavin based on Nelson Beebe pretest
	test results.

2023-09-13  Gavin Smith <gavinsmith0123@gmail.com>

	pretest 7.0.92

2023-09-13  Gavin Smith <gavinsmith0123@gmail.com>

	* install-info/install-info.c (main) <--description>:
	Free string when concatenating text.

2023-09-13  Gavin Smith <gavinsmith0123@gmail.com>

	* install-info/install-info.c (output_dirfile):
	Free string passed to popen.

2023-09-13  Gavin Smith <gavinsmith0123@gmail.com>

	* install-info/install-info.c (open_possibly_compressed_file):
	Free string passed to popen.

2023-09-13  Gavin Smith <gavinsmith0123@gmail.com>

	* install-info/install-info.c (reformat_new_entries): Free
	strings set by split_entry.

2023-09-13  Gavin Smith <gavinsmith0123@gmail.com>

	* install-info/install-info.c (readfile): Do not truncate input
	file at 8192 bytes.  Report from Andreas Schwab.

2023-09-12  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\newlineloadsconf): Hook into definitions
	made with \envdef as well as ends-of-lines and commands defined
	with \parsearg.  Werner Lemberg reported an error when a @tex block
	followed "\input texinfo" immediately.

2023-09-11  Gavin Smith <gavinsmith0123@gmail.com>

	pretest 7.0.91

2023-09-11  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: adjust release instructions

2023-09-09  Patrice Dumas <pertusus@free.fr>

	* tp/t/html_tests.t (automatic_menus): test with FORMAT_MENU menu
	and no explicit menus.

2023-09-09  Patrice Dumas <pertusus@free.fr>

	Automatic menu in HTML if missing and FORMAT_MENU is menu

	* tp/Texinfo/Convert/HTML.pm (%available_converter_info)
	(_convert_heading_command): add 'labels' to the
	%available_converter_info.  Automatic menu setup and formatting if
	FORMAT_MENU is menu, a sectioning command is being formatted,
	associated node is with automatic directions and without menu
	and there is no table of contents already formatted.

2023-09-09  Patrice Dumas <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (new_complete_menu_master_menu),
	tp/Texinfo/Convert/Plaintext.pm (_convert): move code setting up a
	menu and detailed menu if node is Top to Texinfo::Structuring
	as new_complete_menu_master_menu.

2023-09-08  Patrice Dumas <pertusus@free.fr>

	* tp/Texinfo/Convert/Unicode.pm (string_width): remove explicit
	matching of 0-width characters, they correspond to the remaining
	characters after matching printing characters except for Marks.

2023-09-08  Patrice Dumas <pertusus@free.fr>

	* tp/Texinfo/Convert/Unicode.pm (string_width): replace IsPrint
	by more explicit character classes.

2023-09-07  Patrice Dumas <pertusus@free.fr>

	* tp/Texinfo/Convert/Unicode.pm (string_width): use
	DefaultIgnorableCodePoint for better compatibility with old perls.

2023-09-07  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: add note re *.pot versions.

2023-09-06  Patrice Dumas <pertusus@free.fr>

	* tp/t/input_files/in_menu_only_special_spaces_node.texi,
	tp/t/input_files/only_special_spaces_node.texi: separate node for
	LINE SEPARATOR and PARAGRAPH SEPARATOR in test files.

2023-09-06  Patrice Dumas <pertusus@free.fr>

	* tp/Texinfo/Convert/Unicode.pm (string_width): consider
	Default_Ignorable_Code_Point to be of zero width.  These codepoints
	are described as having no visible glyph or advance width in and of
	themselves.

2023-09-06  Patrice Dumas <pertusus@free.fr>

	Consider control characters to have a 0 width

	* tp/Texinfo/Convert/Unicode.pm (string_width): do not consider space
	control characters especially.  This is better for line feed, carriage
	return and form feed, and vertical or horizontal tabs should not
	happen in situations where we want to know the width of strings.

2023-09-05  Patrice Dumas <pertusus@free.fr>

	Add customization of external node reference names

	* doc/texi2any_api.texi (Customizing Output Target Names)
	(Customizing External Node Output Names), tp/Texinfo/Convert/HTML.pm
	(%customizable_file_id_setting_references, _external_node_href):
	add external_target_split_name and external_target_non_split_name
	file id setting customization function reference.  Based on
	Jonas Hahnfeld feedback.

2023-09-04  Patrice Dumas <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_external_node_href): initialize
	explicitly $target_split.  Use a different variable for the case of
	$target_split ($file) and !$target_split ($directory).  Rearrange code
	returning the final href to have less conditions.  If target is empty
	and TOP_NODE_FILE_TARGET is not set use the directory and
	target_filebase as in the other cases.  This case probably never
	happens, though, as TOP_NODE_FILE_TARGET is always set.

2023-09-04  Patrice Dumas <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_external_node_href): do not call
	_normalized_to_id in $target, it is already done in
	_normalized_label_id_file.

2023-09-04  Patrice Dumas <pertusus@free.fr>

	Add last element argument to format_end_file

	* doc/texi2any_api.texi (Customizing HTML File End),
	tp/Texinfo/Convert/HTML.pm (_default_format_end_file, output): add the
	last element to the call of format_end_file in output.  Idea from
	LilyPond init file commit from Jonas Hahnfeld where converter state
	is used, to be able to get the output unit directly instead.

2023-09-03  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Config.pm (GNUT_load_init_file): Check if
	message is non-empty as well as defined before printing.
	(_GNUT_document_fatal): Keep going if FORCE is set.

2023-09-02  Gavin Smith <gavinsmith0123@gmail.com>

	Fatal error for init file loading

	* tp/Texinfo/Config.pm (_GNUT_document_fatal): copy
	from _GNUT_document_warn and exit program.
	(GNUT_load_init_file): Load init file with "do" rather than
	"require".  As calling code has already located the file with
	Texinfo::Common::locate_init_file, we do not need "require" to
	locate the file in @INC.  Call _GNUT_document_fatal if "do"
	could not load or parse the file.

	Report from Jonas Hahnfeld who is working on an init file for
	GNU Lilypond.  It was not helpful to continue on if there
	was a syntax error in the init file.

2023-09-01  Patrice Dumas <pertusus@free.fr>

	Run 'gnulib-tool --add-import libunistring' under tp/Texinfo/XS.

	Update gnulib.

2023-08-20  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/README: Add Unicode::Collate to list of modules.  Mention
	possibility of not using internal versions of some modules.
	* tp/t/README: Say to look at tp/README for the module requirements.

2023-08-19  Bruno Haible  <bruno@clisp.org>

	* doc/Makefile.am (wwwdoc-install):
	Indent all lines in the rule with a tab.

2023-08-19  Bruno Haible  <bruno@clisp.org>

	* doc/Makefile.am (refcard/txirefcard.pdf, refcard/txirefcard-a4.pdf):
	Combine Makefile rules in attempt to forestall two make processes
	running at the same time in case of a parallel make.

2023-08-19  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/Makefile.am (refcard/txirefcard.pdf, refcard/txirefcard-a4.pdf):
	Add rules for these files, as they aren't tracked in git any more
	and are needed for make dist.  From Bruno.

2023-08-19  Gavin Smith <gavinsmith0123@gmail.com>

	* contrib/gen-dir-node,
	* contrib/javaprop2texiflag.pl,
	* doc/refcard/Makefile: Eliminate $Id keyword expansion.

2023-08-19  Gavin Smith <gavinsmith0123@gmail.com>

	* configure.ac: Check for Unicode::Collate and issue a warning
	if not found.  Report from Bruno Haible on CentOS 8-stream.

2023-08-19  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Structuring.pm (sort_indices):
	Put collator options in a hash variable to make code clearer.
	Reorder code slightly.

2023-08-19  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Structuring.pm (Texinfo::CollateStub):
	Provide fall-back module in case Unicode::Collate can't be loaded.
	(sort_indices): Use it if loading Unicode::Collate fails.

2023-08-19  Patrice Dumas <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (complete_node_tree_with_menus): add
	missing extra for menus key.

2023-08-18  Gavin Smith <gavinsmith0123@gmail.com>

	* install-info/tests/ii-0059-test: Fix malformed menu entry.

2023-08-18  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: remove recommendation to check with
	-Wdeclaration-after-statement, as it may not be a relevant
	warning any more.  From Bruno.

2023-08-18  Gavin Smith <gavinsmith0123@gmail.com>

	* install-info/install-info.c (readfile): null-terminate file
	data so to avoid reading off the end in mark_entry_for_deletion.
	(mark_entry_for_deletion): Add checks for end of data.

2023-08-18  Gavin Smith <gavinsmith0123@gmail.com>

	* install-info/install-info.c (output_dirfile): Avoid mixed
	declaration and statements.

2023-08-18  Gavin Smith <gavinsmith0123@gmail.com>

	install-info atomic dir update

	* install-info/install-info.c (output_dirfile):
	Get name of temp file by appending to dir file name.  This
	ensures that the temporary file is in the same directory and
	thus on the same disk volume.  Report from Bruno Haible.

2023-08-18  Gavin Smith <gavinsmith0123@gmail.com>

	* install-info/install-info.c (output_dirfile):
	Change further uses of perror to pfatal_with_name for concision
	and to print program name.

2023-08-18  Gavin Smith <gavinsmith0123@gmail.com>

	* install-info/install-info.c (output_dirfile):
	In case removing and renaming to target dirfile failed, print
	error message and exit with pfatal_with_name function.  Lack
	of exit reported by Bruno Haible.

2023-08-16  Gavin Smith <gavinsmith0123@gmail.com>

	pretest 7.0.90

2023-08-16  Gavin Smith <gavinsmith0123@gmail.com>

	* util/srclist.txt: Update source for INSTALL to doc/INSTALL.ISO
	in gnulib sources to avoid non-ASCII sequences.

2023-08-15  Gavin Smith <gavinsmith0123@gmail.com>

	* INSTALL: integrate text from doc/README about *.tex installation.
	use https: for ftp.gnu.org link.
	* doc/README: eliminate file.
	* doc/Makefile.am (install-data-local): update reference to INSTALL.

2023-08-15  Gavin Smith <gavinsmith0123@gmail.com>

	* info/session.c: removed unused variable.

2023-08-15  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: update suggested configure invocation to
	disable some unneeded warnings

2023-08-15  Gavin Smith <gavinsmith0123@gmail.com>

	parsetexi compiler warnings

	* tp/Texinfo/XS/parsetexi/parser.c (isolate_last_space):
	Change a condition to make it easier to see that a variable is
	not used uninitialised.
	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line):
	Restructure to make it clearer that a variable is not used
	uninitialised, especially as this is quite a long function.

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block) <float>:
	Comment out declaration of unused variable.

2023-08-15  Gavin Smith <gavinsmith0123@gmail.com>

	parsetexi compiler warnings

	* tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line):
	Do not save separator characters into unused variables.
	* tp/Texinfo/XS/parsetexi/separator.c: Removed unused "funexit:" label.

2023-08-15  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: add pod2texi to list of programs with
	copyright years in --version calls.  Adjust commands for
	looking for copyright years to update.

2023-08-15  Gavin Smith <gavinsmith0123@gmail.com>

	Bump version to 7.0.90 for pretest

	* configure.ac: version
	* README-hacking: reorder some instructions

2023-08-15  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/refcard/txirefcard.tex: 2023, 7.1

2023-08-15  Gavin Smith <gavinsmith0123@gmail.com>

	* build-aux/pre-inst-env.in: set TEXINFO_DEV_SOURCE rather than
	TEXINFO_UNINSTALLED as the latter is not used anywhere.

2023-08-15  Gavin Smith <gavinsmith0123@gmail.com>

	Translator comments and contexts

	* tp/Texinfo/Common (%def_map):
	Change "users-modifiable" to "user-modifiable" in a translator
	comment, and shorten context for @deftypefn "Function" to be
	similar to context for @deffn -- we don't need to describe
	what the difference is in these contexts.

2023-08-15  Gavin Smith <gavinsmith0123@gmail.com>

	Move month names translation strings

	* tp/Texinfo/Convert/Converter.pm,
	* tp/Texinfo/Convert/Utils.pm: move appearance of month names
	in gdt to Utils.pm, in order to be next to the @MONTH_NAMES
	array that these strings are used with.

2023-08-15  Gavin Smith <gavinsmith0123@gmail.com>

	* ChangeLog, texindex/ChangeLog: Move texindex ChangeLog entries
	into top-level file.

2023-08-15  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/maintain/regenerate_cmd_tests.sh,
	* tp/maintain/regenerate_docstr.sh: do not place copyright year
	in generated files as this complicates updating copyright years.
	* tp/maintain/regenerate_docstr.sh: add a comment as to the
	purpose of this file.

2023-08-15  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: tweak advice on updating copyright years

2023-08-14  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: start of advice on how to update copyright
	years automatically

2023-08-14  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/prove.sh: Add a comment stating the purpose of this file (mail
	from Patrice, October 24th, 2022).

2023-08-14  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: reorder to put longer, less predictable
	tasks further away from the final release instructions.

2023-08-14  Gavin Smith <gavinsmith0123@gmail.com>

	* INSTALL.generic, build-aux/compile, build-aux/config.guess,
	build-aux/config.sub, build-aux/depcomp, build-aux/mdate-sh:
	update from gnulib

2023-08-14  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Menus): Be clearer about when menus are
	output in HTML.

2023-08-14  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/Makefile.am (MAKEINFO_ENVIRONMENT): Do not use shell
	export statements as this may lead to the same problem experienced
	with TEXI2DVI_ENVIRONMENT.

2023-08-14  Gavin Smith <gavinsmith0123@gmail.com>

	Do not rely on texi2dvi internal directory layout

	* doc/Makefile.am (TEXI2DVI_ENVIRONMENT),
	* doc/tp_api/Makefile.am (TEXI2DVI_ENVIRONMENT):
	Use $(abs_top_srcdir) and $(abs_top_builddir) to reference texindex
	files, rather than $(top_srcdir) and $(top_builddir) concatenated
	with a certain number of "../", as this is hard to understand and
	depends on internal details of texi2dvi that we shouldn't have
	to think about.

2023-08-14  Gavin Smith <gavinsmith0123@gmail.com>

	Fix "make distcheck" without installed texinfo.tex

	* doc/Makefile.am (TEXI2DVI_ENVIRONMENT),
	* doc/tp_api/Makefile.am (TEXI2DVI_ENVIRONMENT):
	Do not export TEXINDEX or TEXINDEX_SCRIPT shell variables in
	separate shell statements.

	As texi2dvi was run by Makefile rules like

	  TEXINPUTS=... MAKEINFO=... \
	  TEXINDEX=... ; export TEXINDEX ; \
	  TEXINDEX_SCRIPT=... ; export TEXINDEX_SCRIPT ; ../util/texi2dvi ...

	the first semicolon ended the shell statement where TEXINPUTS and
	MAKEINFO were set, so they were not set correctly for texi2dvi.
	This broke "make distcheck" under doc/tp_api, where texinfo.tex
	was not found, if not installed on the user's system.

2023-08-13  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS: Run "gnulib-tool --add-import"

	* tp/Texinfo/XS/Makefile.am
	(XSParagraph_la_LDFLAGS, Parsetexi_la_LDFLAGS):
	Add $(LTLIBUNISTRING) as recommended by gnulib-tool --add-import.
	* tp/Texinfo/XS/parsetexi/labels.c,
	* tp/Texinfo/XS/parsetexi/source-marks.c:
	include <config.h> before <string.h>.

2023-08-13  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: advice on LDADD for new gnulib modules

2023-08-13  Gavin Smith <gavinsmith0123@gmail.com>

	gnulib LDADD

	* info/Makefile.am (LDADD), install-info/Makefile.am (LDADD):
	Revise and extend variable use from gnulib so that the correct
	libraries will be linked on various platforms reliably.

2023-08-13  Gavin Smith <gavinsmith0123@gmail.com>

	Run "gnulib-tool --add-import" (top level)

2023-08-13  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: note that we can't use gettext 0.22.

2023-08-13  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\entry): Reduce possible margin overhang from
	2.1em to 1.5em.
	(\indexdotfill): Reduce minumum length from 1em
	to 0.5em.  This stops long section titles jutting out into the
	margin too visibly.

2023-08-13  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: texinfo.tex, info updates.

2023-08-13  John Wheeler <wheelerwjx9@runbox.com>

	* install-info/tests/ii-0058-test,
	* install-info/tests/ii-0059-test: Add new tests to check
	blank lines between sections on repeated addition and deletion of
	sections.

2023-08-12  Gavin Smith <gavinsmith0123@gmail.com>

	* info/terminal.c (term_Km): Remove.
	(terminal_initialize_terminal): Do not load or set Km (kmous)
	capability string.  As the termcap string for xterm can be
	"\033[<" rather than the "\033[M" we expected, we cannot rely
	on the contents of this.
	(initialize_byte_map): Add KEY_MOUSE bindings unconditionally.  They
	are harmless even if mouse support is off.
	(terminal_begin_using_terminal): Do not use term_Km to decide
	whether to try to turn on "normal tracking mode".  Instead, only
	use the setting from the "mouse" variable.
	(terminal_end_using_terminal): Likewise.

2023-08-12  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (xspara_get_state): Remove
	unused function (which currently does nothing).

2023-08-12  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Command List): List new commands
	@defblock, @defline, @deftypeline, @linemacro, @link,
	@nodedescription, @nodedescriptionblock.
	(Node Descriptions): Add index entries for new commands.

2023-08-12  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: list updated automake version used for distribution

2023-08-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line): free
	fullpath only after error messages have been output.

	* tp/Texinfo/XS/parsetexi/parser.c (check_valid_nesting, parse_texi):
	add parentheses to avoid ambiguity and match better perl parser code.
	(isolate_last_space): simplify debug output code.

	* tp/Texinfo/XS/parsetexi/parser.c, tp/Texinfo/XS/parsetexi/input.c,
	tp/Texinfo/XS/parsetexi/tree.c, tp/Texinfo/XS/parsetexi/close.c,
	tp/Texinfo/XS/parsetexi/end_line.c, tp/Texinfo/XS/parsetexi/macro.c,
	tp/Texinfo/XS/parsetexi/menus.c, tp/Texinfo/XS/parsetexi/indices.c:
	remove unused variables.

	* tp/Texinfo/XS/parsetexi/close.c (close_command_cleanup),
	tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace):
	add parentheses to avoid ambiguity and match better perl parser code.

	* tp/Texinfo/XS/parsetexi/api.c (store_source_mark_list): explicit
	default in switch for SM_status_none and SM_type_none.

	* tp/Texinfo/XS/MiscXS.xs (xs_parse_texi_regex): remove left over
	variable.

	* tp/Texinfo/XS/xspara.c (xspara_init): group expressions to avoid
	ambiguity.

	* tp/Texinfo/XS/xspara.c (xspara_get_state): avoid mixing declarations
	and code.

2023-08-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/source_marks.c (source_marks_names): setup
	the source_marks_names table in the file using it and not in the
	header file defining the macro used to setup the table, to have the
	table defined only where it is used.

2023-08-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_block_command),
	tp/Texinfo/XS/parsetexi/macro.c (expand_linemacro_arguments),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): avoid
	mixing declarations and code.

	* tp/Texinfo/XS/parsetexi/handle_commands.c (parse_rawline_command):
	remove unused variable.

2023-08-12  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: add note re "git stash list".

2023-08-07  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/refcard/txirefcard.tex: Close TeX group as intended (broken
	since 2022-10-21).

2023-08-07  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/refcard/txirefcard.tex: Document new commands.

2023-08-07  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/refcard/txicmdcheck: ignore @item_LINE as this is not
	a real Texinfo command and is only used internally.

2023-08-07  Gavin Smith <gavinsmith0123@gmail.com>

	* po/POTFILES.in, po_document/POTFILES.in: update so that
	"make po-check" and "make po_document-check" work at the top level.

2023-08-07  Gavin Smith <gavinsmith0123@gmail.com>

	* Makefile.am (po-check): look under directories beginning A-Z as
	well as a-z to include Pod-Simple-Texinfo.  Eliminate use of
	$(CVS_LIST_EXCEPT) which does not appear to be defined anywhere.

2023-08-07  Gavin Smith <gavinsmith0123@gmail.com>

	* po/POTFILES.in: some updates
	* Makefile.am (po-check): exclude tp/t/results directory.

2023-08-07  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Other Customization Variables)
	<CLOSE_QUOTE_SYMBOL>: Give @samp as an example use case, as
	at OPEN_QUOTE_SYMBOL.

2023-08-07  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi: Add line "@microtype on".

2023-08-07  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: edit, clarify, reorder.

2023-08-07  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/info-stnd.texi (Node Commands) <d>: Say a little about
	what the dir node is.

2023-08-07  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Common.pm (@variable_string_settables):
	Change AUTO_MENU_DESCRIPTION_FILLCOLUMN to
	AUTO_MENU_MAX_WIDTH and AUTO_MENU_DESCRIPTION_INDENT_LENGTH to
	AUTO_MENU_DESCRIPTION_ALIGN_COLUMN.
	* tp/Texinfo/Convert/Plaintext.pm (_convert): Subtract one
	from the value of AUTO_MENU_DESCRIPTION_ALIGN_COLUMN to get the
	number of preceding columns in the line.

2023-08-05  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: Mention AUTO_MENU_DESCRIPTION_FILLCOLUMN and
	AUTO_MENU_DESCRIPTION_INDENT_LENGTH.

2023-08-05  Gavin Smith <gavinsmith0123@gmail.com>

	* TODO: add outputting detailmenu comment lines

2023-08-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Translations.pm (gdt): have the gettext framework convert
	translated strings to UTF-8, and decode from UTF-8 to internal perl
	encoding.

2023-08-06  Patrice Dumas  <pertusus@free.fr>

	* po_document/LINGUAS, po_document/pl.iso-8859-2.po, tp/Makefile.am
	(test_files), t/input_files/pl_translated_inserted_strings_8bit.texi,
	tp/Makefile.tres (test_files_generated_list), tp/t/formats_encodings.t
	(8bit_document_translations): add 8bit encoded po_document po file for
	testing purposes, using iconv and manual edition of charset for
	polish.  Add a corresponding test, 8bit_document_translations, with
	@documentencoding ISO-8859-2 which should use the pl.iso-8859-2.po
	translations file.

2023-08-06  Patrice Dumas  <pertusus@free.fr>

	update po files

2023-08-06  Patrice Dumas  <pertusus@free.fr>

	* po_document/POTFILES.in: add tp/Texinfo/Structuring.pm.

2023-08-06  Patrice Dumas  <pertusus@free.fr>

	* TODO, tp/TODO: update.

2023-08-05  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Common.pm,  tp/Texinfo/Structuring.pm
	(_normalized_entry_associated_internal_node, new_master_menu):
	Move to Structuring.pm as Common.pm should not depend on
	Texinfo::Structuring or Texinfo::Translations.  Report from Patrice.

2023-08-05  Gavin Smith <gavinsmith0123@gmail.com>

	add CHECK_MISSING_MENU_ENTRY

	* tp/Texinfo/Common.pm (%default_main_program_customization):
	Add CHECK_MISSING_MENU_ENTRY, true by default.
	* tp/Texinfo/Structuring.pm (complete_node_tree_with_menus):
	Do not output warnings about missing menu entries if 
	CHECK_MISSING_MENU_ENTRY is not set.  This was formerly controlled
	by CHECK_NORMAL_MENU_STRUCTURE but was latterly on unconditionally.
	* doc/texinfo.texi (Other Customization Variables): Document.
	* tp/t/test_utils.pl: Set 'CHECK_NORMAL_MENU_STRUCTURE' in
	configuration.
	* NEWS: update

2023-08-04  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Top): Remove @menu and @detailmenu, using
	@nodedescription throughout.  Also remove joke after end of menu.

2023-08-04  Gavin Smith <gavinsmith0123@gmail.com>

	Blank line before detailmenu

	* tp/Texinfo/Convert/Plaintext.pm (_convert) <sectioning commands>:
	Add a blank line before the inserted detailmenu block.

2023-08-04  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Structuring.pm,
	* tp/Texinfo/Common.pm (_normalized_entry_associated_internal_node):
	Remove duplicate definition in Structuring.pm, using the definition
	in Common.pm instead.

2023-08-04  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Common.pm (new_master_menu): Always take an array
	reference as an argument with a list of menus to operate on, so
	that there is only one way of calling this function.  Callers updated.
	* tp/Texinfo/Convert/Plaintext.pm (_convert) <sectioning commands>:
	Check that node name is actually "Top".

2023-08-04  Gavin Smith <gavinsmith0123@gmail.com>

	Generate master menu in plaintext output

	* tp/Texinfo/Common.pm (new_master_menu): Take extra optional
	argument which is the menu in the Top node.
	* tp/Texinfo/Convert/Plaintext.pm (_convert) <sectioning commands>:
	At the Top node, call new_master_menu after calling
	Texinfo::Structuring::new_complete_node_menu, so to also generate
	a detailed menu.

2023-08-04  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Common.pm (_print_down_menus):
	Call Texinfo::Structuring:::new_complete_node_menu in order to output
	part of the master menu when a node is missing a @menu block.

2023-08-04  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Common.pm (%valid_tree_transformations):
	Add 'complete_tree_nodes_missing_menu', which should have been in
	this list as it is documented and implemented.

2023-08-04  Gavin Smith <gavinsmith0123@gmail.com>

	Move new_master_menu

	* tp/Texinfo/Transformations.pm
	* tp/Texinfo/Common.pm (new_master_menu): Move to Common.pm.
	* tp/t/do_master_menu.t: Update.

2023-08-04  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl (set_translations_encoding): really pass argument.
	Report and investigation of faulty commit by Werner.

2023-08-04  Gavin Smith <gavinsmith0123@gmail.com>

	* info/session.c (info_handle_pointer): When going Up, look
	for the current node in the Up nodes menu and position the
	cursor there.
	* NEWS: mention this

2023-08-03  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi: Use trailing comma before 'or' more
	consistently.

2023-08-03  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Menus): Advertise the benefits of not using
	@menu in Texinfo sources.

2023-08-03  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Node Descriptions): New node to document
	@nodedescription and @nodedescriptionblock.
	(Menus): Edit slightly.

2023-08-03  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: reword slightly

2023-08-03  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Writing a Node, Writing a Menu, Menu Parts)
	(Raise/lower sections, Cross Reference Parts):
	Refer to 'texi2any' rather than 'makeinfo'.

2023-08-03  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi: Finish removing most @menu blocks, using
	@nodedescription instead.

2023-08-02  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert) <node description>:
	If adding extra space before node description, count this space
	in the line length.

2023-08-02  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Hardcopy with TeX): Edit and condense.  Reference
	another node for details of changing the paper size.
	(@smallbook): Say that 8.5x11" paper is called letter size.

2023-08-02  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Printing): Remove node, as it is duplicative
	of "Texinfo Mode Printing".  Move a paragraph into "Hardcopy with TeX".

2023-08-02  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Emacs Shell Printing): Remove node, moving
	some material into "Hardcopy with TeX".

2023-08-02  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Printing with Emacs): Move node and sub-nodes
	to appendix.

2023-08-02  Gavin Smith <gavinsmith0123@gmail.com>

	Edits to manual

	* doc/texinfo.texi (Insertions): Remove @iftex block listing
	contents of chapter.
	(Requirements Summmary): Remove node as the content is covered
	elsewhere.

2023-08-02  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi: Continue removing @menu throughout.

2023-08-02  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert) <node description>:
	Use the same code for @nodedescription and @nodedescriptionblock
	for adding extra spaces if needed to separate the description.
	Use the previous converter for adding the spaces and add two
	spaces rather than one.  Suggestion from Patrice.

2023-08-01  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi: Start removing @menu throughout.

2023-08-01  Gavin Smith <gavinsmith0123@gmail.com>

	Remove extra space for @nodedescriptionblock

	* tp/Texinfo/Convert/Plaintext.pm (_convert) <@nodedescriptionblock>:
	Check if space is needed before adding space with current paragraph
	formatter, as the existing check would always be true and the space
	would be added, leading @nodedescriptionblock descriptions to be
	indented by an extra space compared with @nodedescription descriptions.

2023-08-01  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/t/10menu.t (nodedescription_descriptions): Adjust test so
	it tests what was tested before with a node description only fitting
	on the next line in a menu.

2023-08-01  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (PDF Colors): Move up a level as the section is not
	just related to @link.

2023-08-01  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Other Customization Variables)
	<AUTO_MENU_DESCRIPTION_FILLCOLUMN>,
	<AUTO_MENU_DESCRIPTION_INDENT_LENGTH>: Update.

2023-08-01  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert) <menu entry description>:
	Multiply by 0.44 instead of dividing by 2.32 as this is easier
	to understand.

2023-08-01  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/info-stnd.texi: Remove remaining @menu blocks and
	use @nodedescription where needed.

2023-08-01  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm <AUTO_MENU_DESCRIPTION_FILLCOLUMN>
	If AUTO_MENU_DESCRIPTION_FILLCOLUMN not set, increase the text width
	by 10% as existing Info menus often go beyond 72 columns in width.

2023-08-01  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\nodedescription, \nodedescriptionblock):
	Add stub implementations.
	* NEWS: Mention these new commands.

2023-07-31  Patrice Dumas  <pertusus@free.fr>

	nodedescription customization

	* doc/texinfo.texi (Other Customization Variables),
	tp/Texinfo/Common.pm b/tp/Texinfo/Common.pm
	(@variable_string_settables), tp/Texinfo/Convert/Plaintext.pm
	(_convert): add AUTO_MENU_DESCRIPTION_INDENT_LENGTH and
	AUTO_MENU_DESCRIPTION_FILLCOLUMN customization for @nodedescription*
	formatting.

	* tp/t/10menu.t (commands_in_nodedescriptionblock): set
	AUTO_MENU_DESCRIPTION_INDENT_LENGTH and
	AUTO_MENU_DESCRIPTION_FILLCOLUMN.

2023-07-31  Patrice Dumas  <pertusus@free.fr>

	@nodedescriptionblock output

	* tp/Texinfo/Convert/HTML.pm (convert_tree_new_formatting_context)
	(_convert_paragraph_type, _convert_menu_entry_type): add formatting
	of @nodedescriptionblock. Check if node description was formatted more
	than once, and use convert_tree_new_formatting_context in that case.
	pass block_command to convert_tree_new_formatting_context to be able
	tp avoid paragraph markup for the first nodedescriptionblock
	paragraph.

	* tp/Texinfo/Convert/Plaintext.pm (converter_initialize)
	(new_formatter, _convert): formatting of @nodedescriptionblock. Add
	'indent_length' to format_context considered variables for
	new_formatter. Use text_element_context to set the counter for
	nodedescription and nodedescriptionblock. Add seen_node_descriptions
	to the converter state to be able to be silent if a node description
	is formatted more than once. Determine $description_indent_length
	by applying a factor on text_element_context max.

	* tp/Texinfo/Convert/HTML.pm (_convert_printindex_command): multiple
	pass argument of convert_tree_new_formatting_context usable as
	identifier.

	* tp/Makefile.tres, tp/t/10menu.t (commands_in_nodedescriptionblock):
	test multiple @nodedescriptionblock with commands in it.

2023-07-31  Patrice Dumas  <pertusus@free.fr>

	@nodedescriptionblock parsing

	* tp/Texinfo/Convert/*.pm, tp/Texinfo/ParserNonXS.pm
	(_handle_line_command, _handle_block_command),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command),
	(handle_block_command), tp/Texinfo/command_data.txt: add
	@nodedescriptionblock.  Set extra node key node_long_description.
	Also associated with node_description unless there is also a
	@nodedescription.

	* tp/Makefile.tres, tp/t/10menu.t (nodedescriptionblock_descriptions):
	new test.

2023-07-30  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/separator.c (handle_comma):
	Keep copy of return value of next_text so to avoid a memory
	leak.

2023-07-30  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/end_line.c (parse_line_command_args)
	<@defindex>: Free index name when finished.
	* tp/Texinfo/XS/parsetexi/indices.c (add_index): Call strdup on
	argument to add_index_internal.

2023-07-30  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/tree.c (destroy_node_spec):
	Free 'out_of_tree_elements' array.

2023-07-30  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/macro.c (parse_macro_command_line):
	Free return value of read_command_name in the case that the name
	is bad.

2023-07-30  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/macro.c (unset_macro_record):
	Set 'macro_name' field of MACRO to null rather than an empty
	string.  This prevents a memory leak if the macro record is
	reused and the pointer to the empty string is not freed.

2023-07-30  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line)
	<@value>: Free a string in one case where it was not freed.

2023-07-29  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: hints on valgrind for tp/t tests

2023-07-29  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/def.c (split_delimiters):
	Free return value from u8_strconv_from_encoding.

2023-07-29  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/macro.c (expandline_macro_arguments):
	Free return value from parse_command_name.

2023-07-29  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/source_marks.c (relocate_source_marks):
	Free malloc-allocated int array at end of function.

2023-07-29  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line) <@include>:
	Call free on return value of locate_include_file once done with value.

2023-07-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_expand_linemacro_arguments),
	tp/Texinfo/Convert/Texinfo.pm (convert_to_texinfo),
	tp/Texinfo/XS/parsetexi/convert.c (convert_to_texinfo_internal),
	tp/Texinfo/XS/parsetexi/element_types.txt,
	tp/Texinfo/XS/parsetexi/macro.c (expand_linemacro_arguments):
	use a new type, bracketed_linemacro_arg instead of bracketed_arg for
	the linemacro call element holding text.  It is indeed different from
	bracketed_arg, which contains other elements and not directly text.

	* tp/Texinfo/ParserNonXS.pm (_handle_macro),
	tp/Texinfo/XS/parsetexi/macro.c (handle_macro): rename name extra macro
	call key as command_name and put it in info instead of extra.

	* tp/t/60macro.t (macro_expansion_in_multitable_prototype): add test
	of macro expansion in bracketed_arg in multitable prototypes.

2023-07-29  John Wheeler <wheelerwjx9@runbox.com>  (tiny change)

	* install-info/install-info.c (output_dirfile):
	Do not insert a blank line before a new section if one is there
	already.  This prevents the number of blank lines continually
	increasing if a section is repeatedly deleted and inserted.

2023-07-29  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo-tex-test.texi (Index and paragraphs): Remove section
	as change making index command end paragraph was reverted.

2023-07-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_next_text): do not try to modify the
	output when there was an encoding error.  Do not use Encode::decode
	to emit a warning in case of decoding error, as it may not, and it
	would not be the same message as the XS parser.
	Instead call Encode::decode with check argument set to
	Encode::FB_CROAK in an eval to get the perl message and the
	information that there was an error.  Get the erroneous byte using
	Encode::decode with Encode::FB_QUIET.  Then call Encode::decode
	again with the default check argument to get the decoded string.
	Based on Gavin input.

	* tp/tests/encoded/Makefile.am (EXTRA_DIST),
	tp/tests/encoded/list-of-tests (test_latin1_no_documentencoding):
	prepare a test with a letter in latin1 but no documentencoding to
	test for manuals that assumed latin1, especially for accented letters
	in person names.  Do not set it because the XS and perl parsers lead
	to different outputs.

2023-07-29  Patrice Dumas  <pertusus@free.fr>

	* NEWS: mention stricter checks of input encoding, with more errors
	and warnings, especially for UTF-8.

2023-07-29  Patrice Dumas  <pertusus@free.fr>

	* texi2any.pl: if format and converted format differ, mention both in
	messages including converted format (only one case).

	* texi2any.pl: rename set_format_menu_from_cmdline_header as
	set_format_menu_from_cmdline_header_option.

2023-07-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Unicode.pm (check_unicode_point_conversion): in
	case encoding is not attempted, still use an eval to catch invalid
	argument to hex().

2023-07-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Unicode.pm (check_unicode_point_conversion): with
	strict encoding, there is a warning for nonchar with perl 5.10.1 on
	solaris 11, though not on solaris 10.  So for a range of perl versions,
	5.10.0 to 5.13.8 we do not attempt the eval and check for the
	codepoints to be below 0x10FFFF early.

2023-07-28  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\deftypeline): Read arguments correctly, in
	the same way as \deftypefn.

2023-07-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/60macro.t
	(line_end_accent_command_macro_call): add test for a command with
	braces expanded in a macro followed by end of line one line command.

	* tp/Texinfo/Common.pm (modify_tree): error out if argument not
	defined or not a HASH.

2023-07-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (element_associated_processing_encoding):
	rename element_extra_encoding_for_perl as
	element_associated_processing_encoding.  Update callers.

2023-07-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (%non_formatted_brace_commands): add sortas.

2023-07-28  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl (set_translations_encoding): reset translations
	encoding when COMMAND_LINE_ENCODING is reset.

	* tp/texi2any.pl: move code around for a more logical organization.

2023-07-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Unicode.pm (check_unicode_point_conversion):
	check that the codepoint expands to valid UTF-8, by using
	:encoding(utf-8) instead of :utf8 on the stream, consistently with the
	conversion used to output UTF-8.

2023-07-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Unicode.pm
	(%unicode_character_brace_no_arg_commands): add a comment to described
	the failure with charnames::vianame.

	* tp/Texinfo/Convert/Unicode.pm (_eight_bit_and_unicode_point)
	(unicode_point_decoded_in_encoding): exclude 127, \x{7F}, DEL from the
	characters considered to be decoded.  It is probably actually decoded,
	but should not represent an accented character or a specific character.

2023-07-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Unicode.pm
	(%unicode_character_brace_no_arg_commands): revert use of
	charnames::vianame as an attempt to fix tests of @sc{@aa{}} in
	perl 5.10.1 (on solaris).

2023-07-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.xs (init): use macro corresponding
	to bytes to get file paths in the C parser.  The file path comes from
	Texinfo::ModulePath through Texinfo::XSLoader and is a byte string.

2023-07-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.xs: use # comments, not C
	comments.

2023-07-28  Patrice Dumas  <pertusus@free.fr>

	Set 'no utf8' in texi2any as we substitute file names in byte strings

	* tp/texi2any.pl: set 'no utf8'.  Through rules in Makefile.am
	directory paths set through configure are substituted directly in
	strings in the code and we always use these strings as byte string,
	therefore we explicitly set no utf8 to be sure that strings in code
	will never be considered as character strings by Perl.

2023-07-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm,
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (parse_file)
	(add_include_directory): use macro corresponding to bytes to get
	file paths in the C parser.  Add comments explaining that file paths
	should be binary string, with any encoding, while other strings should
	be UTF-8 encoded.

2023-07-28  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl: use $curdir from File::Spec->curdir() instead of '.'.

2023-07-27  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\unnsecentry, \unnsubsecentry): Correct
	spelling of command sequences.

2023-07-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs: pass parser conf strings as
	UTF-8 encoded bytes, and use the macro corresponding to bytes to get
	the strings in the C parser.

2023-07-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parse_texi_piece)
	(parse_texi_text, parse_texi_line),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (parse_piece, parse_string)
	(parse_text): encode strings passed to the C parser to UTF-8
	explicitly to make those strings byte strings.  In the C parser, use
	the macro corresponding to bytes to get the strings.

2023-07-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/api.c (store_additional_info)
	(store_source_mark_list, element_to_perl_hash): add fatal() calls for
	impossible cases (info information element added twice, source mark
	element registered twice, parent set after the children).
	Add comments to explain that since args and contents are processed
	before extra information, element associated to extra often have their
	hv already set.

2023-07-27  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/info-stnd.texi (Top): Eliminate @menu and
	use new @nodedescription command in sub-nodes.

2023-07-27  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/info-stnd.texi (Xref Commands): Eliminate @menu and
	use new @nodedescription command in sub-nodes.

2023-07-27  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (xspara_add_text):
	Re-order arguments to fprintf to match intended order.

2023-07-27  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/info-stnd.texi (Node Commands): Remove reference to "this
	window".  Add index entry for 'execute-command'.
	(More Node Commands): Subordinate comment about 'global-next-node'
	and 'global-prev-node' to one of the items in the table.

2023-07-27  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/info-stnd.texi (Xref Commands): Mention menus in this node.
	(Parts of an Xref): Change two cases of "cross reference" to
	"cross-reference".   Place example earlier in node.
	Refer to a menu entry as an "entry".  Link
	to different node in Texinfo manual.  Fix capitalisation of
	"Texinfo".

2023-07-27  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/info-stnd.texi (Node Commands): Do not link to emacs manual
	for explanation of M-x, as this contains much irrelevant material.
	State that M-x is 'execute-command'.  Give example using previously
	documented command.  Change ALT to Alt and CTRL to Ctrl, as well
	as META to Meta.

2023-07-27  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/info-stnd.texi (Node Commands): Edit.  Do not talk about
	'the current window' as this is an unnecessary complication.  Say
	more about the hierarchical structure of an Info file.

2023-07-27  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/info-stnd.texi (Node Commands, More Node Commands):
	Split off 'More Node Commands' node with the less important
	commands in it.
	(Cursor Commands, Node Commands): Move description of M-x, C-u
	and keystroke notation earlier in manual.

2023-07-27  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/info-stnd.texi (Node Commands): Reduce duplication in
	discussion of 'l' command and talk less about 'discarding nodes'.

2023-07-27  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/info-stnd.texi (Node Commands) <goto-invocation>:
	Fix example to use the right key.
	(Stand-alone Info, Miscellaneous Commands):
	Change 'makeinfo' to 'texi2any'.

2023-07-27  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (@verbatim): Change [tab] to <tab> as is
	more usual in other parts of the manual.

2023-07-26  Gavin Smith <gavinsmith0123@gmail.com>

	TOC @subsubsection number alignment

	* doc/texinfo.tex (\findsecnowidths): Also collect information
	on the widths of subsubsection numbers.
	(\numsubsecentry, \unsubsecentry): Call \retrievesecnowidth.
	(\dosubsubsecentry): Assign \secnowidth based on result.

2023-07-26  Gavin Smith <gavinsmith0123@gmail.com>

	TOC @subsection number alignment

	* doc/texinfo.tex (\findsecnowidths): Also collect information
	on the widths of subsection numbers.
	(\retrievesecnowidth): Take an argument, being the dimension
	register to assign to.
	(\numsecentry, \unsecentry): Call \retrievesecnowidth.
	(\dosubsecentry): Assign \secnowidth based on result.

2023-07-26  Patrice Dumas  <pertusus@free.fr>

	Simpler more consistent UTF-8 and unicode handling, stricter UTF-8 conversion

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line): map utf8 to
	utf-8 for input_encoding, to get the same output as the perl parser
	with mime_name and also because it is better.

	* tp/Texinfo/Common.pm (%encoding_name_conversion_map): map utf8 to
	utf-8 to always use the same conversion in perl, and prefer the strict
	conversion.

	* tp/Texinfo/Common.pm (encode_file_name, count_bytes): do not use
	utf-8 specific conversion, always use Encode encode and also use the
	strict conversion.

	* tp/Texinfo/Convert/Unicode.pm (_format_eight_bit_accents_stack),
	tp/Texinfo/ParserNonXS.pm (_new_text_input, _next_text): use the
	utf-8 encoding not utf8 for Encode encode strict conversion.

	* tp/Texinfo/Convert/HTML.pm (converter_initialize),
	tp/Texinfo/Convert/Unicode.pm: use charnames::vianame to obtain
	characters based on a string representation of unicode codepoints, as
	it is simple and this is what is described in the documentation.

	* tp/Texinfo/Convert/Unicode.pm (unicode_point_decoded_in_encoding):
	handle hex strings in the ascii range for 8bit encodings.

	* tp/Makefile.tres, tp/t/08misc_commands.t (documentencoding_utf8):
	new test with documentencoding utf8.

2023-07-26  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\summarycontents): Set \extrasecnoskip to
	restore extra space in the summary contents.

2023-07-26  Gavin Smith <gavinsmith0123@gmail.com>

	TOC section number spacing

	* doc/texinfo.tex (\labelspace): Narrow from 1em to 0.6em.  This
	is used after section numbers in the table of contents.
	(\tocentry, \extrasecnoskip): Add an extra skip of \extrasecnoskip
	after the section number.
	(\dochapentry): Set \extrasecnoskip so to maintain the same space
	after chapter numbers in the table of contents.

2023-07-26  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\tocentry): Fix setting of \entrycontskip
	to work with last change.

2023-07-26  Gavin Smith <gavinsmith0123@gmail.com>

	TOC section number alignment

	* doc/texinfo.tex (\findsecnowidths): New macro, to get maximum
	width of section numbers for each chapter.
	(\contents): Call it.

	(\retrievesecnowidth): New macro to get the maximum widths.
	(\numchapentry, \appentry): Call it.

	(\tocentry, \secnowidth): Use \secnowdith for alignment if set to
	a non-zero value.
	(\dosecentry): Set \secnowidth based on result of \retrievesecnowidth.

	This aligns section titles in the table of contents if there are
	10 or more sections in a chapter.  Report from Karl.

2023-07-26  Patrice Dumas  <pertusus@free.fr>

	in HTML associate node without section to following heading command

	* tp/Texinfo/Convert/HTML.pm (%defaults, _convert_heading_command),
	NEWS, doc/texinfo.texi (HTML Customization Variables),
	tp/Texinfo/Common.pm (@variable_string_settables),
	tp/Texinfo/Convert/Utils.pm (find_root_command_next_heading_command):
	add find_root_command_next_heading_command() to return a heading
	command found before contents that could be formatted.  Use that
	in HTML heading formating such as not to output a heading if there
	is a node not associated to sectioning command but followed by
	a @*heading command.  Use USE_NEXT_HEADING_FOR_LONE_NODE to customize
	that, set in the default case.

	* tp/Makefile.tres, tp/t/html_tests.t (headings_after_lone_nodes):
	new test to test association of lone node with next @*heading command.

2023-07-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_default_format_navigation_panel): do
	not output buttons corresponding to space separators if there is no
	button before.  Do not output the paragraph in the navigation panel
	div if there is no navigation panel buttons output.

2023-07-25  Patrice Dumas  <pertusus@free.fr>

	Complete HTML menus with nodedescription

	* tp/Texinfo/Convert/HTML.pm (_convert_menu_entry_type): replace
	empty description by node_description extra information.

	* tp/Texinfo/Convert/Plaintext.pm (_convert): more robust
	determination of empty menu description.

	* tp/t/results/menu/nodedescription_descriptions.pl
	(nodedescription_descriptions): fix type in @verb name.

2023-07-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_expand_linemacro_arguments),
	tp/Texinfo/XS/parsetexi/macro.c (expand_linemacro_arguments):
	a comment on a linemacro defined command invokation (not in braces) is
	not part of the arguments, and is left after the expansion as
	agreed with Gavin.

	* tp/Makefile.tres, tp/t/65linemacro.t
	(comment_on_linemacro_call_out_of_braces)
	(comment_on_linemacro_call_macro_expansion): more tests of comments on
	linemacro call lines.

2023-07-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/ParagraphNonXS.pm (new): rename 'last_char'
	as 'last_letter'. a Always set 'last_letter', to an empty string
	when it was previously undef.

	* tp/Texinfo/Convert/ParagraphNonXS.pm (end, _add_next, add_text),
	tp/Texinfo/XS/xspara.c (xspara__end_line, xspara_end)
	(xspara_add_text): set last_letter to the last character when it is
	space or end of line, or fullwidth character.  Do not unset
	last_letter in _add_pending_word.  Unset last_letter in end.

	* tp/Texinfo/Convert/ParagraphNonXS.pm ($end_sentence_characters):
	rename $end_sentence_character as $end_sentence_characters.

	* tp/Texinfo/XS/xspara.c (after_punctuation_characters)
	(end_sentence_characters): use defin for the strings to be sure to
	avoid errors in code (] was missing in one place).

	* tp/Texinfo/Convert/ParagraphNonXS.pm: try to have all debug messages
	as one string.

	* tp/t/paragraph.t: more tests with fullwidth characters, including
	latin fullwidth characters that can be upper case.

	* tp/Makefile.tres, tp/t/plaintext_tests.t
	(split_punctuation_detection_in_commands): new test with all the
	puctuation related character tested and with @-commands.

2023-07-24  Gavin Smith <gavinsmith0123@gmail.com>

	No casts in isascii_* calls

	* tp/Texinfo/XS/parsetexi/end_line.c (isascii_alpha),
	* tp/Texinfo/XS/parsetexi/parser.c (isascii_alnum):
	Remove casts to 'unsigned char' from call sites.  These should
	not be necessary as we check in the functions that the argument
	is in the ASCII range.

2023-07-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (_convert): add a space after
	a menu entry before the added menu entry description if there is none.

	* tp/Texinfo/Convert/Plaintext.pm: change in spacing.

	* tp/t/10menu.t (nodedescription_descriptions): more tests with
	long node and name entries.

2023-07-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/ParagraphNonXS.pm (_add_pending_word, _add_next):
	rearrange code to be more similar to XS Paragraph.

2023-07-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/xspara.c (xspara__print_escaped_spaces): really
	add this function (rename from print_escaped_spaces).

2023-07-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/xspara.c (xspara__add_pending_word): reset
	state.space_counter too when indent and !state.unfilled.

	* tp/Texinfo/XS/xspara.c (xspara__print_escaped_spaces)
	(xspara__add_pending_word, xspara_end, xspara__add_next)
	(xspara_add_text): add debug similar to the perl Paragraph module.
	Enabled by changing a variable in the source file and recompiling.

2023-07-23  Patrice Dumas  <pertusus@free.fr>

	Complete Plaintext/Info menus with nodedescription

	* tp/Texinfo/Convert/Plaintext.pm (_convert): use nodedescription
	if a menu_entry_description is empty, using a new paragraph container.

	* tp/Texinfo/Convert/ParagraphNonXS.pm (counter),
	tp/Texinfo/XS/XSParagraph.xs (xspara_counter), tp/Texinfo/XS/xspara.c
	(xspara_counter): add counter() to get the current column counter value.

	* tp/Makefile.tres, tp/t/10menu.t (nodedescription_descriptions): new
	test to test @nodedescription added descriptions.

2023-07-23  Gavin Smith <gavinsmith0123@gmail.com>

	Fix parsetexi compilation errors

	* tp/Texinfo/XS/parsetexi/macro.c (expand_linemacro_arguments):
	Place case label after block variable declarations to prevent
	gcc error 'a label can only be part of a statement and a
	declaration is not a statement'.

2023-07-23  Patrice Dumas  <pertusus@free.fr>

	@nodedescription parsing in texi2any

	* tp/Texinfo/ParserNonXS.pm (%contain_full_text_commands)
	(_handle_line_command), tp/Texinfo/XS/parsetexi/handle_commands.c
	(handle_line_command), tp/Texinfo/XS/parsetexi/parser.c
	(check_valid_nesting), tp/Texinfo/command_data.txt: parse
	@nodedescription, adding extra information about the current node in
	and in the current node too in extra node_description.

	* tp/t/test_utils.pl (@contents_keys): add node_description.

	* tp/Makefile.tres, tp/t/08misc_commands.t (nodedescription): test
	parsing of @nodedescription.

2023-07-23  Patrice Dumas  <pertusus@free.fr>

	* doc/tp_api/Makefile.am (AM_MAKEINFOFLAGS): add the
	TREE_TRANSFORMATIONS complete_tree_nodes_menus, otherwise the Index
	appendix node in texi2any_internals_indices.texi concatenated file
	is not in any menu.

2023-07-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_expand_macro_arguments, _handle_macro),
	tp/Texinfo/XS/parsetexi/macro.c (expand_macro_arguments)
	(handle_macro): pass the leading brace and possible spaces following
	the leading brace to expand_macro_arguments instead of handling them
	in handle_macro.  Add space before brace to
	"spaces_after_cmd_before_arg" info key as an element for macros call
	elements.

2023-07-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_new_value_element)
	(_process_remaining_on_line), tp/Texinfo/XS/parsetexi/parser.c
	(new_value_element, process_remaining_on_line) <value>: add space
	before brace to "spaces_after_cmd_before_arg" info key as an element,
	similar to other brace commands.

2023-07-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/65linemacro.t
	(protection_of_end_of_line_by_command): add specific test of
	protection of end of line by @ in linemacro call.  From Gavin.

2023-07-22  Patrice Dumas  <pertusus@free.fr>

	* tp/t/60macro.t (non_ascii_in_macro_name): skip test if /a regex flag
	is not available.

2023-07-22  Patrice Dumas  <pertusus@free.fr>

	autoconf test for conversion from EUC-CN to UTF-8 by iconv

	* configure.ac, tp/Makefile.am, tp/Texinfo/ModulePath.pm.in,
	tp/t/formats_encodings.t (multiple_include_encodings),
	tp/t/info_tests.t (chinese_mixed_with_en_EUC_CN): add a runtime check
	whether iconv converts EUC-CN to UTF-8.  Pass the result through
	Makefile.am and Texinfo::ModulePath.

2023-07-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/api.c (parse_file),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line),
	tp/Texinfo/XS/parsetexi/macro.c (parse_macro_command_line),
	tp/Texinfo/XS/parsetexi/parser.c (check_line_directive): rename
	char variables used as a temporary placeholder for a character
	replaced by an end of string as saved to be more explicit and
	consistent.

2023-07-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm, tp/Texinfo/XS/parsetexi/input.c: explain
	the mapping of US-ASCII encoding to ISO-8859-1 for compatibility
	with old manuals in which US-ASCII could have been considered to
	be an alias for ISO-8859-1.  Based on Gavin input and looking at
	old Texinfo releases code and manuals.

2023-07-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/end_line.c (isascii_alpha)
	(parse_line_command_args, end_line_starting_block)
	(end_line_misc_line), tp/Texinfo/XS/parsetexi/handle_commands.c
	(parse_rawline_command), tp/Texinfo/XS/parsetexi/macro.c
	(parse_macro_command_line), tp/Texinfo/XS/parsetexi/parser.c
	(isascii_alnum, read_command_name, read_flag_name): add isascii_alpha
	to replace isalpha and isascii_alnum to replace isalnum to make sure
	that the character is also ascii, both because we want to select ascii
	characters only, and because we do not want to depend on the locale.

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line): replace
	uses of isspace by other str* functions applied on whitespace_chars
	to avoid being dependent on the locale as isspace is.

	* tp/Texinfo/ParserNonXS.pm, tp/Texinfo/XS/parsetexi/end_line.c,
	tp/Texinfo/XS/parsetexi/parser.c: use more consistently \d instead
	of [0-9] or [[:digit:]] in the perl parser, and use consistently
	digit_chars in the XS parser for a more consistent code and easier
	comparison between the two codes.

2023-07-22  Patrice Dumas  <pertusus@free.fr>

	Same parsing of @macro line for both parsers

	* tp/Texinfo/ParserNonXS.pm (_parse_macro_command_line),
	tp/Texinfo/XS/parsetexi/macro.c (parse_macro_command_line): use
	the same code to parse @macro line for both parsers to get the
	same parsing and same errors message.

	* tp/Makefile.tres, tp/t/60macro.t (zero_argument_comment)
	(non_ascii_in_macro_name): new tests, with comment on zero arguments
	@macro line and non ascii character in macro name.

2023-07-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (element_extra_encoding_for_perl)
	(set_output_encodings), tp/Texinfo/Convert/Converter.pm
	(txt_image_text), tp/Texinfo/Convert/IXIN.pm (output_ixin),
	tp/Texinfo/Convert/Plaintext.pm (converter_initialize),
	tp/Texinfo/Translations.pm (gdt): check if encoding name
	is not defined, or not empty, but not that it is not '0'.

	* tp/Texinfo/Convert/Converter.pm (txt_image_text),
	tp/Texinfo/Convert/DocBook.pm (_convert), tp/Texinfo/Convert/Info.pm
	(format_image), tp/Texinfo/Convert/Plaintext.pm (format_image): do not
	remove last end of line in txt_image_text, but in callers.

	* tp/ext/highlight_syntax.pm (highlight_process): check close()
	errors.

2023-07-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (txt_image_text): decode file name
	for error messages.

2023-07-22  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/encoded/osé_utf8_no_setfilename.texi: synchronize with
	tp/tests/encoded/osé_utf8.texi.

2023-07-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (html_image_file_location_name): add
	leading dot to extension used in case of error.

2023-07-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_input_push_file, _next_text)
	(_end_line_misc_line), tp/Texinfo/Convert/HTML.pm (_process_css_file):
	do not use binmode to reset input encoding, as with buffering in
	input the file content is read ahead with the previous encoding.
	Instead set binary mode and decode upon getting the line.

	* tp/Makefile.am (test_files), t/include/chapter_*.texi,
	t/include/documentdescription_EUC_CN.texi,
	t/input_files/multiple_include_encodings.texi, tp/Makefile.tres,
	tp/t/formats_encodings.t (multiple_include_encodings): new test
	to test multiple encodings in a Texinfo manual with included files
	using different encodings.

	* tp/tests/encoded/Makefile.am (EXTRA_DIST), tp/tests/Makefile.onetst,
	tp/tests/encoded/list-of-tests (non_ascii_test_info),
	tp/tests/encoded/osé_utf8.texi, tp/tests/encoded/txt_çimage.txt:
	add image text file to osé_utf8.texi.  Add an info output test
	for osé_utf8.texi.

2023-07-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (%encoding_name_conversion_map)
	(element_extra_encoding_for_perl, set_output_encodings),
	tp/Texinfo/ParserNonXS.pm (_end_line_misc_line): add mapping of
	encodings to encodings that extend them to use the extending encoding
	for conversion, as is done for us-ascii to ISO-8859-1 in XS parser.

	* tp/t/formats_encodings.t (char_us_ascii_latin1_in_refs),
	tp/Makefile.tres: add test with @documentencoding us-ascii and
	non-ascii ISO-8859-1 encoded characters.

2023-07-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (%parser_state_initialization)
	(get_parser_info, _end_line_misc_line, _handle_close_brace):
	set info information in get_parser_info, set input_encoding_name
	as a parser state.  This allows not to set global parser information
	in parse_texi_line, as is done in the XS parser.

	* tp/Texinfo/XS/parsetexi/api.c (reset_parser_except_conf)
	(build_global_info), tp/Texinfo/XS/parsetexi/end_line.c
	(end_line_misc_line), tp/Texinfo/XS/parsetexi/input.c
	(set_input_encoding, reset_encoding_list),
	tp/Texinfo/XS/parsetexi/parser.c (wipe_global_info, wipe_global_info),
	tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace):
	remove global_info.input_encoding_name, and rename input_encoding_name
	as global_input_encoding_name to be used instead, to have only one
	variable used.  Set global_input_encoding_name only if the iconv
	conversion could be initialized.  Set input encoding to utf8 after
	resetting the variables, not before.  Rename current_encoding as
	current_encoding_conversion. rename struct ENCODING as
	ENCODING_CONVERSION.

	* tp/Texinfo/XS/parsetexi/input.c (set_input_encoding)
	(encode_file_name): distinguish encoding name used in conversion and
	input encoding name.

	* tp/Makefile.am (test_files), tp/Makefile.tres,
	tp/maintain/regenerate_latin1_tests.sh, tp/t/formats_encodings.t
	(char_utf8_latin1_in_refs),
	tp/t/input_files/char_latin1_latin1_in_refs.texi,
	tp/t/input_files/char_us_ascii_latin1_in_refs.texi,
	tp/t/input_files/char_utf8_latin1_in_refs.texi: change file name,
	minor changes in files and generated files, generate a file with
	US-ASCII documentencoding containing latin1 encoded characters, not
	ussed for now.

2023-07-21  Patrice Dumas  <pertusus@free.fr>

	Use any input encoding known by iconv in the XS parser 

	* doc/texinfo.texi (@code{@@documentencoding}),
	tp/Texinfo/XS/parsetexi/api.c (reset_parser_except_conf),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line),
	tp/Texinfo/XS/parsetexi/input.c (set_input_encoding)
	(convert_to_utf8, encode_file_name, reset_encoding_list):
	use a list of encodings and iconv handlers based on the
	@documentencoding found in the manual.  Always set utf-8 at
	the first position in the list.  Use any encoding known by iconv
	instead of a fixed list of known encodings.  Remove enum
	character_encoding.

	* tp/Texinfo/ParserNonXS.pm (_end_line_misc_line),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line)
	<documentencoding>: trim non-ascii characters and keep only
	alphanumeric characters, - and _ in encoding names. iconv also seems
	to trim non alphanumeric non - _ characters.  Consider an encoding not
	handled by iconv or not found in perl parser during parsing to be
	unhandled.

	* tp/Texinfo/Common.pm (get_perl_encoding)
	(element_extra_encoding_for_perl), tp/Texinfo/ParserNonXS.pm
	(%parser_state_initialization, parse_texi_text, _input_push_file)
	(get_parser_info, parse_texi_file, _encode_file_name),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (get_parser_info): add
	get_perl_encoding function in Texinfo::Common to set
	{'info'}->{'input_perl_encoding'} based on XS parser code.  Use this
	function in both parsers.  In the perl parser, add get_parser_info
	function to call get_perl_encoding instead of doing it while parsing,
	and call get_parser_info in parse_* functions as required, similar to
	code in the XS parser.  Consider an encoding not found by perl to
	be unrecognized.

	* tp/Makefile.am (test_files), tp/Makefile.tres,
	tp/t/08misc_commands.t (documentencoding_zero), tp/t/info_tests.t
	(chinese_mixed_with_en_EUC_CN),
	tp/t/input_files/chinese_mixed_with_en_EUC_CN.texi: two new tests
	related to encodings, one using EUC-CN an ascii compatible encodding
	that was not available before in the XS parser.

2023-07-20  Patrice Dumas  <pertusus@free.fr>

	* tp/t/65linemacro.t (end_conditional_in_linemacro)
	(begin_conditional_in_linemacro, block_begin_end_in_linemacro_call):
	add another conditional test in end_conditional_in_linemacro, add
	begin_conditional_in_linemacro and block_begin_end_in_linemacro_call
	similar tests.

2023-07-20  Patrice Dumas  <pertusus@free.fr>

	* tp/t/65linemacro.t (recursive_linemacro_in_call): new test.

2023-07-20  Patrice Dumas  <pertusus@free.fr>

	* tp/t/60macro.t (arobase_brace_in_macro_call), tp/t/65linemacro.t
	(arobase_brace_in_linemacro_call): add tests with @{ and @} in macro
	and linemacro calls.

	* tp/t/65linemacro.t (spaces_after_command_in_call)
	(spaces_after_unknown_command_in_call): rename
	spaces_after_command_in_call as spaces_after_unknown_command_in_call
	and use a known brace command in the new version of
	spaces_after_command_in_call.

	* tp/t/65linemacro.t (spaces_after_macro_linemacro_commands_in_call):
	add test.

2023-07-20  Patrice Dumas  <pertusus@free.fr>

	* tp/t/60macro.t (verb_with_arobase_in_macro_call)
	(verb_with_brace_in_macro_call, tp/t/65linemacro.t
	(verb_in_linemacro_call, verb_with_arobase_in_linemacro_call)
	(verb_with_brace_in_linemacro_call), tp/Makefile.tres: more tests for
	@verb in macro and linemacro calls.

2023-07-20  Patrice Dumas  <pertusus@free.fr>

	* tp/t/65linemacro.t (comment_in_linemacro_call)
	(comment_in_one_argument_linemacro_call)
	(comment_at_end_of_linemacro_call): new tests with comments and
	linemacro.

2023-07-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_handle_macro),
	tp/Texinfo/XS/parsetexi/macro.c (handle_macro): put checks related to
	expansion before the expansion, as during the expansion, the text may
	go past the call.  In particular for user defined linemacro which
	generally get the final new line from following text.

	* tp/t/65linemacro.t (call_macro_in_linemacro_body)
	(call_macro_in_linemacro_call, recursive_linemacro_in_body),
	tp/Makefile.tres: new @linemacro tests.

	* tp/Texinfo/XS/parsetexi/macro.c (expand_linemacro_arguments):
	change code to be more readable and compact.

	* tp/Texinfo/XS/parsetexi/debug.c (debug_print_protected_string):
	special message if input_string is 0.

2023-07-19  Patrice Dumas  <pertusus@free.fr>

	Reimplement linemacro arguments expansion in a separate function

	* tp/Texinfo/ParserNonXS.pm (_expand_linemacro_arguments)
	(_end_line_misc_line, _end_line_def_line, _end_line, _handle_macro)
	(_handle_open_brace, _process_remaining_on_line, _parse_texi),
	tp/Texinfo/XS/parsetexi/context_stack.c (context_name),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line)
	(end_line_misc_line, end_line), tp/Texinfo/XS/parsetexi/macro.c
	(count_toplevel_braces, set_toplevel_braces_nr)
	(expand_linemacro_arguments, handle_macro),
	tp/Texinfo/XS/parsetexi/parser.c (linecommand_expansion_delimiters)
	(process_remaining_on_line, parse_texi),
	tp/Texinfo/XS/parsetexi/separator.c (handle_open_brace):
	use the expand_linemacro_arguments function directly in handle_macro
	to parse the linemacro defined user commands arguments, such that they
	are expanded in a second step only.  @-command are taken into account
	to protect spaces or braces, braces are matched, spaces separate
	arguments and what remains on the line is the last argument.  In the
	XS parser, use a specific counter count_toplevel_braces, and use
	set_toplevel_braces_nr to count closed braces.
	Remove code related to the previous implementation.

	* tp/Texinfo/ParserNonXS.pm (%parser_state_initialization)
	(_end_line_def_line, _process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/api.c (reset_parser_except_conf),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line):
	remove global state in_parsing_only, which is not relevant with
	the new implementation.

2023-07-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_command_name)
	(_process_remaining_on_line), tp/Texinfo/XS/MiscXS.xs
	(xs_parse_command_name), tp/Texinfo/XS/misc.c (xs_parse_command_name):
	use more similar interface for parse_command_name in the perl parser
	than in the XS parser.

2023-07-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_command_name, _parse_texi_regex)
	(_process_remaining_on_line), tp/Texinfo/XS/MiscXS.xs
	(xs_parse_command_name, xs_parse_texi_regex), tp/Texinfo/XS/misc.c
	(xs_parse_command_name, xs_parse_texi_regex),
	tp/Texinfo/XS/parsetexi/parser.c (parse_command_name)
	(process_remaining_on_line): process text starting with @ in one
	place.  Determine first if starting by @ (in _parse_texi_regex in the
	perl parser) and afterwards determine the command name, with a new
	function parse_command_name.

2023-07-17  Gavin Smith <gavinsmith0123@gmail.com>

	Multi-line TOC entry alignment

	* doc/texinfo.tex (\entrycontskip): new dimen.
	(\entry): Use \entrycontskip for indentation of continuation lines.
	When splitting across several lines, cancel adjustments
	made to allow a slightly longer, single line.  When entry text could
	cross over more than two lines, use the same line length for all
	lines.

	(\tocentry): New macro.  Handle concatenation of section
	number, space and section title, before calling \entry.
	When a TOC entry has a section number, set \entrycontskip
	to the width of the number and a following space so that any
	continuation lines in the entry will be aligned.

	(\partentry, \numchapentry, \shortchaptentry, \appentry)
	(\unnchapentry, \shortunnchapentry, \numsecentry, \unsecentry)
	(\numsubsecentry, \unnsubsecentry, \numsubsubsecentry)
	(\unnsubsubsecentry, \dochapentry, \dosecentry, \dosubsecentry)
	(\dosubsubsecentry):
	Calls to \tocentry (previously alias for \entry) updated.

	Report from Karl.

2023-07-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_misc_line): inline and remove
	_encoding_alias, for simpler code more similar to XS parser.

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line): update
	comments and move a variable declaration.

2023-07-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/IXIN.pm (output_ixin): take encoding information
	from image element.

2023-07-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (encoded_input_file_name),
	tp/Texinfo/Convert/Utils.pm (expand_verbatiminclude)
	(encoded_input_file_name): put encoded_input_file_name in
	Texinfo::Convert::Utils, and make encoded_input_file_name in
	Texinfo::Convert::Converter a wrapper around it.  Add an optional
	argument to encoded_input_file_name to specify the input file
	encoding.  Use encoded_input_file_name in expand_verbatiminclude
	with the optional argument.

	* tp/texi2any.pl: initialize correctly the converter used when
	SORT_ELEMENT_COUNT is set.  Use the converter more consistently to
	find customization variables and methods.

2023-07-16  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): OUTPUT_PERL_ENCODING should always be set
	in converters, so use nly that variables to set output encoding.

2023-07-16  Patrice Dumas  <pertusus@free.fr>

	* tp/t/08misc_commands.t (comment_space_command_on_line): remove
	redundant xml test.

2023-07-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (get_parser_info),
	tp/Texinfo/XS/parsetexi/api.c (build_global_info),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line)
	<documentencoding>, tp/Texinfo/XS/parsetexi/parser.c
	(wipe_global_info): do not set input_perl_encoding in the XS parser,
	set in perl code in Parsetexi.pm get_parser_info.

2023-07-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_misc_line),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line): remove
	input_perl_encoding from documentencoding extra hash.

2023-07-15  Patrice Dumas  <pertusus@free.fr>

	Replace extra input_perl_encoding by input_encoding_name in elements

	* tp/Texinfo/Common.pm (element_extra_encoding_for_perl),
	tp/Texinfo/Convert/Converter.pm (txt_image_text),
	tp/Texinfo/Convert/Text.pm (converter), tp/Texinfo/Convert/Utils.pm
	(expand_verbatiminclude), tp/Texinfo/ParserNonXS.pm
	(_end_line_misc_line, _handle_close_brace),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line),
	tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace): use
	input_encoding_name instead of input_perl_encoding in tree extra
	elements.  Add element_extra_encoding_for_perl to Texinfo::Common
	to find perl encoding based on element extra input_encoding_name.

2023-07-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/separator.c (handle_open_brace) <verb>:
	handle a non-ascii verb delimiter.

	* tp/Makefile.tres, tp/t/formats_encodings.t
	(verb_delimiter_not_ascii): new test to test non ascii @verb
	delimiters.

2023-07-15  Patrice Dumas  <pertusus@free.fr>

	* tp/t/formats_encodings.t (dotless_argument_non_ascii): add the
	test of braced non-ascii argument of @dotless.

2023-07-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line)
	<accent commands>: use an element string to get a whole UTF-8
	character in error message on dotless argument.

	* tp/Makefile.tres, tp/t/formats_encodings.t
	(dotless_argument_non_ascii): new test to test the dotless incorrect
	argument error message with a non-ascii character.

2023-07-15  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/t/formats_encodings.t (accent_argument_non_ascii): Enable.

2023-07-15  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line)
	<accent commands>: Count UTF-8 continuation bytes for character
	following accent command.  Report from Patrice.

2023-07-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/formats_encodings.t: add
	accent_argument_non_ascii test.  Set it to be skipped as the result is
	incorrect with the XS parser for now.

2023-07-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (_convert): avoid undef warning
	with definfoenclose by checking that $brace_commands{} exists.
	Change in spaces.

2023-07-15  Patrice Dumas  <pertusus@free.fr>

	Distinguish input text macro context and input text macro expansion

	* tp/Texinfo/ParserNonXS.pm (_input_push_text, _next_text)
	(_process_remaining_on_line), tp/Texinfo/XS/parsetexi/input.c
	(next_text, input_push_text), tp/Texinfo/XS/parsetexi/parser.c
	(process_remaining_on_line): the macro name passed to
	input_push_text means that the text comes from macro expansion.
	The input stack is used to determine if alreay in macro context.

2023-07-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_macro_command_line)
	(_expand_macro_arguments, _end_line, _handle_macro)
	(_process_remaining_on_line), tp/Texinfo/XS/parsetexi/end_line.c
	(end_line_misc_line), tp/Texinfo/XS/parsetexi/macro.c
	(parse_macro_command_line, expand_macro_arguments, handle_macro),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line):
	synchronize debug messages, move code around to be more consistent
	across parsers, 

	* tp/Texinfo/ParserNonXS.pm (_handle_comma): remove retval return
	value, it is only set to the same value as the default in the caller.

	* tp/Texinfo/ParserNonXS.pm (_new_macro, _process_remaining_on_line):
	add _new_macro function to be more in line with XS parser.

	* tp/Texinfo/ParserNonXS.pm (_expand_macro_body, _handle_macro): allow
	macrobody to be undef if there is no content, similar to XS parser.

2023-07-14  Patrice Dumas  <pertusus@free.fr>

	* tp/t/60macro.t: add spaces after bad macro specification argument.

2023-07-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (run_stage_handlers): do not output the
	code handler reference, instead use an index to determine the handler.

2023-07-14  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: mention @linemacro

2023-07-14  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Generic Definition Commands), NEWS:
	Document @deftypeline.

2023-07-12  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: remove reverted change about index commands ending
	paragraphs.

2023-07-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_misc_line)
	(_handle_menu_entry_separators, _handle_line_command)
	(_handle_open_brace, _handle_comma),
	tp/Texinfo/XS/parsetexi/handle_commands.c (parse_rawline_command)
	(handle_line_command), tp/Texinfo/XS/parsetexi/menus.c
	(handle_menu_entry_separators), tp/Texinfo/XS/parsetexi/parser.c
	(process_remaining_on_line), tp/Texinfo/XS/parsetexi/separator.c
	(handle_comma): synchronize debug messages across parsers.

	* tp/Texinfo/ParserNonXS.pm (_handle_open_brace),
	tp/Texinfo/XS/parsetexi/separator.c (handle_comma): rearrange code
	related to inline type.

2023-07-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_html_set_pages_files): set up a
	reproducible order following the tree units order for the call
	of set_file_path.

2023-07-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/debug.c (debug_print_element)
	(debug_print_protected_string): use fputs instead of debug_nonl to
	output a string when there is no need for formats.

2023-07-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_handle_open_brace)
	(_process_remaining_on_line): handle @verb delimiter determination
	in handle_open_brace to do the same as in the XS parser.

2023-07-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/separator.c (handle_open_brace): call
	new_line after verb opening brace if the line is an empty string
	in case the delimiter is in macro expansion.

2023-07-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/60macro.t: add macro_for_verb test.

2023-07-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/65linemacro.t: add
	end_conditional_in_linemacro test.

2023-07-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line, _handle_macro)
	(_handle_menu_entry_separators, _handle_open_brace)
	(_process_remaining_on_line, _parse_texi): use exactly the
	whitespace_chars_except_newline chracters from the XS parser
	in matching.

	* tp/Texinfo/ParserNonXS.pm (_debug_protect_eol)
	(_process_remaining_on_line): use a function to protect eol in debug
	messages.

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): add
	debug message for form feeds.

2023-07-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_expand_macro_arguments),
	tp/Texinfo/XS/parsetexi/macro.c (expand_macro_arguments): simplify XS
	parser code.  More consistent code.

2023-07-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_close_current, _expand_macro_arguments)
	(_handle_menu_entry_separators, _handle_close_brace)
	(_process_remaining_on_line, _parse_line_command_args),
	tp/Texinfo/XS/parsetexi/close.c (close_all_style_commands)
	(close_commands), tp/Texinfo/XS/parsetexi/context_stack.c
	(context_name), p/Texinfo/XS/parsetexi/macro.c
	(expand_macro_arguments), tp/Texinfo/XS/parsetexi/menus.c
	(handle_menu_entry_separators), tp/Texinfo/XS/parsetexi/parser.c
	(abort_empty_line, process_remaining_on_line, parse_texi), 
	tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace): synchronize
	debug messages.

	* tp/Texinfo/ParserNonXS.pm (_expand_macro_arguments),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line):
	more similar codes for both parsers.


2023-07-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs (reset_parser),
	tp/Texinfo/XS/parsetexi/api.c (reset_parser): pass directly DEBUG
	configuration value to reset_parser() to override previous parser
	configuration, as the configuration isn't already reset and the new
	configuration is set afterwards.  Do not call debug() in reset_parser()
	but use directly the debugging configuration input value.

2023-07-13  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Error Reporting in User Defined Functions),
	tp/Texinfo/Report.pm (line_warn, line_error),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (_get_errors), 
	tp/Texinfo/XS/parsetexi/errors.c (debug_error_warning_message)
	(line_error_internal): output directly some messages for
	warning/errors in XS parser as is done in perl parser, using
	the debug_error_warning_message function.  To avoid a redundant
	message being output when calling Texinfo::Report::line_warn or
	line_error from Parsetexi.pm _get_errors, add an argument to
	line_warn/line_error to silence the messages output normally when
	DEBUG is set.

	* tp/Texinfo/ParserNonXS.pm (parser, simple_parser)
	(_process_remaining_on_line), tp/Texinfo/XS/parsetexi/close.c
	(close_container), tp/Texinfo/XS/parsetexi/debug.c (debug_protect_eol)
	(debug_print_protected_string), tp/Texinfo/XS/parsetexi/input.c
	(next_text), tp/Texinfo/XS/parsetexi/parser.c
	(process_remaining_on_line, parse_texi): synchronize debug messages.

2023-07-12  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo-tex-test.texi (Definitions): Add a needed
	"@clear txidefnamenospace" before examples.

2023-07-12  Gavin Smith <gavinsmith0123@gmail.com>

	No custom gendocs template any more

	* doc/gendocs.chapter/gendocs_template: Remove.  Not needed
	any more following gnulib update.
	* doc/Makefile.am (wwwdoc-build): Update.
	* README-hacking: mention necessity of installing texinfo.tex to
	run "make wwwdoc-build".

2023-07-12  Gavin Smith <gavinsmith0123@gmail.com>

	No space for @ def line continuation

	* doc/texinfo.texi (\argremovespace): Remove macro handling
	@(newline).  This should only occur in line arguments on @def*
	lines and we do not need the complicated handling of it generally.
	Handling @(newline) in here makes it very hard to make any changes
	that just affect @def*.
	(\argremovespace): Reinstate definition from 2003-11-22 to handle
	stripping a space token from the end of an argument, which is
	simpler and all that is needed for most calls.
	(\printname, \defunargs): Make @<newline> sequence expand to
	nothing.  This matches the behaviour of texi2any.

	bug-texinfo discussion, 7 Apr 2023.

2023-07-12  Gavin Smith <gavinsmith0123@gmail.com>

	XS file copyright notices

	* tp/Texinfo/XS/MiscXS.xs
	* tp/Texinfo/XS/XSParagraph.xs,
	* tp/Texinfo/XS/parsetexi/Parsetexi.xs:
	Move or add copyright notice further up in files.

2023-07-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (%parser_state_initialization)
	(_end_line_def_line, _process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/api.c (reset_parser_except_conf),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line):
	add in_parsing_only state set when only parsing should process,
	not any processing (error message, rearranging of the tree...).

	* tp/Texinfo/ParserNonXS.pm (%parser_state_initialization, _next_text)
	(_process_remaining_on_line): remove value_stack, use a simpler
	integer as indicator of the number of values expansion,
	value_expansion_nr, as in the XS parser.

	* tp/Texinfo/XS/parsetexi/close.c (close_commands): no debug message
	if stopping closing at ET_root_line.

	* tp/Texinfo/ParserNonXS.pm (_close_all_style_commands, _next_text)
	(_end_line_misc_line, _end_line_starting_block, _end_line)
	(_handle_other_command, _handle_open_brace, _parse_line_command_args),
	tp/Texinfo/XS/parsetexi/close.c (close_current),
	tp/Texinfo/XS/parsetexi/context_stack.c (context_name),
	tp/Texinfo/XS/parsetexi/end_line.c (parse_line_command_args)
	(end_line_starting_block, end_line_misc_line, end_line),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_brace_command),
	tp/Texinfo/XS/parsetexi/parser.c (parent_of_command_as_argument)
	(process_remaining_on_line), tp/Texinfo/XS/parsetexi/separator.c
	(handle_open_brace, handle_close_brace),
	tp/Texinfo/XS/parsetexi/source_marks.c (place_source_mark):
	add context_name function in XS parser. Modify debug messages,
	synchronize debug messages across both parsers.


2023-07-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/close.c (remove_empty_content)
	(close_container, close_commands), tp/Texinfo/XS/parsetexi/end_line.c
	(end_line_def_line, end_line_starting_block, end_line),
	tp/Texinfo/XS/parsetexi/parser.c (merge_text, abort_empty_line)
	(isolate_last_space), tp/Texinfo/XS/parsetexi/source_marks.c
	(place_source_mark): do not use print_element_debug without free'ing
	the result string, instead use debug_print_element more to avoid
	memory leaks.  Report and idea of fix from Gavin.

2023-07-11  Gavin Smith <gavinsmith0123@gmail.com>

	NEWS: Mention CHECK_NORMAL_MENU_STRUCTURE change.

2023-07-11  Gavin Smith <gavinsmith0123@gmail.com>

	Warnings for missing menu entries

	* tp/Texinfo/Structuring.pm (complete_node_tree_with_menus):
	Give a warning for missing menu entries even if
	CHECK_NORMAL_MENU_STRUCTURE is not set.

	Report from Bruno Haible.

2023-07-11  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi: Fix structuring errors revealed by
	CHECK_NORMAL_MENU_STRUCTURE=1.

2023-07-10  Patrice Dumas  <pertusus@free.fr>

	* util/texinfo.dtd: fix typo in link attribute declaration.

2023-07-10  Gavin Smith <gavinsmith0123@gmail.com>

	@link for "Texinfo XML"

	* tp/Texinfo/Convert/TexinfoMarkup.pm (%commands_args_elements):
	Add 'link'.
	(_convert): Handle @link like @inforef.
	* util/texinfo.dtd: Add link element and its subelements.

2023-07-10  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (@link), NEWS: Document @link.
	* doc/texinfo.texi (Info Format FAQ): Mention possibility of @link.

2023-07-10  Gavin Smith <gavinsmith0123@gmail.com>

	* util/texinfo.dtd: Add 'link'.

2023-07-10  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/t/converters_tests.t (link): New test.

2023-07-10  Gavin Smith <gavinsmith0123@gmail.com>

	@link for DocBook

	* tp/Texinfo/Convert/DocBook.pm (_convert): Handle @link.

2023-07-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_close_current),
	tp/Texinfo/XS/parsetexi/close.c (close_current): use the current
	element returned by end_line_misc_line and end_line_starting_block,
	and get the parent/call close_container for each type.

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line): unset parent
	field of linemacro_call container in source mark.

	* tp/Texinfo/ParserNonXS.pm (_close_container),
	tp/Texinfo/XS/parsetexi/close.c (close_container): output a debug
	message even if there are source marks.

	* tp/Texinfo/Structuring.pm (sectioning_structure): change in debug
	message.

2023-07-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_remove_empty_content, _close_container),
	tp/Texinfo/XS/parsetexi/close.c (remove_empty_content)
	(close_container): synchronize debug messages across the parsers.
	Use more print_element_debug instead of debug_print_element in XS
	parser.

2023-07-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (debug_command_name, debug_print_element),
	tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/debug.c (debug_command_name)
	(print_element_debug), tp/Texinfo/XS/parsetexi/parser.c
	(process_remaining_on_line): escape \n and \t in command name in
	debug messages for better readability.

2023-07-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_debug_show_source_mark)
	(_place_source_mark, _merge_text),
	tp/Texinfo/XS/parsetexi/source_marks.c (source_mark_name)
	place_source_mark), tp/Texinfo/XS/parsetexi/tree_types.h
	(source_marks_names): more similar code in perl parser than in XS
	parser, same source marks debug message in XS parser than in perl
	parser.

	* tp/Texinfo/XS/parsetexi/api.c (store_source_mark_list),
	tp/Texinfo/XS/parsetexi/tree_types.h (enum source_mark_status): remove
	unused SM_status_fail source mark status.

2023-07-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (%parser_state_initialization, _next_text)
	(_handle_macro): register the number of expanded macros in a scalar
	and go through input to check if a macro is being expanded instead
	of keeping a stack of expanded macros, also to be more similar with
	XS parser.

	* tp/Texinfo/ParserNonXS.pm (_isolate_last_space),
	tp/Texinfo/XS/parsetexi/close.c (close_current),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line)
	(end_line_starting_block), tp/Texinfo/XS/parsetexi/macro.c
	(handle_macro), tp/Texinfo/XS/parsetexi/parser.c (isolate_last_space):
	add debug messages in XS parser to match better perl parser.

2023-07-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (debug_print_element),
	tp/Texinfo/ParserNonXS.pm (_merge_text, _abort_empty_line)
	(_isolate_last_space, _end_line_misc_line, _parse_texi),
	tp/Texinfo/XS/parsetexi/context_stack.c (push_context, pop_context),
	tp/Texinfo/XS/parsetexi/debug.c (print_element_debug),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line),
	tp/Texinfo/XS/parsetexi/macro.c (parse_macro_command_line),
	tp/Texinfo/XS/parsetexi/parser.c (merge_text, abort_empty_line)
	(parse_texi): shorten debug messages, synchronize debug messages of
	perl and XS parsers to some extent.

2023-07-07  Patrice Dumas  <pertusus@free.fr>

	* tp/t/65linemacro.t, tp/Makefile.tres: add blockitem_no_item
	test.

2023-07-02  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\link): Call \unsepspaces in case
	@link is used in @example environment, to stop the label
	in e.g. @link{One, Three} being taken as " Three" with a
	extra leading space.  Report from Andreas Falkenhahn.

2023-06-25  Gavin Smith <gavinsmith0123@gmail.com>

	Rename texi2any config file

	* tp/texi2any.pl ($conf_file_name): Rename config file from
	'Config' to 'texi2any-config.pm', as 'Config' is too generic
	and can clash with other uses.
	* doc/texi2any_api.texi (Loading Init Files): Update.

	Report from Jun T <takimoto-j@kba.biglobe.ne.jp>.

2023-06-11  Gavin Smith <gavinsmith0123@gmail.com>

	@link for LaTeX

	* tp/Texinfo/Convert/LaTeX.pm (_convert): Handle @link.

2023-06-10  Paul Eggert <eggert@cs.ucla.edu>

	* doc/texinfo.tex: Fix two misspellings in comments.
	Originally reported by Josh Soref <jsoref@gmail.com> in:
	https://lists.gnu.org/r/bug-gnulib/2023-06/msg00057.html

2023-06-05  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: Correct name of new variable.

2023-05-17  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/debug.h: Change include guard symbol to
	avoid clash with Perl headers.  Report from Werner.  Remove copyright
	notice, as this file is trivial.

2023-05-05  Gavin Smith <gavinsmith0123@gmail.com>

	@link for HTML

	* tp/Texinfo/Convert/HTML.pm (%default_commands_args):
	Add 'link', copied from 'inforef'.
	(_convert_xref_commands): Treat 'link' similarly to 'ref', but
	with the arguments of 'inforef'.
	Do not prefix a user-provided label with a parenthesised manual.

2023-05-05  Gavin Smith <gavinsmith0123@gmail.com>

	Error checking for @link and @inforef

	* tp/Texinfo/command_data.txt (link): Add ref flag.
	* tp/Texinfo/ParserNonXS.pm (_handle_close_brace) <ref command>,
	* tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace):
	Handle @link the same as @inforef.  Add internal @link and @inforef
	to list of internal references, which results in check being done
	in Texinfo/Structuring.pm for references to non-existent nodes.

2023-05-05  Gavin Smith <gavinsmith0123@gmail.com>

	@link for Info output

	* tp/Texinfo/command_data.txt: Add @link.
	* tp/Texinfo/Convert/Plaintext.pm (_convert): Handle.

2023-04-21  Gavin Smith <gavinsmith0123@gmail.com>

	* info/infomap.c (default_vi_like_info_keys): Add BackTab for
	info_move_to_prev_xref.
	Report from Sebastian Carlos <sebaaa1754@gmail.com>

2023-04-16  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert):
	Do not insert into  'current_contents' array at all.  Do not
	copy 'contents' array when converting element contents.  This
	save space and time.
	<xref commands, index entry commands> Adapt to fact that
	elements are not removed from 'current_contents' as they are
	converted, so current element is still present.

2023-04-15  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert):
	Insert into 'current_contents' array less, rather calling
	_convert recursively on added material.  This seems more
	straightforward than modifying an array that we are iterating
	over.

2023-04-15  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert):
	Move handling of cross-reference commands earlier.

2023-04-15  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert):
	Combine brace commands into a single conditional block
	so all the checks for these can be easily skipped.

2023-04-15  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/api.c (store_source_mark_list):
	Use newRV_noinc when refering to objects we have just created.
	(store_additional_info): Use sv_2mortal on created hash.

2023-04-14  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/api.c (Root): Declare as a static
	pointer.  For some reason, even though the symbol was undefined
	in the XS library, the program still ran, although much slower.

2023-04-14  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/api.c (reset_parser_except_conf):
	Always call destroy_element_and_children.

2023-04-14  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/tree.c (reset_obstacks):
	Do not call obstack_init more than once.  Storage was not
	being reused in the obstack.
	(alloc_element): Zero element.
	(alloc_and_zero): Do not use for obstack_chunk_alloc definition,
	and remove.

2023-04-14  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line):
	Free a variable to avoid a memory leak.

2023-04-13  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: add note about Perl::Destruct::Level.

2023-04-13  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/api.c (element_to_perl_hash)
	(build_single_index_data, build_global_info, build_global_info2)
	(build_source_info_hash, convert_error): Use newRV_noinc instead
	of newRV_inc when we have just created a Perl object that we
	are taking a reference to, as the object already has a reference
	count of 1.

2023-04-13  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/tree.c (spare_element, new_element)
	(destroy_element, reset_obstacks): Reuse storage from
	destroy_element, which is called a lot from abort_empty_line.
	* tp/Texinfo/XS/parsetexi/end_line.c (end_line): Disable
	check for infinite loop when closing commands.

2023-04-12  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/tree_types.h (ELEMENT):
	Reorder fields slightly.

2023-04-11  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/tree.c: Remove some commented-out code.

2023-04-11  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/tree.c (alloc_and_zero): New function
	to wrap calloc.  Use for obstack_chunk_alloc definition.
	(new_element): Remove explicit initialisation code.

2023-04-10  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/tree_types.h (ELEMENT):
	Contain ASSOCIATED_INFO structures as subfields rather than
	as pointers outside the structure.  This avoids having to
	allocate these objects separately and may improve memory cache
	performance.
	* tp/Texinfo/XS/parsetexi/tree.c (alloc_associated_info)
	(new_associated_info): Remove.
	(destroy_associated_info): Do not free the ASSOCIATED_INFO
	object itself.
	(destroy_element): Call destroy_associated_info to free other
	storage.

2023-04-10  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/api.c (build_single_index_data):
	Remove commented-out code.  Combine conditional blocks.  Use
	av_unshift and av_store instead of av_push.

2023-04-10  Gavin Smith <gavinsmith0123@gmail.com>

	Run 'gnulib-tool --add-import obstack' under tp/Texinfo/XS.

2023-04-10  Gavin Smith <gavinsmith0123@gmail.com>

	Obstacks for parsetexi

	* tp/Texinfo/XS/parsetexi/tree.c (alloc_element, alloc_associated_info)
	(reset_obstacks): Use obstack allocation for tree elements.
	(new_associated_info, new_element): Call new functions.
	(destroy_element): Do not call 'free' on obstack-allocated storage.
	* tp/Texinfo/XS/parsetexi/api.c (reset_parser_except_conf):
	Call reset_obstacks.
	(parse_string, parse_piece): Do not create tree elements until
	after calling reset_parser_except_conf.

2023-04-10  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/input.c (encode_with_iconv):
	Remove spurious comment.

2023-04-10  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: add note of LD_BIND_NOW variable for callgrind

2023-04-10  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/api.c (build_perl_array)
	(store_additional_info, element_to_perl_hash)
	(build_target_elements_list, build_internal_xref_list):
	Use av_unshift to extend array followed by av_store instead
	of av_push for each element.

2023-04-10  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/api.c (build_perl_array):
	Remove case checking for a null pointer that we unconditionally
	dereferenced afterwards anyway.

2023-04-09  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (xspara_add_text):
	Use btowc instead of mbrtowc for printable ASCII characters.

2023-04-09  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/api.c (element_to_perl_hash): Precompute
	hash arguments for hv_store using PERL_HASH macro.

2023-04-09  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (PRINTABLE_ASCII): New macro.
	(xspara__add_next): Use btowc for printable ASCII bytes rather
	than mbrtowc.

2023-04-09  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/debug.c (debug_print_element):
	Do not construct dump string for element unless it will actually
	be printed.
	(print_element_debug): Declare as static.

2023-04-09  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/api.c (reset_parser_except_conf):
	Keep a few old values of the 'Root' pointer to avoid calling
	destroy_element_and_children on the main tree, which takes a
	significant length of time.

2023-04-09  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: mention callgrind for XS modules

2023-04-09  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (xspara__add_next): When getting
	display length of text, optimize for the common case of printable
	ASCII characters, not calling mbrtowc or wcwidth for such.

2023-04-09  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (xspara_add_text):
	Use a static buffer rather than calling malloc and free.  This
	is significant as it is done for nearly every character output.

2023-04-09  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (xspara__add_next): Do not use mbrlen
	to go back one UTF-8 code point; use elementary operations instead.
	Use strchr instead of wcschr to check for end-of-word punctuation.

2023-04-09  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (xspara__add_next),
	* tp/Texinfo/Convert/ParagraphNonXS.pm (_add_next):
	Move code into a conditional block as it will only be run if
	that block is run.

2023-04-09  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (xspara_add_text): Only call mbrtowc
	after if current character is an ASCII space character, for which
	case this is not needed.

2023-04-08  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (xspara_add_text, xspara_add_next):
	Receive length of strings as an argument and return lengths in
	structure.  This avoids having to call strlen.

2023-04-08  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert): Inline the most
	frequently used call to _count_added for efficiency.

2023-04-07  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert):
	Check for accent command after checking for style command
	as accents commands are slightly less used.

2023-04-07  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert):
	Use $type variable instead of accessing 'type' value in hash.

2023-04-07  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert): Assign
	variables $type and $command earlier so we can use them in
	a condition.  Swap two blocks of code dealing with spaces to
	put the more frequently used one first, which may have a
	minor reduction in runtime.

2023-04-06  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\startxreflink): Use \ifpdforxetex conditional
	to avoid duplicating code for both cases.

2023-04-06  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Line macros): Add space in example before
	line continuation character.  Add index entries.

2023-04-06  Gavin Smith <gavinsmith0123@gmail.com>

	* TODO.HTML: Update location of webkitgtk-info sources

2023-04-05  Gavin Smith <gavinsmith0123@gmail.com>

	Avoid gnulib/Perl definition clash

	* tp/Texinfo/XS/MiscXS.xs,
	* tp/Texinfo/XS/misc.c,
	* tp/Texinfo/XS/parsetexi/Parsetexi.xs,
	* tp/Texinfo/XS/xspara.c [defined _WIN32 && !defined __CYGWIN__]:
	'#undef free' after including "perl.h" and before including
	"XSUB.h" to avoid warnings about redefining symbols in Perl
	headers that Gnulib already redefined.	(Same change made on
	2022-10-22 to other files.)  From Eli and Arash Esbati.

2023-04-05  Gavin Smith <gavinsmith0123@gmail.com>

	intptr_t for KEY_PAIR

	* tp/Texinfo/XS/parsetexi/tree_types.h (KEY_PAIR):
	Store 'value' field as an 'intptr_t', which is said to
	allow storage of pointer values, and may avoid possible
	warnings of pointer/integer casts when storing integer values,
	especially on MS-Windows.  Consequent changes throughout the
	rest of the code.

	* tp/Texinfo/XS/parsetexi/extra.c
	(lookup_extra_element, lookup_info_element): New functions to
	simplify some code that called lookup_info and lookup_extra.

	Suggestion From Eli.

2023-04-04  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Line Macros): Change second example to
	show use of braces for the return type for @deftypeline.

2023-04-04  Gavin Smith <gavinsmith0123@gmail.com>

	@link in texinfo.tex

	* doc/texinfo.tex (\xrefX, \getprintedrefname, \startxreflink):
	Split out \getprintedrefname and \startxreflink so we can reuse
	this code.
	(\link): New experimental command for creating plain link in
	PDF output with no page number or decoration around link.
	(\definedummies): Add \link.

	Suggestion from Andreas Falkenhahn (help-texinfo, February 2023).

2023-04-03  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/def.c (parse_def): Treat @deftypeline
	like @deftypefn in alternating between typearg and arg in arguments.

2023-04-03  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/t/19def.t (deftypeline): New test.

2023-04-03  Gavin Smith <gavinsmith0123@gmail.com>

	@deftypeline in texi2any

	* tp/Texinfo/command_data.txt,
	* tp/Texinfo/Common.pm (%def_map),
	* tp/Texinfo/XS/parsetexi/def.c (def_maps):
	Add @deftypeline.

	* tp/Texinfo/ParserNonXS.pm (_gather_def_item, _end_line_def_line),
	* tp/Texinfo/XS/parsetexi/def.c (gather_def_item),
	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line),
	* tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command):
	Treat @deftypeline the same as @defline.

	* tp/Texinfo/Convert/DocBook.pm (%defcommand_name_type),
	* tp/Texinfo/Convert/LaTeX.pm (_convert),
	* tp/Texinfo/Convert/Plaintext.pm (_convert),
	* tp/Texinfo/Convert/TexinfoMarkup.pm (%defcommand_name_type):
	Handle @deftypeline.

2023-04-03  Gavin Smith <gavinsmith0123@gmail.com>

	* install-info/Makefile.am (LDADD): Add $(GETRANDOM) in attempt
	to fix missing BCryptGenRandom symbol on MinGW.

2023-04-03  Gavin Smith <gavinsmith0123@gmail.com>

	Run gnulib-tool --add-import

2023-04-03  Gavin Smith <gavinsmith0123@gmail.com>

	* install-info/install-infoc (output_dirfile): Use chmod
	instead of fchmod as fchmod doesn't exist on MinGW.  From
	Arash Esbati.

2023-04-03  Gavin Smith <gavinsmith0123@gmail.com>

	* info/pcterm.c (MAX): Add definition (removed on 2023-01-15).
	Report from Arash Esbati.

2023-04-02  Gavin Smith <gavinsmith0123@gmail.com>

	* info/indices.c (info_indices_of_file_buffer): Check for
	N_IsIndex flag on index nodes.  This has the effect that typing
	'i<ret>' avoids taking you to a node with "Index" in the name
	that is not a real index, as long as there are other nodes with
	the index marker in them.

2023-04-02  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/HTML.pm (%default_no_arg_commands_formatting):
	In 'preformatted' context, use '...' for @dots as well as for
	@enddots.  This is because a monospaced ellipsis looks bad inside
	@example.

2023-04-02  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/t/22xtable.t (item_index_transformation):
	New test using 'relate_index_entries_to_item' transformation.

2023-04-02  Gavin Smith <gavinsmith0123@gmail.com>

	* util/htmlxref.cnf (gdb, stabs): Update.
	From Thérèse Godefroy <godef.th@free.fr>

2023-04-02  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm
	(_handle_brace_command, _handle_open_brace):
	Duplicate 'source_info' hashes to avoid disparity with XS test results.

2023-04-02  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Common.pm (_relate_index_entries_to_table_items_in):
	Relocate index entries before setting 'entry_associated_element'.

2023-04-02  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/multitable.c (gather_previous_item):
	Rename variables to match XS code.
	* tp/Texinfo/ParserNonXS.pm (_gather_previous_item): add comment.

2023-04-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_texi),
	tp/Texinfo/XS/parsetexi/context_stack.c (in_context),
	tp/Texinfo/XS/parsetexi/parser.c (parse_texi): if in a linemacro
	command expansion at the end of input, call end_line to get new input
	corresponding to the linemacro command expansion.

	* tp/t/65linemacro.t, tp/Makefile.tres: add brace_command_not_closed,
	verb_not_closed and paragraph_no_paragraph tests.

2023-03-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line): if a linemacro
	command call is nested on a line, return instead of closing
	the precedeing commands as they may use the expansion result.

	* tp/Texinfo/ParserNonXS.pm (_end_line): fix name of linemacro
	call type.

	* tp/Texinfo/ParserNonXS.pm (_handle_close_brace): avoid a potential
	undefinition message.

	* tp/t/65linemacro.t, tp/Makefile.tres: add
	simple_nested_linemacro_calls and nested_linemacro_calls tests.

	* tp/t/60macro.t: always call @phooindex in
	macro_alias_definfoenclose_defindex and not phoo.

2023-03-28  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Line Macros): Write node documenting @linemacro.

2023-03-27  Gavin Smith <gavinsmith0123@gmail.com>

	Fix PDF page labels if pages appear between title page and contents

	* doc/texinfo.texi (\contentsendroman): Record end of contents
	in new count register, \contentsendcount.  Reset \pageno to 1.
	(\pagelabels): Check \contentsendcount to support case of @contents
	appearing at end of document.

	Arnold Robbins reported that Roman numerals would be used for the
	PDF page labels throughout the gawk manual.  This was because the
	two dedication pages before the contents were being treated as the
	Arabic-numbered pages in the document.

2023-03-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_next_bracketed_or_word_agg),
	tp/Texinfo/XS/parsetexi/def.c (next_bracketed_or_word_agg): to be
	consistent with Texinfo TeX, only spaces delimitates arguments,
	matching braces (bracketed_arg) do not automatically start a new
	argument.

	* tp/t/65linemacro.t: change braces_after_text to use @defline and
	@defblock to have results easier to interpret.

2023-03-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_handle_macro)
	(_process_remaining_on_line), tp/Texinfo/XS/parsetexi/macro.c
	(handle_macro): rename arguments_container variable as
	macro_call_element for consistency.

2023-03-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): do not
	set source_info for linemacro call container.

2023-03-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_def): use code more similar to XS
	parser to set the def_role for the rest or arguments.

	* tp/Texinfo/XS/parsetexi/def.c (parse_def): rename next_type as
	set_type_not_arg.

2023-03-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_def),
	tp/Texinfo/XS/parsetexi/def.c (parse_def),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line): handle
	linemacro without argument, by correct memory initialization, checking
	that there is a last argument and avoiding destroying element if
	it was not initialized.

	* tp/Texinfo/ParserNonXS.pm (_parse_def): do not increase results
	index, similar to XS parser.

	* tp/Makefile.tres, t/65linemacro.t: add missing_formal_arg and
	no_arguments tests.

2023-03-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/def.c (parse_def): do not increase the
	index in the result array, such as to have the value at that index
	set.

2023-03-27  Patrice Dumas  <pertusus@free.fr>

	* tp/t/65linemacro.t, tp/Makefile.tres: add tests of @linemacro.

2023-03-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_split_def_args)
	(_next_bracketed_or_word_agg, _parse_def): add
	_next_bracketed_or_word_agg and modify _parse_def to use the same code
	as the XS parser, which is much cleaner.

	* tp/Texinfo/ParserNonXS.pm (_parse_def, _end_line_def_line),
	tp/Texinfo/XS/parsetexi/def.c (parse_def, end_line_def_line): do not
	put spaces in the last linemacro defined command call argument.

2023-03-26  Patrice Dumas  <pertusus@free.fr>

	linemacro implementation for the XS Parser

	* tp/Texinfo/XS/parsetexi/api.c (linemacro_expansion),
	tp/Texinfo/XS/parsetexi/context_stack.h (no_paragraph_context),
	tp/Texinfo/XS/parsetexi/def.c (parse_def),
	tp/Texinfo/XS/parsetexi/element_types.txt,
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line)
	(end_line_misc_line, end_line),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_block_command),
	tp/Texinfo/XS/parsetexi/macro.c (handle_macro),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line)
	(parse_texi), tp/Texinfo/XS/parsetexi/separator.c (handle_open_brace),
	tp/Texinfo/XS/parsetexi/source_marks.c (register_source_mark)
	(source_marks_reset_counters): handle @linemacro and linemacro defined
	command calls using the same design as for perl Parser.

	* tp/Texinfo/ParserNonXS.pm (%no_paragraph_contexts): set
	ct_linecommand to be no paragraph context.

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line):
	change code opening arguments_container line_arg for linemacro command
	call to be more like XS parser.

2023-03-26  Gavin Smith <gavinsmith0123@gmail.com>

	* NEWS: add 7.0.3 news.
	* README-hacking: update

2023-03-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/def.c (parse_def),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line),
	tp/Texinfo/XS/parsetexi/tree_types.h (DEF_ARG): return parsed
	definition information as a list of DEF_ARG argument type name and
	element, instead of setting the types of arguments as structure
	fields.  Remove DEF_INFO type.

2023-03-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/def.c (DEF_MAP, def_maps, parse_def): pass
	the list of def commands arguments by using a list of arguments names
	as strings.  This is a first step to allow to generalize parse_def
	to be able to handle linemacro defined arguments with arbitrary names
	and is more similar to the perl parser.

2023-03-26  Patrice Dumas  <pertusus@free.fr>

	linemacro implementation for the perl Parser

	* tp/Texinfo/ParserNonXS.pm (_parse_def, _end_line_misc_line)
	(_end_line_def_line, _handle_macro, _handle_block_command)
	(_handle_open_brace, _process_remaining_on_line, _parse_texi),
	tp/Texinfo/command_data.txt: handle @linemacro and linemacro defined
	command calls.  The associated command call arguments parsing is
	different than for regular @macro.  In _handle_macro start a
	linemacro_call container, but do not parse the arguments.  In
	_process_remaining_on_line add the linemacro_call container to the
	tree and start a line_arg in ct_linecommand, to let regular Texinfo
	code parsing proceed similar to @def lines, with a special treatment
	of @ at end of lines.  At end of line, use _parse_def to determine
	arguments, reusing part of the code used for @def*.  Replace with
	linemacro body expansion text, remove the container element from the
	tree and associate it to the source mark.

	* tp/Texinfo/Convert/HTML.pm, tp/Texinfo/Convert/LaTeX.pm,
	tp/Texinfo/Convert/Plaintext.pm, tp/Texinfo/Convert/TexinfoMarkup.pm
	(_convert), tp/Texinfo/Convert/Text.pm,
	tp/Texinfo/Convert/TextContent.pm: ignore or handle @linemacro.

	* tp/Texinfo/ParserNonXS.pm (_start_empty_line_after_command): code
	more similar to XS parser.

	* util/texinfo.dtd: add linemacro.

2023-03-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Texinfo.pm (convert_to_texinfo)
	(_expand_cmd_args_to_texi), tp/Texinfo/XS/parsetexi/convert.c
	(expand_cmd_args_to_texi, convert_to_texinfo_internal),
	tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace): consider
	spaces_before_argument (and spaces_after_argument) only in
	convert_to_texinfo_internal/convert_to_texinfo.  Call
	convert_contents_to_texinfo instead of convert_to_texinfo to avoid
	spaces appearing in messages.

2023-03-25  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Image Scaling, Predefined Indices):
	Move index commands back after @item in @table so that they are not
	considered to be part of the preceding paragraphs.  These uses of
	@table do not have empty lines to save vertical space in Info
	output.  This partially reverts change on 2022-11-26.

2023-03-25  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Common.pm (_relate_index_entries_to_table_items_in):
	Move index entries that immediately follow an @item to before the
	item.

2023-03-25  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (_gather_previous_item):
	Comments and variable names changed.  Compare expressions to zero
	explicitly to be clearer.

2023-03-23  Gavin Smith <gavinsmith0123@gmail.com>

	Make setting TEXI2DVI_BUILD_DIRECTORY equivalent to --build-dir option

	* util/texi2dvi: Make setting build dir to a directory change
	build mode from 'local' to 'tidy' regardless of whether it is
	given with --build-dir or setting the TEXI2DVI_BUILD_DIRECTORY
	envvar.
	(build_dir): Make default value empty rather than '.'.
	(usage): Update.

	Suggestion from Bogdan Drozdowski.

2023-03-21  Patrice Dumas  <pertusus@free.fr>

	Index commands do not end paragraphs in texi2any

	* tp/Texinfo/ParserNonXS.pm (_parse_line_command_args),
	tp/Texinfo/XS/parsetexi/indices.c (add_index_command): do not set
	index commands as close_paragraph.

2023-03-21  Gavin Smith <gavinsmith0123@gmail.com>

	Index commands do not end paragraphs

	* doc/texinfo.tex (\doindex, \docodeindex): Do not use \indexpar.
	(\indexpar): Remove.

	This reverts change on 2023-02-19.  It caused problems for the
	Lilypond manuals -- report from Werner.

2023-03-19  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: Update

2023-03-19  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo-tex-test.texi (Line macros):
	Test @defline with continuation.  Add example of nested @defblock
	for API documentation.

2023-03-13  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\linemacro): Do not set \scanctxt when getting
	argument in order to keep @ as the escape character, allowing
	@<NEWLINE> to be kept as a line continuation character for @def*.
	* doc/texinfo-tex-test.texi (Line macros): Add example.

2023-03-13  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\linemacro): Fix definition of zero-arg
	@linemacro so not to break literal backslash in macro body.
	* doc/texinfo-tex-test.texi (Line macros): More tests.

2023-03-13  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\linemacro): Parameter list in macro definition
	is in braces and surrounded by commas, the same as for @macro.
	Suggestion from Patrice.

2023-03-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/separator.c (handle_comma): when at the end
	of a line after strcspn call, do not prepend to argument text, as the
	line is empty.

2023-03-12  Gavin Smith <gavinsmith0123@gmail.com>

	Roman rather than bold for &rest etc.

	* doc/texinfo.tex (\amprm): Use \rm instead of \bf.
	* doc/texinfo.texi (Def Cmd Conventions, Sample Function Definition):
	Update.  Bold gives too much emphasis when compared with the
	headword itself, which is in tt.

2023-03-12  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\defname, \printdefname, \defcaption, \docaptionz)
	(\defmacro, \macrodef): Rename macros beginning with \def... to
	avoid possible confusion with @def* Texinfo commands.

2023-03-12  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\linemacro): Do not use @xeatspaces around
	macro arguments as this appears to be unnecessary.

2023-03-12  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\linemacrodef): Do not append space to macro
	argument line.  Require empty final argument to be given explicitly
	as {}.  Avoid extra space before arg in @example environment.
	* doc/texinfo-tex-test.texi (Line macros): Update.  Add case with
	substitution into @example environment.

2023-03-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/separator.c (handle_comma): when getting
	a line in an inline* ignored last argument, set line to the new text
	gotten, even if null, as otherwise the previously freed line (freed as
	alloc_line) may be used.

2023-03-12  Patrice Dumas  <pertusus@free.fr>

	Update po files

2023-03-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/end_line.c (parse_line_command_args): fix
	missing end of firstparagraphindent command name in message.

	* po/POTFILES.in: add tp/Texinfo/XS/parsetexi/labels.c

	* tp/Texinfo/ParserNonXS.pm: synchronize messages with XS parser.

	* tp/t/08misc_commands.t: use @firstparagraphindent insert to have it
	tested somewhere and add test of an @firstparagraphindent invalid
	argument.

2023-03-12  Patrice Dumas  <pertusus@free.fr>

	Update in-source copy of Text::Unidecode to 1.30

	* tp/Texinfo/Convert/Unicode.pm (%transliterate_map): add an explicite
	transliterations of characters in the 0080 to 009F range to an empty
	string.  Indeed, in Text::Unicode starting from version 1.25_01, those
	characters (C1 codes) are mapped to Windows-1252 characters.  We still
	consider the Unicode standard to rule and keep on transliterating to
	empty strings.

	* tp/t/nodenormalization.t: update test result without Unidecode now
	that the 0085 character has an explicit transliteration.

2023-03-12  Patrice Dumas  <pertusus@free.fr>

	Update in-source copy of Unicode::EastAsianWidth to 12.0

2023-03-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%default_special_element_info): change
	the 'order' of contents and shortcontents to have shortcontents
	separate element appear before contents separate element.

2023-03-12  Gavin Smith <gavinsmith0123@gmail.com>

	Swap contents and shortcontents

	* tp/Texinfo/Convert/HTML.pm (_convert_heading_command)
	(_contents_shortcontents_in_title, _prepare_special_elements):
	Swap the output for @contents and @shortcontents, so that
	@shortcontents is first, for CONTENTS_OUTPUT_LOCATION set to
	'after_top', 'after_title', or 'separate_element'.  From
	Arsen Arsenović.
	* NEWS: update

2023-03-12  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/separator.c (handle_open_brace):
	Move declaration out of switch block to stop compilation error.

2023-03-12  Patrice Dumas  <pertusus@free.fr>

	* tp/t/30sectioning.t: modify node name for two_nodes_at_the_end to be
	more in line with the test content.

2023-03-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/30sectioning.t: add
	two_nodes_at_the_end_nodes and two_nodes_at_the_end_texi2html.

	* tp/Makefile.tres, tp/t/40moresectioning.t: do not set TEXI2HTML in
	more_sections_than_nodes, but add more_sections_than_nodes_texi2html.

2023-03-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/30sectioning.t: add
	chapter_between_nodes_texi2html, two_nodes_between_chapters_nodes and
	two_nodes_between_chapters_texi2html.

2023-03-11  Patrice Dumas  <pertusus@free.fr>

	* tp/t/30sectioning.t, tp/Makefile.tres: add
	one_node_explicit_directions_anchor_no_use_node and
	top_without_node_texi2html_no_use_nodes tests.

2023-03-11  Patrice Dumas  <pertusus@free.fr>

	* tp/t/30sectioning.t: add
	nodes_after_top_before_chapter_no_use_nodes_chapter test.

	* tp/t/40moresectioning.t: add
	placed_things_before_element_no_use_node and
	sectioning_part_appendix_texi2html_chapter tests.

2023-03-11  Patrice Dumas  <pertusus@free.fr>

	* tp/t/40moresectioning.t, tp/Makefile.tres: add
	anchor_in_footnote_split_node and
	anchor_in_footnote_separate_split_node tests.

2023-03-11  Patrice Dumas  <pertusus@free.fr>

	* tp/t/50value.t, tp/t/60macro.t, tp/Makefile.tres: add
	closing_brace_in_value_in_ingnored_inline and
	closing_brace_in_macro_call_in_ingnored_inline with end of @inline*
	command in @value or macro expansion in the ignored @inline* command
	argument.

2023-03-11  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo-tex-test.texi (Macros):
	Show desired output for all test cases to make it easier to
	check.

2023-03-11  Gavin Smith <gavinsmith0123@gmail.com>

	Avoid spurious space in macro expansion

	* doc/texinfo.texi (\defmacro): Define a control sequence with
	\string rather than \relax.  This avoids an extra space appearing
	for an argument substituted into an environment like @example.

	* doc/texinfo-tex-test.texi (Bugs, Substitution into @example):
	Update now-working test case.

2023-03-11  Patrice Dumas  <pertusus@free.fr>

	* tp/texi2any.pl: minor changes.  Reindent, change in comments.
	Use $main_configuration instead of $converter for
	Texinfo::Common::output_files_open_out call for SORT_ELEMENT_COUNT.

2023-03-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): determine if an
	accent command argument has braces in the same way as it is done in
	other converters by checking if argument type is not
	brace_command_arg.

2023-03-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_close_current, _handle_close_brace),
	tp/Texinfo/XS/parsetexi/close.c (close_current),
	tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace): separate
	code handling bracketed_arg and balanced_braces.  No functional
	change.

2023-03-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_handle_open_brace, _handle_close_brace),
	tp/Texinfo/XS/parsetexi/separator.c (handle_open_brace,
	handle_close_brace): right in a rawpreformatted, use merge_text to
	merge an opening or a closing brace to the preceding text, if any.

2023-03-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_convert), tp/Texinfo/Convert/HTML.pm
	(_convert_balanced_braces_type), tp/Texinfo/Convert/LaTeX.pm
	(_convert), tp/Texinfo/Convert/Plaintext.pm (_convert),
	tp/Texinfo/Convert/Texinfo.pm (convert_to_texinfo),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/Convert/Text.pm (_convert),
	tp/Texinfo/Convert/TextContent.pm (_convert),
	tp/Texinfo/ParserNonXS.pm (_close_current, _handle_open_brace)
	(_handle_close_brace), tp/Texinfo/XS/parsetexi/close.c
	(close_current), tp/Texinfo/XS/parsetexi/convert.c
	(convert_to_texinfo_internal), tp/Texinfo/XS/parsetexi/separator.c
	(handle_open_brace, handle_close_brace): put braces associated to the
	balanced_braces type in the contents of the container, as text.

	* tp/Texinfo/ParserNonXS.pm (_handle_close_brace),
	tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace): abort empty
	line and close paragraph in brace_command_context commands only if the
	current container is actually a paragraph.

	* tp/t/03coverage_braces.t, tp/Makefile.tres: add
	empty_line_in_braces_in_math and
	empty_line_in_braces_in_math_at_begin_line tests.

2023-03-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_convert), tp/Texinfo/Convert/HTML.pm
	(_convert_balanced_braces_type), tp/Texinfo/Convert/LaTeX.pm
	(_convert), tp/Texinfo/Convert/NodeNameNormalization.pm (_convert),
	tp/Texinfo/Convert/Plaintext.pm (_convert),
	tp/Texinfo/Convert/Texinfo.pm (convert_to_texinfo),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/Convert/Text.pm (_convert),
	tp/Texinfo/Convert/TextContent.pm (_convert),
	tp/Texinfo/ParserNonXS.pm (_close_current, _handle_open_brace)
	(_handle_close_brace), tp/Texinfo/XS/parsetexi/close.c (close_current),
	tp/Texinfo/XS/parsetexi/convert.c (convert_to_texinfo_internal),
	tp/Texinfo/XS/parsetexi/element_types.txt,
	tp/Texinfo/XS/parsetexi/separator.c (handle_open_brace)
	(handle_close_brace): rename bracketed type as balanced_braces.

	* tp/t/01use.t: replace bracketed by bracketed_arg on @multitable
	line.

2023-03-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_convert),
	tp/Texinfo/Convert/LaTeX.pm (_convert),
	tp/Texinfo/Convert/Plaintext.pm (_convert),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/Convert/Text.pm (_convert),
	tp/Texinfo/Convert/TextContent.pm (_convert),
	tp/Texinfo/ParserNonXS.pm (_close_current, _split_def_args)
	(_end_line_starting_block, _handle_close_brace),
	tp/Texinfo/XS/parsetexi/close.c (close_current),
	tp/Texinfo/XS/parsetexi/def.c (split_def_args),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block),
	tp/Texinfo/XS/parsetexi/separator.c (handle_open_brace)
	(handle_close_brace): use 'bracketed_arg' instead of 'bracketed' on
	@multitable line for column prototypes.

2023-03-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Translations.pm (complete_indices)
	(_non_bracketed_contents): fix _non_bracketed_contents by using
	'bracketed_arg' as the type, to match with the type on @def* lines.
	But do not call _non_bracketed_contents as it is not clear that it is
	better to avoid the 'bracketed_arg' type.

2023-03-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Texinfo.pm (convert_to_texinfo),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/ParserNonXS.pm (_split_def_args, _parse_def)
	(_end_line_def_line), tp/Texinfo/XS/parsetexi/convert.c
	(convert_to_texinfo_internal), tp/Texinfo/XS/parsetexi/def.c
	(next_bracketed_or_word_agg, split_delimiters),
	tp/Texinfo/XS/parsetexi/element_types.txt,
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line): rename
	bracketed_def_content as bracketed_arg.

2023-03-10  Patrice Dumas  <pertusus@free.fr>

	No capitalization of @sc argument in node name normalization

	* NEWS, doc/texinfo.texi (HTML Xref Command Expansion),
	tp/Texinfo/Convert/NodeNameNormalization.pm (_convert),
	tp/t/nodenormalization.t: no upper-casing of @sc argument in node
	normalization (and therfore in HTML cross references).

2023-03-10  Patrice Dumas  <pertusus@free.fr>

	* tp/t/converters_tests.t, tp/t/nodenormalization.t, tp/Makefile.tres:
	test commands with lower case arguments in @var, with commands_in_var
	and a test in nodenormalization.t.

2023-03-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/NodeNameNormalization.pm (_convert),
	tp/Texinfo/Convert/Text.pm (_convert),
	tp/Texinfo/Convert/TextContent.pm (_convert),
	tp/Texinfo/ParserNonXS.pm (_handle_line_command),
	tp/Texinfo/XS/parsetexi/element_types.txt,
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command):
	rename 'misc_arg' type as 'rawline_arg'.

2023-03-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_convert): protect from upper-casing
	in @sc the node name and the associated text in @*ref.

	* tp/t/converters_tests.t, tp/t/nodenormalization.t: use a variable
	for the content common to the two test files for lower-case content to
	be tested in @sc.

2023-03-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (_process_text, new_formatter)
	(_convert): put upper casing information on a distinct stack, to be
	able to stop the upper casing context, using an internal type
	_stop_upper_case.  Use it for node and file and *note for @*ref, for
	@url and @inlineraw.

	* tp/t/info_tests.t, tp/t/nodenormalization.t: add more to
	commands_in_sc.

2023-03-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (_process_text): remove condition
	on'var' state when 'upper_case' is set, as 'upper_case' implies 'var'.

2023-03-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_docbook_section_element, _convert),
	tp/Texinfo/Convert/Info.pm (format_node), tp/Texinfo/Convert/LaTeX.pm
	(_associate_other_nodes_to_sections), tp/Texinfo/Structuring.pm
	(set_menus_node_directions), tp/Texinfo/Transformations.pm
	(insert_nodes_for_sectioning_commands): avoid autovivification, and
	use defined() for extra 'normalized' strings that can be '0'.

	* tp/Texinfo/Transformations.pm (_new_node): remove/warn about cases
	that cannot happen.

	* tp/Texinfo/Convert/Plaintext.pm (_process_text): use $context for 
	'var' state too.

2023-03-08  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Overview): Remove duplicate words.  From
	Ray Kuo <ray20140811@gmail.com>.

2023-03-08  Arsen Arsenović  <arsen@aarsen.me>

	texi2any: Don't switch to subdir mode if '-' names a dir
	* tp/texi2any.pl (output|out|o=s): If the filename argument is
	specifically '-', do not consider the possibility of it being the
	name of a subdirectory.  This prevents programs that generate info
	in a pipeline from being confused in weird working directories.

2023-03-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/info_tests.t: add commands_in_sc
	tp/t/nodenormalization.t: add two more tests, one corresponding to
	commands_in_sc.

2023-03-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (set_menus_node_directions): use in-tree
	external menu_entry_node as menu direction.

2023-03-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (output_internal_links): determine if
	index entry is in code style by checking the associated index
	information, and not the entry information.

2023-03-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_index_entries),
	tp/Texinfo/Convert/IXIN.pm, tp/Texinfo/Convert/LaTeX.pm
	(_index_entry), tp/Texinfo/Convert/Plaintext.pm (process_printindex),
	tp/Texinfo/Structuring.pm (index_entry_sort_string, sort_indices),
	tp/init/chm.pm (chm_init), tp/t/test_sort.t, tp/t/test_utils.pl (test):
	pass indices_information to sort_indices.  Set 'code' in options for
	text conversion before calling index_entry_sort_string, based on
	indices_information.

	* tp/Texinfo/Translations.pm (complete_indices): do not set in_code
	for index entries, the information should always be taken from the
	entry associated index name.

	* tp/Texinfo/Structuring.pm (sort_indices): rename $entry as
	$index_entry.

	* tp/Texinfo/Convert/HTML.pm (_prepare_index_entries),
	tp/Texinfo/Convert/Plaintext.pm (process_printindex): rename
	$index_names as $indices_information.

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_index_entry): use associated
	index information, and not the entry information to determine if index
	entry is in code style.

2023-03-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (lookup_index_entry): lookup_index_entry also
	returns index information.  Update callers.

	* tp/Texinfo/Convert/DocBook.pm (_index_entry),
	tp/Texinfo/Convert/HTML.pm (_convert_printindex_command),
	tp/Texinfo/Convert/Plaintext.pm (process_printindex), tp/init/chm.pm
	(chm_init): determine if index entry is in code style by checking the
	associated index information, and not the entry information.

	* tp/Texinfo/Convert/HTML.pm (%available_converter_info): add
	indices_information.

2023-03-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (_copy_tree, _copy_extra_info): do not setup
	any extra info in _copy_tree.  Rename _substitute_references as
	_copy_extra_info as it now copy all the extra info.  Detect if an hash
	in _substitute_references is an element, and in that case call
	_copy_tree and _copy_extra_info on that out of tree element.
	Remove FIXME for a situation that happens fine.

	* tp/Texinfo/Common.pm (_substitute_references_in_array): remove the
	case of a text element, cannot happen right now and should be done
	differently as if could be an element with other information.

2023-03-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_def, _end_line_def_line): gather
	initial arguments name, category... in a has, to be returned from the
	function after setting the extra def_role key.  Set other contents
	extra def_role key directly.  More similar to the XS parser.

2023-03-07  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (@contents_keys): remove obsolete keys.  Add
	'info'.  Remove keys within 'info'.

2023-03-07  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (_duplicate_element_keys): remove code related to
	extra keys not existing anymore.

2023-03-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/api.c (store_additional_info),
	tp/Texinfo/XS/parsetexi/extra.c (add_extra_contents_oot),
	tp/Texinfo/XS/parsetexi/tree.c (destroy_associated_info),
	tp/Texinfo/XS/parsetexi/tree_types.h (enum extra_type): remove
	extra_contents_oot extra type, remove add_extra_contents_oot
	function.

2023-03-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (_copy_tree, _substitute_references): remove
	handling of extra prototypes that do not exist anymore.

2023-03-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/element_types.txt: remove
	bracketed_multitable_prototype and row_prototype.

2023-03-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_starting_block),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_other_command):
	remove extra prototypes.  Use the number of bracketed content to set
	max_columns, and always use max_columns for the number of columns
	in the XS parser.

2023-03-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_convert),
	tp/Texinfo/Convert/LaTeX.pm (_convert),
	tp/Texinfo/Convert/Plaintext.pm (_convert),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): use directly the
	multitable line argument and the bracketed on that line to determine
	the prototype, instead of extra prototypes.

	* tp/t/plaintext_tests.t, tp/Makefile.tres: use braces on @multitable
	line for multitable_in_example_extraneous_tab, and add
	multitable_in_example_extraneous_item_tab without braces.

2023-03-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (_copy_tree, _substitute_references): handle
	def_index_element and def_index_ref_element explicitly as out of tree
	elements.

2023-03-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_def_line),
	tp/Texinfo/XS/parsetexi/api.c (store_additional_info),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line),
	tp/Texinfo/XS/parsetexi/extra.c (add_extra_misc_args),
	tp/Texinfo/XS/parsetexi/tree.c (destroy_associated_info),
	tp/Texinfo/XS/parsetexi/tree_types.h (enum extra_type):
	do not set extra def_parsed_hash in the tree.  It is easy to look at
	the contents, and in general the @def args argument need to be
	collected at the same time, such that there is a need to look at the
	contents anyway.
	Remove everything related to extra_def_info, in particular the
	add_extra_misc_args function.

2023-03-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Translations.pm (complete_indices): remove the type of
	the tree root returned by gdt.  Do not mess with the parent of the
	elements, as the elements may be in the main tree.

2023-03-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Translations.pm (complete_indices): determine the name
	and class of def command by looking at the contents instead of using
	def_parsed_hash.

2023-03-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/api.c (store_additional_info),
	tp/Texinfo/XS/parsetexi/indices.c (enter_index_entry): use the
	"integer" extra key in extra_misc_args to pass an integer instead
	of a string in the extra_misc_args array.  Use it for the index
	number.

2023-03-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_def_line_type),
	tp/Texinfo/Convert/LaTeX.pm (_convert),
	tp/Texinfo/Convert/Plaintext.pm (_convert), tp/Texinfo/Convert/Text.pm
	(_convert), tp/Texinfo/Convert/Utils.pm
	(definition_arguments_content, definition_category_tree): determine
	the category, name, type and name in definition_arguments_content.
	Do not use def_parsed_hash in definition_category_tree.  Use this
	information instead of def_parsed_hash in the callers.

2023-03-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/indices.c (enter_index_entry),
	tp/Texinfo/XS/parsetexi/api.c (build_single_index_data): store the
	index_entry extra array directly in enter_index_entry, using
	extra_misc_args.

2023-03-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (lookup_index_entry), tp/Texinfo/ParserNonXS.pm
	(_enter_index_entry), tp/Texinfo/XS/parsetexi/api.c
	(build_single_index_data), t/test_utils.pl (_duplicate_element_keys):
	store the index name and the index entry number in the index_entry
	extra value, do not refer directly to the index entry structure,
	Texinfo::Common::lookup_index_entry should be used to get the index
	entry structure.

2023-03-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (lookup_index_entry)
	(_relate_index_entries_to_table_items_in)
	(_relate_index_entries_to_table_items)
	(relate_index_entries_to_table_items_in_tree),
	tp/Texinfo/Convert/DocBook.pm (_index_entry),
	tp/Texinfo/Convert/LaTeX.pm (_index_entry),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_index_entry, _convert),
	tp/t/test_utils.pl (test), tp/texi2any.pl: add the lookup_index_entry
	function, to find an index entry based on the extra index_entry key,
	that abstracts how the index entry is found.  The function requires
	the indices information too.
	Pass the indices information to
	_relate_index_entries_to_table_items_in through
	relate_index_entries_to_table_items_in_tree.

	* tp/Texinfo/Structuring.pm (merge_indices), tp/t/automatic_nodes.t,
	tp/t/test_sort.t, tp/t/test_utils.pl (test): change name of
	$index_names to $indices_information.

	* tp/Texinfo/Convert/Plaintext.pm (_convert): use index_entry_command
	type to determine that the commmand is an index entry command instead
	of using the command name.

2023-03-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (_relate_index_entries_to_table_items_in),
	tp/Texinfo/Convert/LaTeX.pm (_convert),
	tp/Texinfo/Convert/Plaintext.pm (_convert): use index_entry_command
	type instead of extra index_entry when this is more relevant.

	* tp/Texinfo/Transformations.pm (_reassociate_to_node): simplify and
	generalize code reassociating extra element_node, by using only that
	information and not information related to the element as an index
	element.

2023-03-06  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Tree Element Conversion Functions),
	tp/Texinfo/Convert/HTML.pm (_convert)
	(_convert_index_entry_command_type): use the type of index commands,
	index_entry_command, to select index commands formatting, instead of
	a modified command name.  Convert with
	_convert_index_entry_command_type, remove _convert_index_command.

2023-03-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/api.c (store_additional_info),
	tp/Texinfo/XS/parsetexi/extra.c (add_extra_contents_array)
	(add_extra_index_entry), tp/Texinfo/XS/parsetexi/tree.c
	(destroy_associated_info), tp/Texinfo/XS/parsetexi/tree_types.h:
	remove extra_contents_array and extra_index_entry extra types and
	associated functions, add_extra_contents_array and
	add_extra_index_entry.

2023-03-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line)
	(_handle_open_brace, _handle_close_brace, _handle_comma):
	add _handle_open_brace, _handle_close_brace, _handle_comma from
	_process_remaining_on_line code, as in the XS parser.

2023-03-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_texi_regex)
	(_process_remaining_on_line), tp/Texinfo/XS/MiscXS.xs
	(xs_parse_texi_regex), tp/Texinfo/XS/misc.c (xs_parse_texi_regex),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/separator.c (handle_separator): handle
	separately the different separators (except for menu only separators)
	instead of grouping them, directly in process_remaining_on_line.
	Remove the handle_separator function.

2023-03-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (_copy_tree, _substitute_references_in_array)
	(_substitute_references): copy info keys, fix _substitute_references
	calls in which new and current were swapped, add more checks,
	enable extra key hash handling setup for index_entry for all the
	extra key hashes, add a level argument for nicer debug messages.

	* tp/t/test_tree_copy.t: test copy with Texinfo manual and
	tests/converage/formatting.texi.

2023-03-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_def): set parent for the
	definition args for the argument content gathered when there
	is no args to finish the item before.

	* tp/Makefile.tres, tp/t/19def.t: add def_groupings_args to
	test grouping of def args more.

2023-03-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): do not
	start a paragraph for an unknown @-command.

2023-03-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): do not
	throw away the current line in an ignored rawpreformatted.

	* tp/Makefile.tres, tp/t/16raw.t: add second_level_lone_braces_in_html
	and second_level_lone_braces_in_html_not_expanded tests with braces at
	the beginning of a line within an @-command within a rawpreformatted
	environment.

2023-03-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/separator.c (handle_open_brace):
	abort empty line before opening brace in rawpreformatted.

2023-03-05  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Invoking Macros): Mention possibility of
	using @asis to escape commas.

2023-03-05  Gavin Smith <gavinsmith0123@gmail.com>

	Warning for \, in macro arg

	* tp/Texinfo/ParserNonXS.pm (_expand_macro_arguments),
	* tp/Texinfo/XS/parsetexi/macro.c (expand_macro_arguments):
	Issue a warning if \, is used in a macro argument, recommending
	@comma{} instead.

	\, doesn't work with texinfo.tex so it is better to warn about it.

2023-03-05  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (_handle_line_command) <def commands>
	Avoid a variable being undefined.

2023-03-05  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/t/19def.t (defline_no_params, adjacent_defline, multiple_defline)
	(defblock_no_defline): New tests.

2023-03-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line, _parse_texi),
	tp/Texinfo/XS/parsetexi/parser.c (parse_texi),
	tp/Texinfo/XS/parsetexi/separator.c (handle_open_brace)
	(handle_close_brace): do not abort empty line if there is a misplaced
	brace.  Abort empty line at the very end of the document.

2023-03-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line): move
	end_line_def_line definition up in the file to be before the functions
	using it.

	* tp/Texinfo/XS/parsetexi/end_line.c, tp/Texinfo/XS/parsetexi/labels.c
	(check_register_target_element_label, parse_node_manual): move
	parse_node_manual and check_register_target_element_label to labels.c.

	* tp/Texinfo/XS/parsetexi/parser.h: do not include "def.h", let the
	files using functions from def.c include it directly.
	Do not define end_line_def_line which is only used within end_line.c.

2023-03-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/end_line.c,
	tp/Texinfo/XS/parsetexi/handle_commands.c (skip_to_comment):
	(skip_to_comment_if_comment_or_spaces, parse_rawline_command): move
	parse_rawline_command, skip_to_comment and
	skip_to_comment_if_comment_or_spaces to handle_commands.c.

2023-03-05  Patrice Dumas  <pertusus@free.fr>

	Merge special command line data type into lineraw

	* tp/Texinfo/Common.pm (_informative_command_value),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/ParserNonXS.pm(_handle_line_command)
	(_parse_rawline_command), tp/Texinfo/XS/parsetexi/end_line.c
	(parse_rawline_command), tp/Texinfo/XS/parsetexi/handle_commands.c
	(handle_line_command), tp/Texinfo/command_data.txt: merge LINE_special
	commands in LINE_lineraw, with arguments.  Rename
	parse_special_misc_command as parse_rawline_command and have the
	function return the information on whether the command had special
	args.

2023-03-05  Patrice Dumas  <pertusus@free.fr>

	* tp/t/02coverage.t, tp/Makefile.am (test_files), tp/Makefile.tres:
	add delcomment_on_comment with a DEL comment on a @comment line.

2023-03-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_handle_line_command),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command):
	always close a line or block line command a raw line command is on.

2023-03-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line): minor
	change, remove a useless variable, code more similar to XS parser.

2023-03-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.h (GLOBAL_INFO),
	tp/Texinfo/XS/parsetexi/parser.c (register_global_command)
	(wipe_global_info), tp/Texinfo/XS/parsetexi/api.c
	(build_global_info2): add author to global info, to be consistent with
	global in command_data.txt.
	Remove a useless TODO.

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): minor
	changes: change order of code, remove useless retval set, changein
	comments, more similar codes in XS and perl parsers.

2023-03-04  Gavin Smith <gavinsmith0123@gmail.com>

	Multiple @defline in @defblock in texi2any

	* tp/Texinfo/XS/parsetexi/handle_commands.c
	(handle_line_command) <def command>: Allow for @defline
	occurring part way through a @defblock.
	* tp/Texinfo/XS/parsetexi/def.c (gather_def_item)
	Check for empty contents in block, and for items before a
	@defline, gather an element of type 'def_item' rather than
	'inter_def_item'.

2023-03-04  Gavin Smith <gavinsmith0123@gmail.com>

	Multiple @defline in @defblock in texi2any

	* tp/Texinfo/ParserNonXS.pm
	(_handle_line_command) <def command>: Allow for @defline occurring
	part way through a @defblock.
	(_gather_def_item): Check for empty contents in block, and for
	items before a @defline, gather an element of type 'def_item'
	rather than 'inter_def_item'.

2023-03-04  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Generic Definition Commands), NEWS:
	Document @defblock, @defline.

2023-03-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (relocate_source_marks): move from
	tp/Texinfo/ParserNonXS.pm.

	* tp/Texinfo/Common.pm (relocate_source_marks),
	tp/Texinfo/ParserNonXS.pm (_isolate_last_space, _split_delimiters)
	(_split_def_args), tp/Texinfo/XS/parsetexi/def.c (split_delimiters)
	(split_def_args), tp/Texinfo/XS/parsetexi/parser.c
	(isolate_last_space_internal), tp/Texinfo/XS/parsetexi/source_marks.c
	(relocate_source_marks): pass current index and added length to
	relocate_source_marks, and get the new current index in return.

	* tp/Texinfo/XS/parsetexi/end_line.c (parse_node_manual),
	tp/Texinfo/Common.pm (parse_node_manual): relocate source marks from
	removed elements.

2023-03-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (parse_node_manual): use same code as XS
	parser.

	* tp/Texinfo/XS/parsetexi/end_line.c (parse_node_manual): minor change
	in code.

	* tp/t/60macro.t, tp/Makefile.tres: add macro_call_in_node_manual,
	demonstrating that source marks are lost in parse_node_manual.

2023-03-04  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\deflinex, \newdef): Remove.

2023-03-04  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/command_data.txt: Remove @deflinex as @defline is
	enough.

2023-03-04  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo-tex-test.texi (Macros): Add example that doesn't
	work properly.

2023-03-04  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo-tex-test.texi (Line macros): New section.

2023-03-04  Gavin Smith <gavinsmith0123@gmail.com>

	@linemacro, adapted from @macro implementation

	(\linemacro): New macro, to implement @linemacro command.
	(\linegetargs, \linegetparamlist, \parselinemacrobody, \linemacrodef):
	New macros that are part of the implementation.

	This is mainly intended for use with @defblock/@defline.

2023-03-04  Patrice Dumas  <pertusus@free.fr>

	Add alias_of info key for an alias used for an @-command element

	* tp/Texinfo/ParserNonXS.pm (_handle_macro, _handle_other_command)
	(_handle_line_command, _handle_block_command)
	(_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_other_command)
	(handle_line_command, handle_block_command, handle_brace_command),
	tp/Texinfo/XS/parsetexi/macro.c (handle_macro),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line):
	handle_macro returns the element containing the macro expansion
	argument, or 0 if there was an error instead of returning an error
	status.
	Return command element and change command element variable name
	in handle_*_command functions.
	Add alias information in command element in alias_of info key.

2023-03-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_handle_line_command),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command): use
	data command information and arg_spec more, where it makes sense even
	if there cannot be @item there.

2023-03-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line),
	tp/Texinfo/ParserNonXS.pm (_end_line_misc_line, _handle_line_command),
	tp/maintain/regenerate_commands_perl_info.pl: in end_line_misc_line,
	use item_LINE to get the command data information associated to
	@item.
	Keep item_LINE in the perl commands information as in the XS parser,
	modify _handle_line_command and _end_line_misc_line accordingly, also
	to be more in line with the XS parser code.
	For some selected flags that are of interest for converters but not
	for the parsers, duplicate the multi category, ie item_LINE
	information for the main command, here item.  In the converters,
	item_LINE is not present and the tree allows to knwo in advance which
	type of item command is processed.

2023-03-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line), 
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command):
	for @item, there is a difference between the command name, and the
	name used to access data information, which is item_LINE.  Check
	preferentially command data with the modified name and use the
	original name in messages and command name checks.  Pass both
	the original command and the data access name to handle_line_command.
	Reorganize command processing in process_remaining_on_line, closing a
	containing paragraph as soon as possible to be able to check the
	parent command, and opening a paragraph as late as possible.

2023-03-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_handle_other_command)
	(_handle_line_command, _handle_block_command, _handle_brace_command)
	(_process_remaining_on_line): split handle_*_command out of
	_process_remaining_on_line as in the XS parser.

2023-03-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_menu_entry, _end_line),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line),
	tp/Texinfo/XS/parsetexi/menus.c (end_line_menu_entry): put code
	handling end of menu entry from end_line in its own function
	end_line_menu_entry.

	* tp/Texinfo/ParserNonXS.pm (_handle_menu_entry_separators),
	tp/Texinfo/XS/parsetexi/menus.c (handle_menu_entry_separators):
	rename handle_menu as handle_menu_entry_separators.

2023-03-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line)
	(_handle_menu): split _handle_menu out of _process_remaining_on_line
	to be more similar to XS parser.

2023-03-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/menus.c (handle_menu): move code that sets up
	a menu separator before code that handles a menu separator for
	improved readability.

2023-03-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_texi_regex)
	(_process_remaining_on_line), tp/Texinfo/XS/MiscXS.xs
	(xs_parse_texi_regex), tp/Texinfo/XS/parsetexi/menus.c (handle_menu),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/separator.c (handle_separator): handle menu
	separator separatly from other separators (with a possible overlap for
	comma, considered both as a menu and other separator in the perl
	parser), also moving the code starting the menu_entry_separator
	element together with the code handling menu entries.

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line): code more
	similar to XS parser code for accent argument without brace and for
	menu_entry.

2023-03-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XSLoader.pm (init): call Texinfo::Parser->import() after
	loading the NonXS parser.

2023-03-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/menus.c (handle_menu): start a node entry
	only if the * is at the beginning of a line, as for the perl parser.

	* tp/Makefile.tres, tp/t/10menu.t: add leading_space_before_menu_star test.

2023-03-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/menus.c (handle_menu): synchronize and improve
	comments and debug messages.  No change in code.

2023-03-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_next_text): remove 'fh' at the end of
	STDIN too.  Report from Arsen Arsenović.

2023-03-01  Patrice Dumas  <pertusus@free.fr>

	Remove extra misc_args for special and lineraw line commands

	* tp/Texinfo/Common.pm (_informative_command_value),
	tp/Texinfo/Convert/LaTeX.pm (_convert), tp/Texinfo/ParserNonXS.pm
	(_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command): do
	not add args to extra misc_args for special and lineraw line commands,
	regular args can be used instead.

2023-03-01  Patrice Dumas  <pertusus@free.fr>

	Merge LINE_skipline in LINE_lineraw, distinguish with arg number

	* tp/Texinfo/Common.pm (_informative_command_value),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/command_data.awk,
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command),
	tp/Texinfo/command_data.txt: merge LINE_lineraw with LINE_skipline,
	but set the number of arguments to 1 for former lineraw commands and
	to 0 for former LINE_skipline commands.  Use the number of arguments
	to distinguish when needed.

2023-03-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/58alias.t: add alias_macro_target_removed
	to test an alias resolving to a @macro after @unmacro.

2023-03-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line):
	catch an unknown command that is an unresolved alias earlier.

2023-03-01  Patrice Dumas  <pertusus@free.fr>

	An alias referring to another alias at definition time is resolved

	* NEWS, tp/Texinfo/ParserNonXS.pm (_parse_line_command_args),
	tp/Texinfo/XS/parsetexi/end_line.c (parse_line_command_args),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): resolve
	an alias referring to another alias, at @alias defintion time.

	* tp/Makefile.tres, tp/t/58alias.t: add texinfo_command_alias,
	texinfo_command_alias_indirect, texinfo_command_alias_indirect_before
	and recursive_alias tests.

2023-03-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line)
	(_parse_line_command_args): unset previous alias when a macro is
	defined, unset macro, alias and definfoenclose when a @def*index
	command is defined and unset alias, macro and @def*index when a
	@definfoenclose command is defined.

	* tp/Texinfo/XS/parsetexi/commands.c (add_texinfo_command),
	tp/Texinfo/XS/parsetexi/macro.c (delete_macro, unset_macro_record):
	when adding a user-defined command, reuse the existing command but
	reset it, unsetting the macro record with the new function
	unset_macro_record based on part of delete_macro.

	* tp/Texinfo/XS/parsetexi/commands.c (add_texinfo_command)
	(remove_texinfo_command), tp/Texinfo/XS/parsetexi/commands.h,
	tp/Texinfo/XS/parsetexi/end_line.c (parse_line_command_args),
	tp/Texinfo/XS/parsetexi/indices.c (add_index_command),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line):
	pre-register @alias existing command if it does not actually exist,
	using the new flag CF_REGISTERED.  If the command is not defined, also
	set CF_UNKNOWN.  Keep CF_REGISTERED when redefining the command.

	* tp/Texinfo/ParserNonXS.pm (_parse_line_command_args),
	tp/Texinfo/XS/parsetexi/end_line.c (parse_line_command_args),
	tp/Texinfo/XS/parsetexi/indices.c (index_by_name): do not
	destroy an index if it is re-defined.  Reset the associated index
	command.

	* tp/Texinfo/ParserNonXS.pm (_parse_line_command_args),
	tp/Texinfo/XS/parsetexi/end_line.c (parse_line_command_args): warn if
	an alias refers to another alias and do not set it.

	* tp/Texinfo/XS/parsetexi/macro.c (lookup_macro_and_slot, new_macro):
	try to reuse empty macro_list slots instead of always adding a new
	macro.

	* tp/Makefile.tres (test_files_generated_list), tp/t/58alias.t,
	tp/t/60macro.t: add alias.t tests alias_non_existing_command,
	alias_of_macro, alias_of_macro_before_macro, alias_of_definfoenclose,
	alias_of_definfoenclose_before_definfoenclose, alias_of_added_index,
	alias_of_added_index_before_added_index to test for pre-registering of
	@alias referred to commands.  Add macro.t tests
	macro_replaced_by_definfoenclose, definfoenclose_replaced_by_macro,
	macro_alias_definfoenclose_defindex.

2023-02-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/convert.c (convert_contents_to_texinfo),
	tp/Texinfo/XS/parsetexi/end_line.c
	(check_register_target_element_label, end_line_starting_block),
	tp/Texinfo/XS/parsetexi/macro.c (new_macro): add the
	convert_contents_to_texinfo function that converts only the contents
	of an element.  Use it.

2023-02-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/convert.c (expand_cmd_args_to_texi)
	(convert_to_texinfo_internal): update to match
	Texinfo::Convert::Texinfo.

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block)
	tp/Texinfo/XS/parsetexi/macro.c (new_macro): call new_element on
	temporary element used to convert contents only with
	convert_to_texinfo to initialize properly.

	* tp/Texinfo/Convert/Texinfo.pm (_expand_cmd_args_to_texi): there
	are spaces_after_cmd_before_arg only after commands.

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line): minor
	change, use an else if, to be like the perl parser code, and remove
	an old FIXME.

2023-02-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (parse_node_manual), tp/Texinfo/ParserNonXS.pm
	(_end_line_misc_line), tp/Texinfo/Structuring.pm
	(new_node_menu_entry): add an argument to control whether the element
	argument is modified or not as in the XS parser.  Remove
	_parse_node_manual and call directly parse_node_manual instead.

2023-02-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/end_line.c
	(check_register_target_element_label), tp/Texinfo/XS/parsetexi/tree.c
	(destroy_node_spec): add destroy_node_spec to deallocate out of
	tree elements coollected in a label manual and node name
	specification, as well as the manual and node name associated
	elements.  Use it in check_register_target_element_label.  In the
	other cases, the manual and node name elements are used in the tree
	and will be deallocated when the tree is destroyed.

2023-02-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_misc_line)
	(_end_line_starting_block, _check_register_target_element_label)
	(_process_remaining_on_line), tp/Texinfo/XS/parsetexi/end_line.c
	(check_register_target_element_label, end_line_starting_block)
	(end_line_misc_line), tp/Texinfo/XS/parsetexi/separator.c
	(handle_close_brace): group together the call of
	parse_node_manual, the check of no manual element and the
	registering if a target element for links in
	_check_register_target_element_label.  Remove _check_internal_node,
	integrated in _check_register_target_element_label.

	* tp/Texinfo/XS/parsetexi/end_line.c (parse_node_manual): add an
	argument to control whether the element argument is modified or not.
	Add a field in NODE_SPEC_EXTRA to keep the added elements in case
	the element argument is not modified.  Do not modify the node before
	being sure that there really is a manual name if there is an opening
	brace.  Update callers.

2023-02-27  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Other Customization Variables),
	* NEWS: Document ASCII_DASHES_AND_QUOTES and ASCII_GLYPH.

2023-02-27  Gavin Smith <gavinsmith0123@gmail.com>

	Nuke obsolete XS overrides

	* tp/Texinfo/XS/MiscXS.xs, tp/Texinfo/XS/misc.c
	(xs_abort_empty_line, xs_merge_text): Remove.
	* tp/Texinfo/ParserNonXS.pm: Remove commented-out code using these.

	These would only be used in unusual cases when the XS parser
	couldn't be used but the other XS overrides could still be loaded.
	It means that there are now only two implementations of these
	functions rather than three.  The removed implementations had not
	been changed to match changes in the other two, and it would be
	laborious to keep these up to date.

2023-02-27  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (%defaults, converter_initialize):
	Rename 'ASCII_PUNCTUATION' as 'ASCII_DASHES_AND_QUOTES' and
	'NO_GRATUITOUS_UTF8' as 'ASCII_PUNCTUATION'.

2023-02-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Texinfo.pm (link_element_to_texi),
	tp/Texinfo/ParserNonXS.pm (_check_node_label),
	tp/Texinfo/Structuring.pm: new function that replaces functionally
	node_extra_to_texi and is applied to an element.  Update callers.

	* tp/Texinfo/Structuring.pm associate_internal_references): more
	common code to handle both types of internal references commands.

	* tp/Texinfo/Convert/Texinfo.pm (target_element_to_texi_label): remove
	call to node_extra_to_texi, it cannot happen.

	* tp/Texinfo/ParserNonXS.pm (_check_node_label, _check_empty_node),
	tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/end_line.c (check_empty_node)
	(check_node_label), tp/Texinfo/XS/parsetexi/separator.c
	(handle_close_brace): determine directly if an @anchor is empty, and
	call check_internal_node if it is not the case.  Remove
	check_node_label and check_empty_node.

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace): rename
	arg as arg_label in the code determining @*ref link label information.

	* tp/Texinfo/Structuring.pm (nodes_tree): rename $arg as
	$direction_element.

2023-02-27  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/pod2texi.pl (_parsed_manual_tree): update node
	element creation to match with the current tree.

	* Pod-Simple-Texinfo/manual_tests, Pod-Simple-Texinfo/Makefile.am
	(EXTRA_DIST): add a directory with a script to ease manual testing of
	the code in pod2texi.pl _parsed_manual_tree with gaps in sectioning
	and manual name prepended.

2023-02-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (_convert), tp/Texinfo/Structuring.pm
	(associate_internal_references): remove the 'label' extra key, instead
	dynamically determine the link target as already done in other output
	formats than Plaintext.

	* tp/Texinfo/Structuring.pm (associate_internal_references): remove a
	missed occurence of node_argument.

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block)
	(end_line_misc_line), tp/Texinfo/XS/parsetexi/separator.c
	(handle_close_brace): free all the elements of returned by parse_node_manual
	for elements that are targets of links and use parse_node_manual only
	to check that their syntax is not the one of an external reference.

2023-02-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_convert), tp/Texinfo/Convert/HTML.pm
	(_convert_xref_commands), tp/Texinfo/Convert/LaTeX.pm (_convert),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/Structuring.pm (check_nodes_are_referenced)
	(associate_internal_references), tp/Texinfo/XS/parsetexi/separator.c
	(handle_close_brace), tp/Texinfo/XS/parsetexi/tree.c
	(destroy_associated_info), tp/Texinfo/XS/parsetexi/api.c
	(build_node_spec, store_additional_info),
	tp/Texinfo/XS/parsetexi/extra.c (add_extra_node_spec): put
	node_content and node_manual information for @xref commands in the
	first argument instead of with the command in node_argument.
	Remove node_argument.
	Remove completly extra_node_spec and associated functions,
	build_node_spec and add_extra_node_spec from the XS parser.

2023-02-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_register_extra_menu_entry_information)
	(_enter_menu_entry_node), tp/Texinfo/Structuring.pm
	(associate_internal_references), tp/Texinfo/XS/parsetexi/menus.c
	(register_extra_menu_entry_information, enter_menu_entry_node):
	put menu_entry_node in internal_references instead of menu_entry.

2023-02-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (_copy_tree, _substitute_references),
	tp/Texinfo/Convert/HTML.pm (_convert_menu_entry_type),
	tp/Texinfo/ParserNonXS.pm (_register_extra_menu_entry_information),
	tp/Texinfo/Structuring.pm (_check_menu_entry)
	(set_menus_node_directions, associate_internal_references)
	(new_node_menu_entry), tp/Texinfo/Transformations.pm
	(_normalized_entry_associated_internal_node),
	tp/Texinfo/XS/parsetexi/menus.c
	(register_extra_menu_entry_information): put node_content and
	node_manual information directly in the menu_entry_node element,
	not in the menu_entry, remove menu_entry_node_label.

2023-02-26  Gavin Smith <gavinsmith0123@gmail.com>

	Add NO_GRATUITOUS_UTF8 (name could change)

	* tp/Texinfo/Common.pm (@variable_string_settables):
	Add NO_GRATUITOUS_UTF8.
	* tp/Texinfo/Convert/Plaintext.pm (converter_initialize):
	Set several other variables if NO_GRATUITOUS_UTF8 is set.
	Move call to Texinfo::Convert::Text::copy_options_for_convert_text
	to end of function as it is not immediately obvious which options
	are relevant for this call.

2023-02-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/NodeNameNormalization.pm (set_nodes_list_labels),
	tp/Texinfo/Convert/Plaintext.pm (_convert),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/ParserNonXS.pm (_end_line_misc_line),
	tp/Texinfo/Structuring.pm (nodes_tree) and other functions,
	tp/Texinfo/Transformations.pm
	(_get_non_automatic_nodes_with_sections),
	tp/Texinfo/XS/parsetexi/api.c (store_additional_info),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line),
	tp/Texinfo/XS/parsetexi/extra.c (add_extra_node_spec_array),
	tp/Texinfo/XS/parsetexi/tree.c (destroy_associated_info):
	remove the nodes_manuals extra key array, instead set extra
	node_content, manual_content and normalized directly in the @node
	directions arguments, and use the number of arguments of @node to
	determine if there are automatic directions.
	Remove completly add_extra_node_spec_array and extra type
	extra_node_spec_array.

	* tp/Texinfo/ParserNonXS.pm: avoid autovivification.

	* tp/Texinfo/Structuring.pm (_label_target_unit_element): rename
	_label_target_element as _label_target_unit_element.

	* tp/Texinfo/XS/parsetexi/api.c (store_additional_info): to determine
	if an extra key is needed, count the number of additional info set.

2023-02-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/debug.c (print_element_debug)
	(debug_print_element): add print_element_debug that sets up the
	element debugging string based on debug_print_element code.  Use in
	debug_print_element.

2023-02-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_xref_commands)
	(_convert_menu_entry_type): rename $node_entry as $label_info.
	Reindent.

2023-02-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/NodeNameNormalization.pm (set_nodes_list_labels):
	remove code related to structures not present for target elements
	anymore.
	Reindent.

2023-02-26  Arsen Arsenović  <arsen@aarsen.me>

	install-info: Invert umask in mode computation
	* install-info/install-info.c (output_dirfile): Invert umask
	applied to tempfile (as is specified in the definition for
	umasks).

2023-02-26  Arsen Arsenović  <arsen@aarsen.me>

	install-info: Relax tempfile mode earlier
	* install-info/install-info.c (output_dirfile): Reorder the
	tempfile mode relaxation block directly under mkstemp, in order to
	not accidentally operate on a closed file descriptor.

2023-02-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/NodeNameNormalization.pm (set_nodes_list_labels),
	tp/Texinfo/Convert/Plaintext.pm (_convert), tp/Texinfo/ParserNonXS.pm
	(_end_line_misc_line), tp/Texinfo/Structuring.pm,
	tp/Texinfo/Transformations.pm (_new_node)
	(_get_non_automatic_nodes_with_sections),
	tp/Texinfo/XS/parsetexi/api.c (store_additional_info),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line): do not put
	the node name itself in extra nodes_manuals, only the node directions.

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): remove check on
	existing manual_content for automatic directions, as it should never
	be possible.

	* tp/Texinfo/Convert/Texinfo.pm: use Texinfo::Common;

2023-02-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (register_label, get_label_element),
	tp/Texinfo/Convert/Converter.pm (node_information_filename)
	(_set_tree_units_files, sort_element_counts),
	tp/Texinfo/Convert/HTML.pm (command_text, _normalized_label_id_file)
	(_set_root_commands_targets_node_files, _external_node_href, output),
	tp/Texinfo/Convert/IXIN.pm, tp/Texinfo/Convert/Info.pm (output)
	(format_node), tp/Texinfo/Convert/LaTeX.pm (_convert),
	tp/Texinfo/Convert/NodeNameNormalization.pm (set_nodes_list_labels),
	tp/Texinfo/Convert/Plaintext.pm (process_footnotes, node_line)
	(_convert), tp/Texinfo/Convert/Texinfo.pm
	(target_element_to_texi_label), tp/Texinfo/Convert/TexinfoMarkup.pm
	(_convert), tp/Texinfo/ParserNonXS.pm (_end_line_misc_line)
	(_end_line_starting_block, _process_remaining_on_line),
	tp/Texinfo/Structuring.pm (_check_node_same_texinfo_code)
	(_check_menu_entry, check_nodes_are_referenced)
	(complete_node_tree_with_menus, nodes_tree)
	(associate_internal_references, number_floats, new_node_menu_entry),
	tp/Texinfo/Transformations.pm (_new_node),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block)
	(end_line_misc_line), tp/Texinfo/XS/parsetexi/labels.c
	(register_label), tp/Texinfo/XS/parsetexi/separator.c
	(handle_close_brace), tp/init/documentation_examples.pm: do not
	register the label element in register_label, instead use directly
	arguments, first argument of node or anchor, second argument of float,
	possibly using get_label_element when the element command name is not
	known.
	Use {'extra'}->{'normalized'} instead of {'extra'}->{'node_content'}
	to determine if th enode is present multiple times, or empty.
	Pass normalized label string and label contents separately to
	node_information_filename, to _normalized_label_id_file and to user
	defined reference label_target_name.
	Add file_info_label_contents with label contents to files_source_info
	for a redirection file.
	Add 'normalized' extra key in Plaintext/Info for nodes or anchors
	created for footnotes.
	Add target_element_to_texi_label to format target element label to
	Texinfo.

	* tp/Texinfo/Convert/DocBook.pm (_convert),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): use directly the
	normalized extra key instead of redoing the normalization.

2023-02-26  Gavin Smith <gavinsmith0123@gmail.com>

	ASCII_GLYPH in tests

	* tp/t/plaintext.t
	(punctuation_sc_accents_ascii_punct)
	(punctuation_sc_accents_ascii_glyph)
	(punctuation_sc_accents_ascii_punct_latin1)
	(punctuation_sc_accents_ascii_glyph_latin1)
	(punctuation_sc_accents_ascii_punct_usascii)
	(punctuation_sc_accents_ascii_glyph_usascii)
	(punctuation_sc_accents_to_utf8_ascii_punct_latin1)
	(punctuation_sc_accents_to_utf8_ascii_glyph_latin1)
	(punctuation_sc_accents_to_utf8_ascii_punct_usascii):
	(punctuation_sc_accents_to_utf8_ascii_glyph_usascii):
	Rename from *_ascii_punct_* to *_ascii_glyph_*.

2023-02-26  Gavin Smith <gavinsmith0123@gmail.com>

	ASCII_GLYPH in tests

	* tp/t/plaintext.t
	(punctuation_sc_accents_ascii_punct)
	(punctuation_sc_accents_ascii_punct_latin1)
	(punctuation_sc_accents_ascii_punct_usascii)
	(punctuation_sc_accents_to_utf8_ascii_punct_latin1)
	(punctuation_sc_accents_to_utf8_ascii_punct_usascii):
	Set ASCII_GLYPH rather than ASCII_PUNCTUATION.

2023-02-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/NodeNameNormalization.pm (set_nodes_list_labels):
	use -> systematically with references.

2023-02-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/api.c (build_target_elements_list):
	rename build_label_list as build_target_elements_list.

	* tp/Texinfo/XS/parsetexi/labels.c (register_label),
	tp/Texinfo/XS/parsetexi/labels.h, tp/Texinfo/XS/parsetexi/api.c
	(build_target_elements_list): rename labels_list as
	target_elements_list and make it a list of element.  Remove the LABEL
	type.  More explicit comments and variable names.

	* tp/Texinfo/XS/parsetexi/labels.h: remove external definition of
	internal_xref_space.

	* tp/Texinfo/ParserNonXS.pm: remove _register_label, call directly
	Texinfo::Common::register_label.

	* tp/Texinfo/Common.pm (register_label): more explicit comments and
	variable names.

2023-02-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_starting_block),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block): check
	only that there is a command_as_argument, not the parent command to
	error on accent command being used as command_as_argument.

	* tp/Texinfo/ParserNonXS.pm (_end_line_starting_block): remove
	a useless check of contents content.

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block): use
	a else if to be more similar to pure parser code.

2023-02-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_close_current)
	(_process_remaining_on_line, _parse_texi): use same messages as XS
	parser.  Remove redundant checks on contents, now if contetns exists,
	there is some contents.

	* tp/Texinfo/XS/parsetexi/separator.c (handle_open_brace): remove
	useless code for an impossible situation.

2023-02-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_special_misc_command): match
	@comment before @c.  Allow @clickstyle argument to be be right
	after @clickstyle without space in-between.

	* tp/Texinfo/XS/parsetexi/end_line.c (parse_special_misc_command):
	check that there is only comments or spaces after argument for
	unmacro and clickstyle.  For clickstyle, verify that the string is not
	finished before doing memcmp.

	* tp/Texinfo/ParserNonXS.pm (_parse_special_misc_command),
	tp/Texinfo/XS/parsetexi/end_line.c (parse_special_misc_command): check
	remaining on line only for @clickstyle.

	* tp/Makefile.tres, tp/t/08misc_commands.t: add
	clickstyle_no_end_of_line and clickstyle_and_comments tests.  Add a
	case without spaces between @clickstyle and argument in the clickstyle
	test.
	For set_on_item_line and set_in_item_missing_line tests, use different
	item names with and without comments following to be able to check
	more easily the results.

2023-02-24  Arsen Arsenović  <arsen@aarsen.me>

	install-info: Fix dir file mode being restricted

	The recent switch to mkstemp and atomic updating of the directory
	file unintentionally lead to overly restrictive permissions being
	set on directory file.  This error was originally introduced in
	93162b78d84f731710025b300bc0cd7ca8b14347 (2022-12-03 Gavin Smith
	<gavinsmith0123@gmail.com>).
	* install-info/install-info.c (output_dirfile): Change mode of
	installed dir file back to its usual value, rather than the
	mkstemp default of 0600.

2023-02-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/end_line.c
	(skip_to_comment_if_comment_or_spaces, parse_special_misc_command):
	add skip_to_comment_if_comment_or_spaces based on set argument
	handling, to return end of argument before comment and whitespace if
	the line is followed either by whitespaces or a comment.  Use in
	@clear argument parsing to allow for comments but error out if
	there is anything else than a comment or whitespaces following
	the flag argument.

	* * tp/Texinfo/XS/parsetexi/end_line.c (parse_special_misc_command):
	handle the case of Texinfo framgment with @set ending right after
	the argument, without a new line.

	* tp/Texinfo/XS/parsetexi/end_line.c (skip_to_comment): rename
	skip_comment as skip_to_comment.

	* tp/Makefile.tres, tp/t/50value.t: add
	begin_like_comment_on_set_line, comment_on_clear_line,
	set_no_end_of_line and clear_no_end_of_line tests.

	remove or replace some FIXME.

2023-02-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/menus.c (handle_menu): remove empty menu entry
	node description by using close_container to close.

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line): clarify
	the comments explaining the situation after closing when encountering
	a root command or @bye.  Restate a FIXME as a TODO and be more
	explicit.

2023-02-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): explain
	why the next input is directly drawn after macro handling.

2023-02-22  Gavin Smith <gavinsmith0123@gmail.com>

	Split ASCII_GLYPH and ASCII_PUNCTUATION

	* tp/Texinfo/Common.pm (@variable_string_settables):
	Add ASCII_GLYPH.
	* tp/Texinfo/Convert/Plaintext.pm (converter_initialize):
	Ignore ASCII_PUNCTUATION for the output of @quoted_commands.
	(_process_text): Reorder conditional.
	(%defaults): Set ASCII_PUNCTUATION to 1 and ASCII_GLYPH to 0.
	* tp/Texinfo/Convert/Text.pm
	(copy_options_for_convert_text): Propagate ASCII_GLYPH.
	(brace_no_arg_command): Check ASCII_GLYPH setting rather than
	that of ASCII_PUNCTUATION.

2023-02-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_handle_macro)
	(_process_remaining_on_line), tp/Texinfo/XS/parsetexi/macro.c
	(handle_macro), tp/Texinfo/XS/parsetexi/parser.c
	(process_remaining_on_line): return an error status from handle_macro for macro
	expansion error.  Do not get next text and instead return the
	remaining of the line if there was a macro expansion error.

	* tp/Texinfo/ParserNonXS.pm (_handle_macro),
	tp/Texinfo/XS/parsetexi/macro.c (handle_macro): rename current element
	for line_args line arguments parsing as arg_elt.

	* tp/Texinfo/ParserNonXS.pm (_handle_macro),
	tp/Texinfo/XS/parsetexi/macro.c (handle_macro): expand macro body only
	if there is no expansion error.

2023-02-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace): rename
	region extra anchor key to element_region.

2023-02-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line):
	remove code removing empty contents and trensferring source
	marks of accent command now that it is collected by
	gather_spaces_after_cmd_before_arg.

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line): similar
	organization of code with XS parser.

2023-02-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Texinfo.pm (_expand_cmd_args_to_texi),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/ParserNonXS.pm (_gather_spaces_after_cmd_before_arg)
	(_process_remaining_on_line), tp/Texinfo/XS/parsetexi/convert.c
	(expand_cmd_args_to_texi), tp/Texinfo/XS/parsetexi/parser.c
	(gather_spaces_after_cmd_before_arg, process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/separator.c (handle_open_brace): store
	spaces_after_cmd_before_arg as an element, firstly put in the brace
	command contents (with an internal type used solely for debugging)
	to gather source marks, then removed from the tree and put in
	the spaces_after_cmd_before_arg info key, with
	gather_spaces_after_cmd_before_arg().

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line): avoid
	autovivification.

2023-02-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_next_text, _parse_texi)
	(_process_remaining_on_line): adapt to input stack not being empty
	even after last input has been fetched.  Remove completly the empty
	input from the input stack at the end of _parse_texi.

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): in case
	of an unclosed raw output ignored block, exit to get to end line
	processing in parse_texi instead of setting the line to an empty
	string.

2023-02-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/Makefile.am (Parsetexi_la_SOURCES),
	tp/Texinfo/XS/parsetexi/debug.h, tp/Texinfo/XS/parsetexi/api.c,
	tp/Texinfo/XS/parsetexi/close.c,
	tp/Texinfo/XS/parsetexi/context_stack.c,
	tp/Texinfo/XS/parsetexi/debug.c, tp/Texinfo/XS/parsetexi/end_line.c,
	tp/Texinfo/XS/parsetexi/handle_commands.c,
	tp/Texinfo/XS/parsetexi/macro.c, tp/Texinfo/XS/parsetexi/menus.c,
	tp/Texinfo/XS/parsetexi/parser.c, tp/Texinfo/XS/parsetexi/parser.h,
	tp/Texinfo/XS/parsetexi/separator.c,
	tp/Texinfo/XS/parsetexi/source_marks.c,
	tp/Texinfo/XS/parsetexi/end_line.c, tp/Texinfo/XS/parsetexi/input.c:
	add a separate include fle for debug.c.  More include of header files
	when the code declared in these header files is directly used.

	* tp/Texinfo/XS/parsetexi/input.c (next_text): add a debug statement
	if a source mark was missed, more similar code as in the perl parser.

2023-02-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line):
	do not call end_line nor ask for a new line when there is no more
	input after an empty line, since this is done in parse_texi.

	* tp/Texinfo/ParserNonXS.pm (_parse_texi),
	tp/Texinfo/XS/parsetexi/parser.c (parse_texi): gather text after @bye
	only if there is still some input and status was FINISHED_TOTALLY.
	Collect source marks after @bye.

	* tp/Texinfo/XS/parsetexi/parser.c (parse_texi): check that the
	context_stack is empty at the end.

	* tp/Texinfo/XS/parsetexi/parser.c (parse_texi): do not call
	input_reset_input_stack at the end, as now the text after @bye is
	collected, so the input stack, as well as macro expansion and value
	expansions should all be closed.  Add bug messages if it is not
	the case.

	* tp/t/60macro.t, tp/Makefile.tres: add bye_in_macro test.

2023-02-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_input_push_file, _end_line_misc_line),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line),
	tp/Texinfo/XS/parsetexi/input.c (next_text, input_push_file):
	keep the information on the full include file path with input info.
	Use the full input path in include file opening and closing errors.

	* tp/Texinfo/ParserNonXS.pm (_input_push_file): return the error
	message.  Update callers.

	* tp/Texinfo/ParserNonXS.pm (_new_text_input): die if opening the
	internal text handler fails.
	(_next_text): show the close error message.

2023-02-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/xspara.c (xspara__add_next): check output of mbrtowc,
	in particular if 0, advance to avoid an infinite loop.

2023-02-20  Patrice Dumas  <pertusus@free.fr>

	* po/POTFILES.in: update highlight_syntax.pm path.

2023-02-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (float_type_number),
	tp/Texinfo/Convert/HTML.pm (_convert_listoffloats_command),
	tp/Texinfo/Convert/IXIN.pm, tp/Texinfo/Convert/LaTeX.pm (_convert),
	tp/Texinfo/Convert/Plaintext.pm (_convert),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): @float and
	@listoffloats always have {'extra'}->{'float_type'} set, assume that
	in the code.

2023-02-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/NodeNameNormalization.pm (set_float_types): avoid
	autovivification.

2023-02-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/NodeNameNormalization.pm (_parse_float_type),
	tp/Texinfo/XS/parsetexi/end_line.c (parse_float_type): check only
	that there is one argument, not that there is content in the argument.

2023-02-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (_substitute_references),
	tp/Texinfo/Convert/Converter.pm (float_type_number)
	(float_name_caption), tp/Texinfo/Convert/HTML.pm
	(_convert_listoffloats_command), tp/Texinfo/Convert/IXIN.pm,
	tp/Texinfo/Convert/LaTeX.pm (_convert),
	tp/Texinfo/Convert/NodeNameNormalization.pm (_parse_float_type),
	tp/Texinfo/Convert/Plaintext.pm (_convert),
	tp/Texinfo/Convert/TexinfoMarkup.p (_convert),
	tp/Texinfo/XS/parsetexi/api.c (store_additional_info): put
	float_type directly in extra as string.

2023-02-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/NodeNameNormalization.pm (_parse_float_type),
	tp/Texinfo/XS/parsetexi/api.c (store_additional_info),
	tp/Texinfo/XS/parsetexi/end_line.c (parse_float_type),
	tp/Texinfo/XS/parsetexi/extra.c (add_extra_float_type),
	tp/Texinfo/XS/parsetexi/tree.c (destroy_associated_info):
	do not store 'content' in extra float_type, it is not used
	anymore.  Do corresponding changes in the XS parser, removing the
	add_extra_float_type function, the extra_float_type extra type
	and the EXTRA_FLOAT_TYPE type (this code is not really used in
	the XS parser, but could be).

2023-02-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (float_type_number)
	(float_name_caption), tp/Texinfo/Convert/IXIN.pm,
	tp/Texinfo/Convert/LaTeX.pm (_latex_header, _convert): use directly
	float or listoffloats {'args'}->[0] instead of
	{'extra'}->{'float_type'}->{'content'}.

2023-02-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/NodeNameNormalization.pm (_parse_float_type),
	tp/Texinfo/XS/parsetexi/end_line.c (parse_float_type): return
	the float type.  (Note that parse_float_type in end_line.c
	is not currently used).

2023-02-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (_substitute_references),
	tp/Texinfo/Convert/Converter.pm (float_type_number)
	(float_name_caption), tp/Texinfo/Convert/HTML.pm
	(_convert_listoffloats_command), tp/Texinfo/Convert/IXIN.pm,
	tp/Texinfo/Convert/LaTeX.pm (_latex_header, _convert),
	tp/Texinfo/Convert/NodeNameNormalization.pm (_parse_float_type)
	(set_float_types), tp/Texinfo/Convert/Plaintext.pm (_convert),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/XS/parsetexi/api.c (store_additional_info),
	tp/Texinfo/XS/parsetexi/end_line.c (parse_float_type): rename
	extra key type for float and listoffloats as float_type.

2023-02-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (debug_print_element): rename
	debug_print_element_short as debug_print_element as both functions are
	almost the same, and remove the former debug_print_element function.
	Update callers.

	* tp/Texinfo/XS/parsetexi/debug.c (debug_print_element): rename
	debug_print_element_short as debug_print_element.  Update callers.

	* tp/Texinfo/ParserNonXS.pm (_print_current): inline and remove.

2023-02-19  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Other Customization Variables),
	tp/Texinfo/Common.pm (@variable_string_settables),
	tp/Texinfo/Convert/Plaintext.pm (converter_initialize): add
	OPEN_DOUBLE_QUOTE_SYMBOL and CLOSE_DOUBLE_QUOTE_SYMBOL to be able to
	customize double quotes used for @dfn in Info and Plaintext.

2023-02-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (@set_flag_index_char_ignore): use only
	one data structure for txiindex*ignore sets order and association
	with symbols.

2023-02-19  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/Makefile.onetst, tp/tests/other/list-of-tests: add a test
	of HIGHLIGHT_SYNTAX_DEFAULT_LANGUAGE.

2023-02-19  Patrice Dumas  <pertusus@free.fr>

	* tp/ext/highlight_syntax.pm (highlight_setup, highlight_process):
	handle HIGHLIGHT_SYNTAX customization option being not defined.  Can
	happen if highlight_syntax.pm is loaded as an init file and not
	as an extension.

	* tp/tests/Makefile.onetst, tp/tests/other/list-of-tests: add syntax
	highlighting tests with HIGHLIGHT_SYNTAX highlight and pygments.

2023-02-19  Patrice Dumas  <pertusus@free.fr>

	Add other commands for syntax highlighting

	* doc/texinfo.texi (Other Customization Variables)
	(Syntax Highlighting), tp/ext/highlight_syntax.pm
	(%highlight_type_languages_name_mappings, highlight_setup)
	(_convert_element, highlight_process): add the possibility to use
	the highlight command and the pygmentize command. 

	* tp/ext/highlight_syntax.pm (_get_language, highlight_process):
	return the language to be converted to warn if verbose and the
	language is not found.

2023-02-19  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo-tex-test.texi (Index and paragraphs): New section.

2023-02-19  Gavin Smith <gavinsmith0123@gmail.com>

	Reorganise test file

	* doc/texinfo-tex-test.texi (Headings and Footings): Change some
	@chapter's to @section's to simplify table of contents.
	(Test of @displaymath): Move earlier in file.
	(Index display): Move to end.

2023-02-19  Gavin Smith <gavinsmith0123@gmail.com>

	Index commands end paragraphs

	* doc/texinfo.tex (\indexpar): New macro to end open paragraphs.
	(\doindex, \docodeindex): Use \indexpar.
	(\itemzzz, \itemizeitem): Add penalty that will be recognized in
	\indexpar to make an exception immediately after @item.
	(\safewhatsit): Propagate \lastpenalty in horizontal mode.
	(\newindex): Remove obsolete comment about vms filenames.

2023-02-19  Patrice Dumas  <pertusus@free.fr>

	* tp/ext/highlight_syntax.pm (highlight_setup, highlight_process):
	determine list of languages highlighted in an handler, highlight_setup
	in order to be able to use the customization variables while doing
	this initialization.

	* tp/ext/highlight_syntax.pm (highlight_setup): silence the redundant
	warning message associated to a failure to run the command through
	open.

	* tp/ext/highlight_syntax.pm (_get_language): handle not defined language.

	* tp/tests/other/highlight_example.texi: add more @example blocks,
	including without language set.

2023-02-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (@variable_string_settables),
	tp/ext/highlight_syntax.pm (_get_language), tp/texi2any.pl,
	tp/Makefile.am (dist_extensions_DATA): load highlight_syntax.pm in
	main program if HIGHLIGHT_SYNTAX is set.  Rename
	HIGHLIGHT_SYNTAX_DEFAULT as HIGHLIGHT_SYNTAX_DEFAULT_LANGUAGE.  Setup
	highlight_syntax.pm as an internal extension.

	* doc/texinfo.texi (Other Customization Variables, Generating HTML)
	(Syntax Highlighting): document syntax highlighting support in
	texi2any for @example for HTML.

	* tp/tests/other/list-of-tests: use HIGHLIGHT_SYNTAX to load
	syntax highlighting for one test case.

2023-02-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (parser): remove a check and handling of
	user-provided state in parser.  Both codes were not active.

2023-02-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (%default_no_paragraph_commands, parser):
	(_parse_line_command_args), tp/Texinfo/XS/parsetexi/command_data.awk,
	tp/Texinfo/XS/parsetexi/indices.c (add_index_command),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line),
	tp/Texinfo/command_data.txt,
	tp/maintain/regenerate_commands_perl_info.pl: add no_paragraph flag.
	Put the flag explicitly for brace and nobrace commands in
	command_data.txt and add automatically for line and block commands.
	Add default index commands and add dynamically new index commands.

2023-02-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line):
	remove index entry commands from the list of commands that do not
	start paragraphs in the check before calling begin_paragraph.

2023-02-18  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (_end_line_def_line):
	Reorder conditional to match XS code.  No functional changes.

2023-02-18  Patrice Dumas  <pertusus@free.fr>

	Index commands close paragraphs

	* tp/Texinfo/ParserNonXS.pm (%default_close_paragraph_commands),
	(parser, _parse_line_command_args), tp/Texinfo/XS/parsetexi/commands.c
	(close_preformatted_command), tp/Texinfo/XS/parsetexi/indices.c
	(add_index_command): set index commands as close_paragraph commands,
	but do not set them to close preformatted containers.

	* tp/Texinfo/ParserNonXS.pm (_end_paragraph),
	tp/Texinfo/XS/parsetexi/parser.c (end_paragraph): remove empty
	paragraphs.

2023-02-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/indices.c (enter_index_entry): remove
	the number field from the index entry structure as it is not
	used, the position in the index array is directly used in api.c.

	* tp/Texinfo/ParserNonXS.pm: update POD documentation of index
	entries, add index related extra keys documentation.

2023-02-18  Gavin Smith <gavinsmith0123@gmail.com>

	* Texinfo/Convert/HTML.pm (_convert_def_line_type) <DEF_TABLE>:
	Reorder conditional and remove one level of indentation.  No
	functional changes.

2023-02-18  Gavin Smith <gavinsmith0123@gmail.com>

	* Texinfo/Convert/TexinfoMarkup.pm (%defcommand_name_type):
	Specfify 'defline' as documenting 'symbol' objects.
	* util/texinfo.dtd: Add <defsymbol>.

2023-02-18  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/DocBook.pm (%defcommand_name_type):
	For @defline, wrap main symbol in <varname>, which is the
	best DocBook tag I could find for this.

2023-02-18  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/LaTeX.pm (_convert): Do not treat @defline
	as "unhandled".

2023-02-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_printindex_command)
	(_prepare_index_entries), tp/Texinfo/Convert/IXIN.pm (output_ixin),
	tp/Texinfo/Convert/Plaintext.pm (process_printindex),
	tp/Texinfo/ParserNonXS.pm (_enter_index_entry),
	tp/Texinfo/Transformations.pm (_reassociate_to_node),
	tp/Texinfo/XS/parsetexi/indices.c (enter_index_entry),
	tp/t/automatic_nodes.t: rename 'entry_node' as 'element_node' and
	'entry_region' as 'element_region'.

2023-02-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_printindex_command)
	(_prepare_index_entries), tp/Texinfo/Convert/IXIN.pm (output_ixin),
	tp/Texinfo/Convert/Plaintext.pm (process_printindex),
	tp/Texinfo/ParserNonXS.pm (_enter_index_entry),
	tp/Texinfo/Structuring.pm (index_entry_sort_string),
	tp/Texinfo/Transformations.pm (_reassociate_to_node),
	tp/Texinfo/XS/parsetexi/api.c (build_single_index_data),
	tp/Texinfo/XS/parsetexi/indices.c (wipe_index, enter_index_entry),
	tp/t/automatic_nodes.t: associate 'entry_node', 'entry_region'
	and 'index_ignore_chars' to the element associated to an index entry
	rather than to the index entry.

2023-02-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/api.c (build_single_index_data),
	tp/Texinfo/XS/parsetexi/indices.c (wipe_index, enter_index_entry):
	store index_ignore_chars as a string already in enter_index_entry.

2023-02-18  Patrice Dumas  <pertusus@free.fr>

	Store index_ignore_chars as a string

	* tp/Texinfo/Common.pm (_substitute_references),
	tp/Texinfo/ParserNonXS.pm (@set_flag_index_char_ignore_order)
	(_enter_index_entry), tp/Texinfo/Structuring.pm
	(index_entry_sort_string), tp/Texinfo/XS/parsetexi/api.c
	(build_single_index_data): store index_ignore_chars as a string,
	by concatenating txiindex*ignore characters in a predetermined order.

2023-02-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/09indices.t: add index_entries_before_nodes
	test, with NODE_NAME_IN_INDEX set to get the HTML warning, as when the
	converter is called with convert, as is sthe case for html_text,
	NODE_NAME_IN_INDEX is not set based on USE_NODES.

2023-02-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_printindex_command): add
	targetted warnings for index entries not associated to node or section
	that are formatted in printindex with warnings only if the index entry
	is expected to be associated with a node (NODE_NAME_IN_INDEX set) or
	a section (NODE_NAME_IN_INDEX set to 0), and if the index entry is not
	in a special region (titlepage or copying).

	* tp/t/input_files/index_special_region.texi: add a comment.

2023-02-18  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line):
	Match pure Perl code better by looking up "def_command" extra
	value.

2023-02-18  Gavin Smith <gavinsmith0123@gmail.com>

	@defblock, @defline in XS parser

	* tp/Texinfo/XS/parsetexi/close.c (close_command_cleanup):
	Call gather_def_item for @defblock.
	* tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command):
	Handle @defline.  Allow @defline and @deflinex in @defblock.
	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line):
	No index entry for @defline.

2023-02-18  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/Common.pm (%def_map): Add defline.

2023-02-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (index_content_element),
	tp/Texinfo/Convert/DocBook.pm (_index_entry),
	tp/Texinfo/Convert/HTML.pm (_convert_printindex_command)
	(_prepare_index_entries, output_internal_links),
	tp/Texinfo/Convert/IXIN.pm (output_ixin), tp/Texinfo/Convert/LaTeX.pm
	(_index_entry), tp/Texinfo/Convert/Plaintext.pm (process_printindex),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_index_entry),
	tp/Texinfo/ParserNonXS.pm (_enter_index_entry),
	tp/Texinfo/Structuring.pm (sort_indices),
	tp/Texinfo/Transformations.pm (_reassociate_to_node),
	tp/Texinfo/Translations.pm (complete_indices),
	tp/Texinfo/XS/parsetexi/api.c (build_single_index_data),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line),
	tp/Texinfo/XS/parsetexi/indices.c (wipe_index, enter_index_entry),
	tp/init/chm.pm (chm_init): remove 'content_normalized' and
	'entry_content' from index entry.  Instead, add 'def_index_element'
	and 'def_index_ref_element' to extra of definition lines, and use
	Texinfo::Common::index_content_element to find, in the tree, the
	element corresponding to the content of the index entry associated
	to the 'entry_element' entry element.

	* tp/Texinfo/Common.pm (_relate_index_entries_to_table_items_in),
	tp/Texinfo/Convert/HTML.pm (_convert_printindex_command)
	(_prepare_index_entries): use 'entry_associated_element' to
	re-associate index entry command to table entry, and not
	'entry_element' as it holds informations important for the index
	entry. It is not ideal, as it adds an undocumented key to the index
	entry.

	* tp/Texinfo/Convert/DocBook.pm (_convert): restrict elements
	trigerring pending_prepend text addition more than with
	Texinfo::Common::element_is_inline, allow only paragraph and
	preformatted, as containers like line_args are inline, but we do not
	want to have text prepended there.

2023-02-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_enter_index_entry),
	tp/Texinfo/Structuring.pm (sort_indices),
	tp/Texinfo/XS/parsetexi/api.c (build_single_index_data),
	tp/Texinfo/XS/parsetexi/indices.c (enter_index_entry): do not
	duplicate sortas information in index entry. Change 'current' variable
	name.

	* tp/Texinfo/Convert/HTML.pm (_convert_printindex_command),
	tp/Texinfo/Structuring.pm (sort_indices): use a variable for the
	element associated to the index entry.

	* tp/Texinfo/Structuring.pm: avoid autovivification.

2023-02-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_enter_index_entry),
	tp/Texinfo/XS/parsetexi/api.c (build_single_index_data),
	tp/Texinfo/XS/parsetexi/indices.c (enter_index_entry): remove
	index_at_command and index_type_command entries from index entries.
	Remove index_at_command argument of enter_index_entry, update callers.

	* tp/Texinfo/Convert/Plaintext.pm (): determine @-command name
	associated to index entry based on the tree element.

2023-02-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (sort_indices): determine @-command name
	associated to index entry based on the tree element.

2023-02-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (_sort_index_entries)
	(_collator_sort_index_entries): use index_name as the last way to
	disambiguate index entries when sorting.

2023-02-16  Gavin Smith <gavinsmith0123@gmail.com>

	Initial @defblock, @defline in texi2any

	* tp/Texinfo/command_data.txt (defblock, defline, deflinex): Add.

	* tp/Texinfo/ParserNonXS.pm
	(_close_command_cleanup): Call _gather_def_item for @defblock.
	(_process_remaining_on_line):
	Allow any def line command in @defblock, including @defline.
	(_end_line_def_line): No index entry for @defline.

	* tp/Texinfo/Convert/Plaintext.pm (%indented_commands): Add @defblock.
	(_convert): Do not treat "defline" as an unhandled command.  Treat
	defline similarly to deffn.
	* tp/Texinfo/Convert/HTML.pm (%default_commands_conversion):
	Use _convert_def_command for @defblock.

	* doc/texinfo.tex (@defline, @deftypeline):
	Define as synonymns for @deflinex, @deftypelinex.

2023-02-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_close_container, _remove_empty_content)
	(_expand_macro_arguments), tp/Texinfo/XS/parsetexi/close.c
	(remove_empty_content, close_container),
	tp/Texinfo/XS/parsetexi/macro.c (expand_macro_arguments): separate the
	code to remove empty content, put in remove_empty_content from the
	remaining of close_container.  Do not remove completly macro arguments
	that are empty, only remove the contents, keep a brace_command_arg to
	mark that there was an empty string argument in the Texinfo code.

2023-02-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): keep information 
	on empty ignored inline conditional arguments.

	* tp/Makefile.tres, tp/t/xml_tests.t: new test
	inlineifset_empty_second_arg.

2023-02-16  Patrice Dumas  <pertusus@free.fr>

	* util/txixml2texi.pl (BEGIN): update by adapting texi2any.pl BEGIN
	block.

2023-02-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/separator.c (handle_comma): do not open
	a brace command container if the second argument of inlinefmtifelse
	does not exist.

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line): comments,
	more similar code to XS parser.

2023-02-15  Patrice Dumas  <pertusus@free.fr>

	* tp/t/input_files/delcomment_followed_by_cpp_line.texi: remove
	(wrong) @setfilename.

	* tp/t/test_utils.pl (output_texi_file): do not add a chapter if there
	is a node with name starting by chap.

2023-02-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/converters_tests.t: add
	setfilename_no_extension test.

	* tp/t/30sectioning.t, tp/t/input_files/*.texi,
	tp/tests/formatting/*.texi: remove some @setfilename,
	when it is not useful for the test, for file that are used in more
	than one test.

2023-02-15  Patrice Dumas  <pertusus@free.fr>

	* tp/t/converters_tests.t: change node names to avoid warnings.

2023-02-15  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/handle_commands.c (parse_line_command_args):
	Reference regions stack correctly.  Report from Patrice.

2023-02-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/xml_tests.t: rename node_no_section as
	top_node_no_section and node_and_bye as top_node_and_bye.

	* tp/tests/formatting/index_entries_relate_to_item.texi,
	tp/t/input_files/all_spaces.texi,
	tp/t/input_files/chinese_mixed_with_en.texi: add chapter/node after
	Top node.

2023-02-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/languages.t: rename simple as
	simple_documentlanguage and multiple as multiple_documentlanguage.
	Add some chapter and node after Top to be more useful for output
	formats that do not output the Top node, and also to test for
	translation in @node.

2023-02-15  Patrice Dumas  <pertusus@free.fr>

	* tp/t/init_files_tests.t, tp/t/init/undef_node_file_name.init: change
	tests to be more useful for LaTeX, and more like actual manuals by
	renaming a node and adding a chapter.

2023-02-15  Patrice Dumas  <pertusus@free.fr>

	* tp/t/formats_encodings.t: change tests to be more useful for LaTeX by
	renaming a node.

	* tp/t/html_tests.t: add some chapters for tests to look more like
	actual manuals.

2023-02-15  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace):
	Call add_extra_string_dup instead of add_extra_string.

2023-02-15  Gavin Smith <gavinsmith0123@gmail.com>

	Put regions stack in nesting context

	* tp/Texinfo/XS/parsetexi/context_stack.h (NESTING_CONTEXT):
	Add regions_stack field.
	* tp/Texinfo/XS/parsetexi/api.c (reset_parser_except_conf): Reset it.
	* tp/Texinfo/XS/parsetexi/context_stack.c
	(push_region, pop_region, current_region, current_region_cmd)
	(reset_region_stack): Remove.

	* tp/Texinfo/XS/parsetexi/handle_commands.c (handle_block_command),
	* tp/Texinfo/XS/parsetexi/close.c (pop_block_command_contexts):
	Push and pop from new regions stack.

	* tp/Texinfo/XS/parsetexi/tree_types.h (INDEX_ENTRY):
	Type of 'region' field is now enum command_id, not ELEMENT *.
	* tp/Texinfo/XS/parsetexi/indices.c (enter_index_entry):
	Assign 'region' from region_stack.
	* tp/Texinfo/XS/parsetexi/api.c (build_single_index_data):
	Create Perl string for 'entry_region'.
	* tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace) <@anchor>:
	Save 'region' as string rather than element reference.

	* tp/Texinfo/XS/parsetexi/parser.c (check_valid_nesting_context):
	Check that region command does not occur inside region command.
	* tp/Texinfo/XS/parsetexi/handle_commands.c (handle_block_command):
	Do not check for nested region here.

2023-02-15  Gavin Smith <gavinsmith0123@gmail.com>

	Put regions stack in nesting context

	* tp/Texinfo/ParserNonXS.pm (parser):
	Initialise 'regions_stack' on 'nesting_context'.
	(%parser_state_initialization): Remove 'regions_stack'.

	(_pop_block_command_contexts, _enter_index_entry)
	(_process_remaining_on_line, _parse_line_command_args):
	Refer to new array throughout.
	(_enter_index_entry),
	(_process_remaining_on_line) <@anchor>:
	Set 'entry_region' and 'region' to string rather than element
	reference.

	(%not_in_region_commands): New hash, initialised with region
	commands.
	(_check_valid_nesting_context): Check commands within region
	commands.
	(_process_remaining_on_line): Do not check for nested regions here.

2023-02-15  Patrice Dumas  <pertusus@free.fr>

	* tp/t/60macro.t, tp/t/80include.t: change tests to be more useful for
	LaTeX by adding nodes after Top node.

2023-02-15  Patrice Dumas  <pertusus@free.fr>

	* tp/t/57invalid_nestings.t: change ref_in_anchor test name to
	ref_to_top_in_anchor.  Change tests to be more useful for LaTeX by
	adding nodes and renaming nodes.

2023-02-15  Patrice Dumas  <pertusus@free.fr>

	* tp/t/50value.t, tp/t/55conditionals.t: change tests to be more
	useful for LaTeX by adding nodes after Top node.

2023-02-15  Patrice Dumas  <pertusus@free.fr>

	* tp/t/40moresectioning.t: add latex output for
	placed_things_before_node.  Change tests to be more useful for
	LaTeX and avoid warnings by changing node names.

2023-02-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/30sectioning.t: rename node test as
	node_simple.  Change tests to be more useful for LaTeX by adding a
	node after the Top node, change node names, adding an @unnumbered.

2023-02-15  Patrice Dumas  <pertusus@free.fr>

	* tp/t/27float.t, tp/t/28heading.t: change tests to be more useful for
	LaTeX by adding a node after the Top node.  Add latex output for all
	the float tests.

2023-02-15  Patrice Dumas  <pertusus@free.fr>

	* tp/t/22xtable.t, tp/t/25regions.t: change tests to be more useful
	for LaTeX by adding a node or chapter after the Top node or renaming
	the Top or other nodes.

2023-02-15  Patrice Dumas  <pertusus@free.fr>

	* tp/t/19def.t: change tests to be more useful for LaTeX by adding a
	node after the Top node or renaming the Top or other nodes.

2023-02-15  Patrice Dumas  <pertusus@free.fr>

	* tp/t/10menu.t: rename Top node as first when it is not important for
	the first node to be the Top node, for the formats in which Top node
	is not output.

2023-02-15  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (output_texi_file): better formatting of output
	file.  Warn if it is not possible to get an output relevant output
	formats that do not output @node Top.  Node name beginning by 'chap'
	are considered to stop the Top node and allows to have a useful test
	in formats that do not output @node Top content.

	* tp/t/03coverage_braces.t, tp/t/08misc_commands.t: change tests to be
	more useful for LaTeX by adding a node after the Top node or replacing
	by an anchor.

	* tp/t/09indices.t, tp/t/input_files/*.texi: change tests to be more
	useful for LaTeX by adding a node after the Top node or renaming such
	a node to be prefixed by chap and avoid the warning in test_utils.pl..

2023-02-15  Patrice Dumas  <pertusus@free.fr>

	@thisfile in LaTeX output

	* doc/texinfo.texi (Custom Headings), tp/Texinfo/Convert/LaTeX.pm
	(%LaTeX_in_heading_commands_formatting, _latex_header)
	(_push_new_context, _set_custom_headings, _include_file_name)
	(_convert): add a context for custom heading commands.  If thisfile is
	in a custom heading, determine current include file based on source
	marks in collected_includes state stack, and reset a LaTeX macro when
	the current include file changes.  Always prepend to $result in
	_convert.

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/latex_tests.t:
	add custom_heading_with_include and
	custom_heading_with_include_in_command tests.

2023-02-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): check
	the whole command name when checking for nested ignored @if*
	conditional block commands.

	* tp/Makefile.tres, tp/t/55conditionals.t: add
	nested_ifset_prepended_to_command_name test.

2023-02-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): keep
	content in ignored rawpreformatted output block commands in
	elided_rawpreformatted container as raw text.

	* tp/Texinfo/Convert/TextContent.pm (%ignored_block_commands): ignore
	@latex.

2023-02-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/60macro.t: add
	macro_expansion_end_in_conditional_line and
	macro_expansion_end_in_conditional_end tests.

2023-02-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_misc_line)
	(_end_line_starting_block, _parse_texi), tp/Texinfo/XS/parsetexi/api.c
	(store_source_mark_list), tp/Texinfo/XS/parsetexi/end_line.c
	(end_line_starting_block, end_line_misc_line),
	tp/Texinfo/XS/parsetexi/parser.c (push_conditional_stack)
	(pop_conditional_stack, top_conditional_stack),
	tp/Texinfo/XS/parsetexi/parser.h (CONDITIONAL_STACK_ITEM),
	tp/Texinfo/XS/parsetexi/source_marks.c (register_source_mark)
	(source_marks_reset_counters): add source marks for expanded @if*
	block conditionals, associated to the @if opening line and the @end
	line.  Add the start source mark to the conditional stack.

2023-02-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/60macro.t, tp/t/converters_tests.t: add
	macro_expansion_end_in_ignored_ifset_content,
	macro_expansion_end_in_ignored_nested_conditional,
	macro_expansion_end_in_ignored_nested_different_conditional tests in
	*macro.t and inlinefmtifelse_with_commands in converters_tests.t.

2023-02-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_close_commands, _end_line_misc_line)
	(_process_remaining_on_line), tp/Texinfo/XS/parsetexi/close.c
	(close_commands), tp/Texinfo/XS/parsetexi/end_line.c
	(end_line_misc_line), tp/Texinfo/XS/parsetexi/parser.c
	(top_conditional_stack, process_remaining_on_line): process end of
	ignored conditional block in a similar way to other block commands. Do
	not change how it is detected.

2023-02-14  Patrice Dumas  <pertusus@free.fr>

	* tp/ext/latex2html.pm (l2h_process), tp/ext/tex4ht.pm
	(tex4ht_prepare): update for the changes in elided* types names.

2023-02-14  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/coverage/formatting.texi,
	tp/tests/coverage/res_parser/formatting_macro_expand/formatting.texi:
	fix conditional processing meant to avoid Texinfo invalid for TeX,
	with special cases in @example.  Use a conditional definition instead
	of ifset and ifclear nesting, as now ifclear nests in ifset.

2023-02-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/source_marks.c (relocate_source_marks):
	replace the for loop by a while to be sure that the index is
	incremented before the loop exit.  Remove one from the loop variable
	to start the check on source marks to remove.

2023-02-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/source_marks.c (relocate_source_marks):
	return immediately if there are no source marks.  Gavin report.

	* tp/Makefile.tres, tp/t/19def.t: add empty_main_def_arguments.

2023-02-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/macro.c (expand_macro_body): content in
	argument may be missing for the last argument which removal is
	attempted in expand_macro_arguments.  Gavin report.

	* tp/Makefile.tres, tp/t/60macro.t: add macro_call_empty_two_arg
	with diverse possibilities of spaces and empty args for a two
	arguments macro call.

2023-02-13  Patrice Dumas  <pertusus@free.fr>

	Use pre-set keys for index sorting

	* tp/Texinfo/Structuring.pm (_sort_string, _sort_index_entries),
	(_collator_sort_index_entries, index_entry_sort_string, sort_indices),
	tp/Texinfo/Convert/LaTeX.pm (_index_entry): add the possibility to
	preset the sort keys using getSortKey.  Distinguish sort string, which
	can be the preset binary string, from entry string which is a text
	representation of the sorted string.  Idea from Gavin.

2023-02-12  Gavin Smith <gavinsmith0123@gmail.com>

	Non-XS optimizations

	* tp/Texinfo/Convert/ParagraphNonXS.pm (_add_next, add_text):
	Add /o flag to regexes using string interpolation, in order to
	only compile each regex once.
	* tp/Texinfo/Convert/Unicode.pm (string_width):
	Sometimes call 'length' on the string.  This makes a difference
	because string_width is now called from ParagraphNonXS.pm.

2023-02-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_close_ignored_block_conditional)
	(_close_current, _process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/close.c (close_ignored_block_conditional),
	(close_current), tp/Texinfo/XS/parsetexi/parser.c
	(process_remaining_on_line): add close_ignored_block_conditional
	to associated a source mark to a closed ignored conditional block,
	to do it in close_current in addition to process_remaining_on_line.

2023-02-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_misc_line): avoid
	autovivification.

2023-02-12  Patrice Dumas  <pertusus@free.fr>

	Add source marks for ignored @if* conditional block commands

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/api.c (store_source_mark_list),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/source_marks.c (register_source_mark),
	(source_marks_reset_counters): add ignored_conditional_block source
	mark for ignored @if* conditional block commands.  Avoid setting empty
	contents for block commands.

	* tp/Texinfo/XS/parsetexi/end_line.c, tp/Texinfo/XS/parsetexi/input.c,
	tp/Texinfo/XS/parsetexi/macro.c: change in spacing for mark source
	related function calls.

2023-02-12  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line):
	Avoid use of goto statements to reduce program run time.

2023-02-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_starting_block)
	(_process_remaining_on_line), tp/Texinfo/XS/parsetexi/end_line.c
	(end_line_starting_block), tp/Texinfo/XS/parsetexi/handle_commands.c
	(handle_block_command), tp/Texinfo/command_data.txt: do not handle
	especially conditional block commands opening in
	_process_remaining_on_line or handle_block_command, let non-specific
	code handle block command line parsing, and take care of their
	arguments in end_line_starting_block.

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): put
	ignored conditional block content in the block element.

2023-02-12  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): use the same expanded formats in the
	conversion to text as for the parser.

2023-02-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/60macro.t: add unpaired_backslash_in_macro_body
	test. Remove backslash in macro_end_call_in_ignored_inlineraw.

2023-02-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Text.pm: rename _code_options as _code_state and
	raw as _raw_state.

	* tp/Texinfo/Convert/Text.pm (_convert): decrease _raw_state when
	coming out of raw state.

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line): in ignored
	@inline* arguments, do not postpend to the line when there is no match
	with a delimiter, instead consume the line. As in the XS parser.

	* tp/Texinfo/XS/parsetexi/macro.c (expand_macro_body): keep text after
	a non paired \ in the macro body, like the perl parser.

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/separator.c (handle_comma): put elided
	content of @inline* in the tree.

	* tp/Texinfo/ParserNonXS.pm (_expand_macro_body): change code to be
	clearer and more in line with XS parser code.

2023-02-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/element_types.txt,
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/separator.c (handle_comma): remove elided
	as elided_brace_command_arg and elided_block as elided_rawpreformatted
	to convey the similarity with the corresponding containers without
	leading elided_.

2023-02-11  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (%contain_full_line_commands):
	Remove, merged into %contain_full_text_commands.
	* tp/Texinfo/XS/parsetexi/parser.c (check_valid_nesting):
	Update comments.

2023-02-11  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (_end_line_def_line),
	* tp/Texinfo/XS/parsetexi/end_line.c (_end_line_def_line):
	Assign $current to parent element earlier in function.

2023-02-11  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (_end_line_def_line): Do not call
	_isolate_last_space.
	(_end_line_misc_line, _end_line_starting_block): Move call to
	_isolate_last_space before call to _end_line_def_line.

	* tp/Texinfo/XS/parsetexi/end_line.c
	(_end_line_def_line, _end_line_misc_line, _end_line_starting_block):
	Make the same change.

2023-02-11  Gavin Smith <gavinsmith0123@gmail.com>

	Initial @newdef implementation

	* doc/texinfo.tex (@newdef): Implement @newdef.  Syntax is subject
	to change.

2023-02-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/60macro.t: add
	macro_inlineifcond_end_in_empty_ignored and
	macro_inlineifcond_end_in_empty_set tests.

2023-02-11  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Typed Functions):
	Place R language example in @ignore block as @var uppercases
	named arguments in Info output.

2023-02-11  Gavin Smith <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (@defblock, @deflinex, @deftypelinex):
	Add commands for definitions that do not create index entries.

2023-02-11  Gavin Smith <gavinsmith0123@gmail.com>

	Revert @useindex implementation

	* doc/texinfo.tex (\useindex, \defind): Remove.  This reverts
	change on 2022-12-15.

2023-02-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/60macro.t: add
	macro_end_call_in_ignored_inlinefmt,
	macro_end_call_in_ignored_inlineraw,
	macro_call_in_ignored_inlinefmtifelse,
	macro_end_call_in_ignored_inlinefmtifelse and
	macro_call_in_inlinefmtifelse_format with end/start of macro call in
	@inline*fmt and @inlineraw.

2023-02-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/60macro.t: add macro_end_call_in_ignored_raw
	test with a macro call end within an ignored raw format block.

2023-02-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_expand_macro_arguments),
	tp/Texinfo/XS/parsetexi/macro.c (expand_macro_arguments): only remove
	last empty argument in macro call arguments, an empty argument in the
	middle is significant.

	* tp/Makefile.tres, tp/t/60macro.t: new test
	macro_call_empty_middle_arg with an empty middle argument in a macro
	call.

2023-02-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_remove_empty_arg)
	(_expand_macro_arguments, _expand_macro_body, _handle_macro),
	tp/Texinfo/XS/parsetexi/macro.c (remove_empty_arg)
	(expand_macro_arguments, expand_macro_body, handle_macro):
	parse macro arguments in structures similar to the main elements
	tree, for consistency with the remaining of the code, and to hold
	source marks in macro arguments.

	* tp/Texinfo/ParserNonXS.pm (_merge_text): transfer source marks
	only if transfer_marks_element is defined.

	* tp/Texinfo/ParserNonXS.pm: avoid autovivification.

2023-02-10  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/command_data.txt: Remove @useindex as this
	will no longer be implemented.

2023-02-09  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/TODO: remove erroneous constructs that now give warnings

2023-02-09  Gavin Smith <gavinsmith0123@gmail.com>

	Better worded error messages for line context

	* tp/Texinfo/ParserNonXS.pm (_check_valid_nesting_context),
	* tp/Texinfo/XS/parsetexi/parser.c (check_valid_nesting_context):
	For line and block commands, refer to invalid command "on line" to
	avoid confusion with block contents.

2023-02-09  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block):
	Use variable for current command throughout instead of struct access.

2023-02-09  Gavin Smith <gavinsmith0123@gmail.com>

	Use nesting stacks for sectioning and def commands

	* tp/Texinfo/command_data.txt: Add contain_basic_inline flag
	for all def and sectioning_heading commands.

	* tp/Texinfo/ParserNonXS.pm
	(%in_basic_inline_with_refs_commands): Remove.
	(%default_valid_nestings):
	Do not set using %in_basic_inline_with_refs_commands.
	(%ok_in_basic_inline_with_refs_commands): New hash, with exceptions.
	(_check_valid_nesting): Eliminate special handling of ct_def context.
	(_check_valid_nesting_context):
	Use %ok_in_basic_inline_with_refs_commands as list of inclusions
	for sectioning and def commands.

	* tp/Texinfo/ParserNonXS.pm
	(_end_line_misc_line, _end_line_starting_block):
	Pop nesting contexts before calling _end_line_def_line.

	* tp/Texinfo/XS/parsetexi/parser.c (check_valid_nesting):
	Do not handle "basic inline with refs" commands.
	* tp/Texinfo/XS/parsetexi/parser.c (check_valid_nesting_context):
	Include CF_ref commands as allowed for sectioning and def commands.

	* tp/Texinfo/XS/parsetexi/end_line.c
	(end_line_misc_line, end_line_starting_block):
	Pop nesting contexts before calling end_line_def_line.

2023-02-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/source_marks.c (relocate_source_marks):
	only check removal of source marks that were looked at.

2023-02-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/source_marks.c (relocate_source_marks):
	fix incorrect initialization with incorrect memset size argument.
	Gavin report.

2023-02-09  Gavin Smith <gavinsmith0123@gmail.com>

	Call def line ending code at lower level

	* tp/Texinfo/ParserNonXS.pm
	(_end_line_starting_block, _end_line_misc_line):
	Redirect to _end_line_def_line if called on a def line.
	(_end_line, _close_current):
	Remove separate cases for calling _end_line_def_line.

	* tp/Texinfo/XS/parsetexi/end_line.c
	(end_line_starting_block, end_line_misc_line):
	Redirect to end_line_def_line if called on a def line.
	* tp/Texinfo/XS/parsetexi/end_line.c (end_line),
	* tp/Texinfo/XS/parsetexi/close.c (close_current):
	Do not call end_line_def_line.

2023-02-08  Gavin Smith <gavinsmith0123@gmail.com>

	Stop text disappearing in Info nodes with encoding conversion

	* info/util.c (text_buffer_iconv): Update text buffer length
	after error so that we do not write over the same output again.

2023-02-08  Gavin Smith <gavinsmith0123@gmail.com>

	Unify @multitable block line arg ending

	* tp/Texinfo/ParserNonXS.pm (_end_line_misc_line) <@columnfractions>:
	Do not close the @multitable block line element, so that
	_end_line_starting_block will be called afterwards.  Only record
	the @columnfractions command in the 'extra' hash.
	(_end_line_starting_block): Check if columnfractions has been
	set so to avoid reading line as prototype list.

	* tp/Texinfo/XS/parsetexi/end_line.c
	(end_line_misc_line) <@columnfractions>: Do not close multitable
	block line element: only set 'columnfractions'.
	(end_line_starting_block): Check if 'columnfractions' has been set.

2023-02-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line):
	add $current to new_line call to register source mark after @end of
	ignored cnditional.

2023-02-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_relocate_source_marks),
	tp/Texinfo/XS/parsetexi/source_marks.c (relocate_source_marks):
	relocate source marks within a range, with the first source mark not
	necessarily in range.  Move relocate_source_marks from def.c to
	source_marks.c.

	* tp/Texinfo/ParserNonXS.pm (_isolate_last_space),
	tp/Texinfo/XS/parsetexi/parser.c (isolate_last_space_internal):
	relocate source marks corresponding to the new spaces element.

	* tp/Texinfo/XS/parsetexi/source_marks.c
	(remove_from_source_mark_list): move remove_from_source_mark_list from
	tree.c to source_marks.c.

2023-02-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_new_line, _process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/input.c (new_line),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command):
	pass current in new_line to get end of macro/value source marks
	in line commands where there is no macro/value expansion.  Explain
	in a comment that the location of the source mark cannot be accurate,
	as the text is not parsed as usual in the tree.

	* tp/Texinfo/ParserNonXS.pm (_next_text, _debug_show_source_mark):
	show mark source information for debugging with
	_debug_show_source_mark, add code to show ignored source marks in
	_next_text.

2023-02-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/input.c (next_text): after calling
	input_push_text for delcomment, set the input pointer again as the
	input stack may have been reallocated.

2023-02-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_next_text),
	tp/Texinfo/XS/parsetexi/input.c (next_text): reuse input source mark
	for delcomment.  Do not pass line from input source mark to the other
	source marks.

2023-02-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%default_commands_args)
	(_convert_value_command), tp/Texinfo/Convert/LaTeX.pm (_convert),
	tp/Texinfo/Convert/Plaintext.pm (_convert),
	tp/Texinfo/Convert/Texinfo.pm (_expand_cmd_args_to_texi),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/ParserNonXS.pm (_new_value_element)
	(_process_remaining_on_line), tp/Texinfo/XS/parsetexi/parser.c
	(new_value_element, process_remaining_on_line): use the same structure
	for txiinternalvalue, a value not expanded in tree and value expansion
	source mark element, setup by calling new_value_element().  Update
	formatting in converters.

2023-02-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_transfer_source_marks, _close_container)
	(_close_command_cleanup, _merge_text, _end_line): test only existence of
	source_marks key, if it exists it is necessarily non-empty.

	* tp/Texinfo/ParserNonXS.pm (_merge_text, _abort_empty_line)
	(_split_delimiters, _split_def_args): delete source_marks from the
	source element after they have been transferred.

	* tp/Texinfo/ParserNonXS.pm (_split_delimiters, _split_def_args)
	(_parse_def): check that source marks have all been transferred.

2023-02-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/html_tests.t: add the
	file_name_case_insensitive_conflict_node and
	file_name_case_insensitive_conflict_node_no_redirections test to test
	conflicts with node names differing in case only without and with
	NODE_FILES.

2023-02-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line):
	fix beginning of line condition nesting.

2023-02-06  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/many_input_files/*.sh: add $prepended_command to the
	commands run.

2023-02-06  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/many_input_files/*.sh: use a variable for the command
	run to avoid redundant code.

2023-02-06  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/run_parser_all.sh: reindent a function.

2023-02-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/end_line.c (skip_comment),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_block_command),
	tp/Texinfo/XS/parsetexi/parser.c (read_comment): add an argument
	to read_comment, set to 1 if there is a comment.  Remove the
	comment_command argument of read_comment, the comment command is at
	the line argument location, so if there is a comment the caller can
	easily find the comment argument beginning.  Return a pointer past
	@c/@comment, whether there is indeed a comment or not.
	Update call in handle_block_command.
	Use read_comment in skip_comment (removes a valgrind error).

2023-02-06  Gavin Smith <gavinsmith0123@gmail.com>

	Reduce list of line commands that may occur other than at line start

	* tp/Texinfo/ParserNonXS.pm (%begin_line_commands):
	Include @sp, @verbatiminclude, @set, @clear, @vskip.
	* tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line):
	Likewise.
	* NEWS: Mention change for @set and @value, and better validity
	checking in general.
	* doc/texinfo.texi (@set @value): Do not say that @set can
	occur at the beginning of a line.

2023-02-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/macro.c (expand_macro_arguments): fix
	arg_space, which is not the number of allocated elements in arg_list,
	but comparable to arg_number, with 1 added to obtain the allocated
	number of elements to add the null delimiter.  Change name of
	new_arg_space to new_alloc_space to make clearer that it is the
	allocated number of elements, not a space comparable to arg_number.

2023-02-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/macro.c (expand_macro_arguments): always
	allocate 2 arg_list elements, for an argument, which can be an empty
	string, and the null delimiter.  Initialize arg_space to 2
	accordingly (found through valgrind output).

2023-02-05  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (run_all), tp/t/README: process all the tests
	given in argument.

2023-02-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (read_comment): check string
	length to avoid reading past the string end (found through valgrind
	output).

2023-02-05  Patrice Dumas  <pertusus@free.fr>

	Source mark for value expansion

	* tp/Texinfo/ParserNonXS.pm (_next_text, _process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/input.c (next_text),
	tp/Texinfo/XS/parsetexi/api.c (store_source_mark_list),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/source_marks.c (register_source_mark)
	(source_marks_reset_counters): register value expansion source marks.

	* tp/Texinfo/XS/parsetexi/input.c (next_text): strdup line when
	duplicating start source mark line for end source mark.

2023-02-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_relocate_source_marks)
	(_split_delimiters, _split_def_args), tp/Texinfo/XS/parsetexi/def.c
	(relocate_source_marks, split_delimiters, split_def_args): add
	relocate_source_marks to help relocating source marks, taken from from
	split_def_args.  Relocate source marks in split_delimiters using that
	function.

	* tp/Texinfo/XS/parsetexi/def.c (relocate_source_marks),
	tp/Texinfo/XS/parsetexi/tree.c (remove_from_source_mark_list): correct
	the source mark relcation code by starting from the first source mark,
	and add remove_from_source_mark_list to be able to remove a source
	mark from any position in the list.

	* tp/Makefile.tres, tp/t/60macro.t: add macro_in_def_delimiters
	with macro expansion in delimiters and text that tests relocation of
	source marks in split_delimiters.

2023-02-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/60macro.t: add
	macro_before_specific_line_command_args test.

2023-02-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line): remove the
	popping of contents at the end of a root command, there is nothing to
	pop, and if there was, it should be fixed directly.

2023-02-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_transfer_source_marks),
	tp/Texinfo/XS/parsetexi/source_marks.c (transfer_source_marks): modify
	add_source_marks to transfer source marks between two elements.  For
	the perl parser, test for source marks in transfer_source_marks.
	Empty the source element source marks in transfer_source_marks.

2023-02-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_pop_element_from_contents)
	(_abort_empty_line), tp/Texinfo/XS/parsetexi/parser.c
	(abort_empty_line), tp/Texinfo/XS/parsetexi/tree.c
	(pop_element_from_contents): do reparenting of source marks in
	abort_empty_line and not in pop_element_from_contents.

	* tp/Makefile.tres, tp/t/60macro.t: add an explicit test of empty
	string with a macro call source mark first in an element.

2023-02-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line): use merge_text argument
	to transfer source marks when reconstructing text from an aborted menu
	entry line.

	* tp/Makefile.tres, tp/t/60macro.t: add macro_in_menu_comment_like_entry
	with source marks in text finally not considered as a menu entry.

2023-02-05  Gavin Smith <gavinsmith0123@gmail.com>

	No more check for basic inline content in check_valid_nesting.

	* tp/Texinfo/ParserNonXS.pm (%default_valid_nestings):
	Do not add to from the %contain_basic_inline_commands hash.
	* tp/Texinfo/XS/parsetexi/parser.c (check_valid_nesting):
	Do not check or use CF_contain_basic_inline flag.

2023-02-05  Gavin Smith <gavinsmith0123@gmail.com>

	Basic inline stack for block line args

	* tp/Texinfo/ParserNonXS.pm
	(parser): Initialise 'basic_inline_stack_block'  stack.
	(_process_remaining_on_line) <line arg>: Push the new stack.
	(_end_line_starting_block)
	(_end_line_misc_line) <@columnfractions>:
	Pop the new stack.

	(_check_valid_nesting_context): Use 'basic_inline_stack_on_line'.

	* tp/Texinfo/XS/parsetexi/context_stack.h (NESTING_CONTEXT):
	Add basic_inline_stack_block field.
	* tp/Texinfo/XS/parsetexi/api.c (reset_parser_except_conf): Reset it.

	* tp/Texinfo/XS/parsetexi/parser.c (check_valid_nesting_context):
	Use new stack.
	* tp/Texinfo/XS/parsetexi/handle_commands.c (handle_block_command):
	Push.
	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block),
	(end_line_misc_line) <@columnfractions>:
	Pop.

2023-02-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_merge_text, _process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/menus.c (handle_menu),
	tp/Texinfo/XS/parsetexi/parser.c (merge_text): add a new argument to
	merge_text, to provide with an element to transfer source marks from.
	Update callers.

	* tp/t/60macro.t, tp/Makefile.tres: test marco expansion for dot not
	considered as a separator (not followed by a space) in menu entry
	name.

2023-02-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_block_command):
	use close_container to close menu_comment or menu description
	interrupted by a menu command, to handle correctly source marks
	in closed containers.

	* tp/t/60macro.t, tp/Makefile.tres: add
	macro_in_menu_comment_closed_by_detailmenu test.

2023-02-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/menus.c (handle_menu): use close_container
	to close preformatted and menu_comment when starting a menu entry.

2023-02-05  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (_end_line_starting_block):
	Place command name in a variable to avoid accessing hash every time.

2023-02-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/60macro.t: add test of macro expansion in
	empty line after paragraph that is reassociated to the paragraph
	container.

2023-02-04  Gavin Smith <gavinsmith0123@gmail.com>

	Basic inline stack for index commands

	* tp/Texinfo/ParserNonXS.pm (%default_basic_inline_commands):
	Initialise from %contain_basic_inline_commands and add index commands.
	(parser): Initialise $parser->{'basic_inline_commands'} therefrom.
	This hash is already mentioned in comment at top of file.
	(_close_brace_command, _end_line_misc_line)
	(_process_remaining_on_line): Use 'basic_inline_commands' hash.
	(_parse_line_command_args) <new index command>: Add to hash.

	* tp/Texinfo/XS/parsetexi/indices.c (add_index_command):
	Set CF_contain_basic_inline flag.
	* tp/Texinfo/XS/parsetexi/parser.c (check_valid_nesting):
	Eliminate check for CF_index_entry_command.
	(check_valid_nesting_context): Reorder a couple of conditionals.

2023-02-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line): transfer source marks
	from the empty line after menu description.

	* tp/Makefile.tres, tp/t/60macro.t: add focused test of empty string
	macro expansion in empty line after menu description.

2023-02-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (import): never load the abort_empty_line
	XS override as the function is not up to date with the changes needed
	for source marks.  Do not load the merge_text override either, as it
	uses the abort_empty_line XS override.

2023-02-04  Gavin Smith <gavinsmith0123@gmail.com>

	Eliminate duplicate warning messages

	* tp/Texinfo/ParserNonXS.pm (%default_valid_nestings):
	Do not add line commands with basic inline content.
	Do not add 'in_heading_spec' commands to the hashes for
	'heading_spec' commands because these are currently included
	as basic inline content.
	* tp/Texinfo/XS/parsetexi/parser.c (check_valid_nesting):
	Do not check any line commands for basic inline content.

2023-02-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Texinfo.pm (convert_to_texinfo): remove
	menu_entry and menu_comment from types with args.

	* tp/Texinfo/Convert/Texinfo.pm (_expand_cmd_args_to_texi):
	use common code for the different types of commands.

2023-02-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Text.pm (_convert): do not handle menu entry
	differently from other contents.

2023-02-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): do not handle
	menu entry differently from other contents.

2023-02-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_close_container),
	tp/Texinfo/XS/parsetexi/close.c (close_container): keep before_item
	type even if it contains only source marks, as a before_item signals
	in gather_previous_item that there is no need to add an empty table
	definition.

	* tp/Texinfo/ParserNonXS.pm (_close_command_cleanup),
	tp/Texinfo/XS/parsetexi/close.c (close_command_cleanup): keep a
	before_item even if it is empty if it contains a source mark.

	* tp/Texinfo/ParserNonXS.pm (_gather_previous_item): check the
	length of added contents for table definition and for table term
	and add contents only if there is some.

	* tp/Texinfo/ParserNonXS.pm (_close_command_cleanup): do not
	autovivify an empty contents for before_item.

	* tp/t/22xtable.t, tp/Makefile.tres: add empty_table for a regular
	empty @table.

	* tp/t/60macro.t, tp/Makefile.tres: add tests with macro expansion in
	empty before_item, for @table and @multitable, and with empty
	table/multitable and not empty.

2023-02-04  Gavin Smith <gavinsmith0123@gmail.com>

	Basic inline context for line args

	* tp/Texinfo/ParserNonXS.pm (%default_valid_nestings) <heading specs>:
	Duplicate hashes to avoid modifying shared structure.
	(%in_full_text_commands): Add all %in_heading_spec_commands.

	(parser): Initialise 'basic_inline_stack_on_line' in addition to
	'basic_inline_stack'.  Using a separate stack for line arguments
	from that for braced arguments means we can push and pop in exactly
	one place in the code from each stack, which will be more reliable
	and easy to debug.
	(_process_remaining_on_line) <line arg>: Push the new stack.
	(_end_line_misc_line) <line arg>: Pop the new stack.

	(_check_valid_nesting_context): Use 'basic_inline_stack_on_line'.

	* tp/Texinfo/XS/parsetexi/context_stack.h (NESTING_CONTEXT):
	Add basic_inline_stack_on_line field.
	* tp/Texinfo/XS/parsetexi/api.c (reset_parser_except_conf): Reset it.

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line):
	Pop.
	* tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command):
	Push.
	* tp/Texinfo/XS/parsetexi/parser.c (check_valid_nesting_context):
	Use new stack.  Update conditional for what counts as
	basic inline content.

2023-02-04  Gavin Smith <gavinsmith0123@gmail.com>

	* README-hacking: refer to some other text files in sources
	* tp/t/README: advise to rebuild after git pull
	* tp/tests/README: update test results with "make -k check copy-tests".

2023-02-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_is_container_empty, _close_container)
	(_end_preformatted, _close_current), tp/Texinfo/XS/parsetexi/close.c
	(is_container_empty, close_container, close_current),
	tp/Texinfo/XS/parsetexi/parser.c (end_preformatted): pass the source
	marks of an element without any information except for source marks to
	the parent.  Add is_container_empty that returns if a container
	contains information.  Put closing empty type code in close_container
	and use it in end_preformatted too.

	* tp/Texinfo/ParserNonXS.pm (_pop_element_from_contents),
	tp/Texinfo/XS/parsetexi/tree.c (pop_element_from_contents): replace
	reparented source marks from popped element to the preceding element
	by using place_source_mark on the parent instead of add_source_marks.
	Remove the popped element earlier, in XS parser such that the replaced
	source marks are placed on preceding elements.

	* tp/Texinfo/ParserNonXS.pm (_gather_def_item)
	(_close_command_cleanup, _end_line_misc_line)
	(_end_line_starting_block, _process_remaining_on_line): use
	_pop_element_from_contents.  Avoid empty contents.

2023-02-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_close_current),
	tp/Texinfo/XS/parsetexi/close.c (close_current): more precise comment
	on why it is needed to check that the potentially removed empty type
	needs to be cheked to be contents, to avoid args.  Improve debug
	message.

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line): improve debug
	message.

2023-02-03  Gavin Smith <gavinsmith0123@gmail.com>

	Eliminate duplicate nesting warning messages

	* tp/Texinfo/ParserNonXS.pm (%default_valid_nestings) <brace commands>,
	* tp/Texinfo/XS/parsetexi/parser.c (check_valid_nesting):
	Use the same nesting for contain_basic_inline_commands as for other
	brace commands.

2023-02-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_close_current),
	tp/Texinfo/XS/parsetexi/close.c (close_current): do not treat
	especially types in menu_entry now that there are not in extra
	anymore.

2023-02-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_register_extra_menu_entry_information)
	tp/Texinfo/Structuring.pm (new_node_menu_entry),
	tp/Texinfo/XS/parsetexi/menus.c
	(register_extra_menu_entry_information): do not register
	'menu_entry_description' and 'menu_entry_name' in menu_entry 'extra',
	they are easy to get from menu_entry contents.

2023-02-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (_substitute_references),
	tp/Texinfo/Convert/HTML.pm (_convert_menu_entry_type),
	tp/Texinfo/ParserNonXS.pm (_register_extra_menu_entry_information),
	tp/Texinfo/Structuring.pm (_check_menu_entry)
	(set_menus_node_directions, associate_internal_references)
	(new_node_menu_entry), tp/Texinfo/Transformations.pm
	(_normalized_entry_associated_internal_node),
	tp/Texinfo/XS/parsetexi/menus.c
	(register_extra_menu_entry_information): rename menu entry
	'extra' 'menu_entry_node' as 'menu_entry_node_label'.

	* tp/Texinfo/Convert/HTML.pm (_convert_menu_entry_type):
	determine menu entry components in case of preformatted and
	non-preformatted menu entry using the same code, avoiding
	to use 'extra' information if not useful.

2023-02-03  Gavin Smith <gavinsmith0123@gmail.com>

	Use nesting context basic inline stack more generally

	* tp/Texinfo/ParserNonXS.pm
	(_process_remaining_on_line) <contain basic inline>:
	Push command on stack.
	(_close_brace_command) <contain basic inline>:
	Pop command from stack.
	(_process_remaining_on_line) <ref commands>:
	No longer push and pop basic_inline_stack.

	* tp/Texinfo/XS/parsetexi/separator.c
	(handle_open_brace) <CF_contain_basic_inline>:
	Push nesting_context.basic_inline_stack.
	* tp/Texinfo/XS/parsetexi/close.c
	(close_brace_command) <CF_contain_basic_line>:
	Pop nesting_context.basic_inline_stack.
	* tp/Texinfo/XS/parsetexi/separator.c
	(handle_open_brace, handle_close_brace) <ref command>:
	No longer call push_command or pop_command on stack.

2023-02-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line): use
	_pop_element_from_contents for menu separator.

2023-02-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_menu_entry_type),
	tp/Texinfo/Convert/Plaintext.pm (_convert),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/Convert/Text.pm (_convert), tp/Texinfo/ParserNonXS.pm
	(_close_current, _end_line, _register_extra_menu_entry_information)
	(_enter_menu_entry_node, _process_remaining_on_line),
	tp/Texinfo/Structuring.pm (new_node_menu_entry),
	tp/Texinfo/Transformations.pm (menu_to_simple_menu),
	tp/Texinfo/XS/parsetexi/close.c (close_current),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line),
	tp/Texinfo/XS/parsetexi/menus.c
	(register_extra_menu_entry_information, enter_menu_entry_node)
	(handle_menu), tp/Texinfo/XS/parsetexi/separator.c (handle_separator):
	use 'contents' for menu_entry contents, and not 'args'.

	* tp/Texinfo/Convert/Converter.pm, tp/Texinfo/Convert/HTML.pm,
	tp/Texinfo/Convert/LaTeX.pm, tp/Texinfo/Convert/Texinfo.pm,
	tp/Texinfo/Convert/TexinfoMarkup.pm, tp/Texinfo/ParserNonXS.pm,
	tp/Texinfo/Structuring.pm, tp/Texinfo/Transformations.pm:
	avoid autovivification in any case.

2023-02-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_place_source_mark),
	tp/Texinfo/XS/parsetexi/source_marks.c (place_source_mark): initialize
	text for an element added for source marks, such that merge_text can
	merge it with text following.

2023-02-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_close_current, _end_line_misc_line),
	tp/Texinfo/XS/parsetexi/close.c (close_current),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line): close all the
	type elements without content nor information associated in one place
	only, in close_current.

2023-02-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/menus.c (handle_menu): transfer source marks
	from popped menu star element to menu leading text.

2023-02-01  Patrice Dumas  <pertusus@free.fr>

	* tp/DebugTexinfo/DebugTree.pm (_print_tree),
	tp/Texinfo/Convert/Converter.pm (format_comment_or_return_end_line),
	tp/Texinfo/Convert/Texinfo.pm (convert_to_texinfo)
	(_expand_cmd_args_to_texi), tp/Texinfo/Convert/TexinfoMarkup.pm
	(_leading_spaces_arg, _end_line_spaces, _trailing_spaces_arg)
	(_convert), tp/Texinfo/Convert/TextContent.pm (_convert),
	tp/Texinfo/ParserNonXS.pm (_abort_empty_line, _isolate_last_space)
	(_process_remaining_on_line), tp/Texinfo/Structuring.pm
	(new_block_command), tp/Texinfo/Transformations.pm
	(fill_gaps_in_sectioning, _new_node),
	tp/Texinfo/XS/parsetexi/convert.c (expand_cmd_args_to_texi)
	(convert_to_texinfo_internal),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command),
	tp/Texinfo/XS/parsetexi/parser.c (abort_empty_line)
	(isolate_last_space_internal): add "spaces_before_argument" and
	"spaces_after_argument" as elements with text such that they can hold
	source marks too.

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): reassociate
	source marks in accent with following arg to the following_arg type.

	* tp/Texinfo/ParserNonXS.pm (_place_source_mark),
	tp/Texinfo/XS/parsetexi/source_marks.c (place_source_mark): separate
	placing a source mark and registering a source mark.

	* tp/Texinfo/ParserNonXS.pm (_pop_element_from_contents): add $self
	as argument.  Update callers.

2023-01-31  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm
	(%plain_text_commands, %contain_plain_text_commands)
	(%basic_inline_commands, %contain_basic_inline_commands)
	(%full_line_commands, %contain_full_line_commands)
	(%full_text_commands, %contain_full_text_commands):
	Rename to make it clear that these are lists of containing
	commands, not of contained commands.

2023-01-31  Gavin Smith <gavinsmith0123@gmail.com>

	Nesting context basic inline stack

	* tp/Texinfo/XS/parsetexi/context_stack.h
	(COMMAND_STACK): New type.
	* tp/Texinfo/XS/parsetexi/context_stack.c
	(reset_command_stack, push_command, pop_command):
	New functions to operate on COMMAND_STACK.
	(reset_context_stack, push_context, pop_context)
	(current_context_command):
	Use COMMAND_STACK for the command part of the context stack.

	* tp/Texinfo/XS/parsetexi/context_stack.h (NESTING_CONTEXT):
	Replace xref counter with basic_inline_stack, which can be used
	more generally for any command that should only contain basic
	inline content.
	* tp/Texinfo/XS/parsetexi/api.c (reset_parser_except_conf):
	Call reset_command_stack on nesting_context.basic_inline_stack.
	* tp/Texinfo/XS/parsetexi/separator.c
	(handle_open_brace, handle_close_brace) <ref command>:
	Call push_command and pop_command respectively on
	nesting_context.basic_inline_stack

	* tp/Texinfo/ParserNonXS.pm: Corresponding changes.
	(parser): Initialise basic_inline_stack.
	(_process_remaining_on_line) <ref commands>:
	Push and pop basic_inline_stack.
	(_check_valid_nesting_context): Check basic_inline_stack.

2023-01-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_register_source_mark),
	tp/Texinfo/XS/parsetexi/api.c (store_source_mark_list),
	tp/Texinfo/XS/parsetexi/source_marks. (register_source_mark):
	remove the source mark location information, it is not useful.
	Do not set the position if the element text is the empty string.

2023-01-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/api.c (store_source_mark_list): use the
	STORE macro everywhere.

2023-01-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/def.c (split_def_args): count UTF-8 encoded
	Unicode characters for source marks locations.

	* tp/t/19def.t: do not skip end_of_lines_protected_non_ascii test.

	* tp/Texinfo/XS/parsetexi/source_marks.c,
	tp/Texinfo/XS/parsetexi/parser.c (count_convert_u8): move
	count_convert_u8 to parser.c.

2023-01-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/source_marks.c (count_convert_u8)
	(register_source_mark): set the mark source position in text
	as an index in characters, not bytes.

2023-01-30  Patrice Dumas  <pertusus@free.fr>

	in tp/Texinfo/XS gnulib-tool --add-import uniconv/u8-strconv-from-enc unistr/u8-mbsnlen.

2023-01-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/macro.c (expand_macro_arguments): do not
	allocate more space than the number of macro arguments.

2023-01-29  Patrice Dumas  <pertusus@free.fr>

	Source mark for macro expansion

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line)
	(_handle_macro): use a separate function to handle a macro call, as in
	the XS parser.  Get a new line right after handling the macro.  Note
	that it leads to somewhat better output than simply waiting for the
	next text to come in parse_texi.

	* tp/Texinfo/ParserNonXS.pm (_handle_macro, _next_text),
	tp/Texinfo/XS/parsetexi/input.c (next_text),
	tp/Texinfo/XS/parsetexi/macro.c (handle_macro),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/source_marks.c (register_source_mark)
	(source_marks_reset_counters): handle macro expansion source marks.

	* tp/Texinfo/ParserNonXS.pm (_next_text),
	tp/Texinfo/XS/parsetexi/input.c (next_text): do not register a source
	mark if the current element is not defined.

	* tp/Texinfo/XS/parsetexi/macro.c (expand_macro_arguments): if macro
	call is missing a close brace, register the unterminated argument,
	as the perl parser does.

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): remove
	contents of accent commands when the next character is used as
	argument in the perl parser. It matters to have the contents removed
	here when there are source marks, though it is not completly clear why
	and what would be the best to do. Add comments for the XS parser.

	* tp/Texinfo/ParserNonXS.pm (_parse_texi): handle undefined lines
	getting out of _process_remaining_on_line.  Can now happen with
	next_text after macro expansion handling in case the macro expansion
	happens right before the end of a text fragment.

	* tp/Texinfo/XS/parsetexi/debug.c (debug_print_element_short),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/source_marks.c (register_source_mark): add a
	debugging function that prints the element information in a similar
	way as Texinfo::Common::debug_print_element_short.

2023-01-29  Gavin Smith <gavinsmith0123@gmail.com>

	Rename "simple text" commands as "basic inline" commands

	* tp/Texinfo/commmand_data.txt:
	Replace contain_simple_text flag with contain_basic_inline.
	* tp/Texinfo/XS/parsetexi/commands.h:
	Replace CF_contain_simple_text flag with CF_contain_basic_inline.
	* tp/Texinfo/ParserNonXS.pm
	(%contain_simple_text_commands, %contain_basic_inline_commands)
	(%in_simple_text_with_refs_commands)
	(%in_basic_inline_with_refs_commands)
	(%in_simple_text_commands,  %in_basic_inline_commands)
	(%simple_text_commands, %basic_inline_commands)
	(%simple_text_with_refs_commands, %basic_inline_with_refs_commands):
	Rename.

2023-01-29  Gavin Smith <gavinsmith0123@gmail.com>

	Fix 'info (manual)slash/in/node'

	* info/info.c (main, get_initial_file): Move code checking for
	slash in argument to get_initial_file, and don't check for argument
	as a file if it begins with '('.
	(main): Move code adding user provided directory to INFOPATH
	after call to get_initial_code.
	(get_initial_file): Decrement argc as intended.

	Arash Esbati <arash@gnu.org> reported that
	"info '(latex2e)\indent & \noindent'" didn't work on Msys2.

2023-01-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_next_text),
	tp/Texinfo/XS/parsetexi/input.c (next_text): move code related to
	end of text input to the same place as end of file input.

	* tp/Texinfo/ParserNonXS.pm (_next_text),
	tp/Texinfo/XS/parsetexi/input.c (next_text): rename $previous_input
	as $input, and i as input, and use input consistently in the XS parser.

2023-01-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (@variable_string_settables): remove
	TEXINFO_DTD_VERSION' which is also in
	%default_converter_customization.

	Change in comments in various files.

2023-01-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_item_command)
	(_get_copiable_anchor): use double quote for HTML attributes instead
	of single quote for consistency.

2023-01-26  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Basic Formatting Customization): separate
	information about API and result in the default case for
	format_heading_text.

2023-01-26  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): if generating reference results,
	do not process skipped tests at all, to avoid increasing the
	number of tests, as the number of tests is 1.

2023-01-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/Makefile.am (test_files), t/19def.t:
	add the end_of_lines_protected_non_ascii test with non-ASCII
	character counted in source marks.  Skipped for now as the
	XS parser counts bytes and not characters.

2023-01-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_register_source_mark),
	tp/Texinfo/XS/parsetexi/api.c (store_source_mark_list),
	tp/Texinfo/XS/parsetexi/source_marks.c (new_source_mark)
	(register_source_mark): always associate source mark to the
	previous element, and create an empty element if there is
	none.  The index in contents is unreliable as the tree may
	be modified, for example when adding a preamble.

2023-01-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_split_def_args),
	tp/Texinfo/XS/parsetexi/def.c (split_def_args): keep track of
	source marks when splitting @def* arguments.

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/api.c (store_source_mark_list),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/source_marks.c (register_source_mark)
	(source_marks_reset_counters): add source mark for definition line
	continuation.

2023-01-24  Gavin Smith <gavinsmith0123@gmail.com>

	Simplify context brace command closing

	* tp/Texinfo/XS/parsetexi/close.c (close_brace_command): Add
	argument to control printing of error messages and make non-static
	function.  Pop context stack for BRACE_context commands and
	decrement nesting context counters.
	(close_all_style_commands): Remove FIXME about nesting context.
	(close_current): Do not update context stack or context counters
	as it is now done in close_brace_command.
	* tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace):
	Always call close_brace_command, so it is no longer just called for
	erroneous input.

	* tp/Texinfo/ParserNonXS.pm (_close_brace_command): Add
	argument to control printing of error messages.  Pop context stack
	for context brace commands and decrement nesting context counters.
	(_close_all_style_commands): Remove FIXME about nesting context.
	(_close_current): Do not update context stack or context counters
	as it is now done in close_brace_command.
	(_process_remaining_on_line) <close brace>:
	Always call _close_brace_command, so it is no longer just called for
	erroneous input.

2023-01-26  Arsen Arsenović  <arsen@aarsen.me>

	HTML: Enable generating copiable anchors on heading commands
	* doc/texi2any_api.texi (Basic Formatting Customization): Document
	the new $target argument of format_heading_text.
	* tp/Texinfo/Convert/HTML.pm (_default_format_heading_text): Add
	optional target argument, for generating a copiable pilcrow.
	(_convert_heading_command): Pass the element_id of the current
	heading, so that a pilcrow is generated.
	* tp/tests/customization/list-of-tests: Add
	sectioning_without_anchors test, to check getting existing codegen
	with COPIABLE_LINKS=0.

2023-01-25  Arsen Arsenović  <arsen@aarsen.me>

	ParserNonXS: Fix minor Perl error

	* tp/Texinfo/ParserNonXS.pm (_check_valid_nesting_context): Escape
	invalid uses of @.

2023-01-23  Gavin Smith <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line) <close brace>,
	tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace):
	If inside brace_command_context element, call end_paragraph before
	checking what brace command we are closing.  This allows the
	elimination of a duplicate block of code for closing a context
	brace command.

2023-01-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_next_text),
	tp/Texinfo/XS/parsetexi/input.c (next_text): use a common code for
	input file and input text source marks.

2023-01-23  Patrice Dumas  <pertusus@free.fr>

	Source mark for DEL comments

	* tp/Texinfo/ParserNonXS.pm (_next_text, tp/Texinfo/XS/parsetexi/api.c
	(store_source_mark_list), tp/Texinfo/XS/parsetexi/input.c (INPUT)
	(next_text), tp/Texinfo/XS/parsetexi/source_marks.c
	(register_source_mark): add a source mark for DEL comment.  Push an empty text
	line with a source mark to process it at the end of the line.  Rename
	file_source_mark as input_source_mark and use it both for files and
	text input.  Update functions using file_source_mark.  Store the
	comment line in a 'line' in the source mark.

	* tp/Texinfo/XS/parsetexi/source_marks.c (register_source_mark): use
	element text.space > 0 and not text.end to associate source mark to
	a string that is set but empty.

	* tp/Texinfo/ParserNonXS.pm (_close_current),
	tp/Texinfo/XS/parsetexi/close.c (close_current): move nesting code
	with context commands code.

2023-01-22  Patrice Dumas  <pertusus@free.fr>

	Nesting context, @*ref, @footnote, @*caption checking perl parser

	* tp/Texinfo/ParserNonXS.pm (_check_valid_nesting_context)
	(_process_remaining_on_line): new function to check nesting_context.
	Call it together with _check_valid_nesting.

	* tp/Texinfo/ParserNonXS.pm (parser, simple_parser): initialize
	nesting context.

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line)
	(_close_current): increment/decrement nesting context.

2023-01-21  Patrice Dumas  <pertusus@free.fr>

	Keep removed elements with source marks and transfer source marks

	* tp/Texinfo/ParserNonXS.pm (_add_source_marks)
	(_pop_element_from_contents), tp/Texinfo/XS/parsetexi/source_marks.c
	(add_source_mark, add_source_marks, register_source_mark),
	tp/Texinfo/XS/parsetexi/tree.c (pop_element_from_contents): transfer
	source marks from a popped element to the parent element in
	pop_element_from_contents(), using a second argument to signal if
	source marks should be transferred.  Update pop_element_from_contents
	callers.  Use more _pop_element_from_contents in pure perl parser, and
	check better contents key hash not being defined.

	* tp/Texinfo/ParserNonXS.pm (_register_source_mark, _next_text),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line),
	tp/Texinfo/XS/parsetexi/input.c (INPUT, set_input_source_mark)
	(next_text), tp/Texinfo/XS/parsetexi/source_marks.c
	(register_source_mark): do not increment counter for the end of
	@include.  add a second argument to next_text to pass an element that
	can be used to register the end of an @include.  Associate @include
	start source mark to the input stack corresponding to the @include
	file.  Update callers.

	* tp/Texinfo/ParserNonXS.pm (_end_line_misc_line),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line),
	tp/Texinfo/XS/parsetexi/api.c (store_source_mark_list),
	tp/Texinfo/XS/parsetexi/source_marks.c (source_marks_reset_counters),
	tp/Texinfo/XS/parsetexi/tree.c (destroy_source_mark): add a source
	mark for ignored @setfilename.  Associate removed element, @include or
	@setfilename, to source mark, to keep source marks that are in those
	elements and also for the XS parser to keep source marks associated to
	their elements to simplify management of memory.

	* tp/Texinfo/XS/parsetexi/api.c (store_source_mark_list): fix
	setting up the array of source marks that was mixed up with
	type setting.

	* tp/Texinfo/Common.pm (modify_tree): recurse in source marks.

2023-01-22  Gavin Smith  <gavinsmith0123@gmail.com>

	* NEWS: Add 7.0.2 news.
	* README-hacking: minor updates for release instructions

2023-01-22  Gavin Smith  <gavinsmith0123@gmail.com>

	@ref, @xref, @pxref nesting checking.

	* tp/Texinfo/XS/parsetexi/parser.c (check_valid_nesting_context):
	Check if one cross-reference command is used inside another.

	* tp/Texinfo/XS/parsetexi/separator.c (handle_open_brace)
	Increment nesting_context.xref for cross-reference command.
	* tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace),
	Decrement nesting_context.xref for cross-reference command.

	* tp/Texinfo/XS/parsetexi/close.c (close_all_style_commands):
	Add a FIXME comment saying that nesting_context is not touched.

2023-01-22  Gavin Smith  <gavinsmith0123@gmail.com>

	@caption, @shortcaption nesting checking

	* tp/Texinfo/XS/parsetexi/parser.c (check_valid_nesting_context):
	Check if @caption or @shortcaption is called in caption context.

	* tp/Texinfo/XS/parsetexi/separator.c (handle_open_brace)
	Increment nesting_context.caption for @caption, @shortcaption.
	* tp/Texinfo/XS/parsetexi/close.c (close_current),
	* tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace),
	Decrement nesting_context.caption for @caption, @shortcaption.

2023-01-21  Gavin Smith <gavinsmith0123@gmail.com>

	Indent goto labels

	* tp/Texinfo/XS/parsetexi/close.c,
	* tp/Texinfo/XS/parsetexi/def.c,
	* tp/Texinfo/XS/parsetexi/end_line.c,
	* tp/Texinfo/XS/parsetexi/parser.c,
	* tp/Texinfo/XS/parsetexi/separator.c:
	Indent goto labels so that they do not appear as the function
	in git diff.

2023-01-21  Gavin Smith  <gavinsmith0123@gmail.com>

	Nesting context for XS parser

	* tp/Texinfo/XS/parsetexi/context_stack.h (NESTING_CONTEXT):
	Define new structure.
	* tp/Texinfo/XS/parsetexi/context_stack.c (nesting_context): Define.
	* tp/Texinfo/XS/parsetexi/api.c (reset_parser_except_conf):
	Wipe nesting_context.

	* tp/Texinfo/XS/parsetexi/parser.c (check_valid_nesting_context):
	New function to check nesting_context.
	(process_remaining_on_line) <@-command>:
	Call it together with check_valid_nesting.

	* tp/Texinfo/XS/parsetexi/separator.c (handle_open_brace)
	Increment nesting_context.footnote for @footnote.
	* tp/Texinfo/XS/parsetexi/close.c (close_current),
	* tp/Texinfo/XS/parsetexi/separator.c (handle_close_brace),
	Decrement nesting_context.footnote for @footnote.

2023-01-19  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/parsetexi/commands.h: Remove unused flags
	CF_item_container, CF_item_line and CF_inline.

2023-01-17  Patrice Dumas  <pertusus@free.fr>

	Source marks for @include included file start

	* tp/Texinfo/ParserNonXS.pm (_register_source_mark)
	(_end_line_misc_line), tp/Texinfo/XS/Makefile.am
	(Parsetexi_la_SOURCES), tp/Texinfo/XS/parsetexi/api.c
	(reset_parser_except_conf, store_source_mark_list)
	(element_to_perl_hash), tp/Texinfo/XS/parsetexi/end_line.c
	(end_line_misc_line), tp/Texinfo/XS/parsetexi/source_marks.c
	(new_source_mark, register_source_mark, source_marks_reset_counters),
	tp/Texinfo/XS/parsetexi/tree.c (destroy_source_mark_list)
	(destroy_element), tp/Texinfo/XS/parsetexi/tree_types.h: add source
	mark to locate the place where an @include file is expanded.

	* tp/Texinfo/ParserNonXS.pm (_input_push_file): pass include file
	source mark.

2023-01-17  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (@useindex): Use \global in assignment to
	escape the group in \defunargs added 2022-12-29.

2023-01-17  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/command_data.txt: Add @useindex.  Don't do anything
	with it yet.

2023-01-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_misc_line),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_misc_line): remove
	setfilename or include from tree before starting a new preformatted,
	in preformatted context.

	* tp/t/80include.t, tp/Makefile.tres: add test
	include_with_setfilename_in_preformatted that tests @include in
	@example, with a @setfilename in the included file.

2023-01-15  Gavin Smith  <gavinsmith0123@gmail.com>

	* system.h (DEFAULT_TMPDIR): Remove all uses, eliminating
	check for VMS.
	(xexit): Remove declaration; the function itself apparently was
	removed 2012-06-11.

2023-01-15  Gavin Smith  <gavinsmith0123@gmail.com>

	* system.h (MIN, MAX): Remove.
	* info/pcterm.h (MIN): Move MIN to here, the only use site.

2023-01-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_new_document_context): Add the
	_new_document_context function to push a new documeent context.

	* tp/Texinfo/Convert/DocBook.pm (_convert): add 'no_break'
	in document context for @w, and protect text with non-breakable spaces
	in that context.  Report from Gavin.

2023-01-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_text): in space_protected,
	protect spaces in 'line_break_element' before prepending and
	replacing spaces with 'non_breaking_space'.  The unprotection is
	already implemented.

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/html_tests.t:
	add the spaces_in_line_break_in_verb_w test testing space in
	line_break_element.  There is no API to modify line_break_element,
	so $self->{'line_break_element'} is directly set in an init file.

2023-01-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_texi),
	tp/Texinfo/XS/parsetexi/parser.c (parse_texi): revert change from
	2023-01-08, do not ignore empty line early such that line after
	a DEL character is joined with the next line.

2023-01-13  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Comments): add that the line after the DEL
	comment is merged.

2023-01-13  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\setupverb): Set \parindent to 0pt to avoid
	paragraph indent on newline inside @verb.

2023-01-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (output): normalize node redirection
	name before comparing with existing file names, in case case of file
	name needs to be normalized.  Report from Torbjörn Svensson.

	* tp/t/html_tests.t, tp/Makefile.tres: add
	file_name_case_insensitive_conflict_redirections, from Torbjörn
	Svensson.

2023-01-11  Gavin Smith  <gavinsmith0123@gmail.com>

	Hypenation in @code

	* doc/texinfo.tex (\code, \codedash): Set internal \codedashprev
	macro differently when \code starts to avoid hyphenation being
	always turned off for the first hyphen in code.  \codedashprev
	does not actually refer to the previous character, as it is
	only set when a dash is seen, not at every single character
	within @code, so rename it to \codedashnobreak to be less
	confusing.

	Report from Werner.

2023-01-11  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/info-stnd.texi (Invoking Info): Say what happens if Info's
	standard output is not a terminal.

2023-01-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/html_tests.t:
	add filenameconflictwithspecialelement demonstrating conflict of
	redirection file with special element, which needs customizing the
	special element file_string.

2023-01-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (output): add context for node
	and section names for redirection files conflicts for translation.

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/html_tests.t:
	add tests for different possibilities for file conflict with
	redirection files, file_name_conflict_with_section,
	filenameconflictwithnonsplit (which actually shows that there cannot
	be a conflict), file_name_conflict_with_user_defined.

2023-01-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm: reindent, cut at 80 columns, remove
	unused code.

2023-01-10  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/info-stnd.texi (Node Commands):
	Some edits for style and brevity.

2023-01-10  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/info-stnd.texi (Node Commands): Move immediately after
	introductory chapter so that we can immediately introduce the
	important commands 'n', 'p' and 'u'.

2023-01-10  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/info-stnd.texi (MS-DOS/Windows keybindings):
	Collect MS-DOS/Windows alternative keybindings in this node to
	avoid obscuring the documentation in the rest of the manual.

2023-01-10  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/info-stnd.texi (Scrolling Commands, Miscellaneous Commands):
	Move documentation of redraw-display and toggle-wrap to
	Miscellaneous Commands as these aren't scrolling commands.
	Do not describe show-footnotes command as "convenient".

2023-01-10  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/info-stnd.texi (Invoking Info): Move later in the
	manual so that a user reading through the manual from
	start to finish gets information on interactive use first.

2023-01-10  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/info-stnd.texi (Invoking Info): Relegate list of supported
	compression programs to a footnote.

2023-01-10  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/info-stnd.texi (Invoking Info), NEWS:
	Remove "/index" as possible info file extension, as the
	purpose of this is obscure, it is not a proper file extension
	and looks like a mistake, even though it isn't one.
	Originally added 1997-08-06 by Matthew Wilcox to put split info
	files in subdirectories in infodir.
	* doc/filesys.c (info_suffixes): Remove "/index".

2023-01-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (register_normalize_case_filename),
	tp/Texinfo/Convert/HTML.pm (_html_set_pages_files, output): associate
	file names to the source of the name, an element, a special file or a
	stand in file (in case nothing good was found as file name).  Keep
	the information on redirection pages created.  Warn using both the
	redirected node information and the information on file source.
	Rename _normalize_filename_case as register_normalize_case_filename in
	Texinfo::Convert::Converter such that it can be used directly.

	* tp/Texinfo/Report.pm (line_warn, line_error, document_warn)
	(document_error): add a continuation optional argument to convey
	that the line is a continuation line for a warning or error message.

	* tp/Texinfo/Convert/Converter.pm (registered_filename): new function
	to return the normalized file names for file that were registered.  A
	file registered may nt be created.  Not used for now.

2023-01-10  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm
	(_normalize_texinfo_name, _prepare_anchor): update
	Texinfo::Convert::Texinfo::convert_to_texinfo call which has no
	second argument anymore.

2023-01-09  Gavin Smith  <gavinsmith0123@gmail.com>

	* install-info/install-info.c (split_entry):
	Rewrite in slightly more inefficient way to silence obnoxious gcc
	warning about use of strncat.

2023-01-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/html_tests.t:
	add a test with the same transliterated file names for a node, an
	anchor and a float label.

2023-01-09  Patrice Dumas  <pertusus@free.fr>

	* tp/t/input_files/delcomment_followed_by_cpp_line.texi: add more
	cases of del comment followed by cpp directives.

2023-01-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (initialize_tree_units_files)
	(_normalize_filename_case): set $self->{'filenames'} independently
	of CASE_INSENSITIVE_FILENAMES being set.

2023-01-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_texi),
	tp/Texinfo/XS/parsetexi/parser.c (parse_texi): ignore empty line
	early such that it does not go through process_remaining_on_line
	where an empty line leads to next_text being called.  Indeed, we want
	the next line to come from the parse_texi next_text.

2023-01-08  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/LaTeX.pm (_convert) <@verb>:
	Output line break for newline in @verb argument.

2023-01-08  Gavin Smith  <gavinsmith0123@gmail.com>

	@set txicodequoteundirected and @set txicodequotebacktick by default

	* doc/texinfo.tex: Turn on "@set txicodequoteundirected" and
	"@set txicodequotebacktick" by default.
	(\codequoteleft, \codequoteright): Access glyphs by hexadecimal
	index rather than octal so to match comment.
	* doc/texinfo.tex (Inserting Quote Characters): Update.  Make
	text appropriate for all output formats by limiting sample output.
	* NEWS: Mention.

2023-01-08  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\indexnofonts): Remove obsolete comment
	claiming that makeinfo doesn't expand macros in the argument
	to @deffn.

2023-01-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line): do not treat
	especially macro expansion to the empty string.

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/separator.c (handle_comma): decrease remaining
	args counter when correct and only in that case.

	* tp/t/60macro.t, tp/t/02coverage.t, tp/Makefile.am, tp/Makefile.tres:
	add tests showing that cpp line directives are ignored in some setups
	(in macro definition, after a del comment at the beginning of the
	line, after an empty macro expansion).

2023-01-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_input_push_file, parse_texi_file)
	(_end_line_misc_line): use _input_push_file to both open and put
	input file information in $self->{'input'} (as in the XS Parser),
	reusing _open_in code.  Remove _open_in.

2023-01-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_misc_line),
	tp/Texinfo/Convert/Texinfo.pm (convert_to_texinfo)
	(_expand_cmd_args_to_texi), tp/Texinfo/Convert/TexinfoMarkup.pm
	(%ignored_types, %ignored_types): do not set replaced type on included
	files element, use a variable set it a file was included.  Remove
	completely the replaced type.

	* tp/Texinfo/ParserNonXS.pm (_input_push_text),
	tp/Texinfo/XS/parsetexi/input.c (input_push_text): rename input_push as
	input_push_text.  Update the callers.

2023-01-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/input.c (input_push),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): pass
	expanded value and put in value_flag in input structure.  Update
	callers.
	* tp/Texinfo/XS/parsetexi/input.c (macro_expansion_nr)
	(value_expansion_nr, next_text), tp/Texinfo/XS/parsetexi/macro.c
	(handle_macro), tp/Texinfo/XS/parsetexi/parser.c
	(process_remaining_on_line): use separate counters for values and
	macros expansions.

	* tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): error
	out on value expansion number higher than MAX_MACRO_CALL_NESTING.

	* tp/Texinfo/ParserNonXS.pm (_input_push, _process_remaining_on_line):
	put expanded value in iput.  Use 'value_flag' for value flag key name
	in input.

	* tp/Texinfo/ParserNonXS.pm (_input_push, _next_text): fix conditions
	on macro being set.

	* tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): free
	value flag even if there was no value expansion.

	* tp/t/50value.t: add recursive_expansion_in_set for a test of infinite
	recursion with @value.

2023-01-07  Gavin Smith  <gavinsmith0123@gmail.com>

	Treat spaces in @verb and @w differently in HTML

	* tp/Texinfo/Convert/HTML.pm (_convert): Only use 'space_protected'
	stack for @verb.  Use new 'no_break' stack for @w.

	(_convert_text): Handle 'space_protected' and 'no_break' differently.
	For 'space_protected', convert newlines to <br> or <br/> and keep
	multiple spaces.  For 'no_break', treat newline as space and
	condense multiple spaces to one non-breaking space.

	(in_non_breakable_space): Check 'no_break' stack instead of
	'space_protected' stack.
	(in_space_protected): New function to check 'space_protected' stack.

	* doc/texi2any_api.texi (Text Formatting Context): Add documentation
	of in_space_protected.
	* tp/init/html32.pm (html32_convert_text): Call in_space_protected
	as well as in_non_breakable_space API functions.

2023-01-07  Gavin Smith  <gavinsmith0123@gmail.com>

	@backslashchar{} as \ in PDF bookmarks

	* doc/texinfo.tex (\definedummies): Give @backslashchar an
	\indexnofonts definition of \realbackslash so that a backslash
	will be displayed in PDF bookmarks if used in a section title.

2023-01-07  Gavin Smith  <gavinsmith0123@gmail.com>

	@headings does not reset page number

	* doc/texinfo.tex (\HEADINGSsingle, \HEADINGSdouble:
	(\HEADINGSsinglechapoff): Do not call \pageone.  This appears to
	be unnecessary, and does not interact well with PDF page
	labels generation when a @headings or @setchapternewpage
	command is issued later in a document, as in
	doc/texinfo-tex-test.texi.

2023-01-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_input_push),
	tp/Texinfo/XS/parsetexi/api.c,
	tp/Texinfo/XS/parsetexi/handle_commands.c,
	tp/Texinfo/XS/parsetexi/input.c (input_push),
	tp/Texinfo/XS/parsetexi/parser.c: change the order of
	input_push arguments.  Get the filename from the input stack in
	input_push.  Remove input_push_text and input_push_text_with_line_nos,
	call directly input_push.  Update callers.

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm: simplify arguments passing
	to parse_texi_*.  Change variable name, remove comments.

2023-01-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_next_text, _new_line): do not get a
	source_info as _next_text argument.  Keep the first input level to
	have a source for source_info even after the file is closed and the
	filehandle deleted from the input.  Update callers.

2023-01-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_new_text_input, _input_push)
	(_input_push_text_with_line_nos, _input_pushback_text)
	(_input_push_text, parse_texi_piece, parse_texi_line, parse_texi_text)
	(parse_texi_file, _parse_texi_document, _register_global_command)
	(_save_line_directive, _next_text, _in_include, _end_line_misc_line)
	(_process_remaining_on_line): instead of preprocessing text and
	splitting in an array, push a whole text on input and get line by line
	in _next_text.  Do not associate a file with pending text, instead
	put pending text on its own on self->{'input'}.
	remove _text_to_lines and _complete_line_nr.
	More similar code to XS parser.

2023-01-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_next_text, _process_remaining_on_line):
	simplify the information passed to determine the end of macro or value
	expansion.

2023-01-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_prepare_input_from_text)
	(parse_texi_piece, parse_texi_line, parse_texi_text): remove arguments
	not consistent with XS parser.  The input should only be a simple
	string.

2023-01-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (%parser_state_initialization, _next_text)
	(_process_remaining_on_line): add a value_stack to put expanded
	@value.  Use a sourcemark structure put in source_info to mark
	the end of @value expansion.  Also use such a structure for
	@macro, replacing 'end_macro'.
	Check number of values expansion number and error out if
	there is more than MAX_MACRO_CALL_NESTING.
	correct MAX_MACRO_CALL_NESTING name in warning message.

	* tp/Texinfo/XS/parsetexi/Parsetexi.pm (parser),
	tp/Texinfo/XS/parsetexi/Parsetexi.xs
	(conf_set_MAX_MACRO_CALL_NESTING), tp/Texinfo/XS/parsetexi/conf.c
	(conf_set_MAX_MACRO_CALL_NESTING, reset_conf),
	tp/Texinfo/XS/parsetexi/macro.c (handle_macro): pass
	MAX_MACRO_CALL_NESTING to the XS parser.  Use that value for the
	number of macro call nesting allowed.
	correct MAX_MACRO_CALL_NESTING name in warning message.

	* tp/t/60macro.t: add recursive_call_in_rmacro to test for an infinite
	recursion.

2023-01-04  Patrice Dumas  <pertusus@free.fr>

	* .gitignore: replace tp/tests/included_lat*n1.texi by
	tp/tests/built_input.

2023-01-04  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/tests/Makefile.am:
	Call maintain/copy_change_file_name_encoding.pl to create files
	in built_input subdirectory.  This stops make program on
	OpenIndiana 11 gagging immediately in a UTF-8 locale.
	* tp/tests/run_parser_all.sh: Pass -I built_input to texi2any.

2023-01-04  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Multitable Column Widths): State that
	prototype rows have no effect in HTML output.  Report from
	Raymond Toy.

2023-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_default_format_special_body_about):
	show the button desciption if the button specification is an array
	reference of length 2.  Do not show a button, only the description and
	explanation, as we do not know what the button text could look like.

2023-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%defaults): add About to the default
	header buttons.

2023-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/ext/epub3.pm (epub_convert_special_element_type, epub_setup)
	(epub_finish): collect special elements and add them after the
	normal tree unit elements.

2023-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/layout/list-of-tests: set separate footnotestyle for
	formatting_epub_nodes test.

2023-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_conversion_tree_units, output):
	set special elements net and prev in _prepare_conversion_tree_units
	and not in output, in order to do it if called through convert().

2023-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/layout/Makefile.am (EXTRA_DIST): remove Texinfo files not
	used anymore in tests/ (they are in tp/t/input_files/).

2023-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/tex_html/list-of-tests: update path of formatting.texi
	for formatting_singular test.

2023-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/coverage/list-of-tests: add Info and Plaintext.  Rename
	formatting_html_no_texi2html as formatting_html_no_split.

	* tp/tests/layout/list-of-tests: remove useless FORMAT_MENU=nomenu for
	a plaintext format test.

2023-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/layout/list-of-tests: rename formatting_html to
	formatting_texi2html and formatting_html_nodes to
	formatting_texi2html_nodes and add --internal-links options.  Rename
	other tests that look like the defaults for an output format and are
	not.
	Remove formatting_nodes and formatting tests that are redundant with
	other tests.

2023-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/*/list-of-tests, tp/tests/*/Makefile.am, autogen.sh,
	configure.ac, tp/tests/Makefile.am (base_tests_dirs): move init file
	customization related tests from 'contents' and 'formatting' to a new
	'customization' tests directory.  Move remaining 'contents' and
	'indices' tests to 'formatting'.  Move encodings related 'formatting'
	tests to a new tests directory named 'encoded'.  Split 'coverage'
	tests directory with each output format coverage test out of 'layout'.

2023-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/other/list-of-tests: use the default format and not html.

2023-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/*/list-of-tests: remove '-c TEXI2HTML=undef' which is not
	needed anymore.

2023-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/ext/epub3.pm: set USE_NODES to 0 in order to have section names
	used in printindex output.

	* tp/tests/README, tp/tests/run_parser_all.sh: do not set texi2html
	style for the default empty format.

	* tp/tests/tex_html/math_not_closed.texi: remove @setfilename.

2023-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/tex_html/list-of-tests: add explicit options when texi2html
	style is not necessary, and explicitly set TEXI2HTML when needed.

2023-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/30sectioning.t, tp/t/html_tests.t,
	tp/tests/contents/Makefile.am (EXTRA_DIST),
	tp/tests/contents/list-of-tests: move contents_and_parts out of
	tp/tests/contents/list-of-tests to tp/t/30sectioning.t and inline,
	remove the Texinfo file.
	Add no_content tests in tp/tests/contents/list-of-tests to test also
	the default case for contents location and unset the texi2html style.
	Duplicate the no_content tests in tp/t/html_tests.t.

2023-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (convert_to_plaintext): set OUTFILE to undef
	if SPLIT and SUBDIR is set, such that SUBDIR is used to determine the
	destination directory.

2023-01-04  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/regenerate_file_lists.pl, tp/Makefile.tres: list res_*
	directories only and not the files within to avoid an
	"Argument list too long" error for the shell in make dist.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/html_tests.t,
	tp/tests/contents/Makefile.am (EXTRA_DIST),
	tp/tests/contents/list-of-tests: remove contents_in_middle_section*,
	contents_in_middle_chapter*, contents_at_end* and most of tests
	involving double_contents.texi from tp/tests/contents/list-of-tests,
	put similar tests in tp/t/html_tests.t and move the Texinfo file
	accordingly.
	Tests using the book.init init file need to stay in
	tp/tests/contents/list-of-tests, for those tests, do not use the
	texi2html style anymore.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/indices/Makefile.am: remove reference to res_parser_info.

	* tp/tests/nested_formats/Makefile.am: replace *_parser_info by
	*_parser_html.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/contents/list-of-tests: remove no_content_setcatpage* tests
	that are redundant with no_content tests.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/contents/*.texi: remove @setfilename.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/t/40moresectioning.t: inline the
	contents_at_end_document_after_node, contents_at_end_document and
	contents_in_document tests.  Remove the Texinfo files.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (output, _html_set_pages_files): set
	element units next and prev in output and not in
	_html_set_pages_files, in order to do it even if the file is not set.

	* tp/t/40moresectioning.t, tp/Makefile.tres, tp/t/converters_tests.t,
	tp/tests/contents/list-of-tests: inline contents_at_document_begin.texi
	test in tp/t/40moresectioning.t.  Replace
	contents_at_document_begin.texi contents with the
	tests/contents/contents_at_begin.texi file contents, without
	@setfilename.  Add contents_at_document_begin,
	contents_at_document_begin_inline and
	contents_at_document_begin_separate_element tests in
	tp/t/converters_tests.t and remove the contents_at_begin,
	contents_at_begin_inline and contents_at_begin_info tests from
	tp/tests/contents/list-of-tests, since the tests in
	tp/t/converters_tests.t now test for much more.

2023-01-03  Gavin Smith  <gavinsmith0123@gmail.com>

	* Makefile.am (EXTRA_DIST): Distribute more recent ChangeLog.65
	and ChangeLog.70 as well as ChangeLog.46.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/40moresectioning.t: remove
	contents_no_section from 40moresectioning.t and the associated Texinfo
	file, as the test is redundant with contents_with_only_top_node in
	tp/t/30sectioning.t.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/30sectioning.t, tp/t/40moresectioning.t:
	move some tests from tp/t/30sectioning.t to tp/t/40moresectioning.t.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/30sectioning.t, tp/t/40moresectioning.t:
	move some tests from tp/t/30sectioning.t to tp/t/40moresectioning.t
	as part of an effort to reduce the size of 30sectioning.t.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/t/30sectioning.t: use files for the
	longuest codes and code needing escaping of ' or \, leading to three
	files, character_and_spaces_in_refs_text.texi,
	complex_sectioning_case.texi and section_in_unnumbered_text.texi.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/layout/list-of-tests: explicitly set TEXI2HTML style when
	needed, otherwise unset TEXI2HTML and set relevant customization
	variables explicitly.

	* tp/tests/layout/formatting_regions.texi: remove @setfilename

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/nested_formats/list-of-tests: use the default format and
	the html format, and unset TEXI2HTML such that the default format
	produces Info.  The html format des not use the texi2html style
	either.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/formatting/list-of-tests,
	tp/tests/nested_formats/list-of-tests,
	tp/tests/sectioning/list-of-tests: more explicit imprtant
	customization variables or options for the test.  Unset texi2html
	style for some tests.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/t/htmlxref.t: rename tp/t/94htmlxref.t as tp/t/htmlxref.t.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/t/94htmlxref.t: set 'FORMAT_MENU' once for all the tests, do not
	set explicitly 'NODE_FILES'.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/94htmlxref.t: do not use texi2html style,
	set explicitly the relevant customization variables.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Customizing Output File Names):
	tree_unit_file_name is only used for normal element units.

	* doc/texi2any_api.texi: other minor edits.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Customizing Special Elements Output Names):
	add a separate section for Special Elements Output Names.

	* doc/texi2any_api.texi (Customizing Special Elements Output Names)
	(Customizing Footnotes@comma{} Tables of Contents and About): document
	that the special elements element variety is available as 'extra'
	'special_element_variety' key.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/t/layout.t: rename tp/t/93layout.t as tp/t/layout.t.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/93layout.t, tp/tests/layout/list-of-tests:
	move navigation_test_misc_file_collision test to tp/t/93layout.t.
	Remove no_monolithic_only_toc_out test from
	tp/tests/layout/list-of-tests, it is in tp/t/93layout.t.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/t/init/only_toc_out.init: use the correct special element variety
	name.

	* tp/Makefile.tres, tp/t/93layout.t: add no_monolithic_only_toc_out
	test.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/t/30sectioning.t, tp/Makefile.tres, tp/t/92formatting.t:
	move split_for_format_not_split to 30sectioning.t.  Remove
	now empty tp/t/92formatting.t.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/t/92formatting.t, tp/Makefile.tres, tp/t/55conditionals.t:
	move cnd.texi related tests to 55conditionals.t.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/t/92formatting.t: explicit output format for all cond.texi
	tests.

	* tp/t/92formatting.t, tp/Makefile.tres, tp/t/converters_tests.t,
	tp/t/html_tests.t: move simplest_test_prefix* to converters_tests.t
	and move simplest_test_date_in_header and float_copying to
	html_tests.t

	* tp/Makefile.am (test_file), tp/t/02coverage.t: rename
	t/input_files/one_line_no_content.texi as
	t/input_files/minimal_only_input_line.texi.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/t/92formatting.t: remove texi2html style, and set corresponding
	customization instead.

2023-01-03  Patrice Dumas  <pertusus@free.fr>

	* tp/t/92formatting.t: remove texi2html style for cond.texi related
	tests, and remove some custmization variables set.

	* tp/t/input_files/cond.texi: add @top, move @node Top lower to have
	a preamble to test.

2023-01-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/92formatting.t,
	tp/t/info_tests.t: move direntry_dircategory, split_nocopying and
	split_nocopying_split to info_tests.t.  Use only
	tests/formatting/split_nocopying.texi and remove
	t/input_files/split_nocopying.texi.

2023-01-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/02coverage.t, tp/t/92formatting.t: move
	one_line_no_content and one_line tests from 92formatting.t to
	02coverage.t.

2023-01-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/80include.t:
	add test_two_include test in 80include.t which is an inlining of the
	t/input_files/test_two_include.texi file.  Remove
	t/input_files/test_two_include.texi.  Move version.texi from
	t/input_files/ to t/include/.
	Remove the t/input_files/unknown_nodes_renamed.texi and
	t/input_files/unknown_nodes_renamed-noderename.cnf unused files.

2023-01-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/92formatting.t:
	remove the documentlanguage_set_* tests and the
	documentlanguage_set.texi file.

	* tp/t/languages.t, tp/Makefile.tres: add tests of setting
	documentlanguage similar with tests removed from tp/t/92formatting.t
	but using ../../tests/formatting/documentlanguage.texi, which
	is more relevant.

2023-01-02  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (@shorttitlepage): Call \headingsoff
	within a group and reset page number with \pageone, as
	is done in @titlepage.  This stops page numbers appearing
	on the bastard titlepage or the verso.  Report from Arnold Robbins.

2023-01-02  Gavin Smith  <gavinsmith0123@gmail.com>

	* info/man.c (check_manpage_node): Revert to using "man -w"
	instead of "man --where" to work on FreeBSD and macOS.
	Disable this code if __sun is defined.  From Bruno Haible.

2023-01-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/Makefile.tres,
	tp/t/55conditionals.t, tp/t/92formatting.t,
	tp/tests/formatting/Makefile.am (EXTRA_DIST),
	tp/tests/formatting/list-of-tests: move defcondx_Dbar and
	defcondx_Ubar tests to tp/t/55conditionals.t.  Add also similar tests
	in tp/tests/formatting/list-of-tests to test the command line.  Move
	defxcond.texi to tp/tests/formatting/.

	* tp/Makefile.tres, tp/t/60macro.t, tp/t/92formatting.t:
	move glossary and texi_bib_example tests to 60macro.t, renaming
	texi_bib_example as bib_example.

2023-01-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/parser.c (raw_block_stack_top)
	(process_remaining_on_line): use the stack of raw block commands to
	determine the matching end of nested raw block command.

	* tp/Makefile.tres, tp/t/60macro.t: add simple_imbricated_macro_rmacro
	test.

	* tp/t/input_files/glossary.texi: use empty braces for calls of macros
	without arguments.

2023-01-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/Makefile.tres,
	tp/tests/layout/list-of-tests, tp/t/91morecoverage.t: move
	formatting_fr tests from tp/t/91morecoverage.t to
	tp/tests/layout/list-of-tests.  Remove the associated file, remove
	tp/t/91morecoverage.t.

2023-01-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (from_element_direction): use
	TOP_NODE_UP_URL in priority, even if the Up/NodeUp direction
	is set.

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/html_tests.t,
	t/96moresectioning.t: inline top_node_up_implicit and
	top_node_up_explicit tests from 96moresectioning.t in t/html_tests.t,
	adding variants with USE_NODES set to 0.  Remove the corresponding
	files.  Remove the now empty 96moresectioning.t file.

2023-01-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/96moresectioning.t, tp/t/html_tests.t:
	move node_footnote_use_node* tests and sectioning_frames from
	96moresectioning.t to html_tests.t.

2023-01-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/Makefile.tres,
	tp/t/96moresectioning.t: remove two_footnotes_in_nodes and
	two_footnotes_in_nodes_separated that are redundant with tests in
	03coverage_braces.t, and remove the associated Texinfo file.

	* tp/t/03coverage_braces.t: only do html_text output format test if
	not already doing html output format test.

2023-01-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm, tp/Texinfo/Convert/Converter.pm,
	tp/Texinfo/Convert/HTML.pm, tp/Texinfo/Convert/Utils.pm,
	tp/Texinfo/Structuring.pm, tp/Texinfo/Transformations.pm: avoid
	autovivification of extra key.

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/30sectioning.t,
	tp/t/96moresectioning.t: remove more_sections_than_nodes and
	placed_things_before_element from 96moresectioning.t as these tests
	are redundant with tests in 30sectioning.t.  Remove associated
	Texinfo files.
	In 30sectioning.t, set FORMAT_MENU to menu for
	placed_things_before_element, move more_sections_than_nodes to
	@info_tests and test texi2html style.

2023-01-02  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (unsplit, test): unsplit() returns if unsplitting
	was needed.  Rename $split as $test_split.  Add comments on
	re-splitting in tests.

	Add comments in other files.

2023-01-01  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/indices/Makefile.am (EXTRA_DIST, distclean-local): remove
	references to *_parser_info.

2023-01-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (converter_defaults)
	(_set_variables_texi2html): copy %defaults and modify the copy in
	_set_variables_texi2html() instead of changing the file global
	variable.

	* tp/Texinfo/Convert/HTML.pm (_convert_menu_entry_type): menu entry
	node 'normalized' may be undefined if it consists in spaces only.

	* tp/Makefile.tres, tp/t/30sectioning.t: new tests
	in_menu_only_special_ascii_spaces_node_menu and
	in_menu_only_special_spaces_node_menu with 'FORMAT_MENU' => 'menu'
	based on tests with menu entry nodes consisting only in spaces.

	* tp/Makefile.tres, tp/t/96moresectioning.t, tp/Makefile.am
	(test_files), tp/t/30sectioning.t: move
	nodes_after_top_before_chapter* and nodes_after_top_before_section*
	tests from t/96moresectioning.t to t/30sectioning.t, use the inline
	texts and remove the Texinfo files, and rename the tests with
	_texi2html added.

	* tp/Makefile.am (test_files), tp/t/96moresectioning.t: remove
	t/input_files/sectioning.texi, use only
	tests/sectioning/sectioning.texi.

2023-01-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/96moresectioning.t: do not use the texi2html
	style for node_footnote.texi related tests, instead set only the
	relevant customization variables.  Add a test with node_footnote.texi,
	split at node with separate footnotestyle.

2023-01-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/30sectioning.t,
	tp/t/96moresectioning.t: inline equivalent_nodes.texi in
	tp/t/30sectioning.t, renaming the corresponding test as
	equivalent_nodes_defined_linked.  Remove equivalent_nodes.texi and
	the tests in tp/t/96moresectioning.t.

2023-01-01  Patrice Dumas  <pertusus@free.fr>

	* tp/t/input_files/equivalent_nodes.texi: do not use a node before Top
	for this test, but, more simply a regular node.

2023-01-01  Patrice Dumas  <pertusus@free.fr>

	* tp/t/96moresectioning.t: remove specific variables set for PROGRAM,
	PACKAGE_URL and TEST.

2023-01-01  Patrice Dumas  <pertusus@free.fr>

	* tp/t/09indices.t: move $encoding_index_text near the associated
	tests.

2023-01-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/95moreindices.t, tp/t/09indices.t: merge
	tp/t/95moreindices.t with tp/t/09indices.t putting html file
	95moreindices.t tests in @test_html_file.

2023-01-01  Gavin Smith  <gavinsmith0123@gmail.com>

	* info/man.c (check_manpage_node): Use man --where instead of
	man -w to avoid clash with man program on Solaris, where -w
	means to update the whatis database.  Test failure on
	OpenSolaris 2022.10 reported by Bruno Haible.

2023-01-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/95moreindices.t:
	remove double_index_entry from t/95moreindices.t as there is a
	redundant test in tp/t/09indices.t.
	Rename tests such that the defaults are without suffix.

2023-01-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): use only
	one place in code to add the raw line in nested raw blocks.

2023-01-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (%parser_state_initialization),
	(_process_remaining_on_line, _end_line_misc_line, _parse_texi):
	rename conditionals_stack as conditional_stack to match XS parser.

2023-01-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (%parser_state_initialization)
	(_process_remaining_on_line, _parse_texi),
	tp/Texinfo/XS/parsetexi/parser.c (raw_block_stack)
	(push_raw_block_stack, pop_raw_block_stack, process_remaining_on_line)
	(parse_texi): use a stack, raw_block_stack for nested raw block
	commands instead of putting them in the tree.

2023-01-01  Patrice Dumas  <pertusus@free.fr>

	* tp/t/09indices.t, tp/Makefile.tres: add test with index_table with
	default customization, rename former index_table as
	index_table_chapter_no_node.  Add explicit split nodes for Plaintext
	testing for index_nodes.  Split @file_encodings_tests out of
	@file_tests.  In @file_tests, do only testing of Info if it is
	expected to be different from the base case.  Keep spaces at end of
	line in test text only.

2022-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/indices/list-of-tests: remove _info format tests as they
	are redundant with tests in t/*.t.

	* tp/tests/indices/list-of-tests: do not use the TEXI2HTML style
	for index_entries_relate_to_item test.

2022-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): read 'FORMAT_MENU' as a structuring
	option.  Only call Texinfo::Structuring::complete_node_tree_with_menus
	and Texinfo::Structuring::check_nodes_are_referenced if 'FORMAT_MENU'
	is set to menu.

	* tp/Makefile.tres, tp/t/30sectioning.t: add
	chapter_between_nodes_with_appendix and
	chapter_between_nodes_with_appendix_nomenu tests, in particular to
	have a case with Top next node automatic direction being determined 
	by the menu.

	* tp/t/10menu.t: remove 'FORMAT_MENU' => 'nomenu' from the
	converter/structuring options of simple_no_menu test, as it does not
	change the output.

2022-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/t/09indices.t,
	tp/tests/indices/Makefile.am (EXTRA_DIST),
	tp/tests/indices/list-of-tests: move
	index_special_region_no_insertcopying_html tests to tp/t/09indices.t.

2022-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (process_footnotes): handle the case
	of footnotes not associated with nodes.

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/09indices.t,
	tp/tests/indices/Makefile.am (EXTRA_DIST),
	tp/tests/indices/list-of-tests: move index_special_region tests to
	tp/t/09indices.t.

2022-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/indices/Makefile.am (EXTRA_DIST),
	tp/tests/indices/list-of-tests: remove index_special_region_no_region
	and index_special_region_no_region_html and the Texinfo file, as these
	are the same as index_special_region_no_insertcopying tests.

	* tp/tests/indices/index_special_region_no_insertcopying.texi:
	remove @setfilename.

2022-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (get_element_root_command_element)
	(_convert_printindex_command), doc/texi2any_api.texi (Target Commands
	Links@comma{} Texts and Associated Commands): add
	get_element_root_command_element to the API to return the element and
	root command associated to a tree element.  Use
	get_element_root_command_element in printindex conversion to determine
	the printindex root command target when there are no directions.

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/09indices.t,
	tp/tests/indices/Makefile.am (EXTRA_DIST),
	tp/tests/indices/list-of-tests: move index_no_node_no_top test to
	tp/t/09indices.t, add test with USE_NODES to the default value.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/converters_tests.t,
	tp/tests/indices/list-of-tests: add tests based on
	indices_in_begin_tables_lists.texi to tp/t/converters_tests.t to test
	no tree transformation and tree transformation separately.  Change
	HTML indices_in_begin_tables_lists.texi in tp/tests/indices/list-of-tests
	not to use the texi2html style.

	* tp/Makefile.tres, tp/t/info_tests.t, tp/tests/indices/Makefile.am
	(EXTRA_DIST), tp/tests/indices/list-of-tests: move index_one_node test
	to tp/t/info_tests.t and inline it.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/layout/list-of-tests: add 'Need collation compatibility'
	for two more tests.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (sort_indices): add comments on
	how to test compatibility of Unicode::Collate with tests.

	* configure.ac, tp/defs.in (PERL_UNICODE_COLLATE_OK), tp/t/09indices.t,
	tp/tests/run_parser_all.sh (check_unicode_collate_ok),
	tp/tests/layout/list-of-tests, tp/tests/tex_html/list-of-tests:
	Add a configure.ac test for perl 5.18.1 which seems to be the
	first compatible version with the tests results for test using Unicode
	collation.  Use that test result in run_parser_all.sh to skip tests
	with 'Need collation compatibility' put on their command line.
	Skip similarly tests in tp/t/09indices.t based on perl version too.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (sort_indices): give the 'UCA' => 22
	argument to Unicode::Collate to have a stable collation.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/09indices.t,
	tp/tests/indices/Makefile.am (EXTRA_DIST),
	tp/tests/indices/list-of-tests: move index_table test to
	tp/t/09indices.t, move the texinfo file too.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/09indices.t, tp/tests/indices/Makefile.am
	(EXTRA_DIST), tp/tests/indices/list-of-tests: move interesting
	index_and_node_same_name.texi and index_entry_in_footnote.texi
	related tests to tp/t/09indices.t and inline them, renaming
	index_entry_in_footnote as index_entry_in_footnote_sections, as
	already the index_entry_in_footnote very similar test.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/09indices.t, tp/tests/indices/Makefile.am
	(EXTRA_DIST), tp/tests/indices/list-of-tests: move
	printindex_between_node_section and printindex_between_part_chapter
	tests out of tp/tests/indices/list-of-tests to tp/t/09indices.t and
	inline them instead of using Texinfo files.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/09indices.t,
	tp/tests/indices/Makefile.am (EXTRA_DIST),
	tp/tests/indices/list-of-tests: move index_nodes.texi and related
	tests from tests/indices/list-of-tests to tp/t/09indices.t.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/indices/Makefile.am (EXTRA_DIST): remove the
	index_split.texi file in tp/tests/indices/, which is unused, and
	redundant with the one in tp/t/input_files/.  Also remove
	same_doc_nr_split_index_and_element.texi which does not seems to be
	used anywhere.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/indices/Makefile.am (EXTRA_DIST): remove the
	nodes_before_top_and_sections.texi file in tp/tests/indices/, which is
	now unused, and redundant with the one in tp/t/input_files/.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/95moreindices.t,
	tp/tests/indices/list-of-tests: add
	nodes_before_top_and_sections_chapter and
	nodes_before_top_and_sections_chapter_no_node tests to
	95moreindices.t, and remove the equivalent tests (which also used the
	texi2html style) from indices/list-of-tests.

2022-12-30  Gavin Smith  <gavinsmith0123@gmail.com>

	* README-hacking: mention help2man as a program the version of
	which is important for making a release.

2022-12-30  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.texi, doc/info-stnd.texi, doc/texi2any_api.texi:
	Adjust copyright notice slightly to match recommended wording.
	From Hilmar Preuße.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (HTML Customization Variables),
	tp/Texinfo/Convert/HTML.pm (%default, output)
	(_set_variables_texi2html), tp/t/95moreindices.t: set
	NODE_NAME_IN_INDEX based on USE_NODES is undef.  Move
	NODE_NAME_IN_INDEX documentation to HTML Customization Variables.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/t/95moreindices.t: do not set TEXI2HTML, instead set specific
	customization variable relevant for the test.

	* tp/tests/indices/nodes_before_top_and_sections.texi: correct
	@setfilename.
2022-12-29  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): update tree transformation names
	for relate_index_entries_to_items.

	* tp/t/transformations.t, tp/Makefile.tres: add tests using
	tests/indices/index_entries_relate_to_item.texi without and
	with the relate_index_entries_to_items transformation.

2022-12-29  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/indices/index_entries_relate_to_item.texi: add a
	@printindex.

	* tp/tests/indices/list-of-tests: remove --html from
	index_entries_relate_to_item such that there are both HTML and Info
	generated (even though we are mainly interested in HTML output).

2022-12-29  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/indices/index_entries_relate_to_item.texi: remove
	@setfilename, and @node Top and @top.

2022-12-29  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/indices/index_entries_relate_to_item.texi:
	add file on behalf of Arsen Arsenović, corresponding to
	the 2022-12-27  Arsen Arsenović entry.

2022-12-29  Patrice Dumas  <pertusus@free.fr>

	* doc/Makefile.am (TEXI2DVI_ENVIRONMENT): use braces instead of
	parentheses for variable names to ease cut and pasting to shell.

2022-12-29  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2oldapi.texi: add information in comments on how to
	process in source.  Fix to be processable.  More prominently
	state that the API description is obsolete and dates from 2010/2012.

2022-12-29  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (@command{texi2html}): remove reference to
	util/texi2html, as it has been removed.

2022-12-29  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (\defunargs): Wrap in a group to limit
	@var redefinition.

2022-12-29  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Makefile.am (dist-hook): Do not distribute architecture-
	dependent gettext_xs.o file.  Report from Hilmar Preuße.

2022-12-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm (_informative_command_output)
	(_latex_begin_output, _convert): add _informative_command_output
	that returns LaTeX output code for informative @-commands based
	on code in _convert, use it in _convert.  In _latex_begin_output
	also call _informative_command_output for informative commands
	that have a different customization option value from the LaTeX
	default.

	* tp/t/latex_tests.t, Makefile.tres: add
	customize_informative_commands test to test customization options for
	informative @-commands.

2022-12-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (%document_settable_multiple_at_commands):
	change some defaults, set utf-8 for documentencoding and set
	documentlanguage and micrtype undef.

2022-12-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (_informative_command_value): get information
	for line commands of type line, using the first args contents if it is
	text.

	* tp/Texinfo/Common.pm (set_informative_command_value),
	tp/Texinfo/Convert/LaTeX.pm (_convert): add a return
	status from set_informative_command_value(), true if the customization
	variable was set.  Output code related to a command associated to a
	customization variable in LaTeX only if the customization variable
	was set.

	* tp/Texinfo/Config.pm (set_conf), tp/Texinfo/Convert/Text.pm
	(set_conf): add a return status for consistency with
	Texinfo::Convert:Converter set_conf.

	* tp/t/latex_tests.t: add
	setchapternewpage_on_odd_titlepage_set_headings test, with headings
	customization variable set.

2022-12-29  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (@cartouche): Do not use @emph inside
	@cartouche argument as font styles do not accumulate in TeX output.

2022-12-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm (_begin_document): do not set
	$self->{'titlepage_done'}, it is not used anymore.

2022-12-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm (_latex_begin_output, _begin_document)
	(_set_chapter_new_page): initialize based on setchapternewpage and
	headings customization variables values.  Set headings off just before
	the titlepage, and reset afterwards to headings customization
	variables values.  Return headings set together with setchapternewpage
	to avoid setting headings again when initializing.
	Set headings each time after setting setchapternewpage.

2022-12-28  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (@code{@@headings}): Update now that @titlepage
	does not do "@headings on".

2022-12-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm (_begin_document): add a special page
	style for Table of Contents which only shows the page number, to avoid
	an ugly Chapter 0.  Set mainmatter after the Table of Contents.

2022-12-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (output, convert, _convert):
	do not use element units, simply convert the tree.  Sections closed by
	root commands do not span following nodes.

2022-12-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): check
	that a nested @macro is followed by space or at end of string.

	* tp/t/60macro.t, tp/Makefile.tres: add
	macro_imbricated_with_beginning_command_name test with an @-command
	beginning with @macro imbricated in @macro.

2022-12-28  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex, NEWS: Turn microtype off by default, for speed.

2022-12-27  Patrice Dumas  <pertusus@free.fr>

	update po files

2022-12-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line): add end of
	line if needed for nested @ignore with comment.

	* tp/Texinfo/XS/parsetexi/parser.c (read_comment): fix offset with
	@comment.  Skip the @ in comment command name.

	* tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line):
	put the correct string in @ignore comment.  Advance instead of exiting
	when there is a @ that is not a comment.

	* tp/Makefile.tres, tp/t/55conditionals.t: do not skip
	nested_ignore_with_comments.  Add comment without
	argument in @ignore line examples.  Add nested_ignore_comment_no_eol
	to test a very specific case of no end of line after nested @ignore
	and comment.

2022-12-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XSLoader.pm (init): show the DynaLoader error message
	if dl_load_file failed.

2022-12-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/end_line.c: defined floats lists related
	symbols to avoid non-defined symbols linking errors, even if there
	is no code run that uses those symbols.

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block):
	fix check of variadic flag and negation precedence.

	* tp/Texinfo/XS/parsetexi/parser.c (parse_texi): wipe input stack
	after getting the text after @bye.

	* tp/Texinfo/XS/parsetexi/api.c (build_global_info2),
	tp/Texinfo/XS/parsetexi/parser.c (register_global_command)
	(wipe_global_info): really register float as a global command.  Use
	floats for global_info for float as using float breaks, most likely
	because it is a type.

	* tp/Texinfo/Convert/NodeNameNormalization.pm (set_float_types):
	initialize $self->{'floats'}.

	* tp/Texinfo/XS/parsetexi/parser.c (read_comment),
	tp/Texinfo/XS/parsetexi/parser.c  (process_remaining_on_line):
	fix a one off string length error in read_comment.  Fix a typo
	in comments searching on nested @ignore line.  Avoid an infinite loop
	when there is a comment.

	* t/55conditionals.t: add nested_ignore_with_comments, skipped for now
	as the results are incorrect.

2022-12-27  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\indexnofonts): Remove superfluous space
	token recently added to definition by accident.

2022-12-27  Gavin Smith  <gavinsmith0123@gmail.com>

	No colour change for black links

	* doc/texinfo.tex (\setcolor) [pdfTeX]: Keep track of the current
	colour so that in the default case, when everything is black, there
	is no \mark output or pdf output, which is faster when the document
	contains many links.

2022-12-27  Arsen Arsenović  <arsen@aarsen.me>

	Re-enable copyable anchors in HTML output

	* tp/Texinfo/Common.pm (relate_index_entries_to_table_items_in_tree)
	(%valid_tree_transformations): Implement
	relate_index_entries_to_table_items, a transform that finds all
	table terms and associates their indices with them, so that the
	HTML backend generates a copyable anchor.

	* tp/texi2any.pl: Invoke the new
	relate_index_entries_to_table_items transform.
	(%formats_table): Enable the relate_index_entries_to_table_items
	transformation on HTML.
	* tp/tests/indices/list-of-tests (index_entries_relate_to_item):
	New test case.
	* tp/tests/indices/index_entries_relate_to_item.texi: New test file.

2022-12-27  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\definedummies, \indexnofonts):
	Extend dummy definitions in \definedummies to include the
	\indexnofonts expansions.  Always remove braces from
	arguments for dummied control words.
	
	(\atdummies, \indexnofonts):
	Give a suitable definition before using \macrolist to avoid
	user-defined @macro's repeatedly being given longer and longer
	definitions.

2022-12-27  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\definedummies): Remove dummies for
	internal commands to avoid need for redirection.
	(\atdummies): Call \turnoffactive rather than
	\normalturnoffactive followed by \otherbackslash, as this should
	do the same thing and is shorter.

2022-12-27  Gavin Smith  <gavinsmith0123@gmail.com>

	Switch for dummies

	* doc/texinfo.tex (\definedummies):
	Give control sequences alternate expansions depending on
	whether they are being expanded when being written to an
	auxiliary file, using \ifdummies and \ifindexnofonts
	conditionals.  Use @ as the escape character for dummy
	expansions.  Call \definedummies at the end of the file.
	This may make processing files faster due to less redefinitions
	being made.

	(\commondummiesnofonts): All redefinitions moved to \definedummies
	and macro removed.
	(\atdummies): Set \dummiestrue and inline what is left of
	the old definition of \definedummies.
	(\indexnofonts): Set \indexnofontstrue.  Definitions in
	\indexnofonts still override those from \definedummies.

2022-12-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_block_command),
	tp/Texinfo/XS/parsetexi/parser.c (read_comment)
	(process_remaining_on_line): handle nested @ignore.  Gavin report.
	Add read_comment() to get a comment, taken mainly from
	handle_block_command.

	* tp/t/55conditionals.t, tp/Makefile.tres: add test
	ignore_spaces_and_comments with comments and spaces on @ignore lines.

2022-12-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm (_latex_header), doc/texinfo.texi
	(@LaTeX{} Customization Variables), tp/Texinfo/Common.pm
	(@variable_string_settables): add experimental LaTeX documentclass and
	packages customization, using two customization variables,
	CLASS_BEGIN_USEPACKAGE and END_USEPACKAGE. 

2022-12-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): format @bye line
	similarly to other skipline @-commands.

2022-12-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (%type_elements, _convert),
	tp/Texinfo/ParserNonXS.pm (_parse_texi),
	tp/Texinfo/XS/parsetexi/element_types.txt,
	tp/Texinfo/XS/parsetexi/parser.c (parse_texi),
	tp/Texinfo/Convert/*.pm, util/texinfo.dtd: keep text appearing after
	@bye in the Texinfo Tree, as text_after_end in postamble_after_end
	container.  Add postamble_after_end as ignorable type in converters.

2022-12-27  Patrice Dumas  <pertusus@free.fr>

	* t/html_tests.t: fix incorrect braces nesting.

	* t/test_utils.pl: with -c do not add @bye even if it is not at
	the beginning of the line and if followed by @.

2022-12-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (sort_indices): when splitting at letters,
	determine letters by removing diacritics to associate accented letters
	to the main letter.

2022-12-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (setup_index_entry_keys_formatting): set
	sort_string option for conversion to text only if ENABLE_ENCODING is
	unset or encoding is not UTF-8.

2022-12-26  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Conditional Nesting): comment out text on @ignore
	line.

2022-12-26  Patrice Dumas  <pertusus@free.fr>

	Obey --disable-encoding/ENABLE_ENCODING for some conversions to text

	* doc/texi2any_api.texi (Command Tree Element Conversion Functions),
	tp/Texinfo/Convert/HTML.pm (%default_commands_args, _convert),
	tp/ext/epub3.pm (epub_convert_image_command): do not set
	copy_options_for_convert_text second argument for monospacetext, add
	filenametext for which the second argument of
	copy_options_for_convert_text is set and ENABLE_ENCODING is ignored.
	Update code to use filenametext if the output is a file name.

	* tp/Texinfo/Convert/LaTeX.pm (converter_initialize, _convert),
	tp/init/highlight_syntax.pm (highlight_process),
	tp/Texinfo/Convert/HTML.pm (_convert_def_line_type)
	(_external_node_href, output_internal_links, output): do not set the
	second argument of copy_options_for_convert_text to obey
	ENABLE_ENCODING for some conversions to plain text.

	* doc/texinfo.texi (Invoking @command{texi2any}),
	tp/Texinfo/Convert/Text.pm, tp/texi2any.pl: document that
	ENABLE_ENCODING is obeyed for some conversions to plain text and
	for index sorting.

2022-12-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/latex_tests.t: add a new test,
	indices_disable_encoding with the same text as indices, but with
	ENABLE_ENCODING set to 0.

	* t/include/text_only_image.txt: add to git.

2022-12-26  Patrice Dumas  <pertusus@free.fr>

	Set --enable-encoding to be the default for all output formats

	* tp/Texinfo/Common.pm (%default_converter_command_line_options),
	tp/Texinfo/Convert/TexinfoXML.pm (%defaults): set ENABLE_ENCODING
	to 1 in the default case for all the formats.

2022-12-26  Patrice Dumas  <pertusus@free.fr>

	* tp/t/latex_tests.t: in indices test, add simple entry with
	accented letters.

2022-12-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm (_latex_header): do not use noclearpage
	imakeidx option, as the index may not appear in that case, if at the
	end of the document.

2022-12-26  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex: Move more macros to be defined while \ is
	still the escape character, as this is easier to read.

2022-12-25  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex: Provide \ a definition again when Texinfo
	is not a preloaded format.

2022-12-25  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex: Use \everyjob to redefine backslash in
	case of preloaded Texinfo only.
	(\enablebackslashhack, \newlineloadsconf): Rename.
	Do not provide backslash with a definition here.  Capture end
	of line as an argument to avoid need for two-stage redefinition
	of newline.

	(\fixbackslash, \loadconf): Rename to \loadconf, as it is not
	used to fix backslash in the usual case where Texinfo is not
	preloaded.  Begin with \relax rather than space token to terminate
	filename.

2022-12-25  Patrice Dumas  <pertusus@free.fr>

	Use OUTPUT_CHARACTERS instead of --enable-encoding for XML-based and
	LaTeX

	* NEWS, doc/texinfo.texi (@code{@@documentencoding})
	(Other Customization Variables), tp/Texinfo/Common.pm
	(@variable_string_settables), tp/Texinfo/Convert/Converter.pm
	(xml_accents), tp/Texinfo/Convert/HTML.pm (_convert_accent_command)
	(_css_string_convert_accent_command, _convert_text)
	(converter_initialize), tp/Texinfo/Convert/LaTeX.pm
	(converter_initialize, copy_options_for_convert_to_latex_math)
	(_convert), /tp/Texinfo/Convert/TexinfoMarkup.pm (_convert):
	use the OUTPUT_CHARACTERS customization variable for HTML, XML,
	DocBook and LaTeX to determine if encoded characters are output
	instead of entities or macros.

	* t/09indices.t, tp/t/formats_encodings.t, tp/t/html_tests.t,
	tp/tests/layout/list-of-tests,
	tp/tests/many_input_files/different_encodings.sh: set
	OUTPUT_CHARACTERS in addition to ENABLE_ENCODING/--enable-encoding.

2022-12-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (convert_accents, xml_accents),
	tp/Texinfo/Convert/HTML.pm (_convert_accent_command)
	(_css_string_convert_accent_command),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): convert accents
	to encoded characters in convert_accents based on the third
	argument, instead of checking ENABLE_ENCODING.  Update callers.

2022-12-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (sort_indices): set variable collation
	elements to 'Non-Ignorable' such as to have spaces and punctuation
	marks sort before letters.

2022-12-25  Patrice Dumas  <pertusus@free.fr>

	Sort index entries using Unicode Collation in texi2any

	* tp/Texinfo/Structuring.pm (_collator_sort_string)
	(_sort_index_entries, sort_indices): use Unicode::Collate comparison
	for strings.

2022-12-25  Gavin Smith  <gavinsmith0123@gmail.com>

	Attempt to fix pre-dumped Texinfo

	* doc/texinfo.tex: Remove blank line from end of file.
	(\enablebackslashhack): Comment out ends-of-line.  This should
	stop \fixbackslash being run too early.
	(\fixbackslash): Start definition with a space token.

	This has been broken since at least 2017-04-17 when extra
	lines were added to \fixbackslash, so its likely that nobody
	is using Texinfo as a pre-dumped format.

2022-12-25  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex: Move definitions of \normaldot, \normalquest
	and \normalslash.  Call \setregularquotes near definition.

2022-12-25  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex: At end of file, move more definitions before
	the change from \ to @ as the escape character.
	(\normalturnoffactive, \turnoffactive): Define \normalturnoffactive
	in terms of \turnoffactive instead of vice versa.

2022-12-25  Gavin Smith  <gavinsmith0123@gmail.com>

	Reduce scope of catcode changes throughout texinfo.tex

	* doc/texinfo.tex: Surround character encoding definition macros
	in a group, define with \gdef and limit the catcode changes
	for non-ASCII characters to the group.  Move the use of
	@documentencoding to the very end of the file.

2022-12-25  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex: Remove "emacs-page" delimiter from the one
	place it occurs.  Remove vim shiftwidth definition from end of file.

2022-12-25  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex: Use definition of @documentencoding to
	fully set UTF-8 as the default encoding, including for XeTeX
	and LuaTeX.  Report from Werner.

2022-12-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_in_paragraph),
	tp/Texinfo/XS/parsetexi/handle_commands.c (in_paragraph):
	go to the container of the parent command when going through
	parent brace commands.

	* tp/t/08misc_commands.t: add indent_in_command_in_paragraph
	test with @indent and @noindent in an @-command in a paragraph.

2022-12-24  Patrice Dumas  <pertusus@free.fr>

	Warn that @indent and @noindent are useless inside paragraphs

	* tp/Texinfo/ParserNonXS.pm (_in_paragraph)
	(_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/handle_commands.c (in_paragraph)
	(handle_other_command): add in_paragraph that returns true if
	in a paragraph, including in a brace @-command except for a context
	brace command.  Use that function to warn if @indent or @noindent
	are in a pragraph.

2022-12-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm: cut at 80 columns, reindent.

2022-12-24  Patrice Dumas  <pertusus@free.fr>

	Warning for block commands without argument with an argument

	* tp/Texinfo/ParserNonXS.pm (_end_line_starting_block),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block):
	warn if a block command with 0 argument, and not a variadic command
	has arguments on the line.

2022-12-24  Patrice Dumas  <pertusus@free.fr>

	* doc/Makefile.am (TEXINFO_TEX): use in-source texinfo.tex.

2022-12-24  Patrice Dumas  <pertusus@free.fr>

	* NEWS: add title for @cartouche.

2022-12-23  Gavin Smith  <gavinsmith0123@gmail.com>

	Title for cartouche

	* doc/texinfo.tex (\cartouche): Define with \envparseargdef so
	to take an argument.  If argument is given, use it as a title for
	the box.
	(\envparseargdef): Define with \long.

	Feature request from Arnold Robbins.

2022-12-23  Patrice Dumas  <pertusus@free.fr>

	* .gitattributes: set tp/t/results/*/*.pl file always diff-able.

2022-12-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Info.pm (format_image): fix count of lines
	returned when there is an image text file.

2022-12-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Info.pm (format_image): avoid warnings about
	undefined values with @image with alt and text but no image file.

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/info_tests.t,
	tp/t/include/text_only_image.txt: new test
	image_text_file_only_and_alt with alt and text file but no image file.

2022-12-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/NodeNameNormalization.pm
	(normalize_transliterate_texinfo, transliterate_texinfo): modify
	transliterate_texinfo such that it only transliterates but does not
	protect characters, and add normalize_transliterate_texinfo for the
	previous behaviour.  Update callers.

	* tp/Texinfo/Convert/LaTeX.pm (_prepare_floats): transliterate the
	first float element type of a float type to set up the LaTeX float
	name to get more different categories when float type expands to
	non-ASCII characters.

	* tp/t/27float.t: expand LaTeX output for the float_with_at_commands
	test.

2022-12-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm (_prepare_floats): fix type filtering
	regex.

2022-12-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/NodeNameNormalization.pm (_parse_float_type):
	convert float type using NodeNameNormalization.pm
	convert_to_normalized().

	* tp/t/27float.t: new test special_characters_in_float_type.

2022-12-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/NodeNameNormalization.pm (_parse_float_type)
	(set_float_types), tp/Texinfo/ParserNonXS.pm (_end_line_misc_line)
	(_end_line_starting_block, _parse_texi),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (get_parser_info)
	(_set_errors_node_lists_labels_indices),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block)
	(end_line_misc_line), tp/Texinfo/command_data.txt: make float a global
	commmand. Move normalization of float type out of parsers to
	NodeNameNormalization.pm for future normalization using functions
	there.

2022-12-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm: cut at 80 columns better.

2022-12-22  Patrice Dumas  <pertusus@free.fr>

	Handle @float in @cartouche in LaTeX, where it cannot float

	* tp/Texinfo/Convert/LaTeX.pm
	(%LaTeX_non_floating_environment_commands, _latex_header)
	(_push_new_context, _convert): add a stack of commands in which
	there cannot be floats, non_floating_commands, for cartouche which
	uses mdframed.  In this context, use a no-op environment for float
	and \captionof of the caption package.

2022-12-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm (_push_new_context, _convert): carry
	formatted context over to float.

	* tp/Makefile.tres, tp/t/27float.t: add float_in_block_commands
	test.

2022-12-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm: reindent, cut at 80 columns,
	use scalar() explicitly.

2022-12-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (_convert): do not consider the
	cartouche title to be a paragraph, reset paragraph count to the value
	before the title.
	Do not set the text_element_context counter, as the title is on its
	own line.  Do not increase redundantly lines count.

	* tp/Makefile.tres, tp/t/02coverage.t: add cartouche_title_and_content
	new test with cartouche title and some content in the cartouche.

2022-12-21  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (@code{@@cartouche}): document the title argument
	of @cartouche.
	Describe that @cartouche can be used for to isolate a portion of the
	manual from the main flow, corresponding to the sidebar explanation in
	DocBook.

2022-12-20  Patrice Dumas  <pertusus@free.fr>

	Use @cartouche argument as cartouche title in texi2any

	* tp/Texinfo/Convert/DocBook.pm (_convert), tp/Texinfo/Convert/HTML.pm
	(_convert_cartouche_command, _convert), tp/Texinfo/Convert/LaTeX.pm
	(_set_environment_options), tp/Texinfo/Convert/Plaintext.pm
	(_convert), tp/Texinfo/Convert/TexinfoMarkup.pm
	(%commands_args_elements), tp/Texinfo/Convert/Text.pm (_convert),
	tp/Texinfo/command_data.txt, util/texinfo.dtd: add an argument to
	@cartouche.  Format the @cartouche argument as the cartouche title.
	Based on a report from Arnold Robbins.

	* tp/t/02coverage.t: add @cartouche argument in cartouche and
	comment_on_cartouche_line tests.

	* tp/tests/coverage_macro.texi: add @cartouche with argument.

2022-12-19  Werner Lemberg  <wl@gnu.org>

	* doc/texinfo.tex (\code, \dashnobreak): Use a \penalty to disable
	hyphenation for LuaTeX.

2022-12-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_convert): use <sidebar> for
	@cartouche. Based on a report from Arnold Robbins.

2022-12-17  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\-): Provide definition of @- to allow
	a hyphen to be printed for optional line breaks.  From Werner.

2022-12-17  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\code, \tclose): Comments changed.

2022-12-17  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\printdefunline): Call \defcharsdefault
	before creating the index entry in case it contains an ampersand
	or bracket.

2022-12-17  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\defindex, \defidx): Rename to
	\defidx to avoid clash with @defindex command.

2022-12-17  Gavin Smith  <gavinsmith0123@gmail.com>

	Turn off hyphenation for tt fonts completely.

	* doc/texinfo.tex (\setfont): Set \hyphenchar to -1 for
	font styles tt, ttb and ttsl.
	(\nohyphenation): Remove.
	(\key, \tclose, \verb): Do not call \nohyphenation.

	Werner reported that the restoration of \hyphenchar in
	\nohyphenation was wrong as it affected the wrong font.

2022-12-15  Gavin Smith  <gavinsmith0123@gmail.com>

	Configurable index for @def* command

	* doc/texinfo.tex (\defindex, \deftext): Define with \newtoks.
	(\defind): New macro to set \defindex and \deftext.  Call it
	instead of \doind throughout the definitions with \makedefun.
	(\printdefunline): Call \doind using the values that were set
	in \defindex and \deftext.
	(\useindex): Command to overrwrite \defindex value.

2022-12-15  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\dodefunx): Inline into use site in definition
	of \deffoox in \makedefun.  Do not reuse the definition of
	\deffoo manipulating its expansion with the \gobbledefun macro,
	as this was confusing and unnecessary.  No functional changes
	intended.

2022-12-14  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (PARAGRAPH):
	Rename 'protect_spaces' to 'no_break'.

2022-12-14  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/ParagraphNonXS.pm
	(set_space_protection, add_text): Rename 'space_protection' flag
	'no_break' to reflect its function.

2022-12-14  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/texi2any.pl <.info filename check>: Do not use /r flag
	for regex to work with older versions of Perl.

2022-12-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): add end of line
	for multitable with prototype interrupted by another @-command.

2022-12-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* info/util.c (text_buffer_iconv): Correctly update arguments
	for iconv in loop.  Crash for "info groff" reported by Jakub Wilk
	via Hilmar Preuße <hille42@web.de>.

2022-12-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): add end of line
	for block commands with missing args key, except for @def*, which have
	a special processing of their line.

2022-12-12  Patrice Dumas  <pertusus@free.fr>

	* tp/t/converters_tests.t: in form_feeds test, add more form feeds for
	@deffn command and add @deffnx command.

2022-12-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): use
	_leading_spaces_arg for def_line type.

2022-12-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert), util/txixml2texi.pl:
	always add end of line for the block command lines.

	* t/57invalid_nestings.t (@formatted_cases): add
	section_on_cartouche_line.

2022-12-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert), util/texinfo.dtd: if
	the @itemize or @*table command as argument was added, add a
	automaticcommandarg attribute set to on.

	* util/txixml2texi.pl: add a space after @*table and before the
	formatting command if there is not already one.

2022-12-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): do not add an
	entry for erroneous @itemx/@item/@tab constructs.

	* tp/t/57invalid_nestings.t: put itemx_in_itemize_enumerate_in_table
	in @formatted_cases, in particular to check XML output.

2022-12-11  Patrice Dumas  <pertusus@free.fr>

	* util/txixml2texi.pl: handle infoenclose.

2022-12-11  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/HTML.pm (%css_element_class_styles),
	(_convert_text) <in non breakable space>: Do not output
	<span class="w-nolinebreak-text"> element as it is not clear
	that it is needed to prevent breaking at - or _.

2022-12-11  Gavin Smith  <gavinsmith0123@gmail.com>

	Do not copy spaces exactly for @w

	* tp/Texinfo/XS/xspara.c (xspara_add_text) <protect_spaces>
	* tp/Texinfo/Convert/ParagraphNonXS.pm (add_text) <protect_spaces>:
	Change the meaning of this flag to match what @w does in
	texinfo.tex, which simply uses an \hbox for the content, but does
	not protect the spaces.  Do not use exactly the same spaces that
	were given in the input.  Accumulate spaces onto the end of the
	current word so that all spaces and words will be stuck together
	while in the mode and output together in the same line.
	* tp/t/paragraph.t: Manually update reference test results.

	The 'protect_spaces' flag is probably now misnamed.

2022-12-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): add multitable
	space after argument.

2022-12-11  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (xspara_add_text) <space>,
	* tp/Texinfo/Convert/ParagraphNonXS.pm (add_text) <space>:
	Remove extra call to _add_pending_word or xspara__add_pending_word.

2022-12-11  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (xspara_add_text): Make the same change
	so to mirror the structure of the Perl code.

2022-12-11  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/ParagraphNonXS.pm (add_text) <spaces>:
	Separate out code for 'unfilled' to make the rest of the code
	easier to understand.

2022-12-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): add a newline
	at the end of block command lines if there is none (case of another
	command interrupting the block command line).

2022-12-11  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/check_back_xml_forth_texi_t.sh: handle 3 digits in
	front of .t test file name.

2022-12-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): use directly
	the @node direction explicit args, reconstitute node and manual name
	only for automatic directions.

	* tp/t/57invalid_nestings.t: move on_node_line to @formatted_cases
	to output XML.

2022-12-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_starting_block),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block):
	more generic message when @*table argument is incorrect, separating
	missing and bad argument, and showing the argument in case of bad
	argument.

	* tp/Texinfo/XS/parsetexi/convert.c (expand_cmd_args_to_texi):
	add spaces_after_cmd_before_arg expansion.

2022-12-10  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert) <@tie>:
	Use add_next instead of add_text to add space, and do not
	use 'w' formatter stack or call set_space_protection.

2022-12-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_isolate_last_space),
	tp/Texinfo/XS/parsetexi/parser.c (isolate_last_space): do not set
	comment_at_end for brace commands.

2022-12-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert_argument_and_end_line)
	(_convert): convert comment_at_end from brace commands.

	* tp/t/30sectioning.t: output XML for empty_ref_arg test.

2022-12-10  Gavin Smith  <gavinsmith0123@gmail.com>

	&nbsp; for @verb

	* tp/Texinfo/Convert/HTML.pm
	(_convert): Use 'space_protected' context for @verb as
	well as for @w.  Do not use 'verbatim' context for @verb.
	This means that in _convert_text, spaces in the argument
	to @verb will be converted to &nbsp;.

2022-12-10  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\verb): Revert recent change, so that
	line breaks at spaces are not possible, for agreement with
	LaTeX \verb command and so that spaces in argument will always be
	apparent to the reader.

2022-12-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert), util/texinfo.dtd,
	util/txixml2texi.pl: add trailing spaces in block commands arguments.

	* tp/t/converters_tests.t (@test_cases):  add form feeds on @float
	line in form_feeds test.

	* tp/t/16raw.t: move spurious_arg_on_line, beginning_and_end_on_line
	and space_before_end from @test_invalid to @test_cases.  Output
	XML in @test_cases.

	* tp/t/08misc_commands.t: add XML output for
	codequoteundirected_codequotebacktick and
	comment_space_command_on_line tests.

	* tp/t/57invalid_nestings.t: move ignored_text from @test_cases
	to @formatted_cases.

	* tp/t/30sectioning.t: add XML output for node_up_external_node,
	space_in_node and next_no_prev_to_node.

2022-12-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): associate end
	space to the last empty argument if possible.

	* tp/t/27float.t: add XML output format to the tests.

2022-12-10  Gavin Smith  <gavinsmith0123@gmail.com>

	* install-info/install-info.c (error): Declare as static to
	avoid clash with error function from glibc, called from gnulib.
	Report from Sam James <sam@gentoo.org> and suggested solution
	from Arsen Arsenović <arsen@aarsen.me>.

2022-12-09  Patrice Dumas  <pertusus@free.fr>

	* tp/t/18itemize.t (@test_cases): add more tests of accents
	on @itemize lines in empty_accent_argument and accent_argument.

	* tp/t/22xtable.t (@test_cases): add more tests of accents
	on @table line in accent_on_table_line.

2022-12-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line):
	do not consider accent commands to be associated to @itemize
	or @*table.  End the line if there is an accent followed by
	end of line on a block command or line command.

2022-12-07  Patrice Dumas  <pertusus@free.fr>

	* tp/t/input_files/bib-example.texi: use @w{} to avoid mark command
	for @itemize.

	* tp/t/18itemize.t: add xml output for @test_cases.

2022-12-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (%no_arg_commands_formatting),
	util/texinfo.dtd: use &ampsymbol; for @& to avoid using the &amp;
	entity already used for & in text in XML.  &ampsymbol; ultimately maps
	to &amp; in DTD.

	* tp/tests/coverage_macro.texi: add @&.

2022-12-06  Patrice Dumas  <pertusus@free.fr>

	* tp/t/19def.t: move all_empty_def to @test_info and format to xml
	@test_info tests.

2022-12-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_def_line),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line): do not call
	abort_empty_line when processing the @def* line, there is no empty
	line to abort.

2022-12-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_merge_text): use explicitly scalar()
	for clearer code.

	(_isolate_last_space, _end_line_def_line): better debugging output.

2022-12-06  Patrice Dumas  <pertusus@free.fr>

	* tp/t/01use.t: update tree.  Do not use 'use vars'.

2022-12-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_def),
	tp/Texinfo/XS/parsetexi/def.c (next_bracketed_or_word_agg)
	(split_def_args, parse_def): remove code setting spaces_at_end on
	@def* lines, as it cannot happen anymore.  Remove use of spaces_at_end
	def line type.

	* tp/Texinfo/XS/parsetexi/def.c: remove unused next_bracketed_or_word
	function.

2022-12-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Transformations.pm (fill_gaps_in_sectioning): tree
	element added for new section more in line with current tree elements.

2022-12-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_starting_block): allow only
	one letter as @enumerate argument (same as XS parser).

2022-12-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_def_line),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line)
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/Convert/TextContent.pm (_convert): isolate last space
	on @def* command line similarly to other formats with
	isolate_last_space.

	* tp/Texinfo/ParserNonXS.pm (_isolate_last_space): check that there
	is content before trying to isolate last space.

	* tp/Texinfo/ParserNonXS.pm (_merge_text, _end_line_def_line)
	(_end_line_starting_block, _process_remaining_on_line): improve/add
	debug messages.

2022-12-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (_parent_string, debug_print_element_short)
	(debug_print_element): add an optional argument to
	debug_print_element_short to show the parent element name or type.

2022-12-05  Patrice Dumas  <pertusus@free.fr>

	* layout/list-of-tests: add layout formatting_info_disable_encoding
	test, testing Info output coverage with --disable-encoding.

2022-12-05  Patrice Dumas  <pertusus@free.fr>

	* doc/Makefile.am (TEXI2DVI, TEXI2DVI_ENVIRONMENT),
	doc/tp_api/Makefile.am (TEXI2DVI, TEXI2DVI_ENVIRONMENT): use in-source
	texindex and texi2dvi.

	* tp/Makefile.tres: update.

2022-12-04  Patrice Dumas  <pertusus@free.fr>

	* tp/t/57invalid_nestings.t: add tests of section command interrupting
	block command lines that requires gathering tree information,
	section_on_multitable_line, section_on_float_line,
	section_on_enumerate_line, section_on_xtable_line,
	and section_on_itemize_line.

2022-12-04  Patrice Dumas  <pertusus@free.fr>

	Gather tree information when closing incorrectly nested block command line

	* tp/Texinfo/ParserNonXS.pm (_close_current, _end_line_starting_block)
	(_end_line), tp/Texinfo/XS/parsetexi/close.c (close_current): when
	closing block_line_arg in close_current, use the same code as when
	closing at end of line, such as to gather all the information in the
	tree.

2022-12-04  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/tests/coverage,
	* tp/tests/coverage/list-of-tests,
	* tp/tests/coverage/formatting_utf8.texi: Remove.  list-of-tests
	only had one commented-out line.  formatting_utf8.texi was an
	old copy of layout/formatting.texi with an added
	"@documentencoding utf8" line.

2022-12-04  Patrice Dumas  <pertusus@free.fr>

	* util/texinfo.dtd: allow mixing *caption within float contents.  Fix
	email spaces attributes.

2022-12-04  Patrice Dumas  <pertusus@free.fr>

	* tp/t/converters_tests.t: add inlinefmtspaces, inlinerawspaces
	and inlineifsetifclearspaces, similar with other formatted tests but
	with soaces around arguments.

	* util/texinfo.dtd: fix the type of spaces attributes, @inline*
	arguments are optional.

2022-12-04  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (\pdflink) <XeTeX>: Fix definition.

2022-12-04  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/LaTeX.pm (_convert) <@verb>:
	Check \verb delimiter character is not used in contents,
	and change newlines to spaces.
	* tp/t/latex_tests.t (verb): New test.

2022-12-04  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\verb): Turn off hyphenation as this can
	introduce spurious hyphen glyphs in the output.  Allow breaking
	at spaces by using \obeyspaces rather than \sepspaces.  Do not
	obey line breaks, for consistency with HTML output.  Report from
	Werner.

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	* TODO: add @node and HTML splitting

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	Atomic dir update

	* install-info/install-info.c (output_dirfile):
	If rename to dir file failed, try deleting target file
	and try again.  From Eli.

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	Clickable section title in @contents for PDF

	* doc/texinfo.tex
	(\pdflinkpage): Generalise definition of \pdflink to take
	a link contents as well as a page number.
	(\iflinkentrytext): New conditional.
	(\startcontents): Set it.
	(\finishentry) [pdfTeX, XeTeX]: Use \pdflinkpage if \iflinkentrytext
	is true to allow clicking on the section title as well as the page
	number.

	(\shortchapentry, \shortunnchapentry, \dochapentry, \dosecentry,
	(\dosubsecentry, \dosubsubsecentry): Do not call \dopageno or
	\doshortpageno, as these surround the page number with TeX commands
	that get in the way in \pdflinkpage and appear to be unnecessary.
	(\dopageno, \doshortpageno): Remove.

2022-12-03  Patrice Dumas  <pertusus@free.fr>

	Gather tree information when closing incorrectly nested @def* lines

	* tp/Texinfo/ParserNonXS.pm (_close_current, _end_line_def_line)
	(_end_line), tp/Texinfo/XS/parsetexi/close.c (close_current),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line, end_line):
	when ending a @def*x? command line because it was interrupted or
	at the end of the file, use the same code as the code used at the
	end of line, put in the end_line_def_line() function to gather
	information on the line and separate arguments with roles.

	* tp/t/57invalid_nestings.t: move section_on_defx_line to
	@formatted_cases.

2022-12-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): ignore @def*
	arguments that have not been split off with a role added from the @def
	line args.

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	Run gnulib-tool --add-import mkstemp.

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	Atomic dir update

	* install-info/install-info.c (output_dirfile): Write to
	file created by mkstemp first, then rename this to the real
	output file. 
	* TODO: Remove item.

	Report from Pedrum Mohageri, bug-texinfo, November 2015.

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Directory Category), TODO: Do not refer
	to Free Software Directory categories.

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	* configure.ac: Do not add js/node_modules/.bin/ to program
	search path if the directory does not exist.

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/maintain/regenerate_file_lists.pl: Hardcode script name
	to be placed in Makefile.tres, so it will not change depending
	on where it was run from, e.g. from autogen.sh.

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	* configure.ac, util/texi2pdf, js/info.js: bump version to 7.0dev.
	* README-hacking: remove duplicate instruction

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/tests/run_parser_all.sh (post_process_output): Strip
	line with missing file error from logs for predictable results.

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/texi2any.pl: Strip directories from filename in warning for
	predicatable results in test suite.

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	* configure.ac (AM_INIT_AUTOMAKE): Remove dist-xz option for
	development as it is too slow.

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/texi2any.pl: Give a warning if input filename ends in '.info'.
	* NEWS, TODO: Update.
	* tp/tests/formatting/list-of-tests (info_extension_warning):
	New test.

2022-12-02  Gavin Smith  <gavinsmith0123@gmail.com>

	* NEWS, doc/texinfo.texi (Heading Generation, @headings)
	(Custom Headings): Update now that @titlepage does not do
	"@headings on".

2022-12-02  Gavin Smith  <gavinsmith0123@gmail.com>

	Make texi2dvi -t '@headings double' work

	* doc/texinfo.tex (\setchapternewpage): Call \HEADINGSon as
	we are not relying on it being called inside @titlepage any more.

2022-12-02  Gavin Smith  <gavinsmith0123@gmail.com>

	Make texi2dvi -t '@headings double' work

	* doc/texinfo.tex: Call \HEADINGSon to set headings from very start
	of file.
	(\titlepage): Call \headingsoff to turn off headings temporarily.
	Do not call \HEADINGSon as this may override a
	texi2dvi -t '@headings double' setting.  Reset page number with
	\pageone.

2022-12-02  Gavin Smith  <gavinsmith0123@gmail.com>

	* info/window.h: Eliminate #define used to use the same three fields
	in two different structures, as the comment explaining it took
	more space up than it would have taken simply to write the lines
	twice.

2022-12-02  Gavin Smith  <gavinsmith0123@gmail.com>

	* info/session.c (info_beginning_of_line): Avoid freezing
	at beginning of a file when 'nodeline' is set to 'pointers' (the
	default).  Report from Justin Anthony LaPolla <justin.lapolla@hpe.com>.

2022-12-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_format_columnfractions)
	(_convert): add a separate function to format columnfractions command,
	_format_columnfractions().  Use that function to format a bogus
	@columnfractions out of @multitable.

2022-12-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert), util/txixml2texi.pl,
	util/texinfo.dtd: use spacesaftercmd attribute for
	spaces_after_cmd_before_arg for accent commands too.

	* util/texinfo.dtd: add two-letter based index entries index commands.
	Add microtype.  Allow formfeed and verticaltab in menuleadingtext.
	Allow headingmark in style commands.  Add diverse space attributes in
	associated elements, in particular in brace commands.

2022-12-01  Patrice Dumas  <pertusus@free.fr>

	Protect spaces in space attributes in XML specific code

	* tp/Texinfo/Convert/TexinfoMarkup.pm,
	tp/Texinfo/Convert/TexinfoXML.pm (_xml_attributes): protect spaces
	in space attributes in format specific code.

2022-11-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/Convert/TexinfoXML.pm (_xml_attributes),
	util/txixml2texi.pl (unprotect_spaces): add attribute for
	spaces_after_cmd_before_arg info, protect special spaces in it
	and unprotect in txixml2texi.pl.

2022-11-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): add end lines
	after the closing markup element when @end is missing.

2022-11-30  Patrice Dumas  <pertusus@free.fr>

	Gather tree information when closing incorrectly nested line command

	* tp/Texinfo/ParserNonXS.pm (_close_current, _end_line_misc_line)
	(_end_line), tp/Texinfo/XS/parsetexi/close.c (close_current),
	tp/Texinfo/XS/parsetexi/end_line.c: when closing line_arg in
	close_current, use the same code as when closing at end of line,
	such as to gather all the information in the tree, in particular
	rearranging @end in block command and output all the error messages.

2022-11-30  Gavin Smith  <gavinsmith0123@gmail.com>

	* configure.ac (AM_INIT_AUTOMAKE): Remove 'readme-alpha' option,
	as we are using three-part version numbers that do not signify
	alpha releases.

2022-11-30  Gavin Smith  <gavinsmith0123@gmail.com>

	* NEWS: Add 7.0.1 news.

2022-11-29  Per Bothner  <per@bothner.com>

	* js/info.css (cache_index_links): Fix index entry processing.
	Also implement subentry handling.
	(init_iframe - on_load): Change search and call of cache_index_links.

2022-11-29  Per Bothner  <per@bothner.com>

	* js/info.css (.tex-input): Make input element a bit wider.
	This works better for longer index or menu names.

2022-11-29  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (output_texi_file): always add a newline in the
	end of the test Texinfo code.

2022-11-29  Patrice Dumas  <pertusus@free.fr>

	* util/txixml2texi.pl: avoid double comment for line specific command.

2022-11-28  Patrice Dumas  <pertusus@free.fr>

	Protect vertical tab in XML

	* tp/Texinfo/Convert/TexinfoMarkup.pm
	(_protect_in_spaces_attribute_text), tp/Texinfo/Convert/TexinfoXML.pm
	(_xml_attributes, _protect_text), util/txixml2texi.pl,
	util/texinfo.dtd: protect vertical tab U+000B as \v in attributes and
	with verticaltab added entities in other contexts.

2022-11-28  Patrice Dumas  <pertusus@free.fr>

	XML menu leading text and menu separator in elements instead of attributes

	* tp/Texinfo/Convert/TexinfoMarkup.pm (%type_elements, _convert),
	util/texinfo.dtd: put menu_entry_leading_text and menu_entry_separator
	types text in element rather than in attributes.  It is better to keep
	the structure and protect spaces more naturally.

	* util/texinfo.dtd: add endspace attribute for macro and rmacro.


2022-11-27  Per Bothner  <per@bothner.com>

	* js/info.js (on_link): Change query pattern for links.
	Use class printindex-index-section instead of printindex-index-entry
	to get the correct node URL.

2022-11-27  Per Bothner  <per@bothner.com>

	* js/info.js (set_current)url): Don't set parameter default.
	It's not needed, and it triggers an eslint complaint,
	because parameter default values were new in EcmaScript 6 (2015).

2022-11-27  Patrice Dumas  <pertusus@free.fr>

	* maintain/check_back_xml_forth_texi_t.sh: script to test conversion
	of tp/t/*.t Texinfo code to Texinfo XML and back to Texinfo to detect
	issues with Texinfo XML conversion and conversion back to Texinfo.

2022-11-27  Patrice Dumas  <pertusus@free.fr>

	* util/txixml2texi.pl: skip a comment after <columnfractions> as
	the comment is already in the line attribute.

2022-11-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): do not have
	an empty columnprototypes when there is an empty columnfraction,
	but only have a columnfraction.
	Avoid autovivification of extra columnfraction in case of empty
	columnfraction.

2022-11-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): correctly use
	_leading_spaces_arg return in case there is no space after @end
	command line and something else on the line.

2022-11-27  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (output_texi_file): encode to UTF-8 the resulting
	Texinfo file.  Only when the test texinfo comes from perl code and not
	when reading from a file as when reading from a file there is no
	decoding.

2022-11-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_gather_previous_item),
	tp/Texinfo/XS/parsetexi/multitable.c (gather_previous_item):
	Reparent trailing comments from before_item to table_term.

2022-11-27  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/tests/coverage_macro.texi: Readd removed content.  From
	Patrice.

2022-11-27  Gavin Smith  <gavinsmith0123@gmail.com>

	@itemx at beginning of table is an error

	* tp/Texinfo/ParserNonXS.pm (gather_previous_item),
	* tp/Texinfo/XS/parsetexi/multitable.c (gather_previous_item),
	NEWS: @itemx at beginning of table is an error, not a warning,
	as with recent changes this gives invalid HTML and DocBook output.
	Suggestion from Patrice.

2022-11-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (%default_converter_customization): update
	TEXINFO_DTD_VERSION to 7.1 to check more easily that tests are
	valid.

2022-11-26  Patrice Dumas  <pertusus@free.fr>

	* util/texinfo.dtd, configure.ac (TEXINFO_DTD_VERSION): add the
	index entries in tableterm before the @item.

2022-11-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_convert): output <term> when
	table_term container is seen and not for @item, to also enclose
	index entries in table_term before the @item (same as in html).

2022-11-26  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.texi: Move index commands before @item in @table
	throughout.

2022-11-26  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (gather_previous_item),
	* tp/Texinfo/XS/parsetexi/multitable.c (gather_previous_item):
	Reparent trailing index commands from before_item to table_term.

2022-11-26  Gavin Smith  <gavinsmith0123@gmail.com>

	Remove relate_index_entries_to_table_entries_in_tree

	* tp/Texinfo/Common.pm (texinfo_special_joint_transformation)
	(relate_index_entries_to_table_entries_in_tree): Remove.
	* tp/texi2any.pl: Do not use relate_index_entries_to_table_entries
	transformation for HTML or LaTeX.

2022-11-26  Patrice Dumas  <pertusus@free.fr>

	* doc/tp_api/Makefile.am (MAKEINFO): add -I $(top_builddir)/tp/
	to find Texinfo::ModulePath in out-of-source builds.  Report
	from Arsen Arsenović.

2022-11-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_table_term_type): add the
	<dt> in front in _convert_table_term_type.  Remove
	_open_table_term_type.

2022-11-26  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (gather_previous_item),
	* tp/Texinfo/XS/parsetexi/multitable.c (gather_previous_item):
	Leave trailing index entries if no command follows.
	* tp/t/22xtable.t (index_command_before_end_table): New test.

2022-11-26  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/t/22xtable.t (inter_item_commands_in_table): Move test
	here of @cindex directly between @item and @itemx.
	* tp/tests/coverage_macro.texi: Remove cases tested in t/22xtable.t.

2022-11-26  Gavin Smith  <gavinsmith0123@gmail.com>

	Output index anchors inside <dt>

	* tp/Texinfo/ParserNonXS.pm (gather_previous_item),
	* tp/Texinfo/XS/parsetexi/multitable.c (gather_previous_item):
	Do not absorb trailing index entries into a table_definition element.

	* tp/Texinfo/Convert/HTML.pm
	(_open_table_term_type): New function simply to output <dt>.  Add
	it to %default_types_open for 'table_term'.
	(_convert_table_term_type): Dummy function to enable
	_open_table_term_type.
	(_convert) <open type>: Concatenate any result from an "open type"
	handler rather than overwriting it.
	(_convert_item_command): Do not output '<dt>' for @item, as
	_open_table_term_type did this.  Output any index anchor immediately
	after the <dt> as an <a> element rather than setting an 'id' attribute
	on the <dt> tag.

2022-11-26  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (gather_previous_item):
	Use splice operation instead of moving items one by one when
	creating table_term element.  No functional changes intended.

2022-11-25  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (gather_previous_item),
	* tp/Texindo/XS/parsetexi/element_types.txt:
	Rename 'table_item' to 'table_definition'.

2022-11-25  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (_gather_previous_item),
	* tp/Texinfo/XS/parsetexi/multitable.c (gather_previous_item).
	* tp/Texinfo/Common.pm (_relate_index_entry_to_table_entry):
	Revert last change.

2022-11-22  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (_gather_previous_item),
	* tp/Texinfo/XS/parsetexi/multitable.c (gather_previous_item):
	Include index entries in table_term element.
	* tp/Texinfo/Common.pm (_relate_index_entry_to_table_entry):
	Look for index command in table_term rather than table_item.

2022-11-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (command_text, _convert_xref_commands)
	(_initialize_output_state): add 'referred_command_stack' to put
	commands that can be referred to being expanded, to catch if an @*ref
	refers to that command during the expansion, leading to an infinite
	recursion.  In that case, use the node instead of the section, as with
	nodes only it is not possible to construct a an infinite recursion
	as the node must both be a reference target and refer to a specific
	target at the same time, which is not possible.  Report from David
	Bacon.

2022-11-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_printindex_command): do not add
	an empty cell on the letter row.  That way it is possible to add
	a colspan or have only one cell.

2022-11-21  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (_gather_previous_item):
	Splice end of contents array instead of unshifting items from
	end one at a time.  No functional changes intended.  This should
	make it simpler to work forwards and find index commands
	immediately following @item and/or @itemx.

2022-11-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_printindex_command): remove
	span element used for index-entry-level-*, instead add the class to
	the td element.
	Remove classes for empty sectioning cells.
	Report from Per Bothner.

2022-11-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (output): create empty js files for
	tests.

2022-11-20  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/tests/layout/list-of-tests (formatting_epub_nodes):
	Set INFO_JS_DIR in order to exercise code.  From Patrice.

2022-11-20  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/HTML.pm (output) <INFO_JS_DIR>:
	Do not copy js files for tests.

2022-11-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%css_element_class_styles): increase
	index subentries indenting.  Suggestion from Raymond Toy.

2022-11-20  Gavin Smith  <gavinsmith0123@gmail.com>

	* js/info.js (on_load): Update version number.

2022-11-20  Gavin Smith  <gavinsmith0123@gmail.com>

	* README-hacking: info.js needs version update

2022-11-20  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/tests/layout/list-of-tests (formatting_epub_nodes):
	Do not set INFO_JS_DIR to avoid test result having to be
	updated every time one of the js files changes.

2022-11-20  Patrice Dumas  <pertusus@free.fr>

	* tp/DebugTexinfo/DebugTree.pm (_print_tree): use info element key
	instead of extra for information now associated to that key.

2022-11-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (output_internal_links): add subentries
	to index entries text.

2022-11-20  Gavin Smith  <gavinsmith0123@gmail.com>

	info.js improvements

	* js/info.css: No underlining for sidebar links.
	* js/info.js: Remove "Hide sidebar" text as it takes up too much
	space.

2022-11-20  Gavin Smith  <gavinsmith0123@gmail.com>

	* js/info.js (add_header): Check for h1.top after h1.settitle
	for text to put at top of sidebar.

2022-11-20  Gavin Smith  <gavinsmith0123@gmail.com>

	* js/info.js (init_iframe): Change selector for index entries
	to match new HTML output.  From Per and Patrice.

2022-11-20  Gavin Smith  <gavinsmith0123@gmail.com>

	* README-hacking: say to test JS interface manually before a release
	* README: list js/ directory here.

2022-11-20  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/HTML.pm (%defaults): Change INDEX_ENTRY_COLON
	from ':' to ''.  Suggestion from Patrice.

2022-11-18  Gavin Smith  <gavinsmith0123@gmail.com>

	* contrib/my-bib-macros.texi: Move here from web pages.

2022-11-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_printindex_command): use
	padding in CSS instead of non breaking space in a column to add
	a space between index entry and section or node in printindex HTML
	formatting.  Report from Per Bothner.

2022-11-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (comma_index_subentries_tree),
	tp/Texinfo/Convert/HTML.pm (_prepare_index_entries): use subentries
	to determine the identifier of an index entry.  Add an optional
	separator argument to comma_index_subentries_tree() to be able to
	use something else than a comma.  Use a space separator to determine
	the identifier to keep it shorter.

2022-11-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%css_element_class_styles): use
	padding-left instead of margin-left for index-entry-level-*, it
	is more appropriate.  Report from Per Bothner.

2022-11-19  Patrice Dumas  <pertusus@free.fr>

	* po_document/Makevars (XGETTEXT_OPTIONS): add --from-code=UTF-8
	for an non-ASCII encoded character in a comment in tp/ext/epub3.pm.
	Update po files.

2022-11-19  Patrice Dumas  <pertusus@free.fr>

	Add Pod/Simple/Texinfo.pm HTML output to wwwdoc

	* doc/Makefile.am (wwwdoc-build, wwwdoc-install): add
	Pod/Simple/Texinfo.pm HTML output, link Pod/Simple/Texinfo.pm and call
	pod2html such that a relative link to Pod/Simple/Texinfo.html is
	actually output.

2022-11-19  Patrice Dumas  <pertusus@free.fr>

	* doc/Makefile.am (po-check, po_document-check), README-hacking,
	po_document/POTFILES.in, tp/Texinfo/ParserNonXS.pm: add __p to
	po-check regexp, remove gdt.  Add po_document-check target similar
	to po-check for po_document/POTFILES.in.  Update po_document/POTFILES.in
	with the files found.
	In ParserNonXS.pm, add a useless $self argument to gdt( in comment to
	avoid getting caught in po_document-check.

2022-11-18  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/Makefile.am (wwwdoc-build): Pass --quiet flag to pod2html.

2022-11-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm, tp/Texinfo/Convert/Texinfo.pm,
	tp/Texinfo/Convert/TexinfoMarkup.pm, tp/Texinfo/ParserNonXS.pm
	(_isolate_last_space), tp/Texinfo/Transformations.pm,
	tp/Texinfo/XS/parsetexi/extra.c (add_info_element_oot),
	tp/Texinfo/XS/parsetexi/parser.c (isolate_last_space): move
	comment_at_end from extra to info in element.

2022-11-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Texinfo.pm, tp/Texinfo/Convert/TexinfoMarkup.pm,
	tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/element_types.txt,
	tp/Texinfo/XS/parsetexi/extra.c (add_info_string),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): rename
	spaces type used for spaces after command before argument or opening
	brace as spaces_after_cmd_before_arg and move it to info in element.

2022-11-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Texinfo.pm (_expand_cmd_args_to_texi): remove
	redundant conditions.

2022-11-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm, tp/Texinfo/Convert/Texinfo.pm,
	tp/Texinfo/Convert/TexinfoMarkup.pm, tp/Texinfo/ParserNonXS.pm
	(_parse_macro_command_line, _close_brace_command)
	(_process_remaining_on_line), tp/Texinfo/XS/parsetexi/close.c
	(close_brace_command), tp/Texinfo/XS/parsetexi/convert.c
	(expand_cmd_args_to_texi), tp/Texinfo/XS/parsetexi/handle_commands.c
	(handle_line_command), tp/Texinfo/XS/parsetexi/macro.c
	(parse_macro_command_line), tp/Texinfo/XS/parsetexi/parser.c
	(process_remaining_on_line), tp/Texinfo/XS/parsetexi/separator.c
	(handle_open_brace): move arg_line and @verb delimiter from extra to
	info in element.

2022-11-17  Gavin Smith  <gavinsmith0123@gmail.com>

	* info/t/recode-C-locale.sh: New test.

2022-11-17  Gavin Smith  <gavinsmith0123@gmail.com>

	* info/util.c (text_buffer_iconv): Avoid infinite loop
	by updating space left argument passed to iconv, and by
	continually expanding the allocated space in the output buffer
	if iconv continues to return E2BIG.
	Hang on UTF-8 encoded file with LC_ALL=C reported by
	Hilmar Preuße <hille42@web.de>.

2022-11-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm, tp/Texinfo/Convert/Texinfo.pm,
	tp/Texinfo/Convert/TexinfoMarkup.pm,
	tp/Texinfo/Convert/TextContent.pm, tp/Texinfo/ParserNonXS.pm,
	tp/Texinfo/Structuring.pm, tp/Texinfo/XS/misc.c (xs_abort_empty_line),
	tp/Texinfo/XS/parsetexi/convert.c (expand_cmd_args_to_texi)
	(convert_to_texinfo_internal),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command),
	tp/Texinfo/XS/parsetexi/parser.c (abort_empty_line)
	(isolate_last_space_internal): move spaces_before_argument and
	spaces_after_argument from extra to info key element hash.

	* tp/Texinfo/XS/parsetexi/extra.c (lookup_associated_info)
	(lookup_extra, lookup_info): add lookup_associated_info to lookup in
	an associated information structure.  Add wrappers for the info and
	extra structures.

	* tp/Texinfo/Convert/DocBook.pm (_convert): check 'args' and not
	'extra' to determine if there is a @quotation argument.

	* tp/Texinfo/ParserNonXS.pm (_end_line): remove extra element key if
	empty after removing incorrect command_as_argument.  Avoid
	autovivification.

2022-11-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm, tp/Texinfo/Convert/LaTeX.pm,
	tp/Texinfo/Convert/Plaintext.pm, tp/Texinfo/Convert/Plaintext.pm,
	tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/api.c (element_to_perl_hash),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block),
	tp/Texinfo/XS/parsetexi/extra.c (add_info_string_dup),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/tree.c (new_element, destroy_element):
	add an info hash to the tree elements, for information that can not
	be retrieved from the tree.  As a first information moved from
	extra to info, put the @value flag name for @value with unset flag.

2022-11-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/api.c (store_additional_info)
	(element_to_perl_hash), tp/Texinfo/XS/parsetexi/end_line.c
	(end_line_starting_block), tp/Texinfo/XS/parsetexi/extra.c
	(add_associated_info_key, lookup_extra),
	tp/Texinfo/XS/parsetexi/tree.c (new_associated_info, new_element)
	(destroy_associated_info, destroy_element),
	tp/Texinfo/XS/parsetexi/tree_types.h (ASSOCIATED_INFO): instead of
	putting the extra array, the number and space directly in the
	element, use a specific structure, ASSOCIATED_INFO to hold those
	three fields.  Replace add_extra_key by add_associated_info_key
	to associate information.  Add initialization, destruction,
	lookup based on the previous code associated to extra.

2022-11-15  Gavin Smith  <gavinsmith0123@gmail.com>

	* configure.ac: Use absolute path for checking for
	npm commands so that rules in js/Makefile.am work.

2022-11-15  Gavin Smith  <gavinsmith0123@gmail.com>

	* js/yarn.lock, js/server.js: Remove files.

2022-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Texinfo.pm (root_heading_command_to_texinfo):
	show node name as it appeared in the document.

2022-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (special_element_info)
	(_set_root_commands_targets_node_files)
	(_prepare_conversion_tree_units), tp/Texinfo/Translations.pm
	(complete_indices): sort for reproducible function returns
	and messages.

	* tp/Texinfo/Convert/Converter.pm, tp/Texinfo/Convert/HTML.pm,
	tp/Texinfo/Structuring.pm: avoid perl objects in debug messages,
	keeping the perl object name output messages in comments.

	* tp/Texinfo/Convert/HTML.pm (converter_initialize): avoid
	autovivification.

2022-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/command_data.awk: remove code for
	compatibility with old format.

2022-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Commands.pod, tp/Texinfo/Common.pm
	(_add_preamble_before_content),
	tp/Texinfo/XS/parsetexi/command_data.awk, tp/Texinfo/command_data.txt:
	add preamble flag in command_data.txt instead of determining the hash
	in Texinfo::Common.

2022-11-14  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm
	(_texinfo_handle_element_start, _texinfo_handle_element_end): use
	Texinfo::Commands::brace_code_commands.

2022-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm: do not reset simple_text_commands and
	plain_text_commands to full_text_commands.

	Add a check (not enabled) that all the commands that should have
	nesting checks do.

2022-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Commands.pod, tp/Texinfo/Common.pm,
	tp/Texinfo/XS/parsetexi/command_data.awk, tp/Texinfo/command_data.txt:
	move command classification out of Texinfo::Common to
	command_data.txt.  Filter out flags not relevant for the XS parser
	when generating command_data.c.
	Update callers.

2022-11-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (EXTRA_DIST), tp/Texinfo/XS/Makefile.am,
	tp/Texinfo/command_data.txt: move command_data.txt from
	tp/Texinfo/XS/ to tp/Texinfo/ since it is now used both in perl
	modules and in the XS parser.

2022-11-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files): add t/init/*.pm files.

2022-11-13  Patrice Dumas  <pertusus@free.fr>

	* util/texi2dvi (--expand): add --iftex and --no-ifinfo to
	makeinfo call.  Use -c TEXINFO_OUTPUT_FORMAT=plaintexinfo
	instead of --macro-expand=- to avoid the conversion to Info
	that could lead to irrelevant messages.

	* doc/texinfo.texi (Format with @command{texi2dvi} or
	@command{texi2pdf}): no more comments set by texi2dvi.

2022-11-13  Gavin Smith  <gavinsmith0123@gmail.com>

	* util/texi2dvi (--expand): Remove lengthy block of code
	using sed to comment out @tex blocks.  Suggestion from Patrice.
	* NEWS, TODO, README-hacking: update

2022-11-12  Werner Lemberg  <wl@gnu.org>

	* doc/texinfo.tex (\unicodechardefs): Add missing % after }.

2022-11-12  Werner Lemberg  <wl@gnu.org>

	* doc/texinfo.tex (\textdegree): Define using \tcfont to
	enable copying the right character from a PDF reader.

2022-11-12  Patrice Dumas  <pertusus@free.fr>

	* util/htmlxref.cnf: add manuals, in particular mono manuals
	and fix some issues with existing manuals. Report from Tzvetelin
	Katchov.
	Rename mairix manual as mairix-el, and smalltalk* manuals as
	gst*.

2022-11-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (\defmacro): Use \begingroup and
	\endgroup around code reading macro arguments, instead
	of \bgroup and \egroup, as the former do not form a
	"subformula" when used in math mode, which affects the
	spacing.  Suggestion from Vincent Lefèvre.

2022-11-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/gendocs.chapter/gendocs_template: New file.
	* doc/Makefile.am (wwwdoc-build): Use it for texi2any_internals
	manual, as default template does not handle chapter-split
	manuals.

2022-11-12  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (HTML Xref 8-bit Character Expansion):
	update codepoint in example of Xref with @point.

2022-11-12  Patrice Dumas  <pertusus@free.fr>

	Use U+22C6 for @point to get a smaller and more pointy star

	* NEWS, doc/texinfo.texi (HTML Xref Command Expansion),
	tp/Texinfo/Convert/Unicode.pm (%extra_unicode_map),
	tp/tests/coverage_macro.texi: use U+22C6 for @point both
	to get a star more in line with the star obtained with TeX
	also more similar to the asterisk also used, more pointy.
	This changes the HTML corss-references to nodes with @point.

2022-11-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* util/htmlxref.cnf (texi2any_internals): Remove node line
	to prefer split-by-chapter.

2022-11-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/Makefile.am (wwwdoc-build): Split texi2any_internals
	by chapter.  Report from Patrice.  Suppress Info node name
	warnings for texi2any_api and texi2any_internals.

2022-11-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* util/htmlxref.cnf (texi2any_internals): Add split-by-chapter
	line.  Report from Patrice.

2022-11-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* README-hacking: remove to-do item

2022-11-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* README-hacking: collect info on version update.  texi2dvi
	and texi2pdf uploads needed after version update.

2022-11-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* README-hacking, texindex/ti.twjr: Update year reported
	by texindex --version.

2022-11-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\textdegree, \unicodechardefs): Supply definition
	that looks better in a tt font.  Also work inside math.  Report from
	Werner.

2022-11-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* NEWS: correct spelling of "@definfoenclose" in most
	recent release announcement

2022-11-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Macro Details): Add problem with macro
	expansion inside of @math.  Report from Vincent Lefèvre.

2022-11-11  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\unicodechardefs): Use \arrow instead of
	\expansion for U+2192.  From Patrice.

2022-11-11  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/coverage_macro.texi: add UTF-8 encoded characters near to
	accented characters obtained with @-commands.

2022-11-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (%preamble_commands): fix typo on direntry
	command name.

	* tp/tests/layout/formatting.texi: add @latex \DeclareUnicodeCharacter
	for characters not in the default inputenc/fontenc.

2022-11-11  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/coverage_macro.texi: add UTF-8 encoded characters near to
	@-commands to be able to check visually the difference in formatting.

2022-11-10  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/Common.pm, tp/Texinfo/Convert/HTML.pm,
	tp/Texinfo/Convert/Utils.pm, tp/Texinfo/Translations.pm: edits
	translation comments for grammar.

	Update po files.

2022-11-10  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Translation Contexts): edit.

2022-11-10  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Translations Output and Customization):
	translated strings can also be specified for specific elements
	headings customization, refer to the node.

2022-11-10  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Customizing Footnotes@comma{} Tables of
	Contents and About, Special Element Body Formatting Functions):
	merge 'Common Customization of Special Elements' in 'Customizing
	Footnotes@comma{} Tables of Contents and About'.

2022-11-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_printindex_command): put
	hyperlink within span used for indentation of subentries.

2022-11-09  Gavin Smith  <gavinsmith0123@gmail.com>

	* configure.ac (AM_INIT_AUTOMAKE): Increase required automake
	version to 1.16.2.  From Patrice.

2022-11-09  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Translation Contexts),
	tp/Texinfo/Convert/HTML.pm (%direction_type_translation_context)
	(direction_string, special_element_info): add translation contexts
	for direction strings and special elements headings.

	* tp/Texinfo/Translations.pm (pgdt): find gdt() through the
	first argument object.

2022-11-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm, tp/Texinfo/Convert/LaTeX.pm,
	tp/Texinfo/Convert/Plaintext.pm, tp/Texinfo/Convert/Utils.pm: add
	comments for translators.

	Update po files.

2022-11-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (float_name_caption): remove useless
	end of lines in translated strings.  Add comments for translators.

	Update po files.

2022-11-08  Patrice Dumas  <pertusus@free.fr>

	* po_document/Makevars (XGETTEXT_OPTIONS): update pgdt order.

	* tp/Texinfo/Translations.pm (complete_indices): use '{name} of {class}'
	for index entry for @defcv too.

	Update po files.

2022-11-08  Patrice Dumas  <pertusus@free.fr>

	* po_document/Makevars (XGETTEXT_OPTIONS): add -cTRANSLATORS

	* tp/Texinfo/Common.pm (%def_map): add either a # TRANSLATORS:
	comment, or use pgdt to give context.  Use pgdt when the same string
	is used for different @-commands.
	Update test results as some translations are missing after getting
	a context.

2022-11-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Report.pm (line_warn, document_warn), tp/texi2any.pl
	(document_warn): remove \n from translated string marked for
	translation with __p.

2022-11-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/IXIN.pm, tp/Texinfo/Convert/TexinfoMarkup.pm,
	tp/Texinfo/Convert/Utils.pm: convert only if contents are defined,
	initialize contents if needed.

2022-11-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm (_prepare_conversion, _title_font)
	(_convert): convert only if contents are defined.

2022-11-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (sort_element_counts): use
	node name only if set.
	Add a space between sectioning command and @-command and name.

	* tp/texi2any.pl: fix SORT_ELEMENT_COUNT by requiring the correct
	module.

2022-11-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_convert): avoid formatting when
	contents is not set.

	* tp/Texinfo/Convert/Converter.pm (table_item_content_tree):
	explicitly handle undef $contents argument.

2022-11-08  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Adding Output Formats): Update name of
	texi2any_internals manual.
	* util/htmlxref.cnf: Add texi2any_api, texi2any_internals.

2022-11-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm: avoid formatting when contents
	is not set, avoiding a crash with empty @titlefont as title.

	* tp/Texinfo/Convert/Plaintext.pm (_convert): do not format
	author if there is no contents, this cannot happen for now but is more
	robust.

2022-11-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Info.pm (_convert): avoid crashes in case
	of empty arguments.

2022-11-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Info.pm (format_image): avoid crash on empty
	@image extension.  Report from Werner Lemberg.

2022-11-08  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/texi2any.pl: Call _encode_message on messages passed to
	"die" to avoid "Wide character in die" warning.  Report from
	Werner.

2022-11-05  Patrice Dumas  <pertusus@free.fr>

	Do not use FirstInFile in direction strings, document FirstInFile

	* tp/Texinfo/Convert/HTML.pm (direction_string): strip leading
	FirstInFile from direction when looking for the associated strings.

	* doc/texi2any_api.texi (Directions, Direction Strings): document
	directions with FirstInFile prepended.

2022-11-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (check_nodes_are_referenced): consider
	that a node is referenced if it appears in a manu that would be
	setup automatically.  That is if a node has automatic direction,
	no menu, all the children determined by automatic directions are
	considered to be referenced.
	(get_node_node_childs_from_sectioning): avoid spurious
	auto-vivification.

2022-11-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (pgdt): add pgdt that does nothing to
	be able to marks translated strings with a translation context.

2022-11-04  Patrice Dumas  <pertusus@free.fr>

	* NEWS: update with @subentry, @seealso and @seeentry formatting
	in HTML.

2022-11-04  Patrice Dumas  <pertusus@free.fr>

	Format index entry with @seealso or @seeentry in HTML

	* tp/Texinfo/Convert/HTML.pm (_convert_printindex_command):
	format entry with @seealso or @seeentry similarly with Texinfo
	TeX.

2022-11-04  Patrice Dumas  <pertusus@free.fr>

	Format @subentry in HTML similarly as in printed output

	* tp/Texinfo/Convert/Converter.pm (comma_index_subentries_tree),
	tp/Texinfo/Convert/HTML.pm (_convert_printindex_command):
	pass directly the first element with a possible subentry to
	comma_index_subentries_tree to be able to start frmo a subentry, not
	only from the main entry.
	Format subentries in HTML by indenting and not redoing the formatting
	of previous lines first levels, similar with Texinfo TeX.

2022-11-03  Patrice Dumas  <pertusus@free.fr>

	Also use subentries for index entries sorting in texi2any

	* tp/Texinfo/Structuring.pm (_sort_index_entries, sort_indices):
	collect subentries sorting keys and use them to sort the index
	entries.

2022-11-03  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Simple Customization for Commands Without
	Arguments), tp/Texinfo/Config.pm
	(texinfo_register_no_arg_command_formatting),
	tp/Texinfo/Convert/HTML.pm (_translate_names): allow to set
	a Texinfo code to be translated and converted as command without
	arguments output.

2022-11-02  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Simple Navigation Panel Customization):
	describe ACTIVE_ICONS and PASSIVE_ICONS more explicitly.

2022-11-02  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Simple Navigation Panel Customization):
	add CHAPTER_FOOTER_BUTTONS, update explanations.

2022-11-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm (%LaTeX_encoding_names_map)
	(_latex_header): associate both a fontenc and an inputenc to
	an encoding.
	Separate the 'fixed' part of the LaTeX use package part of preamble at
	the beginning, including inputenc and fontenc and the usepackage
	lines determined by the use of Texinfo commands.

2022-11-01  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (@command{texi2html}): update now that translated
	strings customization is done.

	* doc/texi2oldapi.texi: update to expand history to the point where
	the texi2html implementation was abandonned.  Mark that the part on
	the early texi2any API has been obsoleted by texi2any_api.

2022-11-01  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Common Customization of Special Elements)
	(Special Elements Information Customization)
	(Special Element Body Formatting Functions), tp/Texinfo/Common.pm
	(@variable_other_settables), tp/Texinfo/Config.pm
	(_GNUT_initialize_special_element_info)
	(texinfo_register_special_element_info,
	GNUT_get_special_element_info), tp/Texinfo/Convert/HTML.pm
	(special_element_info, _translate_names, converter_initialize):
	change information on special elements to be set with a function,
	texinfo_register_special_element_info in Texinfo::Config, retrieved in
	the Converter with GNUT_get_special_element_info, instead of using
	customization variables.  Add the special_element_info function to
	retrieve the special elements information in the HTML Converter,
	translating special element headings only when needed.  Allow special
	element headings and targets to be undef.
	Remove SPECIAL_ELEMENTS_HEADING, SPECIAL_ELEMENTS_CLASS,
	SPECIAL_ELEMENTS_DIRECTIONS, special_elements_targets,
	special_elements_file_string and special_elements_order customization
	variables.

2022-10-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_special_elements): for
	special elements order, use a hash with indices to be used to order
	the special elements instead of an array.  More code, but much easier
	to customize/modify.

2022-10-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm: remove 'Top' from %defaults
	'special_elements_targets', instead hardcode the empty @top target in
	the code.

2022-10-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_load_htmlxref_files): do not
	set htmlxref_files converter state, use a regular array.

	* tp/Texinfo/Convert/HTML.pm (_external_node_href): remove
	_htmlxref, access directly the 'htmlxref' converter state.

2022-10-31  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Translated Strings Customization),
	tp/init/documentation_examples.pm (my_format_translate_string):
	add translation strings customization example in
	documentation_examples.pm and fix in manual.

2022-10-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Config.pm (texinfo_register_direction_string_info):
	set converted string structure only if the argument is defined.

2022-10-30  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Direction Strings Customization)
	(Getting Direction Strings), tp/Texinfo/Config.pm
	(texinfo_register_direction_string_info), tp/Texinfo/Convert/HTML.pm
	(direction_string, converter_initialize): add context information to
	direction strings customization to be able to convert in string
	and in normal context.  Update calls of direction_string() to use the
	string context for strings that end up in attributes.

2022-10-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Translations.pm (gdt, replace_convert_substrings):
	Split replace_convert_substrings out of gdt, corresponding to the
	substitution of replaced_substrings and conversion to Texinfo
	tree.

	* doc/texi2any_api.texi (Internationalization of Strings Function)
	(Translations Output and Customization)
	(Translated Strings Customization): add a whole chapter on
	strings internationalization, grouping Internationalization of Strings
	Function and information formerly in Basic Formatting Customization.

	* tp/t/test_utils.pl (test), tp/Texinfo/Config.pm
	(_GNUT_initialize_stage_handlers)
	(_GNUT_initialize_no_arg_commands_formatting_strings)
	(_GNUT_initialize_style_commands_formatting_info)
	(GNUT_reinitialize_init_files): add initialization of init files
	information in Texinfo::Config to isolate tests.

2022-10-29  Patrice Dumas  <pertusus@free.fr>

	Add customization of translated strings

	* doc/texi2any_api.texi (Internationalization of Strings Function)
	(Basic Formatting Customization), tp/Texinfo/Convert/HTML.pm (gdt):
	override Texinfo::Translations gdt to call format_translate_string
	user-defined formatting reference if the formatting reference is
	defined.
	Document more arguments of gdt, as they are also used for
	format_translate_string.

2022-10-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (direction_string, _translate_names):
	translate direction strings only when needed and cache them
	afterwards.  Remove the contents of the translated direction
	string types in _translate_names such that they will be re-translated
	in the next direction_string call.

2022-10-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_informative_command, _convert):
	call _translate_names() after documentlanguage conversion in converter
	code instead of calling in conversion function.

2022-10-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_translate_names): update gdt call.

2022-10-29  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Element Direction Information Type)
	(Direction Strings, Getting Direction Strings), tp/Texinfo/Common.pm
	(@variable_other_settables), tp/Texinfo/Config.pm
	(texinfo_register_direction_string_info)
	(GNUT_get_direction_string_info), tp/Texinfo/Convert/HTML.pm
	(direction_string, _translate_names, converter_initialize)
	(_initialize_output_state): change customization of direction strings
	to be set with texinfo_register_direction_string_info, retrieved in
	the converter by GNUT_get_direction_string_info, translated when
	needed and retrieved in formatting code with direction_string, instead
	of using curtomization variables.  Remove the customization variables
	BUTTONS_TEXT, BUTTONS_NAME, BUTTONS_GOTO, BUTTONS_REL,
	BUTTONS_ACCESSKEY, BUTTONS_EXAMPLE.  Update functions that used the
	BUTTONS_* customization variables.

	* tp/Texinfo/Convert/HTML.pm (ACTIVE_ICONS, PASSIVE_ICONS): do not
	initialize ACTIVE_ICONS and PASSIVE_ICONS to empty strings, instead
	set to undef the customization variables as a whole.

2022-10-27  Patrice Dumas  <pertusus@free.fr>

	Add optional translation context for in-document string translations

	* doc/texi2any_api.texi (Internationalization of Strings Function),
	tp/Texinfo/Translations.pm (gdt, pgdt), po_document/Makevars
	(XGETTEXT_OPTIONS), tp/Texinfo/Convert/HTML.pm (_translate_names):
	add a translation context argument to gdt() and add pgdt() which
	has the translation context as first argument.
	Update po_document/Makevars to have pgdt arguments in the correct
	order.

2022-11-07  Gavin Smith  <gavinsmith0123@gmail.com>

	* README-hacking: new ChangeLog file done


Copyright 2022-2024 Free Software Foundation, Inc.

Copying and distribution of this file, with or without modification,
are permitted in any medium without royalty provided the copyright
notice and this notice are preserved.


texindex originally had its own ChangeLog, the contents whereof are moved here:

2019-05-19         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Prose updates.

2019-05-14         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Typo fixes in main menu.

2019-05-12         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Add escape function and call, fixes things when
	backslash is the command character.  Remove @code around the
	names of the nodes for the helper functions.
	* jrweave: Merge with latest version in TexiWeb Jr. (This
	version use @subentry.)

2019-04-11         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Update about testing - works on 5 different awks!

2019-04-10         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Simplify comparison algorithm.

2019-04-09         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Final polish.

2019-04-08         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Lots of polish.

2019-04-07         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Improve commentary on sorting. Index TRUE and FALSE.
	Make fatal() function more portable.

2019-04-05         Arnold D. Robbins     <arnold@skeeve.com>

	* jrweave: Use @sortas for chunk index entries to avoid < and >.
	Use @subentry also.
	* ti.twjr: Print see also after page numbers. Adjust logic and
	sorting.

2019-04-03         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Revise sorting to use the subkeys.
	Add `@set txiindexlessthanignore'.

2019-04-01         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Finish adding indexing of program variables etc.
	* jrweave: Fix 'do not edit' banner.
	* ti.twjr: Bug fixes in page numbers, seealso mixed with multilevel
	entries.

2019-03-28         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Lots of polish to code and doc. Almost done.
	* ti.twjr: Make sure all chunk names start with an upper case
	letter.

2019-03-27         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Finish up new code. Some initial testing.
	* jrweave, jrtangle: Update to latest versions.

2019-03-25         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Rearrange, start on line parsing.

2019-03-18         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Finish up printing code.

2019-03-17         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Reformat code.

2019-03-15         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Outline algorithm for printing entries.

2019-03-14         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Very initial start at printing entries.

2019-03-13         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Pretty much finish off the requirements chapter.

2019-03-12         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Started expansion of requirements chapter.

2019-03-08         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Fix "the the", http --> https, remove unnecessary
	semicolons, add History section. Remove references to unimplemented
	-o option.

2019-03-06         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Add Command_char to list of special characters.

2015-02-27         Arnold D. Robbins     <arnold@skeeve.com>

	* jrweave, jrtangle: Updated to current version. In particular,
	jrtangle should work out of the box on Windows, thanks to
	Eli Zaretskii.

2015-01-08  Karl Berry  <karl@gnu.org>

	* version.texi: remove, no easy way to automatically update it.
	* ti.twjr,
	* Makefile.am (do_subst, texindex.awk, ti.texi): use substitutions
	for @VERSION@ and @UPDATED@ instead.

	* texindex.in: also look for ../share/texinfo/texindex.awk,
	relative to dirname $0.

	* ti.twjr (Invocation_name): new global, renamed from Prgname.
	(usage): use it, a la coreutils.
	* texindex.in: pass it (value $0), with -v.
	
	* Makefile.am (EXTRA_DIST): dek_idx.png rename.

2015-01-06  Karl Berry  <karl@gnu.org>

	first merge into automake:
	* texindex/Makefile.am: new file.
	* texindex/texindex.in: new file.
	* texindex/README: update.
	(see also ../ChangeLog.)

2014-12-30         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Remove `@xrefautomaticsectiontitle on'. It's now
	supplied by jrweave.
	* jrweave: Updated.

2014-12-26         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Restore use of `@xrefautomaticsectiontitle on'.
	And restore support for vim editing.

2014-12-15  Karl Berry  <karl@gnu.org>

	* ti.twjr: convert to minimal Texinfo conventions
	instead of Arnold's published-book conventions.

2014-12-13         Arnold D. Robbins     <arnold@skeeve.com>

	* jrtangle, jrweave: Updated with versions that include
	github location.

2014-08-07         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Typo fix in an index entry. Change the update month
	and increase version to 0.95.

2014-05-30         Arnold D. Robbins     <arnold@skeeve.com>

	* README: New file.
	* tests: New directory with some regression tests.
	* jrtangle, jrweave: Copied from TexiWebJr to have standalone.

	*****

	* All: Pushed to https://github.com/arnoldrobbins/texindex.

2014-04-26         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Remove summaries appendix. Not needed with better
	formatting from jrweave.  Bump version to 0.94.

2014-04-16         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Bug fix. Multiple files had junk in second and
	subsequent output files. Needed to clear out more data between
	files. Bump version to 0.93.

2014-03-21         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: General cleanup and finalizatio of the text. Bump
	version to 0.92.

2014-03-17         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Fix case in chunk names.

2014-03-14         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Add a few commands to make the PDF nicer.

2014-03-04         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Polished up. Add an XKCD cartoon. Bump version to 0.9.
	* donald_knuth.jpg: New file.

2014-03-03         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Rework where initial extraction is done. Set up to
	produce \{ and \}. Works when used with itself to sort the
	index!  Woo hoo!

2014-02-27         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Revise extraction of the initial as per Karl.
	Still needs more documentation but I think we've hit
	functionally complete.

2014-02-26         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Sorting in and seems to work well. Still need to add
	more descriptive prose.  Did some cleanup and added menus.

2014-02-25         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr: Just about done, except for sorting.

2014-02-24         Arnold D. Robbins     <arnold@skeeve.com>

	* ti.twjr, texinfo.tex, Makefile: Initial check-in.

Copyright 2014, 2015 Free Software Foundation, Inc.

Copying and distribution of this file, with or without modification,
are permitted in any medium without royalty provided the copyright
notice and this notice are preserved.

